<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Architecture OverviewA distributed pressure testing system leverages multiple client nodes coordinated through Apache Zookeeper to generate high-concurrency load against target services. This architec">
<meta property="og:type" content="article">
<meta property="og:title" content="Design Distributed Pressure Test Tool By Zookeeper">
<meta property="og:url" content="https://shayne007.github.io/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="Architecture OverviewA distributed pressure testing system leverages multiple client nodes coordinated through Apache Zookeeper to generate high-concurrency load against target services. This architec">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-29T08:46:34.000Z">
<meta property="article:modified_time" content="2025-06-29T08:49:43.160Z">
<meta property="article:author" content="Charlie Feng">
<meta property="article:tag" content="system-design">
<meta property="article:tag" content="pressure test">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/","path":"2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/","title":"Design Distributed Pressure Test Tool By Zookeeper"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Design Distributed Pressure Test Tool By Zookeeper | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Architecture-Overview"><span class="nav-number">1.</span> <span class="nav-text">Architecture Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-Components-Design"><span class="nav-number">2.</span> <span class="nav-text">Core Components Design</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ClientTestNode-Architecture"><span class="nav-number">2.1.</span> <span class="nav-text">ClientTestNode Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MasterTestNode-Coordination"><span class="nav-number">2.2.</span> <span class="nav-text">MasterTestNode Coordination</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Metrics-Collection-and-Statistical-Analysis"><span class="nav-number">3.</span> <span class="nav-text">Metrics Collection and Statistical Analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Core-Metrics-Implementation"><span class="nav-number">3.1.</span> <span class="nav-text">Core Metrics Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-time-Metrics-Aggregation"><span class="nav-number">3.2.</span> <span class="nav-text">Real-time Metrics Aggregation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scalability-and-High-Concurrency-Support"><span class="nav-number">4.</span> <span class="nav-text">Scalability and High Concurrency Support</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynamic-Client-Scaling"><span class="nav-number">4.1.</span> <span class="nav-text">Dynamic Client Scaling</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Auto-scaling-Strategy"><span class="nav-number">4.2.</span> <span class="nav-text">Auto-scaling Strategy</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dashboard-and-Visualization"><span class="nav-number">5.</span> <span class="nav-text">Dashboard and Visualization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-time-Dashboard-Architecture"><span class="nav-number">5.1.</span> <span class="nav-text">Real-time Dashboard Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Frontend-Dashboard-Implementation"><span class="nav-number">5.2.</span> <span class="nav-text">Frontend Dashboard Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Production-Deployment-and-Best-Practices"><span class="nav-number">6.</span> <span class="nav-text">Production Deployment and Best Practices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Containerized-Deployment"><span class="nav-number">6.1.</span> <span class="nav-text">Containerized Deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-Deployment"><span class="nav-number">6.2.</span> <span class="nav-text">Kubernetes Deployment</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Cases-and-Practical-Examples"><span class="nav-number">7.</span> <span class="nav-text">Use Cases and Practical Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#E-commerce-Platform-Load-Testing"><span class="nav-number">7.1.</span> <span class="nav-text">E-commerce Platform Load Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Microservice-Circuit-Breaker-Testing"><span class="nav-number">7.2.</span> <span class="nav-text">Microservice Circuit Breaker Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-Features-and-Optimizations"><span class="nav-number">8.</span> <span class="nav-text">Advanced Features and Optimizations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Intelligent-Load-Distribution"><span class="nav-number">8.1.</span> <span class="nav-text">Intelligent Load Distribution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Predictive-Scaling"><span class="nav-number">8.2.</span> <span class="nav-text">Predictive Scaling</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Monitoring-and-Observability"><span class="nav-number">9.</span> <span class="nav-text">Monitoring and Observability</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Comprehensive-Monitoring-Stack"><span class="nav-number">9.1.</span> <span class="nav-text">Comprehensive Monitoring Stack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alert-Configuration"><span class="nav-number">9.2.</span> <span class="nav-text">Alert Configuration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-Considerations"><span class="nav-number">10.</span> <span class="nav-text">Security Considerations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Authentication-and-Authorization"><span class="nav-number">10.1.</span> <span class="nav-text">Authentication and Authorization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Secure-Zookeeper-Communication"><span class="nav-number">10.2.</span> <span class="nav-text">Secure Zookeeper Communication</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interview-Questions-and-Insights"><span class="nav-number">11.</span> <span class="nav-text">Interview Questions and Insights</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Q-How-do-you-ensure-test-result-accuracy-when-client-nodes-join-leave-during-testing"><span class="nav-number">11.1.</span> <span class="nav-text">Q: How do you ensure test result accuracy when client nodes join&#x2F;leave during testing?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Q-What-strategies-handle-network-partitions-between-client-nodes-and-Zookeeper"><span class="nav-number">11.2.</span> <span class="nav-text">Q: What strategies handle network partitions between client nodes and Zookeeper?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Q-How-do-you-prevent-the-%E2%80%9Cthundering-herd%E2%80%9D-problem-when-starting-distributed-tests"><span class="nav-number">11.3.</span> <span class="nav-text">Q: How do you prevent the “thundering herd” problem when starting distributed tests?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Q-How-do-you-validate-that-your-pressure-test-accurately-reflects-production-traffic-patterns"><span class="nav-number">11.4.</span> <span class="nav-text">Q: How do you validate that your pressure test accurately reflects production traffic patterns?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#External-References-and-Resources"><span class="nav-number">12.</span> <span class="nav-text">External References and Resources</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">13.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Design Distributed Pressure Test Tool By Zookeeper | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Design Distributed Pressure Test Tool By Zookeeper
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-06-29 16:46:34 / Modified: 16:49:43" itemprop="dateCreated datePublished" datetime="2025-06-29T16:46:34+08:00">2025-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/system-design/" itemprop="url" rel="index"><span itemprop="name">system-design</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Architecture-Overview"><a href="#Architecture-Overview" class="headerlink" title="Architecture Overview"></a>Architecture Overview</h2><p>A distributed pressure testing system leverages multiple client nodes coordinated through Apache Zookeeper to generate high-concurrency load against target services. This architecture enables horizontal scaling and provides centralized coordination for distributed testing scenarios.</p>
<pre>
<code class="mermaid">
graph TB
subgraph &quot;Zookeeper Cluster&quot;
    ZK1[Zookeeper Node 1]
    ZK2[Zookeeper Node 2]
    ZK3[Zookeeper Node 3]
end

subgraph &quot;Test Coordination Layer&quot;
    Master[MasterTestNode]
    Dashboard[Dashboard Web UI]
end

subgraph &quot;Client Test Nodes&quot;
    Client1[ClientTestNode 1]
    Client2[ClientTestNode 2]
    Client3[ClientTestNode N...]
end

subgraph &quot;Target Services&quot;
    Service1[Microservice A]
    Service2[Microservice B]
    Service3[Load Balancer]
end

Master --&gt; ZK1
Client1 --&gt; ZK1
Client2 --&gt; ZK2
Client3 --&gt; ZK3

Client1 --&gt; Service1
Client2 --&gt; Service2
Client3 --&gt; Service3

Dashboard --&gt; Master

style Master fill:#e1f5fe
style Dashboard fill:#f3e5f5
style ZK1 fill:#e8f5e8
style ZK2 fill:#e8f5e8
style ZK3 fill:#e8f5e8
</code>
</pre> 

<p><strong>Interview Insight</strong>: <em>Why use Zookeeper for coordination instead of a message queue like Kafka or RabbitMQ?</em></p>
<p>Zookeeper provides strong consistency guarantees and hierarchical namespace perfect for configuration management and coordination. Unlike message queues, Zookeeper offers:</p>
<ul>
<li>Atomic operations for test state management</li>
<li>Watch mechanisms for real-time coordination</li>
<li>Built-in leader election for master node selection</li>
<li>Sequential node creation for unique client identification</li>
</ul>
<h2 id="Core-Components-Design"><a href="#Core-Components-Design" class="headerlink" title="Core Components Design"></a>Core Components Design</h2><h3 id="ClientTestNode-Architecture"><a href="#ClientTestNode-Architecture" class="headerlink" title="ClientTestNode Architecture"></a>ClientTestNode Architecture</h3><p>The ClientTestNode is the workhorse of the distributed testing system. Each node operates independently while coordinating through Zookeeper for synchronization and reporting.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientTestNode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZooKeeper zookeeper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetricsCollector metricsCollector;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HttpTestExecutor testExecutor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String nodeId;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.zookeeper.root:/pressure-test&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String zkRootPath;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Register this client node with Zookeeper</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nodePath</span> <span class="operator">=</span> zkRootPath + <span class="string">&quot;/clients/&quot;</span> + nodeId;</span><br><span class="line">        zookeeper.create(nodePath, </span><br><span class="line">            getNodeInfo().getBytes(), </span><br><span class="line">            ZooDefs.Ids.OPEN_ACL_UNSAFE, </span><br><span class="line">            CreateMode.EPHEMERAL_SEQUENTIAL);</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Start metrics reporting thread</span></span><br><span class="line">        startMetricsReporting();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeTest</span><span class="params">(TestConfiguration config)</span> &#123;</span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (isTestRunning()) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> testExecutor.execute(config);</span><br><span class="line">                    <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.nanoTime() - startTime;</span><br><span class="line">                    metricsCollector.recordSuccess(duration);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    metricsCollector.recordError();</span><br><span class="line">                    log.error(<span class="string">&quot;Test execution failed&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">startMetricsReporting</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduler</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line">        scheduler.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">TestMetrics</span> <span class="variable">metrics</span> <span class="operator">=</span> metricsCollector.getAndReset();</span><br><span class="line">                <span class="type">String</span> <span class="variable">metricsPath</span> <span class="operator">=</span> zkRootPath + <span class="string">&quot;/metrics/&quot;</span> + nodeId;</span><br><span class="line">                zookeeper.setData(metricsPath, </span><br><span class="line">                    SerializationUtils.serialize(metrics), -<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Failed to report metrics&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>, <span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Production Best Practice</strong>: Use connection pooling and keep-alive connections for HTTP testing to avoid TCP connection overhead affecting test results.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpTestExecutorConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CloseableHttpClient <span class="title function_">httpClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> HttpClients.custom()</span><br><span class="line">            .setMaxConnTotal(<span class="number">200</span>)</span><br><span class="line">            .setMaxConnPerRoute(<span class="number">50</span>)</span><br><span class="line">            .setConnectionTimeToLive(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">            .setDefaultRequestConfig(RequestConfig.custom()</span><br><span class="line">                .setConnectTimeout(<span class="number">5000</span>)</span><br><span class="line">                .setSocketTimeout(<span class="number">10000</span>)</span><br><span class="line">                .build())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MasterTestNode-Coordination"><a href="#MasterTestNode-Coordination" class="headerlink" title="MasterTestNode Coordination"></a>MasterTestNode Coordination</h3><p>The MasterTestNode orchestrates the entire testing process, manages test lifecycle, and aggregates metrics from all client nodes.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MasterTestNode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZooKeeper zookeeper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TestConfigurationManager configManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetricsAggregator metricsAggregator;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startDistributedTest</span><span class="params">(TestPlan testPlan)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Create test session</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sessionPath</span> <span class="operator">=</span> createTestSession(testPlan);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Wait for all client nodes to be ready</span></span><br><span class="line">        waitForClientNodes(testPlan.getExpectedClientCount());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Broadcast test configuration</span></span><br><span class="line">        broadcastTestConfiguration(sessionPath, testPlan);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Start metrics collection</span></span><br><span class="line">        startMetricsCollection(sessionPath);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Monitor test execution</span></span><br><span class="line">        monitorTestExecution(sessionPath, testPlan.getDuration());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">createTestSession</span><span class="params">(TestPlan testPlan)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sessionPath</span> <span class="operator">=</span> zkRootPath + <span class="string">&quot;/sessions/&quot;</span> + UUID.randomUUID();</span><br><span class="line">        zookeeper.create(sessionPath, </span><br><span class="line">            SerializationUtils.serialize(testPlan), </span><br><span class="line">            ZooDefs.Ids.OPEN_ACL_UNSAFE, </span><br><span class="line">            CreateMode.PERSISTENT);</span><br><span class="line">        <span class="keyword">return</span> sessionPath;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">waitForClientNodes</span><span class="params">(<span class="type">int</span> expectedCount)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">clientsPath</span> <span class="operator">=</span> zkRootPath + <span class="string">&quot;/clients&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Watcher</span> <span class="variable">watcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent event)</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    List&lt;String&gt; children = zookeeper.getChildren(clientsPath, <span class="built_in">this</span>);</span><br><span class="line">                    <span class="keyword">if</span> (children.size() &gt;= expectedCount) &#123;</span><br><span class="line">                        latch.countDown();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;Error watching client nodes&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        zookeeper.getChildren(clientsPath, watcher);</span><br><span class="line">        latch.await(<span class="number">30</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Insight</strong>: <em>How do you handle client node failures during testing?</em></p>
<p>Use Zookeeper’s ephemeral nodes for client registration. When a client fails, its ephemeral node disappears automatically, allowing the master to detect failures and either redistribute load or mark the test as degraded.</p>
<h2 id="Metrics-Collection-and-Statistical-Analysis"><a href="#Metrics-Collection-and-Statistical-Analysis" class="headerlink" title="Metrics Collection and Statistical Analysis"></a>Metrics Collection and Statistical Analysis</h2><h3 id="Core-Metrics-Implementation"><a href="#Core-Metrics-Implementation" class="headerlink" title="Core Metrics Implementation"></a>Core Metrics Implementation</h3><p>The metrics system captures essential performance indicators with high precision and minimal overhead.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsCollector</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicLong</span> <span class="variable">totalRequests</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicLong</span> <span class="variable">successfulRequests</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicLong</span> <span class="variable">errorCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Histogram responseTimeHistogram;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer.Sample currentSample;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Use HdrHistogram for accurate percentile calculations</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Histogram</span> <span class="variable">histogram</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Histogram</span>(</span><br><span class="line">        TimeUnit.SECONDS.toNanos(<span class="number">60</span>), <span class="number">3</span>); <span class="comment">// 60s max, 3 significant digits</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordSuccess</span><span class="params">(<span class="type">long</span> durationNanos)</span> &#123;</span><br><span class="line">        totalRequests.incrementAndGet();</span><br><span class="line">        successfulRequests.incrementAndGet();</span><br><span class="line">        histogram.recordValue(durationNanos);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordError</span><span class="params">()</span> &#123;</span><br><span class="line">        totalRequests.incrementAndGet();</span><br><span class="line">        errorCount.incrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TestMetrics <span class="title function_">getAndReset</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> totalRequests.getAndSet(<span class="number">0</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">successful</span> <span class="operator">=</span> successfulRequests.getAndSet(<span class="number">0</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">errors</span> <span class="operator">=</span> errorCount.getAndSet(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Calculate percentiles</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">p95</span> <span class="operator">=</span> histogram.getValueAtPercentile(<span class="number">95.0</span>) / <span class="number">1_000_000.0</span>; <span class="comment">// Convert to ms</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">p99</span> <span class="operator">=</span> histogram.getValueAtPercentile(<span class="number">99.0</span>) / <span class="number">1_000_000.0</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">avgResponseTime</span> <span class="operator">=</span> histogram.getMean() / <span class="number">1_000_000.0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Calculate QPS based on collection interval</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">qps</span> <span class="operator">=</span> successful / <span class="number">5.0</span>; <span class="comment">// 5-second reporting interval</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">errorRate</span> <span class="operator">=</span> total &gt; <span class="number">0</span> ? (<span class="type">double</span>) errors / total * <span class="number">100</span> : <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        histogram.reset();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> TestMetrics.builder()</span><br><span class="line">            .qps(qps)</span><br><span class="line">            .avgResponseTime(avgResponseTime)</span><br><span class="line">            .p95ResponseTime(p95)</span><br><span class="line">            .p99ResponseTime(p99)</span><br><span class="line">            .errorRate(errorRate)</span><br><span class="line">            .totalRequests(total)</span><br><span class="line">            .timestamp(System.currentTimeMillis())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Real-time-Metrics-Aggregation"><a href="#Real-time-Metrics-Aggregation" class="headerlink" title="Real-time Metrics Aggregation"></a>Real-time Metrics Aggregation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsAggregator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, TestMetrics&gt; clientMetrics = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PublishSubject&lt;AggregatedMetrics&gt; metricsStream = PublishSubject.create();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateClientMetrics</span><span class="params">(String clientId, TestMetrics metrics)</span> &#123;</span><br><span class="line">        clientMetrics.put(clientId, metrics);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Trigger aggregation</span></span><br><span class="line">        <span class="type">AggregatedMetrics</span> <span class="variable">aggregated</span> <span class="operator">=</span> aggregateMetrics();</span><br><span class="line">        metricsStream.onNext(aggregated);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> AggregatedMetrics <span class="title function_">aggregateMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (clientMetrics.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> AggregatedMetrics.empty();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">totalQps</span> <span class="operator">=</span> clientMetrics.values().stream()</span><br><span class="line">            .mapToDouble(TestMetrics::getQps)</span><br><span class="line">            .sum();</span><br><span class="line">            </span><br><span class="line">        <span class="type">double</span> <span class="variable">weightedAvgResponseTime</span> <span class="operator">=</span> clientMetrics.values().stream()</span><br><span class="line">            .mapToDouble(m -&gt; m.getAvgResponseTime() * m.getTotalRequests())</span><br><span class="line">            .sum() / clientMetrics.values().stream()</span><br><span class="line">            .mapToLong(TestMetrics::getTotalRequests)</span><br><span class="line">            .sum();</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Use weighted percentiles for P95/P99</span></span><br><span class="line">        <span class="type">double</span>[] p95Values = clientMetrics.values().stream()</span><br><span class="line">            .mapToDouble(TestMetrics::getP95ResponseTime)</span><br><span class="line">            .toArray();</span><br><span class="line">        <span class="type">double</span>[] p99Values = clientMetrics.values().stream()</span><br><span class="line">            .mapToDouble(TestMetrics::getP99ResponseTime)</span><br><span class="line">            .toArray();</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> AggregatedMetrics.builder()</span><br><span class="line">            .totalQps(totalQps)</span><br><span class="line">            .avgResponseTime(weightedAvgResponseTime)</span><br><span class="line">            .p95ResponseTime(Percentiles.percentile(p95Values, <span class="number">95</span>))</span><br><span class="line">            .p99ResponseTime(Percentiles.percentile(p99Values, <span class="number">99</span>))</span><br><span class="line">            .activeClients(clientMetrics.size())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Observable&lt;AggregatedMetrics&gt; <span class="title function_">getMetricsStream</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> metricsStream.asObservable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Production Best Practice</strong>: Use sliding window aggregation to provide smooth metrics transitions and avoid metric spikes during client node changes.</p>
<h2 id="Scalability-and-High-Concurrency-Support"><a href="#Scalability-and-High-Concurrency-Support" class="headerlink" title="Scalability and High Concurrency Support"></a>Scalability and High Concurrency Support</h2><h3 id="Dynamic-Client-Scaling"><a href="#Dynamic-Client-Scaling" class="headerlink" title="Dynamic Client Scaling"></a>Dynamic Client Scaling</h3><pre>
<code class="mermaid">
sequenceDiagram
 
sequenceDiagram
    participant Master as MasterTestNode
    participant ZK as Zookeeper
    participant Client1 as ClientTestNode-1
    participant ClientN as ClientTestNode-N
    participant Service as Target Service
    
    Master-&gt;&gt;ZK: Create test session
    Master-&gt;&gt;ZK: Set expected client count
    
    Client1-&gt;&gt;ZK: Register as ephemeral node
    ClientN-&gt;&gt;ZK: Register as ephemeral node
    
    ZK--&gt;&gt;Master: Client count reached
    Master-&gt;&gt;ZK: Broadcast test config
    
    ZK--&gt;&gt;Client1: Receive test config
    ZK--&gt;&gt;ClientN: Receive test config
    
    par Concurrent Testing
        Client1-&gt;&gt;Service: HTTP requests
        ClientN-&gt;&gt;Service: HTTP requests
    and Metrics Reporting
        Client1-&gt;&gt;ZK: Report metrics
        ClientN-&gt;&gt;ZK: Report metrics
    end
    
    ZK--&gt;&gt;Master: Aggregate metrics
</code>
</pre>

<h3 id="Auto-scaling-Strategy"><a href="#Auto-scaling-Strategy" class="headerlink" title="Auto-scaling Strategy"></a>Auto-scaling Strategy</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoScalingController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMetricsUpdate</span><span class="params">(AggregatedMetrics metrics)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (shouldScaleUp(metrics)) &#123;</span><br><span class="line">            requestScaleUp();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shouldScaleDown(metrics)) &#123;</span><br><span class="line">            requestScaleDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">shouldScaleUp</span><span class="params">(AggregatedMetrics metrics)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> metrics.getAvgResponseTime() &gt; responseTimeThreshold </span><br><span class="line">            &amp;&amp; metrics.getTotalQps() &lt; targetQps </span><br><span class="line">            &amp;&amp; metrics.getActiveClients() &lt; maxClients;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">requestScaleUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Integrate with container orchestration (Kubernetes, Docker Swarm)</span></span><br><span class="line">        kubernetesClient.apps().deployments()</span><br><span class="line">            .inNamespace(<span class="string">&quot;pressure-test&quot;</span>)</span><br><span class="line">            .withName(<span class="string">&quot;client-test-nodes&quot;</span>)</span><br><span class="line">            .scale(getCurrentReplicas() + scaleStep);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Dashboard-and-Visualization"><a href="#Dashboard-and-Visualization" class="headerlink" title="Dashboard and Visualization"></a>Dashboard and Visualization</h2><h3 id="Real-time-Dashboard-Architecture"><a href="#Real-time-Dashboard-Architecture" class="headerlink" title="Real-time Dashboard Architecture"></a>Real-time Dashboard Architecture</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/metrics&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetricsAggregator metricsAggregator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SimpMessagingTemplate messagingTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/stream&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> SseEmitter <span class="title function_">streamMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SseEmitter</span> <span class="variable">emitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SseEmitter</span>(Long.MAX_VALUE);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Disposable</span> <span class="variable">subscription</span> <span class="operator">=</span> metricsAggregator.getMetricsStream()</span><br><span class="line">            .observeOn(Schedulers.io())</span><br><span class="line">            .subscribe(</span><br><span class="line">                metrics -&gt; &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        emitter.send(SseEmitter.event()</span><br><span class="line">                            .name(<span class="string">&quot;metrics&quot;</span>)</span><br><span class="line">                            .data(metrics));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        emitter.completeWithError(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                emitter::completeWithError,</span><br><span class="line">                emitter::complete</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">        emitter.onCompletion(() -&gt; subscription.dispose());</span><br><span class="line">        emitter.onTimeout(() -&gt; subscription.dispose());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> emitter;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/test/control&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTestControl</span><span class="params">(TestControlMessage message)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (message.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> START:</span><br><span class="line">                testOrchestrator.startTest(message.getTestPlan());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> STOP:</span><br><span class="line">                testOrchestrator.stopTest(message.getTestId());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PAUSE:</span><br><span class="line">                testOrchestrator.pauseTest(message.getTestId());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Frontend-Dashboard-Implementation"><a href="#Frontend-Dashboard-Implementation" class="headerlink" title="Frontend Dashboard Implementation"></a>Frontend Dashboard Implementation</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Real-time metrics visualization</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MetricsDashboard</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span> = &#123;&#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eventSource</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initializeCharts</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">connectToMetricsStream</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">connectToMetricsStream</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eventSource</span> = <span class="keyword">new</span> <span class="title class_">EventSource</span>(<span class="string">&#x27;/api/metrics/stream&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eventSource</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;metrics&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> metrics = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(event.<span class="property">data</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateCharts</span>(metrics);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eventSource</span>.<span class="property">onerror</span> = <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Metrics stream error:&#x27;</span>, error);</span><br><span class="line">            <span class="comment">// Implement reconnection logic</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">connectToMetricsStream</span>(), <span class="number">5000</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">updateCharts</span>(<span class="params">metrics</span>) &#123;</span><br><span class="line">        <span class="comment">// Update QPS chart</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">qps</span>.<span class="property">data</span>.<span class="property">labels</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleTimeString</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">qps</span>.<span class="property">data</span>.<span class="property">datasets</span>[<span class="number">0</span>].<span class="property">data</span>.<span class="title function_">push</span>(metrics.<span class="property">totalQps</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">qps</span>.<span class="title function_">update</span>(<span class="string">&#x27;none&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update response time chart</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">responseTime</span>.<span class="property">data</span>.<span class="property">datasets</span>[<span class="number">0</span>].<span class="property">data</span>.<span class="title function_">push</span>(metrics.<span class="property">avgResponseTime</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">responseTime</span>.<span class="property">data</span>.<span class="property">datasets</span>[<span class="number">1</span>].<span class="property">data</span>.<span class="title function_">push</span>(metrics.<span class="property">p95ResponseTime</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">responseTime</span>.<span class="property">data</span>.<span class="property">datasets</span>[<span class="number">2</span>].<span class="property">data</span>.<span class="title function_">push</span>(metrics.<span class="property">p99ResponseTime</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">responseTime</span>.<span class="title function_">update</span>(<span class="string">&#x27;none&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Production-Deployment-and-Best-Practices"><a href="#Production-Deployment-and-Best-Practices" class="headerlink" title="Production Deployment and Best Practices"></a>Production Deployment and Best Practices</h2><h3 id="Containerized-Deployment"><a href="#Containerized-Deployment" class="headerlink" title="Containerized Deployment"></a>Containerized Deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">zookeeper:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">confluentinc/cp-zookeeper:latest</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOOKEEPER_CLIENT_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOOKEEPER_TICK_TIME:</span> <span class="number">2000</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zk-data:/var/lib/zookeeper/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zk-logs:/var/lib/zookeeper/log</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">master-node:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">pressure-test/master:latest</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ZOOKEEPER_CONNECT=zookeeper:2181</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=production</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">client-node:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">pressure-test/client:latest</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master-node</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ZOOKEEPER_CONNECT=zookeeper:2181</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MASTER_NODE_URL=http://master-node:8080</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">512M</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">256M</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">zk-data:</span></span><br><span class="line">  <span class="attr">zk-logs:</span></span><br></pre></td></tr></table></figure>

<h3 id="Kubernetes-Deployment"><a href="#Kubernetes-Deployment" class="headerlink" title="Kubernetes Deployment"></a>Kubernetes Deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">client-test-nodes</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">pressure-test-client</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">pressure-test-client</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">client-node</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">pressure-test/client:latest</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;256Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ZOOKEEPER_CONNECT</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;zookeeper-service:2181&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODE_ID</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">zookeeper-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">2181</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">2181</span></span><br></pre></td></tr></table></figure>

<p><strong>Production Best Practice</strong>: Implement health checks and graceful shutdown handling to ensure clean test termination and accurate metrics collection.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GracefulShutdownHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Stop accepting new test requests</span></span><br><span class="line">        testExecutor.shutdown();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Wait for current tests to complete</span></span><br><span class="line">        <span class="keyword">if</span> (!testExecutor.awaitTermination(<span class="number">30</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">            testExecutor.shutdownNow();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Send final metrics</span></span><br><span class="line">        metricsCollector.flush();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Deregister from Zookeeper</span></span><br><span class="line">        zookeeper.delete(clientNodePath, -<span class="number">1</span>);</span><br><span class="line">        zookeeper.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Use-Cases-and-Practical-Examples"><a href="#Use-Cases-and-Practical-Examples" class="headerlink" title="Use Cases and Practical Examples"></a>Use Cases and Practical Examples</h2><h3 id="E-commerce-Platform-Load-Testing"><a href="#E-commerce-Platform-Load-Testing" class="headerlink" title="E-commerce Platform Load Testing"></a>E-commerce Platform Load Testing</h3><p><strong>Scenario</strong>: Testing an e-commerce platform’s checkout process during Black Friday preparation.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EcommerceTestPlan</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TestConfiguration <span class="title function_">createCheckoutTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> TestConfiguration.builder()</span><br><span class="line">            .targetUrl(<span class="string">&quot;https://api.ecommerce.com/checkout&quot;</span>)</span><br><span class="line">            .httpMethod(HttpMethod.POST)</span><br><span class="line">            .requestBodyTemplate(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    &quot;userId&quot;: &quot;$&#123;randomUserId&#125;&quot;,</span></span><br><span class="line"><span class="string">                    &quot;items&quot;: [</span></span><br><span class="line"><span class="string">                        &#123;</span></span><br><span class="line"><span class="string">                            &quot;productId&quot;: &quot;$&#123;randomProductId&#125;&quot;,</span></span><br><span class="line"><span class="string">                            &quot;quantity&quot;: $&#123;randomQuantity&#125;</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                    ],</span></span><br><span class="line"><span class="string">                    &quot;paymentMethod&quot;: &quot;credit_card&quot;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>)</span><br><span class="line">            .variableGenerators(Map.of(</span><br><span class="line">                <span class="string">&quot;randomUserId&quot;</span>, () -&gt; <span class="string">&quot;user_&quot;</span> + ThreadLocalRandom.current().nextInt(<span class="number">1</span>, <span class="number">100000</span>),</span><br><span class="line">                <span class="string">&quot;randomProductId&quot;</span>, () -&gt; <span class="string">&quot;prod_&quot;</span> + ThreadLocalRandom.current().nextInt(<span class="number">1</span>, <span class="number">1000</span>),</span><br><span class="line">                <span class="string">&quot;randomQuantity&quot;</span>, () -&gt; String.valueOf(ThreadLocalRandom.current().nextInt(<span class="number">1</span>, <span class="number">5</span>))</span><br><span class="line">            ))</span><br><span class="line">            .expectedStatusCode(<span class="number">200</span>)</span><br><span class="line">            .maxResponseTime(Duration.ofSeconds(<span class="number">2</span>))</span><br><span class="line">            .concurrency(<span class="number">50</span>)</span><br><span class="line">            .rampUpPeriod(Duration.ofMinutes(<span class="number">5</span>))</span><br><span class="line">            .testDuration(Duration.ofMinutes(<span class="number">30</span>))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Microservice-Circuit-Breaker-Testing"><a href="#Microservice-Circuit-Breaker-Testing" class="headerlink" title="Microservice Circuit Breaker Testing"></a>Microservice Circuit Breaker Testing</h3><p><strong>Scenario</strong>: Testing circuit breaker behavior under various failure conditions.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircuitBreakerTestScenario</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeFailureInjectionTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TestPlan</span> <span class="variable">testPlan</span> <span class="operator">=</span> TestPlan.builder()</span><br><span class="line">            .name(<span class="string">&quot;Circuit Breaker Failure Test&quot;</span>)</span><br><span class="line">            .phases(Arrays.asList(</span><br><span class="line">                <span class="comment">// Phase 1: Normal load</span></span><br><span class="line">                TestPhase.builder()</span><br><span class="line">                    .name(<span class="string">&quot;Baseline&quot;</span>)</span><br><span class="line">                    .duration(Duration.ofMinutes(<span class="number">5</span>))</span><br><span class="line">                    .targetQps(<span class="number">100</span>)</span><br><span class="line">                    .build(),</span><br><span class="line">                    </span><br><span class="line">                <span class="comment">// Phase 2: Inject failures</span></span><br><span class="line">                TestPhase.builder()</span><br><span class="line">                    .name(<span class="string">&quot;Failure Injection&quot;</span>)</span><br><span class="line">                    .duration(Duration.ofMinutes(<span class="number">3</span>))</span><br><span class="line">                    .targetQps(<span class="number">100</span>)</span><br><span class="line">                    .failureRate(<span class="number">0.5</span>) <span class="comment">// 50% failure rate</span></span><br><span class="line">                    .build(),</span><br><span class="line">                    </span><br><span class="line">                <span class="comment">// Phase 3: Recovery testing</span></span><br><span class="line">                TestPhase.builder()</span><br><span class="line">                    .name(<span class="string">&quot;Recovery&quot;</span>)</span><br><span class="line">                    .duration(Duration.ofMinutes(<span class="number">5</span>))</span><br><span class="line">                    .targetQps(<span class="number">100</span>)</span><br><span class="line">                    .build()</span><br><span class="line">            ))</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        masterTestNode.startDistributedTest(testPlan);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Advanced-Features-and-Optimizations"><a href="#Advanced-Features-and-Optimizations" class="headerlink" title="Advanced Features and Optimizations"></a>Advanced Features and Optimizations</h2><h3 id="Intelligent-Load-Distribution"><a href="#Intelligent-Load-Distribution" class="headerlink" title="Intelligent Load Distribution"></a>Intelligent Load Distribution</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoadDistributionStrategy</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">distributeLoad</span><span class="params">(List&lt;ClientTestNode&gt; clients, TestConfiguration config)</span> &#123;</span><br><span class="line">        <span class="comment">// Consider client capabilities and current load</span></span><br><span class="line">        Map&lt;String, Integer&gt; loadDistribution = calculateOptimalDistribution(clients, config);</span><br><span class="line">        </span><br><span class="line">        loadDistribution.forEach((clientId, targetQps) -&gt; &#123;</span><br><span class="line">            <span class="type">TestConfiguration</span> <span class="variable">clientConfig</span> <span class="operator">=</span> config.toBuilder()</span><br><span class="line">                .targetQps(targetQps)</span><br><span class="line">                .build();</span><br><span class="line">            sendConfigurationToClient(clientId, clientConfig);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; <span class="title function_">calculateOptimalDistribution</span><span class="params">(</span></span><br><span class="line"><span class="params">            List&lt;ClientTestNode&gt; clients, TestConfiguration config)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Factor in client CPU, memory, network capability</span></span><br><span class="line">        Map&lt;String, Double&gt; clientCapabilities = clients.stream()</span><br><span class="line">            .collect(Collectors.toMap(</span><br><span class="line">                ClientTestNode::getId,</span><br><span class="line">                <span class="built_in">this</span>::calculateClientCapability</span><br><span class="line">            ));</span><br><span class="line">            </span><br><span class="line">        <span class="type">double</span> <span class="variable">totalCapability</span> <span class="operator">=</span> clientCapabilities.values().stream()</span><br><span class="line">            .mapToDouble(Double::doubleValue)</span><br><span class="line">            .sum();</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> clientCapabilities.entrySet().stream()</span><br><span class="line">            .collect(Collectors.toMap(</span><br><span class="line">                Map.Entry::getKey,</span><br><span class="line">                entry -&gt; (<span class="type">int</span>) (config.getTargetQps() * entry.getValue() / totalCapability)</span><br><span class="line">            ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Predictive-Scaling"><a href="#Predictive-Scaling" class="headerlink" title="Predictive Scaling"></a>Predictive Scaling</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PredictiveScaler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">LinearRegression</span> <span class="variable">responseTimePredictor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinearRegression</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 30000)</span> <span class="comment">// Every 30 seconds</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">analyzeAndPredict</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;MetricsSnapshot&gt; recentMetrics = getRecentMetrics(Duration.ofMinutes(<span class="number">5</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (recentMetrics.size() &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="type">double</span>[] qpsValues = recentMetrics.stream()</span><br><span class="line">                .mapToDouble(MetricsSnapshot::getQps)</span><br><span class="line">                .toArray();</span><br><span class="line">            <span class="type">double</span>[] responseTimeValues = recentMetrics.stream()</span><br><span class="line">                .mapToDouble(MetricsSnapshot::getAvgResponseTime)</span><br><span class="line">                .toArray();</span><br><span class="line">                </span><br><span class="line">            responseTimePredictor.fit(qpsValues, responseTimeValues);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Predict response time at target QPS</span></span><br><span class="line">            <span class="type">double</span> <span class="variable">predictedResponseTime</span> <span class="operator">=</span> responseTimePredictor.predict(targetQps);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (predictedResponseTime &gt; slaThreshold) &#123;</span><br><span class="line">                triggerPreemptiveScaling();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Monitoring-and-Observability"><a href="#Monitoring-and-Observability" class="headerlink" title="Monitoring and Observability"></a>Monitoring and Observability</h2><h3 id="Comprehensive-Monitoring-Stack"><a href="#Comprehensive-Monitoring-Stack" class="headerlink" title="Comprehensive Monitoring Stack"></a>Comprehensive Monitoring Stack</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableMetrics</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonitoringConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MeterRegistry <span class="title function_">meterRegistry</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PrometheusMeterRegistry</span>(PrometheusConfig.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TimedAspect <span class="title function_">timedAspect</span><span class="params">(MeterRegistry registry)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TimedAspect</span>(registry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTestMetrics</span><span class="params">(TestMetricsEvent event)</span> &#123;</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;test.qps&quot;</span>, event.getMetrics().getQps());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;test.response.time.avg&quot;</span>, event.getMetrics().getAvgResponseTime());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;test.response.time.p95&quot;</span>, event.getMetrics().getP95ResponseTime());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;test.response.time.p99&quot;</span>, event.getMetrics().getP99ResponseTime());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;test.error.rate&quot;</span>, event.getMetrics().getErrorRate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Alert-Configuration"><a href="#Alert-Configuration" class="headerlink" title="Alert Configuration"></a>Alert Configuration</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheus Alert Rules</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pressure-test-alerts</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighErrorRate</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">test_error_rate</span> <span class="string">&gt;</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;High error rate detected in pressure test&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;Error rate is <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>% for test <span class="template-variable">&#123;&#123; $labels.test_id &#125;&#125;</span>&quot;</span></span><br><span class="line">      </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">ResponseTimeExceeded</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">test_response_time_p95</span> <span class="string">&gt;</span> <span class="number">2000</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">2m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;P95 response time exceeded SLA&quot;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;P95 response time is <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>ms for test <span class="template-variable">&#123;&#123; $labels.test_id &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Security-Considerations"><a href="#Security-Considerations" class="headerlink" title="Security Considerations"></a>Security Considerations</h2><h3 id="Authentication-and-Authorization"><a href="#Authentication-and-Authorization" class="headerlink" title="Authentication and Authorization"></a>Authentication and Authorization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> http</span><br><span class="line">            .authorizeHttpRequests(auth -&gt; auth</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/api/public/**&quot;</span>).permitAll()</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/api/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/api/test/**&quot;</span>).hasAnyRole(<span class="string">&quot;TESTER&quot;</span>, <span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">            )</span><br><span class="line">            .oauth2ResourceServer(oauth2 -&gt; oauth2</span><br><span class="line">                .jwt(jwt -&gt; jwt.jwtAuthenticationConverter(jwtAuthConverter()))</span><br><span class="line">            )</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Secure-Zookeeper-Communication"><a href="#Secure-Zookeeper-Communication" class="headerlink" title="Secure Zookeeper Communication"></a>Secure Zookeeper Communication</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Zookeeper SASL configuration</span></span><br><span class="line"><span class="attr">zookeeper.sasl.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">zookeeper.security.protocol</span>=<span class="string">SASL_PLAINTEXT</span></span><br><span class="line"><span class="attr">zookeeper.sasl.mechanism</span>=<span class="string">DIGEST-MD5</span></span><br><span class="line"><span class="attr">zookeeper.auth.provider</span>=<span class="string">org.apache.zookeeper.server.auth.SASLAuthenticationProvider</span></span><br></pre></td></tr></table></figure>

<h2 id="Interview-Questions-and-Insights"><a href="#Interview-Questions-and-Insights" class="headerlink" title="Interview Questions and Insights"></a>Interview Questions and Insights</h2><h3 id="Q-How-do-you-ensure-test-result-accuracy-when-client-nodes-join-leave-during-testing"><a href="#Q-How-do-you-ensure-test-result-accuracy-when-client-nodes-join-leave-during-testing" class="headerlink" title="Q: How do you ensure test result accuracy when client nodes join&#x2F;leave during testing?"></a>Q: How do you ensure test result accuracy when client nodes join&#x2F;leave during testing?</h3><p><strong>Answer</strong>: Implement a metrics normalization strategy that weights contributions based on active participation time. Use Zookeeper watches to detect node changes and adjust aggregation algorithms accordingly. Store per-client participation windows and apply time-weighted averaging for accurate QPS calculations.</p>
<h3 id="Q-What-strategies-handle-network-partitions-between-client-nodes-and-Zookeeper"><a href="#Q-What-strategies-handle-network-partitions-between-client-nodes-and-Zookeeper" class="headerlink" title="Q: What strategies handle network partitions between client nodes and Zookeeper?"></a>Q: What strategies handle network partitions between client nodes and Zookeeper?</h3><p><strong>Answer</strong>: Implement local metrics buffering with configurable retention periods. Use exponential backoff for reconnection attempts and maintain test continuity in degraded mode. Client nodes should continue testing with last known configuration while attempting to reconnect, then sync accumulated metrics upon reconnection.</p>
<h3 id="Q-How-do-you-prevent-the-“thundering-herd”-problem-when-starting-distributed-tests"><a href="#Q-How-do-you-prevent-the-“thundering-herd”-problem-when-starting-distributed-tests" class="headerlink" title="Q: How do you prevent the “thundering herd” problem when starting distributed tests?"></a>Q: How do you prevent the “thundering herd” problem when starting distributed tests?</h3><p><strong>Answer</strong>: Use Zookeeper’s sequential node creation for staggered client startup. Implement jittered delays based on client node sequence numbers and use barrier synchronization to ensure coordinated test phases. This prevents simultaneous connection bursts to target services.</p>
<h3 id="Q-How-do-you-validate-that-your-pressure-test-accurately-reflects-production-traffic-patterns"><a href="#Q-How-do-you-validate-that-your-pressure-test-accurately-reflects-production-traffic-patterns" class="headerlink" title="Q: How do you validate that your pressure test accurately reflects production traffic patterns?"></a>Q: How do you validate that your pressure test accurately reflects production traffic patterns?</h3><p><strong>Answer</strong>: Implement traffic pattern analysis using statistical comparison tools. Capture production request distributions (timing, payload sizes, endpoint usage patterns) and use this data to generate realistic test scenarios. Compare test-generated traffic fingerprints with production baselines using techniques like Kolmogorov-Smirnov tests for distribution similarity.</p>
<h2 id="External-References-and-Resources"><a href="#External-References-and-Resources" class="headerlink" title="External References and Resources"></a>External References and Resources</h2><ul>
<li><strong>Apache Zookeeper Documentation</strong>: <a target="_blank" rel="noopener" href="https://zookeeper.apache.org/doc/current/">https://zookeeper.apache.org/doc/current/</a></li>
<li><strong>HdrHistogram for Accurate Latency Measurement</strong>: <a target="_blank" rel="noopener" href="http://hdrhistogram.org/">http://hdrhistogram.org/</a></li>
<li><strong>JMeter for Load Testing Concepts</strong>: <a target="_blank" rel="noopener" href="https://jmeter.apache.org/usermanual/">https://jmeter.apache.org/usermanual/</a></li>
<li><strong>Prometheus Monitoring</strong>: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/">https://prometheus.io/docs/</a></li>
<li><strong>Kubernetes Horizontal Pod Autoscaling</strong>: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/</a></li>
<li><strong>Circuit Breaker Pattern</strong>: <a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/CircuitBreaker.html">https://martinfowler.com/bliki/CircuitBreaker.html</a></li>
<li><strong>Reactive Streams Specification</strong>: <a target="_blank" rel="noopener" href="http://www.reactive-streams.org/">http://www.reactive-streams.org/</a></li>
</ul>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Building a production-ready distributed pressure testing tool requires careful consideration of coordination mechanisms, metrics accuracy, scalability patterns, and operational concerns. The Zookeeper-based architecture provides strong consistency guarantees essential for coordinated testing while enabling horizontal scaling through loosely coupled client nodes.</p>
<p>Key success factors include implementing proper metrics collection with minimal overhead, designing for graceful degradation during network partitions, and providing comprehensive observability for both the testing system itself and the results it produces. The modular architecture enables easy extension for specific testing scenarios while maintaining the core coordination and aggregation capabilities.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/system-design/" rel="tag"># system-design</a>
              <a href="/tags/pressure-test/" rel="tag"># pressure test</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/25/Spring-Security-Framework-Complete-Guide/" rel="prev" title="Spring Security Framework - Complete Guide">
                  <i class="fa fa-angle-left"></i> Spring Security Framework - Complete Guide
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
