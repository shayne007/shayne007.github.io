<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="System Architecture OverviewA distributed pressure testing system leverages multiple client nodes coordinated through Apache Zookeeper to simulate high-load scenarios against target services. This arc">
<meta property="og:type" content="article">
<meta property="og:title" content="Design Distributed Pressure Test Tool By Zookeeper">
<meta property="og:url" content="https://shayne007.github.io/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="System Architecture OverviewA distributed pressure testing system leverages multiple client nodes coordinated through Apache Zookeeper to simulate high-load scenarios against target services. This arc">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-29T08:46:34.000Z">
<meta property="article:modified_time" content="2025-06-30T06:40:16.475Z">
<meta property="article:author" content="Charlie Feng">
<meta property="article:tag" content="system-design">
<meta property="article:tag" content="pressure test">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/","path":"2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/","title":"Design Distributed Pressure Test Tool By Zookeeper"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Design Distributed Pressure Test Tool By Zookeeper | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#System-Architecture-Overview"><span class="nav-number">1.</span> <span class="nav-text">System Architecture Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-Components-Design"><span class="nav-number">2.</span> <span class="nav-text">Core Components Design</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ClientTestNode-Architecture"><span class="nav-number">2.1.</span> <span class="nav-text">ClientTestNode Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MasterTestNode-Coordination"><span class="nav-number">2.2.</span> <span class="nav-text">MasterTestNode Coordination</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Task-Configuration-Management"><span class="nav-number">3.</span> <span class="nav-text">Task Configuration Management</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuration-Structure"><span class="nav-number">3.1.</span> <span class="nav-text">Configuration Structure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynamic-Configuration-Updates"><span class="nav-number">3.2.</span> <span class="nav-text">Dynamic Configuration Updates</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Metrics-Collection-and-Statistics"><span class="nav-number">4.</span> <span class="nav-text">Metrics Collection and Statistics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-time-Metrics-Collection"><span class="nav-number">4.1.</span> <span class="nav-text">Real-time Metrics Collection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Advanced-Statistical-Calculations"><span class="nav-number">4.2.</span> <span class="nav-text">Advanced Statistical Calculations</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zookeeper-Integration-Patterns"><span class="nav-number">5.</span> <span class="nav-text">Zookeeper Integration Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Discovery-and-Registration"><span class="nav-number">5.1.</span> <span class="nav-text">Service Discovery and Registration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Distributed-Coordination-and-Synchronization"><span class="nav-number">5.2.</span> <span class="nav-text">Distributed Coordination and Synchronization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#High-Performance-Netty-Implementation"><span class="nav-number">6.</span> <span class="nav-text">High-Performance Netty Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Netty-HTTP-Client-Configuration"><span class="nav-number">6.1.</span> <span class="nav-text">Netty HTTP Client Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#High-Performance-Request-Execution"><span class="nav-number">6.2.</span> <span class="nav-text">High-Performance Request Execution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Connection-Pool-Management"><span class="nav-number">6.3.</span> <span class="nav-text">Connection Pool Management</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dashboard-and-Visualization"><span class="nav-number">7.</span> <span class="nav-text">Dashboard and Visualization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-time-Dashboard-Backend"><span class="nav-number">7.1.</span> <span class="nav-text">Real-time Dashboard Backend</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebSocket-Configuration-for-Real-time-Updates"><span class="nav-number">7.2.</span> <span class="nav-text">WebSocket Configuration for Real-time Updates</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Frontend-Dashboard-Components"><span class="nav-number">7.3.</span> <span class="nav-text">Frontend Dashboard Components</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Production-Deployment-Considerations"><span class="nav-number">8.</span> <span class="nav-text">Production Deployment Considerations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-Configuration"><span class="nav-number">8.1.</span> <span class="nav-text">Docker Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-Deployment"><span class="nav-number">8.2.</span> <span class="nav-text">Kubernetes Deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monitoring-and-Observability"><span class="nav-number">8.3.</span> <span class="nav-text">Monitoring and Observability</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-Use-Cases-and-Examples"><span class="nav-number">9.</span> <span class="nav-text">Advanced Use Cases and Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Scenario-1-E-commerce-Flash-Sale-Testing"><span class="nav-number">9.1.</span> <span class="nav-text">Scenario 1: E-commerce Flash Sale Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scenario-2-Gradual-Ramp-up-Testing"><span class="nav-number">9.2.</span> <span class="nav-text">Scenario 2: Gradual Ramp-up Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scenario-3-API-Rate-Limiting-Validation"><span class="nav-number">9.3.</span> <span class="nav-text">Scenario 3: API Rate Limiting Validation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Error-Handling-and-Resilience"><span class="nav-number">10.</span> <span class="nav-text">Error Handling and Resilience</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Circuit-Breaker-Implementation"><span class="nav-number">10.1.</span> <span class="nav-text">Circuit Breaker Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Retry-Strategy-with-Backoff"><span class="nav-number">10.2.</span> <span class="nav-text">Retry Strategy with Backoff</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Graceful-Degradation"><span class="nav-number">10.3.</span> <span class="nav-text">Graceful Degradation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-and-Authentication"><span class="nav-number">11.</span> <span class="nav-text">Security and Authentication</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Secure-Test-Execution"><span class="nav-number">11.1.</span> <span class="nav-text">Secure Test Execution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSL-TLS-Configuration"><span class="nav-number">11.2.</span> <span class="nav-text">SSL&#x2F;TLS Configuration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Optimization-Techniques"><span class="nav-number">12.</span> <span class="nav-text">Performance Optimization Techniques</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory-Management"><span class="nav-number">12.1.</span> <span class="nav-text">Memory Management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU-Optimization"><span class="nav-number">12.2.</span> <span class="nav-text">CPU Optimization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshooting-Common-Issues"><span class="nav-number">13.</span> <span class="nav-text">Troubleshooting Common Issues</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Connection-Pool-Exhaustion"><span class="nav-number">13.1.</span> <span class="nav-text">Connection Pool Exhaustion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory-Leak-Detection"><span class="nav-number">13.2.</span> <span class="nav-text">Memory Leak Detection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interview-Questions-and-Insights"><span class="nav-number">14.</span> <span class="nav-text">Interview Questions and Insights</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Best-Practices-and-Recommendations"><span class="nav-number">15.</span> <span class="nav-text">Best Practices and Recommendations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-Planning-and-Design"><span class="nav-number">15.1.</span> <span class="nav-text">Test Planning and Design</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Production-Readiness-Checklist"><span class="nav-number">15.2.</span> <span class="nav-text">Production Readiness Checklist</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scalability-Considerations"><span class="nav-number">15.3.</span> <span class="nav-text">Scalability Considerations</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#External-Resources"><span class="nav-number">16.</span> <span class="nav-text">External Resources</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Design Distributed Pressure Test Tool By Zookeeper | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Design Distributed Pressure Test Tool By Zookeeper
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-06-29 16:46:34" itemprop="dateCreated datePublished" datetime="2025-06-29T16:46:34+08:00">2025-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-30 14:40:16" itemprop="dateModified" datetime="2025-06-30T14:40:16+08:00">2025-06-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/system-design/" itemprop="url" rel="index"><span itemprop="name">system-design</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="System-Architecture-Overview"><a href="#System-Architecture-Overview" class="headerlink" title="System Architecture Overview"></a>System Architecture Overview</h2><p>A distributed pressure testing system leverages multiple client nodes coordinated through Apache Zookeeper to simulate high-load scenarios against target services. This architecture provides horizontal scalability, centralized coordination, and real-time monitoring capabilities.</p>
<pre>
<code class="mermaid">
graph TB
subgraph &quot;Control Layer&quot;
    Master[MasterTestNode]
    Dashboard[Dashboard Website]
    ZK[Zookeeper Cluster]
end

subgraph &quot;Execution Layer&quot;
    Client1[ClientTestNode 1]
    Client2[ClientTestNode 2]
    Client3[ClientTestNode N]
end

subgraph &quot;Target Layer&quot;
    Service[Target Microservice]
    DB[(Database)]
end

Master --&gt; ZK
Dashboard --&gt; Master
Client1 --&gt; ZK
Client2 --&gt; ZK
Client3 --&gt; ZK
Client1 --&gt; Service
Client2 --&gt; Service
Client3 --&gt; Service
Service --&gt; DB

ZK -.-&gt; Master
ZK -.-&gt; Client1
ZK -.-&gt; Client2
ZK -.-&gt; Client3
</code>
</pre>

<p><strong>Interview Question</strong>: <em>Why choose Zookeeper for coordination instead of a message queue like Kafka or RabbitMQ?</em></p>
<p><strong>Answer</strong>: Zookeeper provides strong consistency guarantees, distributed configuration management, and service discovery capabilities essential for test coordination. Unlike message queues that focus on data streaming, Zookeeper excels at maintaining cluster state, leader election, and distributed locks - critical for coordinating test execution phases and preventing race conditions.</p>
<h2 id="Core-Components-Design"><a href="#Core-Components-Design" class="headerlink" title="Core Components Design"></a>Core Components Design</h2><h3 id="ClientTestNode-Architecture"><a href="#ClientTestNode-Architecture" class="headerlink" title="ClientTestNode Architecture"></a>ClientTestNode Architecture</h3><p>The ClientTestNode is the workhorse of the system, responsible for generating load and collecting metrics. Built on Netty for high-performance HTTP communication.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientTestNode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZookeeperClient zkClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NettyHttpClient httpClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetricsCollector metricsCollector;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TaskConfiguration taskConfig;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Register with Zookeeper</span></span><br><span class="line">        zkClient.registerNode(getNodeInfo());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Initialize Netty client</span></span><br><span class="line">        httpClient.initialize(taskConfig.getNettyConfig());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Start metrics collection</span></span><br><span class="line">        metricsCollector.startCollection();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TestTask</span> <span class="variable">task</span> <span class="operator">=</span> zkClient.getTestTask();</span><br><span class="line">        </span><br><span class="line">        <span class="type">EventLoopGroup</span> <span class="variable">group</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(task.getThreadCount());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>()</span><br><span class="line">                .group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .handler(<span class="keyword">new</span> <span class="title class_">HttpClientInitializer</span>(metricsCollector));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Execute concurrent requests</span></span><br><span class="line">            IntStream.range(<span class="number">0</span>, task.getConcurrency())</span><br><span class="line">                .parallel()</span><br><span class="line">                .forEach(i -&gt; executeRequest(bootstrap, task));</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">executeRequest</span><span class="params">(Bootstrap bootstrap, TestTask task)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChannelFuture</span> <span class="variable">future</span> <span class="operator">=</span> bootstrap.connect(task.getTargetHost(), task.getTargetPort());</span><br><span class="line">        future.addListener((ChannelFutureListener) channelFuture -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (channelFuture.isSuccess()) &#123;</span><br><span class="line">                <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> channelFuture.channel();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Build HTTP request</span></span><br><span class="line">                <span class="type">FullHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFullHttpRequest</span>(</span><br><span class="line">                    HTTP_1_1, HttpMethod.valueOf(task.getMethod()), task.getPath());</span><br><span class="line">                request.headers().set(HttpHeaderNames.HOST, task.getTargetHost());</span><br><span class="line">                request.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.KEEP_ALIVE);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Send request and handle response</span></span><br><span class="line">                channel.writeAndFlush(request);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MasterTestNode-Coordination"><a href="#MasterTestNode-Coordination" class="headerlink" title="MasterTestNode Coordination"></a>MasterTestNode Coordination</h3><p>The MasterTestNode orchestrates the entire testing process, manages client lifecycle, and aggregates results.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MasterTestNode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZookeeperClient zkClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TestTaskManager taskManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ResultAggregator resultAggregator;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startTest</span><span class="params">(TestConfiguration config)</span> &#123;</span><br><span class="line">        <span class="comment">// Create test task in Zookeeper</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">taskPath</span> <span class="operator">=</span> zkClient.createTestTask(config);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Wait for client nodes to register</span></span><br><span class="line">        waitForClientNodes(config.getRequiredClientCount());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Distribute task configuration</span></span><br><span class="line">        distributeTaskConfiguration(taskPath, config);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Monitor test execution</span></span><br><span class="line">        monitorTestExecution(taskPath);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">waitForClientNodes</span><span class="params">(<span class="type">int</span> requiredCount)</span> &#123;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(requiredCount);</span><br><span class="line">        </span><br><span class="line">        zkClient.watchChildren(<span class="string">&quot;/test/clients&quot;</span>, (event) -&gt; &#123;</span><br><span class="line">            List&lt;String&gt; children = zkClient.getChildren(<span class="string">&quot;/test/clients&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (children.size() &gt;= requiredCount) &#123;</span><br><span class="line">                latch.countDown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            latch.await(<span class="number">30</span>, TimeUnit.SECONDS);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TestExecutionException</span>(<span class="string">&quot;Timeout waiting for client nodes&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TestResult <span class="title function_">aggregateResults</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; clientNodes = zkClient.getChildren(<span class="string">&quot;/test/clients&quot;</span>);</span><br><span class="line">        List&lt;ClientMetrics&gt; allMetrics = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String clientNode : clientNodes) &#123;</span><br><span class="line">            <span class="type">ClientMetrics</span> <span class="variable">metrics</span> <span class="operator">=</span> zkClient.getData(<span class="string">&quot;/test/results/&quot;</span> + clientNode, ClientMetrics.class);</span><br><span class="line">            allMetrics.add(metrics);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> resultAggregator.aggregate(allMetrics);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Task-Configuration-Management"><a href="#Task-Configuration-Management" class="headerlink" title="Task Configuration Management"></a>Task Configuration Management</h2><h3 id="Configuration-Structure"><a href="#Configuration-Structure" class="headerlink" title="Configuration Structure"></a>Configuration Structure</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonSerialize</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaskConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String testId;</span><br><span class="line">    <span class="keyword">private</span> String targetUrl;</span><br><span class="line">    <span class="keyword">private</span> HttpMethod method;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; headers;</span><br><span class="line">    <span class="keyword">private</span> String requestBody;</span><br><span class="line">    <span class="keyword">private</span> LoadPattern loadPattern;</span><br><span class="line">    <span class="keyword">private</span> Duration duration;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> concurrency;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> qps;</span><br><span class="line">    <span class="keyword">private</span> RetryPolicy retryPolicy;</span><br><span class="line">    <span class="keyword">private</span> NettyConfiguration nettyConfig;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LoadPattern</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> LoadType type; <span class="comment">// CONSTANT, RAMP_UP, SPIKE, STEP</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;LoadStep&gt; steps;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Data</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LoadStep</span> &#123;</span><br><span class="line">            <span class="keyword">private</span> Duration duration;</span><br><span class="line">            <span class="keyword">private</span> <span class="type">int</span> targetQps;</span><br><span class="line">            <span class="keyword">private</span> <span class="type">int</span> concurrency;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">NettyConfiguration</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">connectTimeoutMs</span> <span class="operator">=</span> <span class="number">5000</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">readTimeoutMs</span> <span class="operator">=</span> <span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxConnections</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">keepAlive</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">workerThreads</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors() * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dynamic-Configuration-Updates"><a href="#Dynamic-Configuration-Updates" class="headerlink" title="Dynamic Configuration Updates"></a>Dynamic Configuration Updates</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicConfigurationManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZookeeperClient zkClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> TaskConfiguration currentConfig;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">configPath</span> <span class="operator">=</span> <span class="string">&quot;/test/config&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Watch for configuration changes</span></span><br><span class="line">        zkClient.watchData(configPath, (event) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (event.getType() == EventType.NodeDataChanged) &#123;</span><br><span class="line">                updateConfiguration(zkClient.getData(configPath, TaskConfiguration.class));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateConfiguration</span><span class="params">(TaskConfiguration newConfig)</span> &#123;</span><br><span class="line">        <span class="type">TaskConfiguration</span> <span class="variable">oldConfig</span> <span class="operator">=</span> <span class="built_in">this</span>.currentConfig;</span><br><span class="line">        <span class="built_in">this</span>.currentConfig = newConfig;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Apply hot configuration changes</span></span><br><span class="line">        <span class="keyword">if</span> (oldConfig != <span class="literal">null</span> &amp;&amp; !Objects.equals(oldConfig.getQps(), newConfig.getQps())) &#123;</span><br><span class="line">            adjustLoadRate(newConfig.getQps());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (oldConfig != <span class="literal">null</span> &amp;&amp; !Objects.equals(oldConfig.getConcurrency(), newConfig.getConcurrency())) &#123;</span><br><span class="line">            adjustConcurrency(newConfig.getConcurrency());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">adjustLoadRate</span><span class="params">(<span class="type">int</span> newQps)</span> &#123;</span><br><span class="line">        <span class="comment">// Implement rate limiter adjustment</span></span><br><span class="line">        RateLimiter.create(newQps);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Question</strong>: <em>How do you handle configuration consistency across distributed nodes during runtime updates?</em></p>
<p><strong>Answer</strong>: We use Zookeeperâ€™s atomic operations and watches to ensure configuration consistency. When the master updates configuration, it uses conditional writes (compare-and-swap) to prevent conflicts. Client nodes register watches on configuration znodes and receive immediate notifications. We implement a two-phase commit pattern: first distribute the new configuration, then send an activation signal once all nodes acknowledge receipt.</p>
<h2 id="Metrics-Collection-and-Statistics"><a href="#Metrics-Collection-and-Statistics" class="headerlink" title="Metrics Collection and Statistics"></a>Metrics Collection and Statistics</h2><h3 id="Real-time-Metrics-Collection"><a href="#Real-time-Metrics-Collection" class="headerlink" title="Real-time Metrics Collection"></a>Real-time Metrics Collection</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsCollector</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer responseTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter requestCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter errorCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Histogram responseSizeHistogram;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ScheduledExecutorService scheduler;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MetricsCollector</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MetricRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MetricRegistry</span>();</span><br><span class="line">        <span class="built_in">this</span>.responseTimer = registry.timer(<span class="string">&quot;http.response.time&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.requestCounter = registry.counter(<span class="string">&quot;http.requests.total&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.errorCounter = registry.counter(<span class="string">&quot;http.errors.total&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.responseSizeHistogram = registry.histogram(<span class="string">&quot;http.response.size&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.scheduler = Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordRequest</span><span class="params">(<span class="type">long</span> responseTimeNanos, <span class="type">int</span> statusCode, <span class="type">int</span> responseSize)</span> &#123;</span><br><span class="line">        responseTimer.update(responseTimeNanos, TimeUnit.NANOSECONDS);</span><br><span class="line">        requestCounter.inc();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (statusCode &gt;= <span class="number">400</span>) &#123;</span><br><span class="line">            errorCounter.inc();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        responseSizeHistogram.update(responseSize);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> MetricsSnapshot <span class="title function_">getSnapshot</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Snapshot</span> <span class="variable">timerSnapshot</span> <span class="operator">=</span> responseTimer.getSnapshot();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> MetricsSnapshot.builder()</span><br><span class="line">            .timestamp(System.currentTimeMillis())</span><br><span class="line">            .totalRequests(requestCounter.getCount())</span><br><span class="line">            .totalErrors(errorCounter.getCount())</span><br><span class="line">            .qps(calculateQPS())</span><br><span class="line">            .avgResponseTime(timerSnapshot.getMean())</span><br><span class="line">            .p95ResponseTime(timerSnapshot.get95thPercentile())</span><br><span class="line">            .p99ResponseTime(timerSnapshot.get99thPercentile())</span><br><span class="line">            .errorRate(calculateErrorRate())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateQPS</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">timeWindow</span> <span class="operator">=</span> <span class="number">1000</span>; <span class="comment">// 1 second</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> requestCounter.getCount() / ((currentTime - startTime) / <span class="number">1000.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 1000)</span> <span class="comment">// Report every second</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reportMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MetricsSnapshot</span> <span class="variable">snapshot</span> <span class="operator">=</span> getSnapshot();</span><br><span class="line">        zkClient.updateData(<span class="string">&quot;/test/metrics/&quot;</span> + nodeId, snapshot);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Advanced-Statistical-Calculations"><a href="#Advanced-Statistical-Calculations" class="headerlink" title="Advanced Statistical Calculations"></a>Advanced Statistical Calculations</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatisticalAnalyzer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TestResult <span class="title function_">calculateDetailedStatistics</span><span class="params">(List&lt;MetricsSnapshot&gt; snapshots)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (snapshots.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> TestResult.empty();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Calculate aggregated metrics</span></span><br><span class="line">        <span class="type">DoubleSummaryStatistics</span> <span class="variable">responseTimeStats</span> <span class="operator">=</span> snapshots.stream()</span><br><span class="line">            .mapToDouble(MetricsSnapshot::getAvgResponseTime)</span><br><span class="line">            .summaryStatistics();</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Calculate percentiles using HdrHistogram for accuracy</span></span><br><span class="line">        <span class="type">Histogram</span> <span class="variable">histogram</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Histogram</span>(<span class="number">3</span>);</span><br><span class="line">        snapshots.forEach(snapshot -&gt; </span><br><span class="line">            histogram.recordValue((<span class="type">long</span>) snapshot.getAvgResponseTime()));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Throughput analysis</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">totalQps</span> <span class="operator">=</span> snapshots.stream()</span><br><span class="line">            .mapToDouble(MetricsSnapshot::getQps)</span><br><span class="line">            .sum();</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Error rate analysis</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">totalRequests</span> <span class="operator">=</span> snapshots.stream()</span><br><span class="line">            .mapToDouble(MetricsSnapshot::getTotalRequests)</span><br><span class="line">            .sum();</span><br><span class="line">        <span class="type">double</span> <span class="variable">totalErrors</span> <span class="operator">=</span> snapshots.stream()</span><br><span class="line">            .mapToDouble(MetricsSnapshot::getTotalErrors)</span><br><span class="line">            .sum();</span><br><span class="line">        <span class="type">double</span> <span class="variable">overallErrorRate</span> <span class="operator">=</span> totalErrors / totalRequests * <span class="number">100</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Stability analysis</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">responseTimeStdDev</span> <span class="operator">=</span> calculateStandardDeviation(</span><br><span class="line">            snapshots.stream()</span><br><span class="line">                .mapToDouble(MetricsSnapshot::getAvgResponseTime)</span><br><span class="line">                .toArray());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> TestResult.builder()</span><br><span class="line">            .totalQps(totalQps)</span><br><span class="line">            .avgResponseTime(responseTimeStats.getAverage())</span><br><span class="line">            .minResponseTime(responseTimeStats.getMin())</span><br><span class="line">            .maxResponseTime(responseTimeStats.getMax())</span><br><span class="line">            .p50ResponseTime(histogram.getValueAtPercentile(<span class="number">50</span>))</span><br><span class="line">            .p95ResponseTime(histogram.getValueAtPercentile(<span class="number">95</span>))</span><br><span class="line">            .p99ResponseTime(histogram.getValueAtPercentile(<span class="number">99</span>))</span><br><span class="line">            .p999ResponseTime(histogram.getValueAtPercentile(<span class="number">99.9</span>))</span><br><span class="line">            .errorRate(overallErrorRate)</span><br><span class="line">            .responseTimeStdDev(responseTimeStdDev)</span><br><span class="line">            .stabilityScore(calculateStabilityScore(responseTimeStdDev, overallErrorRate))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateStabilityScore</span><span class="params">(<span class="type">double</span> stdDev, <span class="type">double</span> errorRate)</span> &#123;</span><br><span class="line">        <span class="comment">// Custom stability scoring algorithm</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">variabilityScore</span> <span class="operator">=</span> Math.max(<span class="number">0</span>, <span class="number">100</span> - (stdDev / <span class="number">10</span>)); <span class="comment">// Lower std dev = higher score</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">reliabilityScore</span> <span class="operator">=</span> Math.max(<span class="number">0</span>, <span class="number">100</span> - (errorRate * <span class="number">2</span>)); <span class="comment">// Lower error rate = higher score</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (variabilityScore + reliabilityScore) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Question</strong>: <em>How do you ensure accurate percentile calculations in a distributed environment?</em></p>
<p><strong>Answer</strong>: We use HdrHistogram library for accurate percentile calculations with minimal memory overhead. Each client node maintains local histograms and periodically serializes them to Zookeeper. The master node deserializes and merges histograms using HdrHistogramâ€™s built-in merge capabilities, which maintains accuracy across distributed measurements. This approach is superior to simple averaging and provides true percentile values across the entire distributed system.</p>
<h2 id="Zookeeper-Integration-Patterns"><a href="#Zookeeper-Integration-Patterns" class="headerlink" title="Zookeeper Integration Patterns"></a>Zookeeper Integration Patterns</h2><h3 id="Service-Discovery-and-Registration"><a href="#Service-Discovery-and-Registration" class="headerlink" title="Service Discovery and Registration"></a>Service Discovery and Registration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZookeeperServiceRegistry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CuratorFramework client;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServiceDiscovery&lt;TestNodeMetadata&gt; serviceDiscovery;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ZookeeperServiceRegistry</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.client = CuratorFrameworkFactory.newClient(</span><br><span class="line">            <span class="string">&quot;localhost:2181&quot;</span>, </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">1000</span>, <span class="number">3</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">this</span>.serviceDiscovery = ServiceDiscoveryBuilder.builder(TestNodeMetadata.class)</span><br><span class="line">            .client(client)</span><br><span class="line">            .basePath(<span class="string">&quot;/test/services&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerTestNode</span><span class="params">(TestNodeInfo nodeInfo)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ServiceInstance&lt;TestNodeMetadata&gt; instance = ServiceInstance.&lt;TestNodeMetadata&gt;builder()</span><br><span class="line">                .name(<span class="string">&quot;test-client&quot;</span>)</span><br><span class="line">                .id(nodeInfo.getNodeId())</span><br><span class="line">                .address(nodeInfo.getHost())</span><br><span class="line">                .port(nodeInfo.getPort())</span><br><span class="line">                .payload(<span class="keyword">new</span> <span class="title class_">TestNodeMetadata</span>(nodeInfo))</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">            serviceDiscovery.registerService(instance);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Create ephemeral sequential node for load balancing</span></span><br><span class="line">            client.create()</span><br><span class="line">                .withMode(CreateMode.EPHEMERAL_SEQUENTIAL)</span><br><span class="line">                .forPath(<span class="string">&quot;/test/clients/client-&quot;</span>, nodeInfo.serialize());</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceRegistrationException</span>(<span class="string">&quot;Failed to register test node&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;TestNodeInfo&gt; <span class="title function_">discoverAvailableNodes</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Collection&lt;ServiceInstance&lt;TestNodeMetadata&gt;&gt; instances = </span><br><span class="line">                serviceDiscovery.queryForInstances(<span class="string">&quot;test-client&quot;</span>);</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">return</span> instances.stream()</span><br><span class="line">                .map(instance -&gt; instance.getPayload().getNodeInfo())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceDiscoveryException</span>(<span class="string">&quot;Failed to discover test nodes&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Distributed-Coordination-and-Synchronization"><a href="#Distributed-Coordination-and-Synchronization" class="headerlink" title="Distributed Coordination and Synchronization"></a>Distributed Coordination and Synchronization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistributedTestCoordinator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CuratorFramework client;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DistributedBarrier startBarrier;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DistributedBarrier endBarrier;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InterProcessMutex configLock;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DistributedTestCoordinator</span><span class="params">(CuratorFramework client)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.client = client;</span><br><span class="line">        <span class="built_in">this</span>.startBarrier = <span class="keyword">new</span> <span class="title class_">DistributedBarrier</span>(client, <span class="string">&quot;/test/barriers/start&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.endBarrier = <span class="keyword">new</span> <span class="title class_">DistributedBarrier</span>(client, <span class="string">&quot;/test/barriers/end&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.configLock = <span class="keyword">new</span> <span class="title class_">InterProcessMutex</span>(client, <span class="string">&quot;/test/locks/config&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">coordinateTestStart</span><span class="params">(<span class="type">int</span> expectedClients)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Wait for all clients to be ready</span></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">clientReadyLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(expectedClients);</span><br><span class="line">        </span><br><span class="line">        <span class="type">PathChildrenCache</span> <span class="variable">clientCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PathChildrenCache</span>(client, <span class="string">&quot;/test/clients&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        clientCache.getListenable().addListener((cache, event) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (event.getType() == PathChildrenCacheEvent.Type.CHILD_ADDED) &#123;</span><br><span class="line">                clientReadyLatch.countDown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        clientCache.start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Wait for all clients with timeout</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">allReady</span> <span class="operator">=</span> clientReadyLatch.await(<span class="number">30</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span> (!allReady) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TestCoordinationException</span>(<span class="string">&quot;Not all clients ready within timeout&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Set start barrier to begin test</span></span><br><span class="line">        startBarrier.setBarrier();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Signal all clients to start</span></span><br><span class="line">        client.setData().forPath(<span class="string">&quot;/test/control/command&quot;</span>, <span class="string">&quot;START&quot;</span>.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">waitForTestCompletion</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Wait for end barrier</span></span><br><span class="line">        endBarrier.waitOnBarrier();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Cleanup</span></span><br><span class="line">        cleanupTestResources();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateConfigurationSafely</span><span class="params">(TaskConfiguration newConfig)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Acquire distributed lock</span></span><br><span class="line">        <span class="keyword">if</span> (configLock.acquire(<span class="number">10</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Atomic configuration update</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">configPath</span> <span class="operator">=</span> <span class="string">&quot;/test/config&quot;</span>;</span><br><span class="line">                <span class="type">Stat</span> <span class="variable">stat</span> <span class="operator">=</span> client.checkExists().forPath(configPath);</span><br><span class="line">                </span><br><span class="line">                client.setData()</span><br><span class="line">                    .withVersion(stat.getVersion())</span><br><span class="line">                    .forPath(configPath, JsonUtils.toJson(newConfig).getBytes());</span><br><span class="line">                    </span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                configLock.release();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Failed to acquire configuration lock&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Question</strong>: <em>How do you handle network partitions and split-brain scenarios in your distributed testing system?</em></p>
<p><strong>Answer</strong>: We implement several safeguards: 1) Use Zookeeperâ€™s session timeouts to detect node failures quickly. 2) Implement a master election process using Curatorâ€™s LeaderSelector to prevent split-brain. 3) Use distributed barriers to ensure synchronized test phases. 4) Implement exponential backoff retry policies for transient network issues. 5) Set minimum quorum requirements - tests only proceed if sufficient client nodes are available. 6) Use Zookeeperâ€™s strong consistency guarantees to maintain authoritative state.</p>
<h2 id="High-Performance-Netty-Implementation"><a href="#High-Performance-Netty-Implementation" class="headerlink" title="High-Performance Netty Implementation"></a>High-Performance Netty Implementation</h2><h3 id="Netty-HTTP-Client-Configuration"><a href="#Netty-HTTP-Client-Configuration" class="headerlink" title="Netty HTTP Client Configuration"></a>Netty HTTP Client Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyHttpClientConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> NettyHttpClient <span class="title function_">createHttpClient</span><span class="params">(TaskConfiguration config)</span> &#123;</span><br><span class="line">        <span class="type">NettyConfiguration</span> <span class="variable">nettyConfig</span> <span class="operator">=</span> config.getNettyConfig();</span><br><span class="line">        </span><br><span class="line">        <span class="type">EventLoopGroup</span> <span class="variable">workerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(nettyConfig.getWorkerThreads());</span><br><span class="line">        </span><br><span class="line">        <span class="type">Bootstrap</span> <span class="variable">bootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>()</span><br><span class="line">            .group(workerGroup)</span><br><span class="line">            .channel(NioSocketChannel.class)</span><br><span class="line">            .option(ChannelOption.SO_KEEPALIVE, nettyConfig.isKeepAlive())</span><br><span class="line">            .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, nettyConfig.getConnectTimeoutMs())</span><br><span class="line">            .option(ChannelOption.SO_REUSEADDR, <span class="literal">true</span>)</span><br><span class="line">            .option(ChannelOption.TCP_NODELAY, <span class="literal">true</span>)</span><br><span class="line">            .option(ChannelOption.ALLOCATOR, PooledByteBufAllocator.DEFAULT)</span><br><span class="line">            .handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> &#123;</span><br><span class="line">                    <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// HTTP codec</span></span><br><span class="line">                    pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpClientCodec</span>());</span><br><span class="line">                    pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpObjectAggregator</span>(<span class="number">1048576</span>)); <span class="comment">// 1MB max</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// Compression</span></span><br><span class="line">                    pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpContentDecompressor</span>());</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// Timeout handlers</span></span><br><span class="line">                    pipeline.addLast(<span class="keyword">new</span> <span class="title class_">ReadTimeoutHandler</span>(nettyConfig.getReadTimeoutMs(), TimeUnit.MILLISECONDS));</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// Custom handler for metrics and response processing</span></span><br><span class="line">                    pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpResponseHandler</span>());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NettyHttpClient</span>(bootstrap, workerGroup);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="High-Performance-Request-Execution"><a href="#High-Performance-Request-Execution" class="headerlink" title="High-Performance Request Execution"></a>High-Performance Request Execution</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpResponseHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;FullHttpResponse&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetricsCollector metricsCollector;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicLong</span> <span class="variable">requestStartTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> &#123;</span><br><span class="line">        requestStartTime.set(System.nanoTime());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, FullHttpResponse response)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">responseTime</span> <span class="operator">=</span> System.nanoTime() - requestStartTime.get();</span><br><span class="line">        <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.status().code();</span><br><span class="line">        <span class="type">int</span> <span class="variable">responseSize</span> <span class="operator">=</span> response.content().readableBytes();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Record metrics</span></span><br><span class="line">        metricsCollector.recordRequest(responseTime, statusCode, responseSize);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Handle response based on status</span></span><br><span class="line">        <span class="keyword">if</span> (statusCode &gt;= <span class="number">200</span> &amp;&amp; statusCode &lt; <span class="number">300</span>) &#123;</span><br><span class="line">            handleSuccessResponse(response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            handleErrorResponse(response, statusCode);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Close connection if not keep-alive</span></span><br><span class="line">        <span class="keyword">if</span> (!HttpUtil.isKeepAlive(response)) &#123;</span><br><span class="line">            ctx.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">responseTime</span> <span class="operator">=</span> System.nanoTime() - requestStartTime.get();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Record error metrics</span></span><br><span class="line">        metricsCollector.recordRequest(responseTime, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        logger.error(<span class="string">&quot;Request failed&quot;</span>, cause);</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleSuccessResponse</span><span class="params">(FullHttpResponse response)</span> &#123;</span><br><span class="line">        <span class="comment">// Process successful response</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> response.headers().get(HttpHeaderNames.CONTENT_TYPE);</span><br><span class="line">        <span class="type">ByteBuf</span> <span class="variable">content</span> <span class="operator">=</span> response.content();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Optional: Validate response content</span></span><br><span class="line">        <span class="keyword">if</span> (contentType != <span class="literal">null</span> &amp;&amp; contentType.contains(<span class="string">&quot;application/json&quot;</span>)) &#123;</span><br><span class="line">            validateJsonResponse(content.toString(StandardCharsets.UTF_8));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Connection-Pool-Management"><a href="#Connection-Pool-Management" class="headerlink" title="Connection Pool Management"></a>Connection Pool Management</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyConnectionPoolManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Channel&gt; connectionPool = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">connectionCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maxConnections;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NettyConnectionPoolManager</span><span class="params">(NettyConfiguration config)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maxConnections = config.getMaxConnections();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Channel <span class="title function_">getConnection</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> host + <span class="string">&quot;:&quot;</span> + port;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> connectionPool.computeIfAbsent(key, k -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (connectionCount.get() &gt;= maxConnections) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConnectionPoolExhaustedException</span>(<span class="string">&quot;Connection pool exhausted&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> createNewConnection(host, port);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Channel <span class="title function_">createNewConnection</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">future</span> <span class="operator">=</span> bootstrap.connect(host, port);</span><br><span class="line">            <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> future.sync().channel();</span><br><span class="line">            </span><br><span class="line">            connectionCount.incrementAndGet();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Add close listener to update connection count</span></span><br><span class="line">            channel.closeFuture().addListener(closeFuture -&gt; &#123;</span><br><span class="line">                connectionCount.decrementAndGet();</span><br><span class="line">                connectionPool.remove(host + <span class="string">&quot;:&quot;</span> + port);</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> channel;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConnectionException</span>(<span class="string">&quot;Failed to create connection&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">closeAllConnections</span><span class="params">()</span> &#123;</span><br><span class="line">        connectionPool.values().forEach(Channel::close);</span><br><span class="line">        connectionPool.clear();</span><br><span class="line">        connectionCount.set(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Dashboard-and-Visualization"><a href="#Dashboard-and-Visualization" class="headerlink" title="Dashboard and Visualization"></a>Dashboard and Visualization</h2><h3 id="Real-time-Dashboard-Backend"><a href="#Real-time-Dashboard-Backend" class="headerlink" title="Real-time Dashboard Backend"></a>Real-time Dashboard Backend</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/dashboard&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DashboardController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TestResultService testResultService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SimpMessagingTemplate messagingTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/tests/&#123;testId&#125;/metrics&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;TestMetrics&gt; <span class="title function_">getCurrentMetrics</span><span class="params">(<span class="meta">@PathVariable</span> String testId)</span> &#123;</span><br><span class="line">        <span class="type">TestMetrics</span> <span class="variable">metrics</span> <span class="operator">=</span> testResultService.getCurrentMetrics(testId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(metrics);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/tests/&#123;testId&#125;/timeline&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;TimelineData&gt;&gt; <span class="title function_">getMetricsTimeline</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> String testId,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;300&quot;)</span> <span class="type">int</span> seconds)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        List&lt;TimelineData&gt; timeline = testResultService.getMetricsTimeline(testId, seconds);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(timeline);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMetricsUpdate</span><span class="params">(MetricsUpdateEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// Broadcast real-time metrics to WebSocket clients</span></span><br><span class="line">        messagingTemplate.convertAndSend(</span><br><span class="line">            <span class="string">&quot;/topic/metrics/&quot;</span> + event.getTestId(),</span><br><span class="line">            event.getMetrics()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/tests/&#123;testId&#125;/report&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;TestReport&gt; <span class="title function_">generateReport</span><span class="params">(<span class="meta">@PathVariable</span> String testId)</span> &#123;</span><br><span class="line">        <span class="type">TestReport</span> <span class="variable">report</span> <span class="operator">=</span> testResultService.generateComprehensiveReport(testId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(report);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WebSocket-Configuration-for-Real-time-Updates"><a href="#WebSocket-Configuration-for-Real-time-Updates" class="headerlink" title="WebSocket Configuration for Real-time Updates"></a>WebSocket Configuration for Real-time Updates</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title class_">WebSocketMessageBrokerConfigurer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageBroker</span><span class="params">(MessageBrokerRegistry config)</span> &#123;</span><br><span class="line">        config.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>);</span><br><span class="line">        config.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> &#123;</span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/websocket&quot;</span>)</span><br><span class="line">            .setAllowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">            .withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Frontend-Dashboard-Components"><a href="#Frontend-Dashboard-Components" class="headerlink" title="Frontend Dashboard Components"></a>Frontend Dashboard Components</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Real-time metrics dashboard component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MetricsDashboard</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">testId</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">testId</span> = testId;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">socket</span> = <span class="keyword">new</span> <span class="title class_">SockJS</span>(<span class="string">&#x27;/websocket&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stompClient</span> = <span class="title class_">Stomp</span>.<span class="title function_">over</span>(<span class="variable language_">this</span>.<span class="property">socket</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span> = &#123;&#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initializeCharts</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">connectWebSocket</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">initializeCharts</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// QPS Chart</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">qps</span> = <span class="keyword">new</span> <span class="title class_">Chart</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;qpsChart&#x27;</span>), &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">labels</span>: [],</span><br><span class="line">                <span class="attr">datasets</span>: [&#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;QPS&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: [],</span><br><span class="line">                    <span class="attr">borderColor</span>: <span class="string">&#x27;rgb(75, 192, 192)&#x27;</span>,</span><br><span class="line">                    <span class="attr">tension</span>: <span class="number">0.1</span></span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">responsive</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">scales</span>: &#123;</span><br><span class="line">                    <span class="attr">y</span>: &#123;</span><br><span class="line">                        <span class="attr">beginAtZero</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">plugins</span>: &#123;</span><br><span class="line">                    <span class="attr">title</span>: &#123;</span><br><span class="line">                        <span class="attr">display</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">text</span>: <span class="string">&#x27;Queries Per Second&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Response Time Chart</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">responseTime</span> = <span class="keyword">new</span> <span class="title class_">Chart</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;responseTimeChart&#x27;</span>), &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">labels</span>: [],</span><br><span class="line">                <span class="attr">datasets</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;Average&#x27;</span>,</span><br><span class="line">                        <span class="attr">data</span>: [],</span><br><span class="line">                        <span class="attr">borderColor</span>: <span class="string">&#x27;rgb(54, 162, 235)&#x27;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;P95&#x27;</span>,</span><br><span class="line">                        <span class="attr">data</span>: [],</span><br><span class="line">                        <span class="attr">borderColor</span>: <span class="string">&#x27;rgb(255, 206, 86)&#x27;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;P99&#x27;</span>,</span><br><span class="line">                        <span class="attr">data</span>: [],</span><br><span class="line">                        <span class="attr">borderColor</span>: <span class="string">&#x27;rgb(255, 99, 132)&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">responsive</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">scales</span>: &#123;</span><br><span class="line">                    <span class="attr">y</span>: &#123;</span><br><span class="line">                        <span class="attr">beginAtZero</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">title</span>: &#123;</span><br><span class="line">                            <span class="attr">display</span>: <span class="literal">true</span>,</span><br><span class="line">                            <span class="attr">text</span>: <span class="string">&#x27;Response Time (ms)&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">connectWebSocket</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stompClient</span>.<span class="title function_">connect</span>(&#123;&#125;, <span class="function">(<span class="params">frame</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Connected: &#x27;</span> + frame);</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">stompClient</span>.<span class="title function_">subscribe</span>(<span class="string">`/topic/metrics/<span class="subst">$&#123;<span class="variable language_">this</span>.testId&#125;</span>`</span>, <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> metrics = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(message.<span class="property">body</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">updateCharts</span>(metrics);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">updateMetricCards</span>(metrics);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">updateCharts</span>(<span class="params">metrics</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> timestamp = <span class="keyword">new</span> <span class="title class_">Date</span>(metrics.<span class="property">timestamp</span>).<span class="title function_">toLocaleTimeString</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update QPS chart</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addDataPoint</span>(<span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">qps</span>, timestamp, metrics.<span class="property">qps</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update Response Time chart</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addDataPoint</span>(<span class="variable language_">this</span>.<span class="property">charts</span>.<span class="property">responseTime</span>, timestamp, [</span><br><span class="line">            metrics.<span class="property">avgResponseTime</span>,</span><br><span class="line">            metrics.<span class="property">p95ResponseTime</span>,</span><br><span class="line">            metrics.<span class="property">p99ResponseTime</span></span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">addDataPoint</span>(<span class="params">chart, label, data</span>) &#123;</span><br><span class="line">        chart.<span class="property">data</span>.<span class="property">labels</span>.<span class="title function_">push</span>(label);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(data)) &#123;</span><br><span class="line">            data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">value, index</span>) =&gt;</span> &#123;</span><br><span class="line">                chart.<span class="property">data</span>.<span class="property">datasets</span>[index].<span class="property">data</span>.<span class="title function_">push</span>(value);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            chart.<span class="property">data</span>.<span class="property">datasets</span>[<span class="number">0</span>].<span class="property">data</span>.<span class="title function_">push</span>(data);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Keep only last 50 data points</span></span><br><span class="line">        <span class="keyword">if</span> (chart.<span class="property">data</span>.<span class="property">labels</span>.<span class="property">length</span> &gt; <span class="number">50</span>) &#123;</span><br><span class="line">            chart.<span class="property">data</span>.<span class="property">labels</span>.<span class="title function_">shift</span>();</span><br><span class="line">            chart.<span class="property">data</span>.<span class="property">datasets</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">dataset</span> =&gt;</span> dataset.<span class="property">data</span>.<span class="title function_">shift</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        chart.<span class="title function_">update</span>(<span class="string">&#x27;none&#x27;</span>); <span class="comment">// No animation for better performance</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">updateMetricCards</span>(<span class="params">metrics</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;currentQps&#x27;</span>).<span class="property">textContent</span> = metrics.<span class="property">qps</span>.<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;avgResponseTime&#x27;</span>).<span class="property">textContent</span> = metrics.<span class="property">avgResponseTime</span>.<span class="title function_">toFixed</span>(<span class="number">2</span>) + <span class="string">&#x27; ms&#x27;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;errorRate&#x27;</span>).<span class="property">textContent</span> = (metrics.<span class="property">errorRate</span> * <span class="number">100</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>) + <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;activeConnections&#x27;</span>).<span class="property">textContent</span> = metrics.<span class="property">activeConnections</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Production-Deployment-Considerations"><a href="#Production-Deployment-Considerations" class="headerlink" title="Production Deployment Considerations"></a>Production Deployment Considerations</h2><h3 id="Docker-Configuration"><a href="#Docker-Configuration" class="headerlink" title="Docker Configuration"></a>Docker Configuration</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ClientTestNode Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span>-jre-slim</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install monitoring tools</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    curl \</span></span><br><span class="line"><span class="language-bash">    netcat \</span></span><br><span class="line"><span class="language-bash">    htop \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/client-test-node.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JVM optimization for load testing</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;-Xms2g -Xmx4g -XX:+UseG1GC -XX:+UseStringDeduplication -XX:MaxGCPauseMillis=200 -Dio.netty.allocator.type=pooled -Dio.netty.allocator.numDirectArenas=8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=30s --<span class="built_in">timeout</span>=10s --start-period=60s --retries=3 \</span></span><br><span class="line"><span class="language-bash">  CMD curl -f http://localhost:8080/actuator/health || <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;java <span class="variable">$JAVA_OPTS</span> -jar app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="Kubernetes-Deployment"><a href="#Kubernetes-Deployment" class="headerlink" title="Kubernetes Deployment"></a>Kubernetes Deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client-test-node-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">client-test-node</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">client-test-node</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">client-test-node</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">client-test-node</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">client-test-node</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">your-registry/client-test-node:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8081</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ZOOKEEPER_HOSTS</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;zookeeper:2181&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODE_ID</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_IP</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;4Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;2000m&quot;</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/ready</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">client-test-node-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">client-test-node</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metrics</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8081</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure>

<h3 id="Monitoring-and-Observability"><a href="#Monitoring-and-Observability" class="headerlink" title="Monitoring and Observability"></a>Monitoring and Observability</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemMonitor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ScheduledExecutorService scheduler;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SystemMonitor</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        <span class="built_in">this</span>.scheduler = Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line">        initializeMetrics();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initializeMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// JVM metrics</span></span><br><span class="line">        Metrics.gauge(<span class="string">&quot;jvm.memory.heap.used&quot;</span>, <span class="built_in">this</span>, monitor -&gt; getHeapMemoryUsed());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;jvm.memory.heap.max&quot;</span>, <span class="built_in">this</span>, monitor -&gt; getHeapMemoryMax());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;jvm.gc.pause&quot;</span>, <span class="built_in">this</span>, monitor -&gt; getGCPauseTime());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Netty metrics</span></span><br><span class="line">        Metrics.gauge(<span class="string">&quot;netty.connections.active&quot;</span>, <span class="built_in">this</span>, monitor -&gt; getActiveConnections());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;netty.buffer.memory.used&quot;</span>, <span class="built_in">this</span>, monitor -&gt; getBufferMemoryUsed());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// System metrics</span></span><br><span class="line">        Metrics.gauge(<span class="string">&quot;system.cpu.usage&quot;</span>, <span class="built_in">this</span>, monitor -&gt; getCpuUsage());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;system.memory.usage&quot;</span>, <span class="built_in">this</span>, monitor -&gt; getSystemMemoryUsage());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Custom application metrics</span></span><br><span class="line">        scheduler.scheduleAtFixedRate(<span class="built_in">this</span>::collectCustomMetrics, <span class="number">0</span>, <span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">collectCustomMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Network interface metrics</span></span><br><span class="line">        NetworkInterface[] interfaces = NetworkInterface.getNetworkInterfaces();</span><br><span class="line">        <span class="keyword">for</span> (NetworkInterface ni : interfaces) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ni.isUp() &amp;&amp; !ni.isLoopback()) &#123;</span><br><span class="line">                Metrics.gauge(<span class="string">&quot;network.bytes.sent&quot;</span>, </span><br><span class="line">                    Tags.of(<span class="string">&quot;interface&quot;</span>, ni.getName()), </span><br><span class="line">                    ni.getBytesRecv());</span><br><span class="line">                Metrics.gauge(<span class="string">&quot;network.bytes.received&quot;</span>, </span><br><span class="line">                    Tags.of(<span class="string">&quot;interface&quot;</span>, ni.getName()), </span><br><span class="line">                    ni.getBytesSent());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Thread pool metrics</span></span><br><span class="line">        <span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> (ThreadPoolExecutor) </span><br><span class="line">            ((ScheduledThreadPoolExecutor) scheduler);</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;thread.pool.active&quot;</span>, executor.getActiveCount());</span><br><span class="line">        Metrics.gauge(<span class="string">&quot;thread.pool.queue.size&quot;</span>, executor.getQueue().size());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTestEvent</span><span class="params">(TestEvent event)</span> &#123;</span><br><span class="line">        Metrics.counter(<span class="string">&quot;test.events&quot;</span>, </span><br><span class="line">            Tags.of(<span class="string">&quot;type&quot;</span>, event.getType().name(),</span><br><span class="line">                   <span class="string">&quot;status&quot;</span>, event.getStatus().name()))</span><br><span class="line">            .increment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Question</strong>: <em>How do you handle resource management and prevent memory leaks in a long-running load testing system?</em></p>
<p><strong>Answer</strong>: We implement comprehensive resource management: 1) Use Nettyâ€™s pooled allocators to reduce GC pressure. 2) Configure appropriate JVM heap sizes and use G1GC for low-latency collection. 3) Implement proper connection lifecycle management with connection pooling. 4) Use weak references for caches and implement cache eviction policies. 5) Monitor memory usage through JMX and set up alerts for memory leaks. 6) Implement graceful shutdown procedures to clean up resources. 7) Use profiling tools like async-profiler to identify memory hotspots.</p>
<h2 id="Advanced-Use-Cases-and-Examples"><a href="#Advanced-Use-Cases-and-Examples" class="headerlink" title="Advanced Use Cases and Examples"></a>Advanced Use Cases and Examples</h2><h3 id="Scenario-1-E-commerce-Flash-Sale-Testing"><a href="#Scenario-1-E-commerce-Flash-Sale-Testing" class="headerlink" title="Scenario 1: E-commerce Flash Sale Testing"></a>Scenario 1: E-commerce Flash Sale Testing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlashSaleTestScenario</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TaskConfiguration <span class="title function_">createFlashSaleTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> TaskConfiguration.builder()</span><br><span class="line">            .testId(<span class="string">&quot;flash-sale-2024&quot;</span>)</span><br><span class="line">            .targetUrl(<span class="string">&quot;https://api.ecommerce.com/products/flash-sale&quot;</span>)</span><br><span class="line">            .method(HttpMethod.POST)</span><br><span class="line">            .headers(Map.of(</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                <span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;LoadTester/1.0&quot;</span></span><br><span class="line">            ))</span><br><span class="line">            .requestBody(generateRandomPurchaseRequest())</span><br><span class="line">            .loadPattern(LoadPattern.builder()</span><br><span class="line">                .type(LoadType.SPIKE)</span><br><span class="line">                .steps(Arrays.asList(</span><br><span class="line">                    LoadStep.of(Duration.ofMinutes(<span class="number">2</span>), <span class="number">100</span>, <span class="number">10</span>),   <span class="comment">// Warm-up</span></span><br><span class="line">                    LoadStep.of(Duration.ofMinutes(<span class="number">1</span>), <span class="number">5000</span>, <span class="number">500</span>), <span class="comment">// Spike</span></span><br><span class="line">                    LoadStep.of(Duration.ofMinutes(<span class="number">5</span>), <span class="number">2000</span>, <span class="number">200</span>), <span class="comment">// Sustained</span></span><br><span class="line">                    LoadStep.of(Duration.ofMinutes(<span class="number">2</span>), <span class="number">100</span>, <span class="number">10</span>)    <span class="comment">// Cool-down</span></span><br><span class="line">                ))</span><br><span class="line">                .build())</span><br><span class="line">            .duration(Duration.ofMinutes(<span class="number">10</span>))</span><br><span class="line">            .retryPolicy(RetryPolicy.builder()</span><br><span class="line">                .maxRetries(<span class="number">3</span>)</span><br><span class="line">                .backoffStrategy(BackoffStrategy.EXPONENTIAL)</span><br><span class="line">                .build())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateRandomPurchaseRequest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;productId&quot;: &quot;%s&quot;,</span></span><br><span class="line"><span class="string">                &quot;quantity&quot;: %d,</span></span><br><span class="line"><span class="string">                &quot;userId&quot;: &quot;%s&quot;,</span></span><br><span class="line"><span class="string">                &quot;paymentMethod&quot;: &quot;credit_card&quot;,</span></span><br><span class="line"><span class="string">                &quot;shippingAddress&quot;: &#123;</span></span><br><span class="line"><span class="string">                    &quot;street&quot;: &quot;123 Test St&quot;,</span></span><br><span class="line"><span class="string">                    &quot;city&quot;: &quot;Test City&quot;,</span></span><br><span class="line"><span class="string">                    &quot;zipCode&quot;: &quot;12345&quot;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.formatted(</span><br><span class="line">                generateRandomProductId(), </span><br><span class="line">                ThreadLocalRandom.current().nextInt(<span class="number">1</span>, <span class="number">5</span>),</span><br><span class="line">                generateRandomUserId()</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Scenario-2-Gradual-Ramp-up-Testing"><a href="#Scenario-2-Gradual-Ramp-up-Testing" class="headerlink" title="Scenario 2: Gradual Ramp-up Testing"></a>Scenario 2: Gradual Ramp-up Testing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GradualRampUpTestScenario</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TaskConfiguration <span class="title function_">createRampUpTest</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;LoadStep&gt; rampUpSteps = IntStream.range(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">            .mapToObj(i -&gt; LoadStep.of(</span><br><span class="line">                Duration.ofMinutes(<span class="number">2</span>),</span><br><span class="line">                <span class="number">100</span> + (i * <span class="number">200</span>), <span class="comment">// QPS: 100, 300, 500, 700, 900...</span></span><br><span class="line">                <span class="number">10</span> + (i * <span class="number">20</span>)    <span class="comment">// Concurrency: 10, 30, 50, 70, 90...</span></span><br><span class="line">            ))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> TaskConfiguration.builder()</span><br><span class="line">            .testId(<span class="string">&quot;gradual-ramp-up&quot;</span>)</span><br><span class="line">            .targetUrl(<span class="string">&quot;https://api.service.com/endpoint&quot;</span>)</span><br><span class="line">            .method(HttpMethod.GET)</span><br><span class="line">            .loadPattern(LoadPattern.builder()</span><br><span class="line">                .type(LoadType.RAMP_UP)</span><br><span class="line">                .steps(rampUpSteps)</span><br><span class="line">                .build())</span><br><span class="line">            .duration(Duration.ofMinutes(<span class="number">20</span>))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Scenario-3-API-Rate-Limiting-Validation"><a href="#Scenario-3-API-Rate-Limiting-Validation" class="headerlink" title="Scenario 3: API Rate Limiting Validation"></a>Scenario 3: API Rate Limiting Validation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitingTestScenario</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRateLimiting</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TaskConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> TaskConfiguration.builder()</span><br><span class="line">            .testId(<span class="string">&quot;rate-limiting-validation&quot;</span>)</span><br><span class="line">            .targetUrl(<span class="string">&quot;https://api.service.com/rate-limited-endpoint&quot;</span>)</span><br><span class="line">            .method(HttpMethod.GET)</span><br><span class="line">            .headers(Map.of(<span class="string">&quot;API-Key&quot;</span>, <span class="string">&quot;test-key&quot;</span>))</span><br><span class="line">            .qps(<span class="number">1000</span>) <span class="comment">// Exceed rate limit intentionally</span></span><br><span class="line">            .concurrency(<span class="number">100</span>)</span><br><span class="line">            .duration(Duration.ofMinutes(<span class="number">5</span>))</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Custom result validator</span></span><br><span class="line">        <span class="type">TestResultValidator</span> <span class="variable">validator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestResultValidator</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> ValidationResult <span class="title function_">validate</span><span class="params">(TestResult result)</span> &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">rateLimitErrorRate</span> <span class="operator">=</span> result.getErrorsByStatus().get(<span class="number">429</span>) / </span><br><span class="line">                    (<span class="type">double</span>) result.getTotalRequests() * <span class="number">100</span>;</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">if</span> (rateLimitErrorRate &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ValidationResult.failed(<span class="string">&quot;Rate limiting not working properly&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (result.getP99ResponseTime() &gt; <span class="number">5000</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ValidationResult.failed(<span class="string">&quot;Response time too high under rate limiting&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> ValidationResult.passed();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        executeTestWithValidation(config, validator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Error-Handling-and-Resilience"><a href="#Error-Handling-and-Resilience" class="headerlink" title="Error Handling and Resilience"></a>Error Handling and Resilience</h2><h3 id="Circuit-Breaker-Implementation"><a href="#Circuit-Breaker-Implementation" class="headerlink" title="Circuit Breaker Implementation"></a>Circuit Breaker Implementation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircuitBreakerTestClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetricsCollector metricsCollector;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CircuitBreakerTestClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.circuitBreaker = CircuitBreaker.ofDefaults(<span class="string">&quot;test-circuit-breaker&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.circuitBreaker.getEventPublisher()</span><br><span class="line">            .onStateTransition(event -&gt; </span><br><span class="line">                metricsCollector.recordCircuitBreakerEvent(event));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;HttpResponse&gt; <span class="title function_">executeRequest</span><span class="params">(HttpRequest request)</span> &#123;</span><br><span class="line">        Supplier&lt;CompletableFuture&lt;HttpResponse&gt;&gt; decoratedSupplier = </span><br><span class="line">            CircuitBreaker.decorateSupplier(circuitBreaker, () -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Request failed&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> Try.ofSupplier(decoratedSupplier)</span><br><span class="line">            .recover(throwable -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (throwable <span class="keyword">instanceof</span> CallNotPermittedException) &#123;</span><br><span class="line">                    <span class="comment">// Circuit breaker is open</span></span><br><span class="line">                    metricsCollector.recordCircuitBreakerOpen();</span><br><span class="line">                    <span class="keyword">return</span> CompletableFuture.completedFuture(</span><br><span class="line">                        HttpResponse.builder()</span><br><span class="line">                            .statusCode(<span class="number">503</span>)</span><br><span class="line">                            .body(<span class="string">&quot;Circuit breaker open&quot;</span>)</span><br><span class="line">                            .build()</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> CompletableFuture.failedFuture(throwable);</span><br><span class="line">            &#125;)</span><br><span class="line">            .get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Retry-Strategy-with-Backoff"><a href="#Retry-Strategy-with-Backoff" class="headerlink" title="Retry Strategy with Backoff"></a>Retry Strategy with Backoff</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RetryableTestClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Retry retry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TimeLimiter timeLimiter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RetryableTestClient</span><span class="params">(RetryPolicy retryPolicy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.retry = Retry.of(<span class="string">&quot;test-retry&quot;</span>, RetryConfig.custom()</span><br><span class="line">            .maxAttempts(retryPolicy.getMaxRetries())</span><br><span class="line">            .waitDuration(Duration.ofMillis(retryPolicy.getBaseDelayMs()))</span><br><span class="line">            .intervalFunction(IntervalFunction.ofExponentialBackoff(</span><br><span class="line">                retryPolicy.getBaseDelayMs(), </span><br><span class="line">                retryPolicy.getMultiplier()))</span><br><span class="line">            .retryOnException(throwable -&gt; </span><br><span class="line">                throwable <span class="keyword">instanceof</span> IOException || </span><br><span class="line">                throwable <span class="keyword">instanceof</span> TimeoutException)</span><br><span class="line">            .build());</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.timeLimiter = TimeLimiter.of(<span class="string">&quot;test-timeout&quot;</span>, TimeLimiterConfig.custom()</span><br><span class="line">            .timeoutDuration(Duration.ofSeconds(<span class="number">30</span>))</span><br><span class="line">            .build());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;HttpResponse&gt; <span class="title function_">executeWithRetry</span><span class="params">(HttpRequest request)</span> &#123;</span><br><span class="line">        Supplier&lt;CompletableFuture&lt;HttpResponse&gt;&gt; decoratedSupplier = </span><br><span class="line">            Decorators.ofSupplier(() -&gt; httpClient.execute(request))</span><br><span class="line">                .withRetry(retry)</span><br><span class="line">                .withTimeLimiter(timeLimiter)</span><br><span class="line">                .decorate();</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">return</span> decoratedSupplier.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Graceful-Degradation"><a href="#Graceful-Degradation" class="headerlink" title="Graceful Degradation"></a>Graceful Degradation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GracefulDegradationService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HealthIndicator healthIndicator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AlertService alertService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleHighErrorRate</span><span class="params">(HighErrorRateEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.getErrorRate() &gt; <span class="number">50</span>) &#123;</span><br><span class="line">            <span class="comment">// Reduce load automatically</span></span><br><span class="line">            reduceTestLoad(event.getTestId(), <span class="number">0.5</span>); <span class="comment">// Reduce to 50%</span></span><br><span class="line">            alertService.sendAlert(<span class="string">&quot;High error rate detected, reducing load&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (event.getErrorRate() &gt; <span class="number">80</span>) &#123;</span><br><span class="line">            <span class="comment">// Stop test to prevent damage</span></span><br><span class="line">            stopTest(event.getTestId());</span><br><span class="line">            alertService.sendCriticalAlert(<span class="string">&quot;Critical error rate, test stopped&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleResourceExhaustion</span><span class="params">(ResourceExhaustionEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.getResourceType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MEMORY:</span><br><span class="line">                <span class="comment">// Trigger garbage collection and reduce batch sizes</span></span><br><span class="line">                System.gc();</span><br><span class="line">                adjustBatchSize(event.getTestId(), <span class="number">0.7</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CPU:</span><br><span class="line">                <span class="comment">// Reduce thread pool size</span></span><br><span class="line">                adjustThreadPoolSize(event.getTestId(), <span class="number">0.8</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> NETWORK:</span><br><span class="line">                <span class="comment">// Implement connection throttling</span></span><br><span class="line">                enableConnectionThrottling(event.getTestId());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reduceTestLoad</span><span class="params">(String testId, <span class="type">double</span> factor)</span> &#123;</span><br><span class="line">        <span class="type">TaskConfiguration</span> <span class="variable">currentConfig</span> <span class="operator">=</span> getTestConfiguration(testId);</span><br><span class="line">        <span class="type">TaskConfiguration</span> <span class="variable">reducedConfig</span> <span class="operator">=</span> currentConfig.toBuilder()</span><br><span class="line">            .qps((<span class="type">int</span>) (currentConfig.getQps() * factor))</span><br><span class="line">            .concurrency((<span class="type">int</span>) (currentConfig.getConcurrency() * factor))</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        updateTestConfiguration(testId, reducedConfig);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Security-and-Authentication"><a href="#Security-and-Authentication" class="headerlink" title="Security and Authentication"></a>Security and Authentication</h2><h3 id="Secure-Test-Execution"><a href="#Secure-Test-Execution" class="headerlink" title="Secure Test Execution"></a>Secure Test Execution</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureTestExecutor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtTokenProvider tokenProvider;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CertificateManager certificateManager;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TaskConfiguration <span class="title function_">createSecureTestConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> TaskConfiguration.builder()</span><br><span class="line">            .testId(<span class="string">&quot;secure-api-test&quot;</span>)</span><br><span class="line">            .targetUrl(<span class="string">&quot;https://secure-api.company.com/endpoint&quot;</span>)</span><br><span class="line">            .method(HttpMethod.POST)</span><br><span class="line">            .headers(Map.of(</span><br><span class="line">                <span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer &quot;</span> + tokenProvider.generateTestToken(),</span><br><span class="line">                <span class="string">&quot;X-API-Key&quot;</span>, getApiKey(),</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span></span><br><span class="line">            ))</span><br><span class="line">            .sslConfig(SslConfig.builder()</span><br><span class="line">                .trustStore(certificateManager.getTrustStore())</span><br><span class="line">                .keyStore(certificateManager.getClientKeyStore())</span><br><span class="line">                .verifyHostname(<span class="literal">false</span>) <span class="comment">// Only for testing</span></span><br><span class="line">                .build())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 300000)</span> <span class="comment">// Refresh every 5 minutes</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refreshSecurityTokens</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">newToken</span> <span class="operator">=</span> tokenProvider.refreshToken();</span><br><span class="line">        updateAllActiveTestsWithNewToken(newToken);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateAllActiveTestsWithNewToken</span><span class="params">(String newToken)</span> &#123;</span><br><span class="line">        List&lt;String&gt; activeTests = getActiveTestIds();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String testId : activeTests) &#123;</span><br><span class="line">            <span class="type">TaskConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> getTestConfiguration(testId);</span><br><span class="line">            Map&lt;String, String&gt; updatedHeaders = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(config.getHeaders());</span><br><span class="line">            updatedHeaders.put(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer &quot;</span> + newToken);</span><br><span class="line">            </span><br><span class="line">            <span class="type">TaskConfiguration</span> <span class="variable">updatedConfig</span> <span class="operator">=</span> config.toBuilder()</span><br><span class="line">                .headers(updatedHeaders)</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">            updateTestConfiguration(testId, updatedConfig);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SSL-TLS-Configuration"><a href="#SSL-TLS-Configuration" class="headerlink" title="SSL&#x2F;TLS Configuration"></a>SSL&#x2F;TLS Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSLConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SslContext <span class="title function_">createSslContext</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> SslContextBuilder.forClient()</span><br><span class="line">            .trustManager(createTrustManagerFactory())</span><br><span class="line">            .keyManager(createKeyManagerFactory())</span><br><span class="line">            .protocols(<span class="string">&quot;TLSv1.2&quot;</span>, <span class="string">&quot;TLSv1.3&quot;</span>)</span><br><span class="line">            .ciphers(Arrays.asList(</span><br><span class="line">                <span class="string">&quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TLS_DHE_RSA_WITH_AES_256_GCM_SHA384&quot;</span></span><br><span class="line">            ))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> TrustManagerFactory <span class="title function_">createTrustManagerFactory</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyStore</span> <span class="variable">trustStore</span> <span class="operator">=</span> KeyStore.getInstance(<span class="string">&quot;JKS&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">trustStoreStream</span> <span class="operator">=</span> getClass()</span><br><span class="line">                .getResourceAsStream(<span class="string">&quot;/ssl/truststore.jks&quot;</span>)) &#123;</span><br><span class="line">            trustStore.load(trustStoreStream, <span class="string">&quot;changeit&quot;</span>.toCharArray());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">TrustManagerFactory</span> <span class="variable">trustManagerFactory</span> <span class="operator">=</span> </span><br><span class="line">            TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());</span><br><span class="line">        trustManagerFactory.init(trustStore);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> trustManagerFactory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Performance-Optimization-Techniques"><a href="#Performance-Optimization-Techniques" class="headerlink" title="Performance Optimization Techniques"></a>Performance Optimization Techniques</h2><h3 id="Memory-Management"><a href="#Memory-Management" class="headerlink" title="Memory Management"></a>Memory Management</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemoryOptimizedTestClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectPool&lt;ByteBuf&gt; bufferPool;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectPool&lt;StringBuilder&gt; stringBuilderPool;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MemoryOptimizedTestClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Use Netty&#x27;s pooled allocator</span></span><br><span class="line">        <span class="built_in">this</span>.bufferPool = <span class="keyword">new</span> <span class="title class_">DefaultObjectPool</span>&lt;&gt;(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">PooledObjectFactory</span>&lt;ByteBuf&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> ByteBuf <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> PooledByteBufAllocator.DEFAULT.directBuffer(<span class="number">1024</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">(ByteBuf buffer)</span> &#123;</span><br><span class="line">                    buffer.release();</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">(ByteBuf buffer)</span> &#123;</span><br><span class="line">                    buffer.clear();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// String builder pool for JSON construction</span></span><br><span class="line">        <span class="built_in">this</span>.stringBuilderPool = <span class="keyword">new</span> <span class="title class_">DefaultObjectPool</span>&lt;&gt;(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">PooledObjectFactory</span>&lt;StringBuilder&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> StringBuilder <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">512</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">(StringBuilder sb)</span> &#123;</span><br><span class="line">                    <span class="comment">// No explicit destruction needed</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">(StringBuilder sb)</span> &#123;</span><br><span class="line">                    sb.setLength(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> HttpRequest <span class="title function_">createOptimizedRequest</span><span class="params">(RequestTemplate template)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> stringBuilderPool.borrowObject();</span><br><span class="line">        <span class="type">ByteBuf</span> <span class="variable">buffer</span> <span class="operator">=</span> bufferPool.borrowObject();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Build JSON request body efficiently</span></span><br><span class="line">            sb.append(<span class="string">&quot;&#123;&quot;</span>)</span><br><span class="line">              .append(<span class="string">&quot;\&quot;timestamp\&quot;:&quot;</span>).append(System.currentTimeMillis()).append(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">              .append(<span class="string">&quot;\&quot;data\&quot;:\&quot;&quot;</span>).append(template.getData()).append(<span class="string">&quot;\&quot;&quot;</span>)</span><br><span class="line">              .append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">              </span><br><span class="line">            <span class="comment">// Write to buffer</span></span><br><span class="line">            buffer.writeBytes(sb.toString().getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> HttpRequest.builder()</span><br><span class="line">                .uri(template.getUri())</span><br><span class="line">                .method(template.getMethod())</span><br><span class="line">                .body(buffer.nioBuffer())</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            stringBuilderPool.returnObject(sb);</span><br><span class="line">            bufferPool.returnObject(buffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CPU-Optimization"><a href="#CPU-Optimization" class="headerlink" title="CPU Optimization"></a>CPU Optimization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CPUOptimizedTestExecutor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DisruptorEventBus eventBus;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AffinityExecutor affinityExecutor;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CPUOptimizedTestExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Use Disruptor for lock-free event processing</span></span><br><span class="line">        <span class="built_in">this</span>.eventBus = <span class="keyword">new</span> <span class="title class_">DisruptorEventBus</span>(<span class="string">&quot;test-events&quot;</span>, <span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// CPU affinity for better cache locality</span></span><br><span class="line">        <span class="built_in">this</span>.affinityExecutor = <span class="keyword">new</span> <span class="title class_">AffinityExecutor</span>(<span class="string">&quot;test-executor&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeHighPerformanceTest</span><span class="params">(TaskConfiguration config)</span> &#123;</span><br><span class="line">        <span class="comment">// Partition work across CPU cores</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">coreCount</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class="line">        <span class="type">int</span> <span class="variable">requestsPerCore</span> <span class="operator">=</span> config.getQps() / coreCount;</span><br><span class="line">        </span><br><span class="line">        List&lt;CompletableFuture&lt;Void&gt;&gt; futures = IntStream.range(<span class="number">0</span>, coreCount)</span><br><span class="line">            .mapToObj(coreId -&gt; </span><br><span class="line">                CompletableFuture.runAsync(</span><br><span class="line">                    () -&gt; executeOnCore(coreId, requestsPerCore, config),</span><br><span class="line">                    affinityExecutor.getExecutor(coreId)</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Wait for all cores to complete</span></span><br><span class="line">        CompletableFuture.allOf(futures.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]))</span><br><span class="line">            .join();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">executeOnCore</span><span class="params">(<span class="type">int</span> coreId, <span class="type">int</span> requestCount, TaskConfiguration config)</span> &#123;</span><br><span class="line">        <span class="comment">// Pin thread to specific CPU core for better cache performance</span></span><br><span class="line">        <span class="type">AffinityLock</span> <span class="variable">lock</span> <span class="operator">=</span> AffinityLock.acquireLock(coreId);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">RateLimiter</span> <span class="variable">rateLimiter</span> <span class="operator">=</span> RateLimiter.create(requestCount);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; requestCount; i++) &#123;</span><br><span class="line">                rateLimiter.acquire();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Execute request with minimal object allocation</span></span><br><span class="line">                executeRequestOptimized(config);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Troubleshooting-Common-Issues"><a href="#Troubleshooting-Common-Issues" class="headerlink" title="Troubleshooting Common Issues"></a>Troubleshooting Common Issues</h2><h3 id="Connection-Pool-Exhaustion"><a href="#Connection-Pool-Exhaustion" class="headerlink" title="Connection Pool Exhaustion"></a>Connection Pool Exhaustion</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConnectionPoolMonitor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectionPool connectionPool;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AlertService alertService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 10000)</span> <span class="comment">// Check every 10 seconds</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">monitorConnectionPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ConnectionPoolStats</span> <span class="variable">stats</span> <span class="operator">=</span> connectionPool.getStats();</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">utilizationRate</span> <span class="operator">=</span> (<span class="type">double</span>) stats.getActiveConnections() / </span><br><span class="line">                                stats.getMaxConnections();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (utilizationRate &gt; <span class="number">0.8</span>) &#123;</span><br><span class="line">            alertService.sendWarning(<span class="string">&quot;Connection pool utilization high: &quot;</span> + </span><br><span class="line">                                   (utilizationRate * <span class="number">100</span>) + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (utilizationRate &gt; <span class="number">0.95</span>) &#123;</span><br><span class="line">            <span class="comment">// Emergency action: increase pool size or throttle requests</span></span><br><span class="line">            connectionPool.increasePoolSize(stats.getMaxConnections() * <span class="number">2</span>);</span><br><span class="line">            alertService.sendCriticalAlert(<span class="string">&quot;Connection pool nearly exhausted, &quot;</span> +</span><br><span class="line">                                         <span class="string">&quot;increasing pool size&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Monitor for connection leaks</span></span><br><span class="line">        <span class="keyword">if</span> (stats.getLeakedConnections() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            alertService.sendAlert(<span class="string">&quot;Connection leak detected: &quot;</span> + </span><br><span class="line">                                 stats.getLeakedConnections() + <span class="string">&quot; connections&quot;</span>);</span><br><span class="line">            connectionPool.closeLeakedConnections();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Memory-Leak-Detection"><a href="#Memory-Leak-Detection" class="headerlink" title="Memory Leak Detection"></a>Memory Leak Detection</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemoryLeakDetector</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MBeanServer mBeanServer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;MemorySnapshot&gt; snapshots = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 60000)</span> <span class="comment">// Check every minute</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkMemoryUsage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MemoryMXBean</span> <span class="variable">memoryBean</span> <span class="operator">=</span> ManagementFactory.getMemoryMXBean();</span><br><span class="line">        <span class="type">MemoryUsage</span> <span class="variable">heapUsage</span> <span class="operator">=</span> memoryBean.getHeapMemoryUsage();</span><br><span class="line">        </span><br><span class="line">        <span class="type">MemorySnapshot</span> <span class="variable">snapshot</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MemorySnapshot</span>(</span><br><span class="line">            System.currentTimeMillis(),</span><br><span class="line">            heapUsage.getUsed(),</span><br><span class="line">            heapUsage.getMax(),</span><br><span class="line">            heapUsage.getCommitted()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        snapshots.add(snapshot);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Keep only last 10 minutes of data</span></span><br><span class="line">        snapshots.removeIf(s -&gt; </span><br><span class="line">            System.currentTimeMillis() - s.getTimestamp() &gt; <span class="number">600000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Detect memory leak pattern</span></span><br><span class="line">        <span class="keyword">if</span> (snapshots.size() &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">possibleLeak</span> <span class="operator">=</span> detectMemoryLeakPattern();</span><br><span class="line">            <span class="keyword">if</span> (possibleLeak) &#123;</span><br><span class="line">                triggerMemoryDump();</span><br><span class="line">                alertService.sendCriticalAlert(<span class="string">&quot;Possible memory leak detected&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">detectMemoryLeakPattern</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Simple heuristic: memory usage consistently increasing</span></span><br><span class="line">        List&lt;Long&gt; memoryUsages = snapshots.stream()</span><br><span class="line">            .map(MemorySnapshot::getUsedMemory)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Check if memory usage is consistently increasing</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">increasingCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; memoryUsages.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (memoryUsages.get(i) &gt; memoryUsages.get(i - <span class="number">1</span>)) &#123;</span><br><span class="line">                increasingCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> increasingCount &gt; (memoryUsages.size() * <span class="number">0.8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">triggerMemoryDump</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MBeanServer</span> <span class="variable">server</span> <span class="operator">=</span> ManagementFactory.getPlatformMBeanServer();</span><br><span class="line">            <span class="type">HotSpotDiagnosticMXBean</span> <span class="variable">hotspotMXBean</span> <span class="operator">=</span> </span><br><span class="line">                ManagementFactory.newPlatformMXBeanProxy(</span><br><span class="line">                    server, <span class="string">&quot;com.sun.management:type=HotSpotDiagnostic&quot;</span>,</span><br><span class="line">                    HotSpotDiagnosticMXBean.class);</span><br><span class="line">                    </span><br><span class="line">            <span class="type">String</span> <span class="variable">dumpFile</span> <span class="operator">=</span> <span class="string">&quot;/tmp/memory-dump-&quot;</span> + </span><br><span class="line">                             System.currentTimeMillis() + <span class="string">&quot;.hprof&quot;</span>;</span><br><span class="line">            hotspotMXBean.dumpHeap(dumpFile, <span class="literal">true</span>);</span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">&quot;Memory dump created: &quot;</span> + dumpFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;Failed to create memory dump&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Interview-Questions-and-Insights"><a href="#Interview-Questions-and-Insights" class="headerlink" title="Interview Questions and Insights"></a>Interview Questions and Insights</h2><p><strong>Q: How do you handle the coordination of thousands of concurrent test clients?</strong></p>
<p>A: We use Zookeeperâ€™s hierarchical namespace and watches for efficient coordination. Clients register as ephemeral sequential nodes under <code>/test/clients/</code>, allowing automatic discovery and cleanup. We implement a master-slave pattern where the master uses distributed barriers to synchronize test phases. For large-scale coordination, we use consistent hashing to partition clients into groups, with sub-masters coordinating each group to reduce the coordination load on the main master.</p>
<p><strong>Q: What strategies do you use to ensure test result accuracy in a distributed environment?</strong></p>
<p>A: We implement several accuracy measures: 1) Use NTP for time synchronization across all nodes. 2) Implement vector clocks for ordering distributed events. 3) Use HdrHistogram for accurate percentile calculations. 4) Implement consensus algorithms for critical metrics aggregation. 5) Use statistical sampling techniques for large datasets. 6) Implement outlier detection to identify and handle anomalous results. 7) Cross-validate results using multiple measurement techniques.</p>
<p><strong>Q: How do you prevent your load testing from affecting production systems?</strong></p>
<p>A: We implement multiple safeguards: 1) Circuit breakers to automatically stop testing when error rates exceed thresholds. 2) Rate limiting with gradual ramp-up to detect capacity limits early. 3) Monitoring dashboards with automatic alerts for abnormal patterns. 4) Separate network segments or VPCs for testing. 5) Database read replicas for read-heavy tests. 6) Feature flags to enable&#x2F;disable test-specific functionality. 7) Graceful degradation mechanisms that reduce load automatically.</p>
<p><strong>Q: How do you handle test data management in distributed testing?</strong></p>
<p>A: We use a multi-layered approach: 1) Synthetic data generation using libraries like Faker for realistic test data. 2) Data partitioning strategies to avoid hotspots (e.g., user ID sharding). 3) Test data pools with automatic refresh mechanisms. 4) Database seeding scripts for consistent test environments. 5) Data masking for production-like datasets. 6) Cleanup procedures to maintain test data integrity. 7) Version control for test datasets to ensure reproducibility.</p>
<h2 id="Best-Practices-and-Recommendations"><a href="#Best-Practices-and-Recommendations" class="headerlink" title="Best Practices and Recommendations"></a>Best Practices and Recommendations</h2><h3 id="Test-Planning-and-Design"><a href="#Test-Planning-and-Design" class="headerlink" title="Test Planning and Design"></a>Test Planning and Design</h3><ol>
<li><strong>Start Small, Scale Gradually</strong>: Begin with single-node tests before scaling to distributed scenarios</li>
<li><strong>Realistic Load Patterns</strong>: Use production traffic patterns rather than constant load</li>
<li><strong>Comprehensive Monitoring</strong>: Monitor both client and server metrics during tests</li>
<li><strong>Baseline Establishment</strong>: Establish performance baselines before load testing</li>
<li><strong>Test Environment Isolation</strong>: Ensure test environments closely match production</li>
</ol>
<h3 id="Production-Readiness-Checklist"><a href="#Production-Readiness-Checklist" class="headerlink" title="Production Readiness Checklist"></a>Production Readiness Checklist</h3><ul>
<li><input disabled="" type="checkbox"> Comprehensive error handling and retry mechanisms</li>
<li><input disabled="" type="checkbox"> Resource leak detection and prevention</li>
<li><input disabled="" type="checkbox"> Graceful shutdown procedures</li>
<li><input disabled="" type="checkbox"> Monitoring and alerting integration</li>
<li><input disabled="" type="checkbox"> Security hardening (SSL&#x2F;TLS, authentication)</li>
<li><input disabled="" type="checkbox"> Configuration management and hot reloading</li>
<li><input disabled="" type="checkbox"> Backup and disaster recovery procedures</li>
<li><input disabled="" type="checkbox"> Documentation and runbooks</li>
<li><input disabled="" type="checkbox"> Load testing of the load testing system itself</li>
</ul>
<h3 id="Scalability-Considerations"><a href="#Scalability-Considerations" class="headerlink" title="Scalability Considerations"></a>Scalability Considerations</h3><pre>
<code class="mermaid">
graph TD
A[Client Requests] --&gt; B{Load Balancer}
B --&gt; C[Client Node 1]
B --&gt; D[Client Node 2]
B --&gt; E[Client Node N]

C --&gt; F[Zookeeper Cluster]
D --&gt; F
E --&gt; F

F --&gt; G[Master Node]
G --&gt; H[Results Aggregator]
G --&gt; I[Dashboard]

J[Auto Scaler] --&gt; B
K[Metrics Monitor] --&gt; J
H --&gt; K
</code>
</pre>

<h2 id="External-Resources"><a href="#External-Resources" class="headerlink" title="External Resources"></a>External Resources</h2><ul>
<li><a target="_blank" rel="noopener" href="https://zookeeper.apache.org/doc/current/">Apache Zookeeper Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://netty.io/wiki/user-guide-for-4.x.html">Netty User Guide</a></li>
<li><a target="_blank" rel="noopener" href="http://hdrhistogram.org/">HdrHistogram Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://micrometer.io/docs">Micrometer Metrics</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html">Spring Boot Actuator</a></li>
<li><a target="_blank" rel="noopener" href="https://resilience4j.readme.io/">Resilience4j Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/17/gctuning/">JVM Performance Tuning Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/">Kubernetes Best Practices</a></li>
</ul>
<p>This comprehensive guide provides a production-ready foundation for building a distributed pressure testing system using Zookeeper. The architecture balances performance, reliability, and scalability while providing detailed insights for system design interviews and real-world implementation.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/system-design/" rel="tag"># system-design</a>
              <a href="/tags/pressure-test/" rel="tag"># pressure test</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/25/Spring-Security-Framework-Complete-Guide/" rel="prev" title="Spring Security Framework - Complete Guide">
                  <i class="fa fa-angle-left"></i> Spring Security Framework - Complete Guide
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/" rel="next" title="Design FinTech AI Workflow and Chat System">
                  Design FinTech AI Workflow and Chat System <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
