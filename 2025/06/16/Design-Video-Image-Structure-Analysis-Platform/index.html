<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="System OverviewThe Video Image AI Structured Analysis Platform is a comprehensive solution designed to analyze video files, images, and real-time camera streams using advanced computer vision and mach">
<meta property="og:type" content="article">
<meta property="og:title" content="Design Video Image Structure Analysis Platform">
<meta property="og:url" content="https://shayne007.github.io/2025/06/16/Design-Video-Image-Structure-Analysis-Platform/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="System OverviewThe Video Image AI Structured Analysis Platform is a comprehensive solution designed to analyze video files, images, and real-time camera streams using advanced computer vision and mach">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-16T11:28:03.000Z">
<meta property="article:modified_time" content="2025-06-26T13:04:39.465Z">
<meta property="article:author" content="Charlie Feng">
<meta property="article:tag" content="system-design">
<meta property="article:tag" content="structure analysis platform">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/06/16/Design-Video-Image-Structure-Analysis-Platform/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/06/16/Design-Video-Image-Structure-Analysis-Platform/","path":"2025/06/16/Design-Video-Image-Structure-Analysis-Platform/","title":"Design Video Image Structure Analysis Platform"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Design Video Image Structure Analysis Platform | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#System-Overview"><span class="nav-number">1.</span> <span class="nav-text">System Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Capabilities"><span class="nav-number">1.1.</span> <span class="nav-text">Key Capabilities</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Architecture-Overview"><span class="nav-number">2.</span> <span class="nav-text">Architecture Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-Services-Design"><span class="nav-number">3.</span> <span class="nav-text">Core Services Design</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#StreamingAccessService"><span class="nav-number">3.1.</span> <span class="nav-text">StreamingAccessService</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Key-Features"><span class="nav-number">3.1.1.</span> <span class="nav-text">Key Features:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Implementation-Example"><span class="nav-number">3.1.2.</span> <span class="nav-text">Implementation Example:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StructureAppService"><span class="nav-number">3.2.</span> <span class="nav-text">StructureAppService</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Object-Detection-Pipeline"><span class="nav-number">3.2.1.</span> <span class="nav-text">Object Detection Pipeline:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-Implementation"><span class="nav-number">3.2.2.</span> <span class="nav-text">Service Implementation:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GPU-Resource-Management"><span class="nav-number">3.2.3.</span> <span class="nav-text">GPU Resource Management:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StorageAndSearchService"><span class="nav-number">3.3.</span> <span class="nav-text">StorageAndSearchService</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ElasticSearch-Index-Mappings"><span class="nav-number">3.3.1.</span> <span class="nav-text">ElasticSearch Index Mappings:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-Implementation-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">Service Implementation:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TaskManagerService"><span class="nav-number">3.4.</span> <span class="nav-text">TaskManagerService</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Task-Management"><span class="nav-number">3.4.1.</span> <span class="nav-text">Task Management:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node-Resource-Monitoring"><span class="nav-number">3.4.2.</span> <span class="nav-text">Node Resource Monitoring:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AnalysisPlatformService"><span class="nav-number">3.5.</span> <span class="nav-text">AnalysisPlatformService</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#API-Design"><span class="nav-number">3.5.1.</span> <span class="nav-text">API Design:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Complete-API-Specification"><span class="nav-number">3.6.</span> <span class="nav-text">Complete API Specification:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Microservice-Architecture-with-Spring-Cloud-Alibaba"><span class="nav-number">4.</span> <span class="nav-text">Microservice Architecture with Spring Cloud Alibaba</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Discovery-and-Configuration"><span class="nav-number">4.1.</span> <span class="nav-text">Service Discovery and Configuration:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Circuit-Breaker-Configuration"><span class="nav-number">4.2.</span> <span class="nav-text">Circuit Breaker Configuration:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scalability-and-Performance-Optimization"><span class="nav-number">5.</span> <span class="nav-text">Scalability and Performance Optimization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Horizontal-Scaling-Strategy"><span class="nav-number">5.1.</span> <span class="nav-text">Horizontal Scaling Strategy:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Auto-scaling-Configuration"><span class="nav-number">5.2.</span> <span class="nav-text">Auto-scaling Configuration:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Caching-Strategy"><span class="nav-number">5.3.</span> <span class="nav-text">Caching Strategy:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Frontend-Implementation"><span class="nav-number">6.</span> <span class="nav-text">Frontend Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Camera-Map-Integration"><span class="nav-number">6.1.</span> <span class="nav-text">Camera Map Integration:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Search-Interface"><span class="nav-number">6.2.</span> <span class="nav-text">Search Interface:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-Deployment-Configuration"><span class="nav-number">7.</span> <span class="nav-text">Docker Deployment Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Multi-stage-Dockerfile"><span class="nav-number">7.1.</span> <span class="nav-text">Multi-stage Dockerfile:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Structure-App-Service-GPU-enabled"><span class="nav-number">7.2.</span> <span class="nav-text">Structure App Service (GPU-enabled):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-Compose-for-Development"><span class="nav-number">7.3.</span> <span class="nav-text">Docker Compose for Development:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Optimization-Strategies"><span class="nav-number">8.</span> <span class="nav-text">Performance Optimization Strategies</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Database-Query-Optimization"><span class="nav-number">8.1.</span> <span class="nav-text">Database Query Optimization:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory-and-CPU-Optimization"><span class="nav-number">8.2.</span> <span class="nav-text">Memory and CPU Optimization:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Monitoring-and-Observability"><span class="nav-number">9.</span> <span class="nav-text">Monitoring and Observability</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Comprehensive-Monitoring-Setup"><span class="nav-number">9.1.</span> <span class="nav-text">Comprehensive Monitoring Setup:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Distributed-Tracing"><span class="nav-number">9.2.</span> <span class="nav-text">Distributed Tracing:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Health-Checks-and-Alerting"><span class="nav-number">9.3.</span> <span class="nav-text">Health Checks and Alerting:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-Implementation"><span class="nav-number">10.</span> <span class="nav-text">Security Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Authentication-and-Authorization"><span class="nav-number">10.1.</span> <span class="nav-text">Authentication and Authorization:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-Rate-Limiting"><span class="nav-number">10.2.</span> <span class="nav-text">API Rate Limiting:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-Use-Cases-and-Examples"><span class="nav-number">11.</span> <span class="nav-text">Advanced Use Cases and Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-time-Traffic-Monitoring"><span class="nav-number">11.1.</span> <span class="nav-text">Real-time Traffic Monitoring:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crowd-Density-Analysis"><span class="nav-number">11.2.</span> <span class="nav-text">Crowd Density Analysis:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Behavioral-Pattern-Recognition"><span class="nav-number">11.3.</span> <span class="nav-text">Behavioral Pattern Recognition:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interview-Questions-and-Insights"><span class="nav-number">12.</span> <span class="nav-text">Interview Questions and Insights</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Technical-Architecture-Questions"><span class="nav-number">12.1.</span> <span class="nav-text">Technical Architecture Questions:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scalability-and-Performance-Questions"><span class="nav-number">12.2.</span> <span class="nav-text">Scalability and Performance Questions:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-Management-Questions"><span class="nav-number">12.3.</span> <span class="nav-text">Data Management Questions:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#External-Resources-and-References"><span class="nav-number">13.</span> <span class="nav-text">External Resources and References</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Technical-Documentation"><span class="nav-number">13.1.</span> <span class="nav-text">Technical Documentation:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AI-ML-Resources"><span class="nav-number">13.2.</span> <span class="nav-text">AI&#x2F;ML Resources:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monitoring-and-Observability-1"><span class="nav-number">13.3.</span> <span class="nav-text">Monitoring and Observability:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Container-Orchestration"><span class="nav-number">13.4.</span> <span class="nav-text">Container Orchestration:</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/06/16/Design-Video-Image-Structure-Analysis-Platform/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Design Video Image Structure Analysis Platform | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Design Video Image Structure Analysis Platform
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-06-16 19:28:03" itemprop="dateCreated datePublished" datetime="2025-06-16T19:28:03+08:00">2025-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-26 21:04:39" itemprop="dateModified" datetime="2025-06-26T21:04:39+08:00">2025-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/system-design/" itemprop="url" rel="index"><span itemprop="name">system-design</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="System-Overview"><a href="#System-Overview" class="headerlink" title="System Overview"></a>System Overview</h2><p>The Video Image AI Structured Analysis Platform is a comprehensive solution designed to analyze video files, images, and real-time camera streams using advanced computer vision and machine learning algorithms. The platform extracts structured data about detected objects (persons, vehicles, bikes, motorbikes) and provides powerful search capabilities through multiple interfaces.</p>
<h3 id="Key-Capabilities"><a href="#Key-Capabilities" class="headerlink" title="Key Capabilities"></a>Key Capabilities</h3><ul>
<li>Real-time video stream processing from multiple cameras</li>
<li>Batch video file and image analysis</li>
<li>Object detection and attribute extraction</li>
<li>Distributed storage with similarity search</li>
<li>Scalable microservice architecture</li>
<li>Interactive web-based management interface</li>
</ul>
<h2 id="Architecture-Overview"><a href="#Architecture-Overview" class="headerlink" title="Architecture Overview"></a>Architecture Overview</h2><pre>
<code class="mermaid">
graph TB
subgraph &quot;Client Layer&quot;
    UI[Analysis Platform UI]
    API[REST APIs]
end

subgraph &quot;Application Services&quot;
    APS[Analysis Platform Service]
    TMS[Task Manager Service]
    SAS[Streaming Access Service]
    SAPS[Structure App Service]
    SSS[Storage And Search Service]
end

subgraph &quot;Message Queue&quot;
    KAFKA[Kafka Cluster]
end

subgraph &quot;Storage Layer&quot;
    REDIS[Redis Cache]
    ES[ElasticSearch]
    FASTDFS[FastDFS]
    VECTOR[Vector Database]
    ZK[Zookeeper]
end

subgraph &quot;External&quot;
    CAMERAS[IP Cameras]
    FILES[Video&#x2F;Image Files]
end

UI --&gt; APS
API --&gt; APS
APS --&gt; TMS
APS --&gt; SSS
TMS --&gt; ZK
SAS --&gt; CAMERAS
SAS --&gt; FILES
SAS --&gt; SAPS
SAPS --&gt; KAFKA
KAFKA --&gt; SSS
SSS --&gt; ES
SSS --&gt; FASTDFS
SSS --&gt; VECTOR
APS --&gt; REDIS
</code>
</pre>

<h2 id="Core-Services-Design"><a href="#Core-Services-Design" class="headerlink" title="Core Services Design"></a>Core Services Design</h2><h3 id="StreamingAccessService"><a href="#StreamingAccessService" class="headerlink" title="StreamingAccessService"></a>StreamingAccessService</h3><p>The StreamingAccessService manages real-time video streams from distributed cameras and handles video file processing.</p>
<h4 id="Key-Features"><a href="#Key-Features" class="headerlink" title="Key Features:"></a>Key Features:</h4><ul>
<li>Multi-protocol camera support (RTSP, HTTP, WebRTC)</li>
<li>Video transcoding for format compatibility</li>
<li>Geographic camera distribution tracking</li>
<li>Load balancing across processing nodes</li>
</ul>
<h4 id="Implementation-Example"><a href="#Implementation-Example" class="headerlink" title="Implementation Example:"></a>Implementation Example:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamingAccessService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CameraRepository cameraRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoTranscodingService transcodingService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startCameraStream</span><span class="params">(String cameraId)</span> &#123;</span><br><span class="line">        <span class="type">Camera</span> <span class="variable">camera</span> <span class="operator">=</span> cameraRepository.findById(cameraId);</span><br><span class="line">        </span><br><span class="line">        <span class="type">StreamConfig</span> <span class="variable">config</span> <span class="operator">=</span> StreamConfig.builder()</span><br><span class="line">            .url(camera.getRtspUrl())</span><br><span class="line">            .resolution(camera.getResolution())</span><br><span class="line">            .frameRate(camera.getFrameRate())</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        <span class="type">StreamProcessor</span> <span class="variable">processor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StreamProcessor</span>(config);</span><br><span class="line">        processor.onFrameReceived(frame -&gt; &#123;</span><br><span class="line">            <span class="comment">// Send frame to StructureAppService</span></span><br><span class="line">            structureAppService.analyzeFrame(frame, camera.getLocation());</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        processor.start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;CameraInfo&gt; <span class="title function_">getCamerasInRegion</span><span class="params">(GeoLocation center, <span class="type">double</span> radius)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cameraRepository.findWithinRadius(center, radius)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(<span class="built_in">this</span>::toCameraInfo)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Question</strong>: <em>How would you handle camera connection failures and ensure high availability?</em></p>
<p><strong>Answer</strong>: Implement circuit breaker patterns, retry mechanisms with exponential backoff, health check endpoints, and failover to backup cameras. Use connection pooling and maintain camera status in Redis for quick status checks.</p>
<h3 id="StructureAppService"><a href="#StructureAppService" class="headerlink" title="StructureAppService"></a>StructureAppService</h3><p>This service performs the core AI analysis using computer vision models deployed on GPU-enabled infrastructure.</p>
<h4 id="Object-Detection-Pipeline"><a href="#Object-Detection-Pipeline" class="headerlink" title="Object Detection Pipeline:"></a>Object Detection Pipeline:</h4><pre>
<code class="mermaid">
flowchart LR
A[Input Frame] --&gt; B[Preprocessing]
B --&gt; C[Object Detection]
C --&gt; D[Attribute Extraction]
D --&gt; E[Structured Output]
E --&gt; F[Kafka Publisher]

subgraph &quot;AI Models&quot;
    G[YOLO V8 Detection]
    H[Age&#x2F;Gender Classification]
    I[Vehicle Recognition]
    J[Attribute Extraction]
end

C --&gt; G
D --&gt; H
D --&gt; I
D --&gt; J
</code>
</pre>
<p><strong>Object Analysis Specifications:</strong></p>
<p><em>Person Attributes:</em></p>
<ul>
<li>Age estimation (age ranges: 0-12, 13-17, 18-30, 31-50, 51-70, 70+)</li>
<li>Gender classification (male, female, unknown)</li>
<li>Height estimation using reference objects</li>
<li>Clothing color detection (top, bottom)</li>
<li>Body size estimation (small, medium, large)</li>
<li>Pose estimation for activity recognition</li>
</ul>
<p><em>Vehicle Attributes:</em></p>
<ul>
<li>License plate recognition using OCR</li>
<li>Vehicle type classification (sedan, SUV, truck, bus)</li>
<li>Color detection using color histograms</li>
<li>Brand recognition using CNN models</li>
<li>Seatbelt detection for driver safety compliance</li>
</ul>
<h4 id="Service-Implementation"><a href="#Service-Implementation" class="headerlink" title="Service Implementation:"></a>Service Implementation:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StructureAppService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectDetectionModel objectDetectionModel;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttributeExtractionService attributeService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaProducer&lt;String, AnalysisResult&gt; kafkaProducer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">analyzeFrame</span><span class="params">(VideoFrame frame, GeoLocation location)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Preprocess frame</span></span><br><span class="line">            <span class="type">ProcessedFrame</span> <span class="variable">processed</span> <span class="operator">=</span> preprocessFrame(frame);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Detect objects</span></span><br><span class="line">            List&lt;DetectedObject&gt; objects = objectDetectionModel.detect(processed);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Extract attributes for each object</span></span><br><span class="line">            List&lt;StructuredObject&gt; structuredObjects = objects.stream()</span><br><span class="line">                .map(obj -&gt; extractAttributes(obj, processed))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Create analysis result</span></span><br><span class="line">            <span class="type">AnalysisResult</span> <span class="variable">result</span> <span class="operator">=</span> AnalysisResult.builder()</span><br><span class="line">                .timestamp(Instant.now())</span><br><span class="line">                .location(location)</span><br><span class="line">                .objects(structuredObjects)</span><br><span class="line">                .frameId(frame.getId())</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Send to Kafka</span></span><br><span class="line">            kafkaProducer.send(<span class="string">&quot;analysis-results&quot;</span>, result);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Analysis failed for frame: &#123;&#125;&quot;</span>, frame.getId(), e);</span><br><span class="line">            <span class="comment">// Send to dead letter queue</span></span><br><span class="line">            handleAnalysisFailure(frame, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> StructuredObject <span class="title function_">extractAttributes</span><span class="params">(DetectedObject object, ProcessedFrame frame)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (object.getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> PERSON:</span><br><span class="line">                <span class="keyword">return</span> extractPersonAttributes(object, frame);</span><br><span class="line">            <span class="keyword">case</span> VEHICLE:</span><br><span class="line">                <span class="keyword">return</span> extractVehicleAttributes(object, frame);</span><br><span class="line">            <span class="keyword">case</span> BIKE:</span><br><span class="line">            <span class="keyword">case</span> MOTORBIKE:</span><br><span class="line">                <span class="keyword">return</span> extractBikeAttributes(object, frame);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> createBasicStructuredObject(object);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> PersonObject <span class="title function_">extractPersonAttributes</span><span class="params">(DetectedObject object, ProcessedFrame frame)</span> &#123;</span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">bbox</span> <span class="operator">=</span> object.getBoundingBox();</span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">personImage</span> <span class="operator">=</span> frame.getSubImage(bbox);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> PersonObject.builder()</span><br><span class="line">            .id(UUID.randomUUID().toString())</span><br><span class="line">            .age(ageClassifier.predict(personImage))</span><br><span class="line">            .gender(genderClassifier.predict(personImage))</span><br><span class="line">            .height(estimateHeight(bbox, frame.getDepthInfo()))</span><br><span class="line">            .clothingColor(colorExtractor.extractClothingColor(personImage))</span><br><span class="line">            .trouserColor(colorExtractor.extractTrouserColor(personImage))</span><br><span class="line">            .size(estimateBodySize(bbox))</span><br><span class="line">            .confidence(object.getConfidence())</span><br><span class="line">            .bbox(bbox)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="GPU-Resource-Management"><a href="#GPU-Resource-Management" class="headerlink" title="GPU Resource Management:"></a>GPU Resource Management:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GPUResourceManager</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;GPUTask&gt; taskQueue = <span class="keyword">new</span> <span class="title class_">ConcurrentLinkedQueue</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;GPUWorker&gt; workers;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializeWorkers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">gpuCount</span> <span class="operator">=</span> getAvailableGPUs();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; gpuCount; i++) &#123;</span><br><span class="line">            workers.add(<span class="keyword">new</span> <span class="title class_">GPUWorker</span>(i, taskQueue));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;AnalysisResult&gt; <span class="title function_">submitTask</span><span class="params">(VideoFrame frame)</span> &#123;</span><br><span class="line">        <span class="type">GPUTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GPUTask</span>(frame);</span><br><span class="line">        taskQueue.offer(task);</span><br><span class="line">        <span class="keyword">return</span> task.getFuture();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Question</strong>: <em>How do you optimize GPU utilization for real-time video analysis?</em></p>
<p><strong>Answer</strong>: Use batch processing to maximize GPU throughput, implement dynamic batching based on queue depth, utilize GPU memory pooling, and employ model quantization. Monitor GPU metrics and auto-scale workers based on load.</p>
<h3 id="StorageAndSearchService"><a href="#StorageAndSearchService" class="headerlink" title="StorageAndSearchService"></a>StorageAndSearchService</h3><p>Manages distributed storage across ElasticSearch, FastDFS, and vector databases.</p>
<h4 id="ElasticSearch-Index-Mappings"><a href="#ElasticSearch-Index-Mappings" class="headerlink" title="ElasticSearch Index Mappings:"></a>ElasticSearch Index Mappings:</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;person_index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;geo_point&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;float&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;clothing_color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;trouser_color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;confidence&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;float&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;image_path&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;vector_id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;bbox&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;vehicle_index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;geo_point&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;plate_number&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;model&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;driver_seatbelt&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;boolean&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;vehicle_type&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;confidence&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;float&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;image_path&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;vector_id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;bike_index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;geo_point&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rider_helmet&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;boolean&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rider_count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;confidence&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;float&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;image_path&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;vector_id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="Service-Implementation-1"><a href="#Service-Implementation-1" class="headerlink" title="Service Implementation:"></a>Service Implementation:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageAndSearchService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ElasticsearchClient elasticsearchClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FastDFSClient fastDFSClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorDatabaseClient vectorClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;analysis-results&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processAnalysisResult</span><span class="params">(AnalysisResult result)</span> &#123;</span><br><span class="line">        result.getObjects().forEach(<span class="built_in">this</span>::storeObject);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">storeObject</span><span class="params">(StructuredObject object)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Store image in FastDFS</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">imagePath</span> <span class="operator">=</span> storeImage(object.getImage());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Store vector representation</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">vectorId</span> <span class="operator">=</span> storeVector(object.getImageVector());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Store structured data in ElasticSearch</span></span><br><span class="line">            storeInElasticSearch(object, imagePath, vectorId);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to store object: &#123;&#125;&quot;</span>, object.getId(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">storeImage</span><span class="params">(BufferedImage image)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] imageBytes = convertToBytes(image);</span><br><span class="line">        <span class="keyword">return</span> fastDFSClient.uploadFile(imageBytes, <span class="string">&quot;jpg&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">storeVector</span><span class="params">(<span class="type">float</span>[] vector)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vectorClient.store(vector, Map.of(</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>, Instant.now().toString(),</span><br><span class="line">            <span class="string">&quot;type&quot;</span>, <span class="string">&quot;image_embedding&quot;</span></span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> SearchResult&lt;PersonObject&gt; <span class="title function_">searchPersons</span><span class="params">(PersonSearchQuery query)</span> &#123;</span><br><span class="line">        BoolQuery.<span class="type">Builder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.bool();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (query.getAge() != <span class="literal">null</span>) &#123;</span><br><span class="line">            boolQuery.must(QueryBuilders.range(r -&gt; r</span><br><span class="line">                .field(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">                .gte(JsonData.of(query.getAge() - <span class="number">5</span>))</span><br><span class="line">                .lte(JsonData.of(query.getAge() + <span class="number">5</span>))));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (query.getGender() != <span class="literal">null</span>) &#123;</span><br><span class="line">            boolQuery.must(QueryBuilders.term(t -&gt; t</span><br><span class="line">                .field(<span class="string">&quot;gender&quot;</span>)</span><br><span class="line">                .value(query.getGender())));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (query.getLocation() != <span class="literal">null</span>) &#123;</span><br><span class="line">            boolQuery.must(QueryBuilders.geoDistance(g -&gt; g</span><br><span class="line">                .field(<span class="string">&quot;location&quot;</span>)</span><br><span class="line">                .location(l -&gt; l.latlon(query.getLocation()))</span><br><span class="line">                .distance(query.getRadius() + <span class="string">&quot;km&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> SearchRequest.of(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;person_index&quot;</span>)</span><br><span class="line">            .query(boolQuery.build()._toQuery())</span><br><span class="line">            .size(query.getLimit())</span><br><span class="line">            .from(query.getOffset()));</span><br><span class="line">            </span><br><span class="line">        SearchResponse&lt;PersonObject&gt; response = elasticsearchClient.search(request, PersonObject.class);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> convertToSearchResult(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;SimilarObject&gt; <span class="title function_">findSimilarImages</span><span class="params">(BufferedImage queryImage, <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="type">float</span>[] queryVector = imageEncoder.encode(queryImage);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> vectorClient.similaritySearch(queryVector, limit)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(<span class="built_in">this</span>::enrichWithMetadata)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Question</strong>: <em>How do you ensure data consistency across multiple storage systems?</em></p>
<p><strong>Answer</strong>: Implement saga pattern for distributed transactions, use event sourcing with Kafka for eventual consistency, implement compensation actions for rollback scenarios, and maintain idempotency keys for retry safety.</p>
<h3 id="TaskManagerService"><a href="#TaskManagerService" class="headerlink" title="TaskManagerService"></a>TaskManagerService</h3><p>Coordinates task execution across distributed nodes using Zookeeper for coordination.</p>
<h4 id="Task-Management"><a href="#Task-Management" class="headerlink" title="Task Management:"></a>Task Management:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaskManagerService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CuratorFramework zookeeperClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> NodeResourceMonitor resourceMonitor;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASKS_PATH</span> <span class="operator">=</span> <span class="string">&quot;/video-analysis/tasks&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NODES_PATH</span> <span class="operator">=</span> <span class="string">&quot;/video-analysis/nodes&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createTask</span><span class="params">(AnalysisTask task)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">taskId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">            <span class="type">String</span> <span class="variable">taskPath</span> <span class="operator">=</span> TASKS_PATH + <span class="string">&quot;/&quot;</span> + taskId;</span><br><span class="line">            </span><br><span class="line">            <span class="type">TaskInfo</span> <span class="variable">taskInfo</span> <span class="operator">=</span> TaskInfo.builder()</span><br><span class="line">                .id(taskId)</span><br><span class="line">                .type(task.getType())</span><br><span class="line">                .input(task.getInput())</span><br><span class="line">                .location(task.getLocation())</span><br><span class="line">                .status(TaskStatus.PENDING)</span><br><span class="line">                .createdAt(Instant.now())</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            zookeeperClient.create()</span><br><span class="line">                .creatingParentsIfNeeded()</span><br><span class="line">                .withMode(CreateMode.PERSISTENT)</span><br><span class="line">                .forPath(taskPath, SerializationUtils.serialize(taskInfo));</span><br><span class="line">            </span><br><span class="line">            scheduleTask(taskId);</span><br><span class="line">            <span class="keyword">return</span> taskId;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TaskCreationException</span>(<span class="string">&quot;Failed to create task&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">scheduleTask</span><span class="params">(String taskId)</span> &#123;</span><br><span class="line">        <span class="comment">// Find best node based on resource availability</span></span><br><span class="line">        Optional&lt;NodeInfo&gt; bestNode = findBestAvailableNode();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (bestNode.isPresent()) &#123;</span><br><span class="line">            <span class="comment">// Create a distributed lock for task assignment</span></span><br><span class="line">            <span class="type">InterProcessMutex</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InterProcessMutex</span>(zookeeperClient, </span><br><span class="line">                <span class="string">&quot;/tasks/locks/&quot;</span> + task.getId());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.acquire();</span><br><span class="line">                assignTaskToNode(taskId, bestNode.get());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.release();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Queue task for later execution</span></span><br><span class="line">            queueTask(taskId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Optional&lt;NodeInfo&gt; <span class="title function_">findBestAvailableNode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;String&gt; nodes = zookeeperClient.getChildren().forPath(NODES_PATH);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> nodes.stream()</span><br><span class="line">                .map(<span class="built_in">this</span>::getNodeInfo)</span><br><span class="line">                .filter(Objects::nonNull)</span><br><span class="line">                .filter(node -&gt; node.getGpuUsage() &lt; <span class="number">0.8</span>) <span class="comment">// Less than 80% GPU usage</span></span><br><span class="line">                .max(Comparator.comparing(node -&gt; </span><br><span class="line">                    node.getAvailableGpuMemory() + node.getAvailableCpuCores()));</span><br><span class="line">                    </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to find available node&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> Optional.empty();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTaskCompletion</span><span class="params">(TaskCompletedEvent event)</span> &#123;</span><br><span class="line">        updateTaskStatus(event.getTaskId(), TaskStatus.COMPLETED);</span><br><span class="line">        releaseNodeResources(event.getNodeId());</span><br><span class="line">        scheduleQueuedTasks();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Node-Resource-Monitoring"><a href="#Node-Resource-Monitoring" class="headerlink" title="Node Resource Monitoring:"></a>Node Resource Monitoring:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NodeResourceMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 5000)</span> <span class="comment">// Every 5 seconds</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateNodeResources</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">NodeInfo</span> <span class="variable">nodeInfo</span> <span class="operator">=</span> getCurrentNodeInfo();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">nodePath</span> <span class="operator">=</span> NODES_PATH + <span class="string">&quot;/&quot;</span> + getNodeId();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (zookeeperClient.checkExists().forPath(nodePath) == <span class="literal">null</span>) &#123;</span><br><span class="line">                zookeeperClient.create()</span><br><span class="line">                    .creatingParentsIfNeeded()</span><br><span class="line">                    .withMode(CreateMode.EPHEMERAL)</span><br><span class="line">                    .forPath(nodePath, SerializationUtils.serialize(nodeInfo));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                zookeeperClient.setData()</span><br><span class="line">                    .forPath(nodePath, SerializationUtils.serialize(nodeInfo));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to update node resources&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> NodeInfo <span class="title function_">getCurrentNodeInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> NodeInfo.builder()</span><br><span class="line">            .id(getNodeId())</span><br><span class="line">            .cpuUsage(getCpuUsage())</span><br><span class="line">            .memoryUsage(getMemoryUsage())</span><br><span class="line">            .gpuUsage(getGpuUsage())</span><br><span class="line">            .availableGpuMemory(getAvailableGpuMemory())</span><br><span class="line">            .availableCpuCores(getAvailableCpuCores())</span><br><span class="line">            .lastHeartbeat(Instant.now())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AnalysisPlatformService"><a href="#AnalysisPlatformService" class="headerlink" title="AnalysisPlatformService"></a>AnalysisPlatformService</h3><p>Provides REST APIs for the frontend application with comprehensive caching strategies.</p>
<h4 id="API-Design"><a href="#API-Design" class="headerlink" title="API Design:"></a>API Design:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnalysisPlatformController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskManagerService taskManagerService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StorageAndSearchService searchService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Task Management APIs</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/tasks&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;TaskResponse&gt; <span class="title function_">createTask</span><span class="params">(<span class="meta">@RequestBody</span> CreateTaskRequest request)</span> &#123;</span><br><span class="line">        <span class="type">AnalysisTask</span> <span class="variable">task</span> <span class="operator">=</span> convertToTask(request);</span><br><span class="line">        <span class="type">String</span> <span class="variable">taskId</span> <span class="operator">=</span> taskManagerService.createTask(task);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(TaskResponse.builder()</span><br><span class="line">            .taskId(taskId)</span><br><span class="line">            .status(<span class="string">&quot;CREATED&quot;</span>)</span><br><span class="line">            .build());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/tasks/&#123;taskId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;tasks&quot;, key = &quot;#taskId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;TaskInfo&gt; <span class="title function_">getTask</span><span class="params">(<span class="meta">@PathVariable</span> String taskId)</span> &#123;</span><br><span class="line">        <span class="type">TaskInfo</span> <span class="variable">task</span> <span class="operator">=</span> taskManagerService.getTask(taskId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(task);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/tasks&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;PagedResult&lt;TaskInfo&gt;&gt; <span class="title function_">getTasks</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;20&quot;)</span> <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String status)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">TaskQuery</span> <span class="variable">query</span> <span class="operator">=</span> TaskQuery.builder()</span><br><span class="line">            .page(page)</span><br><span class="line">            .size(size)</span><br><span class="line">            .status(status)</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        PagedResult&lt;TaskInfo&gt; tasks = taskManagerService.getTasks(query);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(tasks);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Camera Management APIs</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/cameras&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;CameraInfo&gt; <span class="title function_">createCamera</span><span class="params">(<span class="meta">@RequestBody</span> CreateCameraRequest request)</span> &#123;</span><br><span class="line">        <span class="type">CameraInfo</span> <span class="variable">camera</span> <span class="operator">=</span> cameraService.createCamera(request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(camera);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/cameras/map&quot;)</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;camera-map&quot;, key = &quot;#center + &#x27;-&#x27; + #zoom&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;CameraMapInfo&gt;&gt; <span class="title function_">getCamerasForMap</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> String center,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> <span class="type">int</span> zoom)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">GeoLocation</span> <span class="variable">centerPoint</span> <span class="operator">=</span> parseGeoLocation(center);</span><br><span class="line">        <span class="type">double</span> <span class="variable">radius</span> <span class="operator">=</span> calculateRadius(zoom);</span><br><span class="line">        </span><br><span class="line">        List&lt;CameraMapInfo&gt; cameras = cameraService.getCamerasInRegion(centerPoint, radius);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(cameras);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Search APIs</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/search/persons&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;SearchResult&lt;PersonObject&gt;&gt; <span class="title function_">searchPersons</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> PersonSearchQuery query)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheKey</span> <span class="operator">=</span> generateCacheKey(<span class="string">&quot;person-search&quot;</span>, query);</span><br><span class="line">        SearchResult&lt;PersonObject&gt; cached = getCachedResult(cacheKey);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(cached);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        SearchResult&lt;PersonObject&gt; result = searchService.searchPersons(query);</span><br><span class="line">        cacheResult(cacheKey, result, Duration.ofMinutes(<span class="number">5</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/search/vehicles&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;SearchResult&lt;VehicleObject&gt;&gt; <span class="title function_">searchVehicles</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> VehicleSearchQuery query)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        SearchResult&lt;VehicleObject&gt; result = searchService.searchVehicles(query);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/search/similarity&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;SimilarObject&gt;&gt; <span class="title function_">searchSimilar</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;image&quot;)</span> MultipartFile imageFile,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> ImageIO.read(imageFile.getInputStream());</span><br><span class="line">            List&lt;SimilarObject&gt; similar = searchService.findSimilarImages(image, limit);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(similar);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.badRequest().build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Statistics APIs</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/stats/objects&quot;)</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;object-stats&quot;, key = &quot;#timeRange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ObjectStatistics&gt; <span class="title function_">getObjectStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> String timeRange)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ObjectStatistics</span> <span class="variable">stats</span> <span class="operator">=</span> analyticsService.getObjectStatistics(timeRange);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(stats);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Complete-API-Specification"><a href="#Complete-API-Specification" class="headerlink" title="Complete API Specification:"></a>Complete API Specification:</h3><table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Description</th>
<th>Cache TTL</th>
</tr>
</thead>
<tbody><tr>
<td><code>/api/v1/tasks</code></td>
<td>POST</td>
<td>Create analysis task</td>
<td>-</td>
</tr>
<tr>
<td><code>/api/v1/tasks/&#123;id&#125;</code></td>
<td>GET</td>
<td>Get task details</td>
<td>1 min</td>
</tr>
<tr>
<td><code>/api/v1/tasks</code></td>
<td>GET</td>
<td>List tasks with pagination</td>
<td>30 sec</td>
</tr>
<tr>
<td><code>/api/v1/cameras</code></td>
<td>POST</td>
<td>Register new camera</td>
<td>-</td>
</tr>
<tr>
<td><code>/api/v1/cameras/&#123;id&#125;</code></td>
<td>PUT</td>
<td>Update camera config</td>
<td>-</td>
</tr>
<tr>
<td><code>/api/v1/cameras/map</code></td>
<td>GET</td>
<td>Get cameras for map view</td>
<td>5 min</td>
</tr>
<tr>
<td><code>/api/v1/search/persons</code></td>
<td>POST</td>
<td>Search persons by attributes</td>
<td>5 min</td>
</tr>
<tr>
<td><code>/api/v1/search/vehicles</code></td>
<td>POST</td>
<td>Search vehicles by attributes</td>
<td>5 min</td>
</tr>
<tr>
<td><code>/api/v1/search/similarity</code></td>
<td>POST</td>
<td>Image similarity search</td>
<td>1 min</td>
</tr>
<tr>
<td><code>/api/v1/stats/objects</code></td>
<td>GET</td>
<td>Object detection statistics</td>
<td>10 min</td>
</tr>
</tbody></table>
<p><strong>Interview Question</strong>: <em>How do you handle API rate limiting and prevent abuse?</em></p>
<p><strong>Answer</strong>: Implement token bucket algorithm with Redis, use sliding window counters, apply different limits per user tier, implement circuit breakers for downstream services, and use API gateways for centralized rate limiting.</p>
<h2 id="Microservice-Architecture-with-Spring-Cloud-Alibaba"><a href="#Microservice-Architecture-with-Spring-Cloud-Alibaba" class="headerlink" title="Microservice Architecture with Spring Cloud Alibaba"></a>Microservice Architecture with Spring Cloud Alibaba</h2><h3 id="Service-Discovery-and-Configuration"><a href="#Service-Discovery-and-Configuration" class="headerlink" title="Service Discovery and Configuration:"></a>Service Discovery and Configuration:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml for each service</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">analysis-platform-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">$&#123;NACOS_SERVER:localhost:8848&#125;</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">$&#123;NACOS_NAMESPACE:dev&#125;</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">$&#123;NACOS_SERVER:localhost:8848&#125;</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">$&#123;NACOS_NAMESPACE:dev&#125;</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">$&#123;SENTINEL_DASHBOARD:localhost:8080&#125;</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">$&#123;SPRING_PROFILES_ACTIVE:dev&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Circuit-Breaker-Configuration"><a href="#Circuit-Breaker-Configuration" class="headerlink" title="Circuit Breaker Configuration:"></a>Circuit Breaker Configuration:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoAnalysisServiceFallback</span> <span class="keyword">implements</span> <span class="title class_">VideoAnalysisService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AnalysisResult <span class="title function_">analyzeVideo</span><span class="params">(VideoRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> AnalysisResult.builder()</span><br><span class="line">            .status(<span class="string">&quot;FALLBACK&quot;</span>)</span><br><span class="line">            .message(<span class="string">&quot;Video analysis service temporarily unavailable&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(</span></span><br><span class="line"><span class="meta">    name = &quot;structure-app-service&quot;, </span></span><br><span class="line"><span class="meta">    fallback = VideoAnalysisServiceFallback.class</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VideoAnalysisService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/analyze&quot;)</span></span><br><span class="line">    AnalysisResult <span class="title function_">analyzeVideo</span><span class="params">(<span class="meta">@RequestBody</span> VideoRequest request)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Scalability-and-Performance-Optimization"><a href="#Scalability-and-Performance-Optimization" class="headerlink" title="Scalability and Performance Optimization"></a>Scalability and Performance Optimization</h2><h3 id="Horizontal-Scaling-Strategy"><a href="#Horizontal-Scaling-Strategy" class="headerlink" title="Horizontal Scaling Strategy:"></a>Horizontal Scaling Strategy:</h3><pre>
<code class="mermaid">
graph LR
subgraph &quot;Load Balancer&quot;
    LB[Nginx&#x2F;HAProxy]
end

subgraph &quot;API Gateway&quot;
    GW1[Gateway 1]
    GW2[Gateway 2]
    GW3[Gateway 3]
end

subgraph &quot;Analysis Platform Services&quot;
    APS1[Service 1]
    APS2[Service 2]
    APS3[Service 3]
end

subgraph &quot;Structure App Services&quot;
    SAS1[GPU Node 1]
    SAS2[GPU Node 2]
    SAS3[GPU Node 3]
end

LB --&gt; GW1
LB --&gt; GW2
LB --&gt; GW3

GW1 --&gt; APS1
GW2 --&gt; APS2
GW3 --&gt; APS3

APS1 --&gt; SAS1
APS2 --&gt; SAS2
APS3 --&gt; SAS3
</code>
</pre>

<h3 id="Auto-scaling-Configuration"><a href="#Auto-scaling-Configuration" class="headerlink" title="Auto-scaling Configuration:"></a>Auto-scaling Configuration:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kubernetes HPA configuration</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling/v2</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">analysis-platform-hpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scaleTargetRef:</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">analysis-platform-service</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Resource</span></span><br><span class="line">    <span class="attr">resource:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">cpu</span></span><br><span class="line">      <span class="attr">target:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Utilization</span></span><br><span class="line">        <span class="attr">averageUtilization:</span> <span class="number">70</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Resource</span></span><br><span class="line">    <span class="attr">resource:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">memory</span></span><br><span class="line">      <span class="attr">target:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Utilization</span></span><br><span class="line">        <span class="attr">averageUtilization:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="Caching-Strategy"><a href="#Caching-Strategy" class="headerlink" title="Caching Strategy:"></a>Caching Strategy:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        RedisCacheManager.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> RedisCacheManager</span><br><span class="line">            .RedisCacheManagerBuilder</span><br><span class="line">            .fromConnectionFactory(redisConnectionFactory())</span><br><span class="line">            .cacheDefaults(cacheConfiguration());</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> RedisCacheConfiguration <span class="title function_">cacheConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">            .entryTtl(Duration.ofMinutes(<span class="number">10</span>))</span><br><span class="line">            .serializeKeysWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>()))</span><br><span class="line">            .serializeValuesWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Frontend-Implementation"><a href="#Frontend-Implementation" class="headerlink" title="Frontend Implementation"></a>Frontend Implementation</h2><h3 id="Camera-Map-Integration"><a href="#Camera-Map-Integration" class="headerlink" title="Camera Map Integration:"></a>Camera Map Integration:</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React component for camera map</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MapContainer</span>, <span class="title class_">TileLayer</span>, <span class="title class_">Marker</span>, <span class="title class_">Popup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-leaflet&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">CameraMap</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [cameras, setCameras] = <span class="title function_">useState</span>([]);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchCameras</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchCameras</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/v1/cameras/map?center=39.9042,116.4074&amp;zoom=10&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="title function_">setCameras</span>(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Failed to fetch cameras:&#x27;</span>, error);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MapContainer</span> <span class="attr">center</span>=<span class="string">&#123;[39.9042,</span> <span class="attr">116.4074</span>]&#125; <span class="attr">zoom</span>=<span class="string">&#123;10&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height:</span> &#x27;<span class="attr">600px</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TileLayer</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">url</span>=<span class="string">&quot;https://&#123;s&#125;.tile.openstreetmap.org/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">attribution</span>=<span class="string">&#x27;<span class="symbol">&amp;copy;</span> OpenStreetMap contributors&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;cameras.map(camera =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Marker</span> <span class="attr">key</span>=<span class="string">&#123;camera.id&#125;</span> <span class="attr">position</span>=<span class="string">&#123;[camera.latitude,</span> <span class="attr">camera.longitude</span>]&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;camera.name&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">p</span>&gt;</span>Status: &#123;camera.status&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">p</span>&gt;</span>Location: &#123;camera.address&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> startAnalysis(camera.id)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                Start Analysis</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Marker</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">MapContainer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Search-Interface"><a href="#Search-Interface" class="headerlink" title="Search Interface:"></a>Search Interface:</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">SearchInterface</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [searchType, setSearchType] = <span class="title function_">useState</span>(<span class="string">&#x27;person&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [searchQuery, setSearchQuery] = <span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [results, setResults] = <span class="title function_">useState</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleSearch</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> endpoint = <span class="string">`/api/v1/search/<span class="subst">$&#123;searchType&#125;</span>s`</span>;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(endpoint, &#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;,</span><br><span class="line">      <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(searchQuery)</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    <span class="title function_">setResults</span>(data.<span class="property">items</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;search-interface&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;search-controls&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">value</span>=<span class="string">&#123;searchType&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setSearchType(e.target.value)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;person&quot;</span>&gt;</span>Person<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;vehicle&quot;</span>&gt;</span>Vehicle<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;bike&quot;</span>&gt;</span>Bike<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span></span><br><span class="line"><span class="language-xml">        &#123;searchType === &#x27;person&#x27; &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">PersonSearchForm</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">query</span>=<span class="string">&#123;searchQuery&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;setSearchQuery&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">        )&#125;</span></span><br><span class="line"><span class="language-xml">        </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleSearch&#125;</span>&gt;</span>Search<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">SearchResults</span> <span class="attr">results</span>=<span class="string">&#123;results&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Docker-Deployment-Configuration"><a href="#Docker-Deployment-Configuration" class="headerlink" title="Docker Deployment Configuration"></a>Docker Deployment Configuration</h2><h3 id="Multi-stage-Dockerfile"><a href="#Multi-stage-Dockerfile" class="headerlink" title="Multi-stage Dockerfile:"></a>Multi-stage Dockerfile:</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Analysis Platform Service</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span>-jdk-slim as builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> pom.xml .</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> src ./src</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> mvn clean package -DskipTests</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span>-jre-slim</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/target/analysis-platform-service.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=30s --<span class="built_in">timeout</span>=3s --start-period=5s --retries=3 \</span></span><br><span class="line"><span class="language-bash">    CMD curl -f http://localhost:8080/actuator/health || <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="Structure-App-Service-GPU-enabled"><a href="#Structure-App-Service-GPU-enabled" class="headerlink" title="Structure App Service (GPU-enabled):"></a>Structure App Service (GPU-enabled):</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Structure App Service with GPU support</span></span><br><span class="line"><span class="keyword">FROM</span> nvidia/cuda:<span class="number">11.8</span>-devel-ubuntu20.<span class="number">04</span> as base</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Python and dependencies</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    python3.9 \</span></span><br><span class="line"><span class="language-bash">    python3-pip \</span></span><br><span class="line"><span class="language-bash">    python3-dev \</span></span><br><span class="line"><span class="language-bash">    build-essential \</span></span><br><span class="line"><span class="language-bash">    cmake \</span></span><br><span class="line"><span class="language-bash">    libopencv-dev \</span></span><br><span class="line"><span class="language-bash">    libglib2.0-0 \</span></span><br><span class="line"><span class="language-bash">    libsm6 \</span></span><br><span class="line"><span class="language-bash">    libxext6 \</span></span><br><span class="line"><span class="language-bash">    libxrender-dev \</span></span><br><span class="line"><span class="language-bash">    libgomp1 \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Python packages</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install --no-cache-dir -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install PyTorch with CUDA support</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy application code</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Download pre-trained models</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> python3 download_models.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8081</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;app.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="Docker-Compose-for-Development"><a href="#Docker-Compose-for-Development" class="headerlink" title="Docker Compose for Development:"></a>Docker Compose for Development:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">zookeeper:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">confluentinc/cp-zookeeper:7.4.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOOKEEPER_CLIENT_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOOKEEPER_TICK_TIME:</span> <span class="number">2000</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;2181:2181&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper-data:/var/lib/zookeeper/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">confluentinc/cp-kafka:7.4.0</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9092:9092&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">KAFKA_BROKER_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">KAFKA_ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper:2181</span></span><br><span class="line">      <span class="attr">KAFKA_ADVERTISED_LISTENERS:</span> <span class="string">PLAINTEXT://localhost:9092</span></span><br><span class="line">      <span class="attr">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kafka-data:/var/lib/kafka/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:8.9.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms2g -Xmx2g&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">xpack.security.enabled=false</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch-data:/usr/share/elasticsearch/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:7-alpine</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--appendonly</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">fastdfs-tracker:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">delron/fastdfs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;22122:22122&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">tracker</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fastdfs-tracker:/var/fdfs</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">fastdfs-storage:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">delron/fastdfs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8888:8888&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">storage</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TRACKER_SERVER:</span> <span class="string">fastdfs-tracker:22122</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fastdfs-storage:/var/fdfs</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fastdfs-tracker</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">vector-db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.0</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;19530:19530&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ETCD_ENDPOINTS:</span> <span class="string">etcd:2379</span></span><br><span class="line">      <span class="attr">MINIO_ADDRESS:</span> <span class="string">minio:9000</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">etcd</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">analysis-platform-service:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./analysis-platform-service</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SPRING_PROFILES_ACTIVE:</span> <span class="string">docker</span></span><br><span class="line">      <span class="attr">KAFKA_BOOTSTRAP_SERVERS:</span> <span class="string">kafka:9092</span></span><br><span class="line">      <span class="attr">REDIS_HOST:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">ELASTICSEARCH_HOST:</span> <span class="string">elasticsearch</span></span><br><span class="line">      <span class="attr">ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper:2181</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kafka</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">structure-app-service:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./structure-app-service</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8081:8081&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">KAFKA_BOOTSTRAP_SERVERS:</span> <span class="string">kafka:9092</span></span><br><span class="line">      <span class="attr">REDIS_HOST:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kafka</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">devices:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">driver:</span> <span class="string">nvidia</span></span><br><span class="line">              <span class="attr">count:</span> <span class="number">1</span></span><br><span class="line">              <span class="attr">capabilities:</span> [<span class="string">gpu</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">zookeeper-data:</span></span><br><span class="line">  <span class="attr">kafka-data:</span></span><br><span class="line">  <span class="attr">elasticsearch-data:</span></span><br><span class="line">  <span class="attr">redis-data:</span></span><br><span class="line">  <span class="attr">fastdfs-tracker:</span></span><br><span class="line">  <span class="attr">fastdfs-storage:</span></span><br></pre></td></tr></table></figure>

<h2 id="Performance-Optimization-Strategies"><a href="#Performance-Optimization-Strategies" class="headerlink" title="Performance Optimization Strategies"></a>Performance Optimization Strategies</h2><h3 id="Database-Query-Optimization"><a href="#Database-Query-Optimization" class="headerlink" title="Database Query Optimization:"></a>Database Query Optimization:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedPersonRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ElasticsearchClient client;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> SearchResult&lt;PersonObject&gt; <span class="title function_">searchWithAggregations</span><span class="params">(PersonSearchQuery query)</span> &#123;</span><br><span class="line">        <span class="comment">// Use composite aggregations for better performance</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> SearchRequest.of(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;person_index&quot;</span>)</span><br><span class="line">            .query(buildQuery(query))</span><br><span class="line">            .aggregations(<span class="string">&quot;age_groups&quot;</span>, a -&gt; a</span><br><span class="line">                .histogram(h -&gt; h</span><br><span class="line">                    .field(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">                    .interval(<span class="number">10.0</span>)))</span><br><span class="line">            .aggregations(<span class="string">&quot;gender_distribution&quot;</span>, a -&gt; a</span><br><span class="line">                .terms(t -&gt; t</span><br><span class="line">                    .field(<span class="string">&quot;gender&quot;</span>)</span><br><span class="line">                    .size(<span class="number">10</span>)))</span><br><span class="line">            .aggregations(<span class="string">&quot;location_clusters&quot;</span>, a -&gt; a</span><br><span class="line">                .geohashGrid(g -&gt; g</span><br><span class="line">                    .field(<span class="string">&quot;location&quot;</span>)</span><br><span class="line">                    .precision(<span class="number">5</span>)))</span><br><span class="line">            .size(query.getLimit())</span><br><span class="line">            .from(query.getOffset())</span><br><span class="line">            .sort(SortOptions.of(so -&gt; so</span><br><span class="line">                .field(f -&gt; f</span><br><span class="line">                    .field(<span class="string">&quot;timestamp&quot;</span>)</span><br><span class="line">                    .order(SortOrder.Desc)))));</span><br><span class="line">        </span><br><span class="line">        SearchResponse&lt;PersonObject&gt; response = client.search(request, PersonObject.class);</span><br><span class="line">        <span class="keyword">return</span> convertToSearchResult(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Batch processing for bulk operations</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;Void&gt; <span class="title function_">bulkIndexPersons</span><span class="params">(List&lt;PersonObject&gt; persons)</span> &#123;</span><br><span class="line">        BulkRequest.<span class="type">Builder</span> <span class="variable">bulkBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>.Builder();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (PersonObject person : persons) &#123;</span><br><span class="line">            bulkBuilder.operations(op -&gt; op</span><br><span class="line">                .index(idx -&gt; idx</span><br><span class="line">                    .index(<span class="string">&quot;person_index&quot;</span>)</span><br><span class="line">                    .id(person.getId())</span><br><span class="line">                    .document(person)));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">BulkResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.bulk(bulkBuilder.build());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (response.errors()) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Bulk indexing errors: &#123;&#125;&quot;</span>, response.items().size());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.completedFuture(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Memory-and-CPU-Optimization"><a href="#Memory-and-CPU-Optimization" class="headerlink" title="Memory and CPU Optimization:"></a>Memory and CPU Optimization:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedImageProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService imageProcessingPool;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectPool&lt;BufferedImage&gt; imagePool;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OptimizedImageProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Create bounded thread pool for image processing</span></span><br><span class="line">        <span class="built_in">this</span>.imageProcessingPool = <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">            <span class="number">4</span>, <span class="comment">// core threads</span></span><br><span class="line">            Runtime.getRuntime().availableProcessors() * <span class="number">2</span>, <span class="comment">// max threads</span></span><br><span class="line">            <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1000</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ThreadFactoryBuilder</span>()</span><br><span class="line">                .setNameFormat(<span class="string">&quot;image-processor-%d&quot;</span>)</span><br><span class="line">                .setDaemon(<span class="literal">true</span>)</span><br><span class="line">                .build(),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Object pool for reusing BufferedImage objects</span></span><br><span class="line">        <span class="built_in">this</span>.imagePool = <span class="keyword">new</span> <span class="title class_">GenericObjectPool</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">BufferedImageFactory</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;ProcessedImage&gt; <span class="title function_">processImageAsync</span><span class="params">(<span class="type">byte</span>[] imageData)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                image = imagePool.borrowObject();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Resize image to standard dimensions</span></span><br><span class="line">                <span class="type">BufferedImage</span> <span class="variable">resized</span> <span class="operator">=</span> resizeImage(imageData, <span class="number">640</span>, <span class="number">480</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Apply optimizations</span></span><br><span class="line">                <span class="keyword">return</span> ProcessedImage.builder()</span><br><span class="line">                    .image(resized)</span><br><span class="line">                    .metadata(extractMetadata(resized))</span><br><span class="line">                    .build();</span><br><span class="line">                    </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ImageProcessingException</span>(<span class="string">&quot;Failed to process image&quot;</span>, e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (image != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        imagePool.returnObject(image);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        log.warn(<span class="string">&quot;Failed to return image to pool&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, imageProcessingPool);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> BufferedImage <span class="title function_">resizeImage</span><span class="params">(<span class="type">byte</span>[] imageData, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(imageData)) &#123;</span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">original</span> <span class="operator">=</span> ImageIO.read(is);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Use high-quality scaling</span></span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">resized</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedImage</span>(width, height, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">            <span class="type">Graphics2D</span> <span class="variable">g2d</span> <span class="operator">=</span> resized.createGraphics();</span><br><span class="line">            </span><br><span class="line">            g2d.setRenderingHint(RenderingHints.KEY_INTERPOLATION, </span><br><span class="line">                RenderingHints.VALUE_INTERPOLATION_BILINEAR);</span><br><span class="line">            g2d.setRenderingHint(RenderingHints.KEY_RENDERING, </span><br><span class="line">                RenderingHints.VALUE_RENDER_QUALITY);</span><br><span class="line">            </span><br><span class="line">            g2d.drawImage(original, <span class="number">0</span>, <span class="number">0</span>, width, height, <span class="literal">null</span>);</span><br><span class="line">            g2d.dispose();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> resized;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ImageProcessingException</span>(<span class="string">&quot;Failed to resize image&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Monitoring-and-Observability"><a href="#Monitoring-and-Observability" class="headerlink" title="Monitoring and Observability"></a>Monitoring and Observability</h2><h3 id="Comprehensive-Monitoring-Setup"><a href="#Comprehensive-Monitoring-Setup" class="headerlink" title="Comprehensive Monitoring Setup:"></a>Comprehensive Monitoring Setup:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter videoAnalysisCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer analysisTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge activeTasksGauge;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SystemMetrics</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        <span class="built_in">this</span>.videoAnalysisCounter = Counter.builder(<span class="string">&quot;video.analysis.total&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Total number of video analysis requests&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;service&quot;</span>, <span class="string">&quot;structure-app&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.analysisTimer = Timer.builder(<span class="string">&quot;video.analysis.duration&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Video analysis processing time&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.activeTasksGauge = Gauge.builder(<span class="string">&quot;tasks.active&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Number of active analysis tasks&quot;</span>)</span><br><span class="line">            .register(meterRegistry, <span class="built_in">this</span>, SystemMetrics::getActiveTaskCount);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordAnalysis</span><span class="params">(String objectType, Duration duration, String result)</span> &#123;</span><br><span class="line">        videoAnalysisCounter.increment(</span><br><span class="line">            Tags.of(</span><br><span class="line">                <span class="string">&quot;object.type&quot;</span>, objectType,</span><br><span class="line">                <span class="string">&quot;result&quot;</span>, result</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        analysisTimer.record(duration);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">getActiveTaskCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> taskManagerService.getActiveTaskCount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Distributed-Tracing"><a href="#Distributed-Tracing" class="headerlink" title="Distributed Tracing:"></a>Distributed Tracing:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TracedAnalysisController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Tracer tracer;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/analyze&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;AnalysisResult&gt; <span class="title function_">analyzeVideo</span><span class="params">(<span class="meta">@RequestBody</span> VideoRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span> tracer.nextSpan()</span><br><span class="line">            .name(<span class="string">&quot;video-analysis&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;video.size&quot;</span>, String.valueOf(request.getSize()))</span><br><span class="line">            .tag(<span class="string">&quot;video.format&quot;</span>, request.getFormat())</span><br><span class="line">            .start();</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">try</span> (Tracer.<span class="type">SpanInScope</span> <span class="variable">ws</span> <span class="operator">=</span> tracer.withSpanInScope(span)) &#123;</span><br><span class="line">            <span class="type">AnalysisResult</span> <span class="variable">result</span> <span class="operator">=</span> performAnalysis(request);</span><br><span class="line">            </span><br><span class="line">            span.tag(<span class="string">&quot;objects.detected&quot;</span>, String.valueOf(result.getObjectCount()));</span><br><span class="line">            span.tag(<span class="string">&quot;analysis.status&quot;</span>, result.getStatus());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(result);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            span.tag(<span class="string">&quot;error&quot;</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            span.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Health-Checks-and-Alerting"><a href="#Health-Checks-and-Alerting" class="headerlink" title="Health Checks and Alerting:"></a>Health Checks and Alerting:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GPUResourceMonitor gpuMonitor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaHealthIndicator kafkaHealth;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        Health.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Health</span>.Builder();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check GPU availability</span></span><br><span class="line">        <span class="keyword">if</span> (gpuMonitor.getAvailableGPUs() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> builder.down()</span><br><span class="line">                .withDetail(<span class="string">&quot;gpu&quot;</span>, <span class="string">&quot;No GPUs available&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check Kafka connectivity</span></span><br><span class="line">        <span class="keyword">if</span> (!kafkaHealth.isHealthy()) &#123;</span><br><span class="line">            <span class="keyword">return</span> builder.down()</span><br><span class="line">                .withDetail(<span class="string">&quot;kafka&quot;</span>, <span class="string">&quot;Kafka connection failed&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check memory usage</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">memoryUsage</span> <span class="operator">=</span> getMemoryUsage();</span><br><span class="line">        <span class="keyword">if</span> (memoryUsage &gt; <span class="number">0.9</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> builder.down()</span><br><span class="line">                .withDetail(<span class="string">&quot;memory&quot;</span>, <span class="string">&quot;Memory usage critical: &quot;</span> + memoryUsage)</span><br><span class="line">                .build();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> builder.up()</span><br><span class="line">            .withDetail(<span class="string">&quot;gpu.count&quot;</span>, gpuMonitor.getAvailableGPUs())</span><br><span class="line">            .withDetail(<span class="string">&quot;memory.usage&quot;</span>, memoryUsage)</span><br><span class="line">            .withDetail(<span class="string">&quot;kafka.status&quot;</span>, <span class="string">&quot;healthy&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Security-Implementation"><a href="#Security-Implementation" class="headerlink" title="Security Implementation"></a>Security Implementation</h2><h3 id="Authentication-and-Authorization"><a href="#Authentication-and-Authorization" class="headerlink" title="Authentication and Authorization:"></a>Authentication and Authorization:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> http</span><br><span class="line">            .csrf().disable()</span><br><span class="line">            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">            .and()</span><br><span class="line">            .authorizeHttpRequests(auth -&gt; auth</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/api/v1/public/**&quot;</span>).permitAll()</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/actuator/health&quot;</span>).permitAll()</span><br><span class="line">                .requestMatchers(HttpMethod.POST, <span class="string">&quot;/api/v1/tasks&quot;</span>).hasRole(<span class="string">&quot;OPERATOR&quot;</span>)</span><br><span class="line">                .requestMatchers(HttpMethod.GET, <span class="string">&quot;/api/v1/search/**&quot;</span>).hasRole(<span class="string">&quot;VIEWER&quot;</span>)</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/api/v1/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">            )</span><br><span class="line">            .oauth2ResourceServer(oauth2 -&gt; oauth2</span><br><span class="line">                .jwt(jwt -&gt; jwt</span><br><span class="line">                    .jwtAuthenticationConverter(jwtAuthenticationConverter())</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JwtAuthenticationConverter <span class="title function_">jwtAuthenticationConverter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JwtGrantedAuthoritiesConverter</span> <span class="variable">authoritiesConverter</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">JwtGrantedAuthoritiesConverter</span>();</span><br><span class="line">        authoritiesConverter.setAuthorityPrefix(<span class="string">&quot;ROLE_&quot;</span>);</span><br><span class="line">        authoritiesConverter.setAuthoritiesClaimName(<span class="string">&quot;authorities&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">JwtAuthenticationConverter</span> <span class="variable">converter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JwtAuthenticationConverter</span>();</span><br><span class="line">        converter.setJwtGrantedAuthoritiesConverter(authoritiesConverter);</span><br><span class="line">        <span class="keyword">return</span> converter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="API-Rate-Limiting"><a href="#API-Rate-Limiting" class="headerlink" title="API Rate Limiting:"></a>API Rate Limiting:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitingFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, RateLimitConfig&gt; rateLimitConfigs = Map.of(</span><br><span class="line">        <span class="string">&quot;/api/v1/search&quot;</span>, <span class="keyword">new</span> <span class="title class_">RateLimitConfig</span>(<span class="number">100</span>, Duration.ofMinutes(<span class="number">1</span>)),</span><br><span class="line">        <span class="string">&quot;/api/v1/tasks&quot;</span>, <span class="keyword">new</span> <span class="title class_">RateLimitConfig</span>(<span class="number">50</span>, Duration.ofMinutes(<span class="number">1</span>)),</span><br><span class="line">        <span class="string">&quot;/api/v1/similarity&quot;</span>, <span class="keyword">new</span> <span class="title class_">RateLimitConfig</span>(<span class="number">20</span>, Duration.ofMinutes(<span class="number">1</span>))</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, </span></span><br><span class="line"><span class="params">                        FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">clientId</span> <span class="operator">=</span> extractClientId(httpRequest);</span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> httpRequest.getRequestURI();</span><br><span class="line">        </span><br><span class="line">        <span class="type">RateLimitConfig</span> <span class="variable">config</span> <span class="operator">=</span> getRateLimitConfig(endpoint);</span><br><span class="line">        <span class="keyword">if</span> (config != <span class="literal">null</span> &amp;&amp; !isRequestAllowed(clientId, endpoint, config)) &#123;</span><br><span class="line">            httpResponse.setStatus(HttpStatus.TOO_MANY_REQUESTS.value());</span><br><span class="line">            httpResponse.getWriter().write(<span class="string">&quot;Rate limit exceeded&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isRequestAllowed</span><span class="params">(String clientId, String endpoint, RateLimitConfig config)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;rate_limit:&quot;</span> + clientId + <span class="string">&quot;:&quot;</span> + endpoint;</span><br><span class="line">        <span class="type">String</span> <span class="variable">currentCount</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (currentCount == <span class="literal">null</span>) &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, <span class="string">&quot;1&quot;</span>, config.getWindow());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> Integer.parseInt(currentCount);</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= config.getLimit()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        redisTemplate.opsForValue().increment(key);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Advanced-Use-Cases-and-Examples"><a href="#Advanced-Use-Cases-and-Examples" class="headerlink" title="Advanced Use Cases and Examples"></a>Advanced Use Cases and Examples</h2><h3 id="Real-time-Traffic-Monitoring"><a href="#Real-time-Traffic-Monitoring" class="headerlink" title="Real-time Traffic Monitoring:"></a>Real-time Traffic Monitoring:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrafficMonitoringService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleVehicleDetection</span><span class="params">(VehicleDetectedEvent event)</span> &#123;</span><br><span class="line">        <span class="type">VehicleObject</span> <span class="variable">vehicle</span> <span class="operator">=</span> event.getVehicle();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check for traffic violations</span></span><br><span class="line">        <span class="keyword">if</span> (isSpeedViolation(vehicle)) &#123;</span><br><span class="line">            publishSpeedViolationAlert(vehicle);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update traffic flow statistics</span></span><br><span class="line">        updateTrafficFlow(vehicle.getLocation(), vehicle.getTimestamp());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check for congestion patterns</span></span><br><span class="line">        <span class="keyword">if</span> (detectTrafficCongestion(vehicle.getLocation())) &#123;</span><br><span class="line">            publishTrafficAlert(vehicle.getLocation());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isSpeedViolation</span><span class="params">(VehicleObject vehicle)</span> &#123;</span><br><span class="line">        <span class="type">SpeedLimit</span> <span class="variable">speedLimit</span> <span class="operator">=</span> getSpeedLimit(vehicle.getLocation());</span><br><span class="line">        <span class="type">double</span> <span class="variable">estimatedSpeed</span> <span class="operator">=</span> calculateSpeed(vehicle);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> estimatedSpeed &gt; speedLimit.getLimit() * <span class="number">1.1</span>; <span class="comment">// 10% tolerance</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">publishSpeedViolationAlert</span><span class="params">(VehicleObject vehicle)</span> &#123;</span><br><span class="line">        <span class="type">SpeedViolationAlert</span> <span class="variable">alert</span> <span class="operator">=</span> SpeedViolationAlert.builder()</span><br><span class="line">            .vehicleId(vehicle.getId())</span><br><span class="line">            .plateNumber(vehicle.getPlateNumber())</span><br><span class="line">            .location(vehicle.getLocation())</span><br><span class="line">            .timestamp(vehicle.getTimestamp())</span><br><span class="line">            .estimatedSpeed(calculateSpeed(vehicle))</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        kafkaTemplate.send(<span class="string">&quot;speed-violations&quot;</span>, alert);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Crowd-Density-Analysis"><a href="#Crowd-Density-Analysis" class="headerlink" title="Crowd Density Analysis:"></a>Crowd Density Analysis:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrowdAnalysisProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CROWD_DENSITY_THRESHOLD</span> <span class="operator">=</span> <span class="number">10</span>; <span class="comment">// persons per square meter</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 30000)</span> <span class="comment">// Every 30 seconds</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">analyzeCrowdDensity</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;CameraLocation&gt; locations = cameraService.getAllActiveLocations();</span><br><span class="line">        </span><br><span class="line">        locations.parallelStream().forEach(location -&gt; &#123;</span><br><span class="line">            List&lt;PersonObject&gt; recentDetections = getRecentPersonDetections(</span><br><span class="line">                location, Duration.ofMinutes(<span class="number">1</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="type">double</span> <span class="variable">density</span> <span class="operator">=</span> calculateCrowdDensity(recentDetections, location.getArea());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (density &gt; CROWD_DENSITY_THRESHOLD) &#123;</span><br><span class="line">                <span class="type">CrowdDensityAlert</span> <span class="variable">alert</span> <span class="operator">=</span> CrowdDensityAlert.builder()</span><br><span class="line">                    .location(location)</span><br><span class="line">                    .density(density)</span><br><span class="line">                    .personCount(recentDetections.size())</span><br><span class="line">                    .timestamp(Instant.now())</span><br><span class="line">                    .severity(determineSeverity(density))</span><br><span class="line">                    .build();</span><br><span class="line">                </span><br><span class="line">                alertService.publishAlert(alert);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Store density metrics</span></span><br><span class="line">            metricsService.recordCrowdDensity(location, density);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateCrowdDensity</span><span class="params">(List&lt;PersonObject&gt; persons, <span class="type">double</span> area)</span> &#123;</span><br><span class="line">        <span class="comment">// Remove duplicates based on spatial proximity</span></span><br><span class="line">        List&lt;PersonObject&gt; uniquePersons = removeDuplicateDetections(persons);</span><br><span class="line">        <span class="keyword">return</span> uniquePersons.size() / area;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;PersonObject&gt; <span class="title function_">removeDuplicateDetections</span><span class="params">(List&lt;PersonObject&gt; persons)</span> &#123;</span><br><span class="line">        List&lt;PersonObject&gt; unique = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (PersonObject person : persons) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isDuplicate</span> <span class="operator">=</span> unique.stream()</span><br><span class="line">                .anyMatch(p -&gt; calculateDistance(p.getBbox(), person.getBbox()) &lt; <span class="number">50</span>);</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">if</span> (!isDuplicate) &#123;</span><br><span class="line">                unique.add(person);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> unique;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Behavioral-Pattern-Recognition"><a href="#Behavioral-Pattern-Recognition" class="headerlink" title="Behavioral Pattern Recognition:"></a>Behavioral Pattern Recognition:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BehaviorAnalysisService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonTrackingService trackingService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">analyzePersonBehavior</span><span class="params">(List&lt;PersonObject&gt; personHistory)</span> &#123;</span><br><span class="line">        <span class="type">PersonTrajectory</span> <span class="variable">trajectory</span> <span class="operator">=</span> trackingService.buildTrajectory(personHistory);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Detect loitering behavior</span></span><br><span class="line">        <span class="keyword">if</span> (detectLoitering(trajectory)) &#123;</span><br><span class="line">            <span class="type">BehaviorAlert</span> <span class="variable">alert</span> <span class="operator">=</span> BehaviorAlert.builder()</span><br><span class="line">                .personId(trajectory.getPersonId())</span><br><span class="line">                .behaviorType(BehaviorType.LOITERING)</span><br><span class="line">                .location(trajectory.getCurrentLocation())</span><br><span class="line">                .duration(trajectory.getDuration())</span><br><span class="line">                .confidence(<span class="number">0.85</span>)</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">            alertService.publishBehaviorAlert(alert);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Detect suspicious movement patterns</span></span><br><span class="line">        <span class="keyword">if</span> (detectSuspiciousMovement(trajectory)) &#123;</span><br><span class="line">            <span class="type">BehaviorAlert</span> <span class="variable">alert</span> <span class="operator">=</span> BehaviorAlert.builder()</span><br><span class="line">                .personId(trajectory.getPersonId())</span><br><span class="line">                .behaviorType(BehaviorType.SUSPICIOUS_MOVEMENT)</span><br><span class="line">                .movementPattern(trajectory.getMovementPattern())</span><br><span class="line">                .confidence(calculateConfidence(trajectory))</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">            alertService.publishBehaviorAlert(alert);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">detectLoitering</span><span class="params">(PersonTrajectory trajectory)</span> &#123;</span><br><span class="line">        <span class="comment">// Check if person stayed in same area for extended period</span></span><br><span class="line">        <span class="type">Duration</span> <span class="variable">stationaryTime</span> <span class="operator">=</span> trajectory.getStationaryTime();</span><br><span class="line">        <span class="type">double</span> <span class="variable">movementRadius</span> <span class="operator">=</span> trajectory.getMovementRadius();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stationaryTime.toMinutes() &gt; <span class="number">10</span> &amp;&amp; movementRadius &lt; <span class="number">5.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">detectSuspiciousMovement</span><span class="params">(PersonTrajectory trajectory)</span> &#123;</span><br><span class="line">        <span class="comment">// Analyze movement patterns for suspicious behavior</span></span><br><span class="line">        <span class="type">MovementPattern</span> <span class="variable">pattern</span> <span class="operator">=</span> trajectory.getMovementPattern();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> pattern.hasErraticMovement() || </span><br><span class="line">               pattern.hasUnusualDirectionChanges() ||</span><br><span class="line">               pattern.isCounterFlow();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Interview-Questions-and-Insights"><a href="#Interview-Questions-and-Insights" class="headerlink" title="Interview Questions and Insights"></a>Interview Questions and Insights</h2><h3 id="Technical-Architecture-Questions"><a href="#Technical-Architecture-Questions" class="headerlink" title="Technical Architecture Questions:"></a>Technical Architecture Questions:</h3><p><strong>Q: How do you ensure data consistency when processing high-volume video streams?</strong></p>
<p><strong>A:</strong> Implement event sourcing with Kafka as the source of truth, use idempotent message processing with unique frame IDs, implement exactly-once semantics in Kafka consumers, and use distributed locking for critical sections. Apply the saga pattern for complex workflows and maintain event ordering through partitioning strategies.</p>
<p><strong>Q: How would you optimize GPU utilization across multiple analysis nodes?</strong></p>
<p><strong>A:</strong> Implement dynamic batching to maximize GPU throughput, use GPU memory pooling to reduce allocation overhead, implement model quantization for faster inference, use multiple streams per GPU for concurrent processing, and implement intelligent load balancing based on GPU memory and compute utilization.</p>
<p><strong>Q: How do you handle camera failures and ensure continuous monitoring?</strong></p>
<p><strong>A:</strong> Implement health checks with circuit breakers, maintain redundant camera coverage for critical areas, use automatic failover mechanisms, implement camera status monitoring with alerting, and maintain a hot standby system for critical infrastructure.</p>
<h3 id="Scalability-and-Performance-Questions"><a href="#Scalability-and-Performance-Questions" class="headerlink" title="Scalability and Performance Questions:"></a>Scalability and Performance Questions:</h3><p><strong>Q: How would you scale this system to handle 10,000 concurrent camera streams?</strong></p>
<p><strong>A:</strong> Implement horizontal scaling with container orchestration (Kubernetes), use streaming data processing frameworks (Apache Flink&#x2F;Storm), implement distributed caching strategies, use database sharding and read replicas, implement edge computing for preprocessing, and use CDN for static content delivery.</p>
<p><strong>Q: How do you optimize search performance for billions of detection records?</strong></p>
<p><strong>A:</strong> Implement data partitioning by time and location, use Elasticsearch with proper index management, implement caching layers with Redis, use approximate algorithms for similarity search, implement data archiving strategies, and use search result pagination with cursor-based pagination.</p>
<h3 id="Data-Management-Questions"><a href="#Data-Management-Questions" class="headerlink" title="Data Management Questions:"></a>Data Management Questions:</h3><p><strong>Q: How do you handle privacy and data retention in video analytics?</strong></p>
<p><strong>A:</strong> Implement data anonymization techniques, use automatic data expiration policies, implement role-based access controls, use encryption for data at rest and in transit, implement audit logging for data access, and ensure compliance with privacy regulations (GDPR, CCPA).</p>
<p><strong>Q: How would you implement real-time similarity search for millions of face vectors?</strong></p>
<p><strong>A:</strong> Use approximate nearest neighbor algorithms (LSH, FAISS), implement hierarchical indexing, use vector quantization techniques, implement distributed vector databases (Milvus, Pinecone), use GPU acceleration for vector operations, and implement caching for frequently accessed vectors.</p>
<h2 id="External-Resources-and-References"><a href="#External-Resources-and-References" class="headerlink" title="External Resources and References"></a>External Resources and References</h2><h3 id="Technical-Documentation"><a href="#Technical-Documentation" class="headerlink" title="Technical Documentation:"></a>Technical Documentation:</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://kafka.apache.org/documentation/">Kafka Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html">Spring Cloud Alibaba</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/happyfish100/fastdfs">FastDFS Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://milvus.io/docs">Milvus Vector Database</a></li>
</ul>
<h3 id="AI-ML-Resources"><a href="#AI-ML-Resources" class="headerlink" title="AI&#x2F;ML Resources:"></a>AI&#x2F;ML Resources:</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.ultralytics.com/">YOLOv8 Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.opencv.org/">OpenCV Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/index.html">PyTorch Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/tensorflow/models">TensorFlow Model Garden</a></li>
</ul>
<h3 id="Monitoring-and-Observability-1"><a href="#Monitoring-and-Observability-1" class="headerlink" title="Monitoring and Observability:"></a>Monitoring and Observability:</h3><ul>
<li><a target="_blank" rel="noopener" href="https://prometheus.io/docs/">Prometheus Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://grafana.com/docs/">Grafana Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jaegertracing.io/docs/">Jaeger Tracing</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html">Spring Boot Actuator</a></li>
</ul>
<h3 id="Container-Orchestration"><a href="#Container-Orchestration" class="headerlink" title="Container Orchestration:"></a>Container Orchestration:</h3><ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/">Kubernetes Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/">Docker Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://helm.sh/docs/">Helm Charts</a></li>
</ul>
<p>This comprehensive platform design provides a production-ready solution for video analytics with proper scalability, performance optimization, and maintainability considerations. The architecture supports both small-scale deployments and large-scale enterprise installations through its modular design and containerized deployment strategy.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/system-design/" rel="tag"># system-design</a>
              <a href="/tags/structure-analysis-platform/" rel="tag"># structure analysis platform</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/16/Elasticsearch-Underlying-Principles-Deep-Dive/" rel="prev" title="Elasticsearch Underlying Principles Deep Dive">
                  <i class="fa fa-angle-left"></i> Elasticsearch Underlying Principles Deep Dive
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/17/Elasticsearch-High-Availability-Deep-Dive-Guide/" rel="next" title="Elasticsearch High Availability: Deep Dive Guide">
                  Elasticsearch High Availability: Deep Dive Guide <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
