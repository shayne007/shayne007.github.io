<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Shards and Replicas: The Foundation of Elasticsearch HAUnderstanding ShardsShards are the fundamental building blocks of Elasticsearch’s distributed architecture. Each index is divided into multiple s">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch High Availability: Deep Dive Guide">
<meta property="og:url" content="https://shayne007.github.io/2025/06/17/Elasticsearch-High-Availability-Deep-Dive-Guide/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="Shards and Replicas: The Foundation of Elasticsearch HAUnderstanding ShardsShards are the fundamental building blocks of Elasticsearch’s distributed architecture. Each index is divided into multiple s">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-17T09:08:58.000Z">
<meta property="article:modified_time" content="2025-06-17T09:10:45.475Z">
<meta property="article:author" content="Charlie Feng">
<meta property="article:tag" content="elasticsearch">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/06/17/Elasticsearch-High-Availability-Deep-Dive-Guide/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/06/17/Elasticsearch-High-Availability-Deep-Dive-Guide/","path":"2025/06/17/Elasticsearch-High-Availability-Deep-Dive-Guide/","title":"Elasticsearch High Availability: Deep Dive Guide"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Elasticsearch High Availability: Deep Dive Guide | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Shards-and-Replicas-The-Foundation-of-Elasticsearch-HA"><span class="nav-number">1.</span> <span class="nav-text">Shards and Replicas: The Foundation of Elasticsearch HA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Understanding-Shards"><span class="nav-number">1.1.</span> <span class="nav-text">Understanding Shards</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Replica-Strategy-for-High-Availability"><span class="nav-number">1.2.</span> <span class="nav-text">Replica Strategy for High Availability</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-World-Example-E-commerce-Platform"><span class="nav-number">1.3.</span> <span class="nav-text">Real-World Example: E-commerce Platform</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TransLog-Ensuring-Write-Durability"><span class="nav-number">2.</span> <span class="nav-text">TransLog: Ensuring Write Durability</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TransLog-Mechanism"><span class="nav-number">2.1.</span> <span class="nav-text">TransLog Mechanism</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TransLog-Configuration-for-High-Availability"><span class="nav-number">2.2.</span> <span class="nav-text">TransLog Configuration for High Availability</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Production-Example-Financial-Trading-System"><span class="nav-number">2.3.</span> <span class="nav-text">Production Example: Financial Trading System</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Production-HA-Challenges-and-Solutions"><span class="nav-number">3.</span> <span class="nav-text">Production HA Challenges and Solutions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Common-Production-Issues"><span class="nav-number">3.1.</span> <span class="nav-text">Common Production Issues</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Split-Brain-Syndrome"><span class="nav-number">3.1.1.</span> <span class="nav-text">Split-Brain Syndrome</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Memory-Pressure-and-GC-Issues"><span class="nav-number">3.1.2.</span> <span class="nav-text">Memory Pressure and GC Issues</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Uneven-Shard-Distribution"><span class="nav-number">3.1.3.</span> <span class="nav-text">Uneven Shard Distribution</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-Production-Case-Study-Log-Analytics-Platform"><span class="nav-number">3.2.</span> <span class="nav-text">Real Production Case Study: Log Analytics Platform</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Optimization-Strategies-for-Production-HA"><span class="nav-number">4.</span> <span class="nav-text">Optimization Strategies for Production HA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Rate-Limiting-Implementation"><span class="nav-number">4.1.</span> <span class="nav-text">Rate Limiting Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Message-Queue-Peak-Shaving"><span class="nav-number">4.2.</span> <span class="nav-text">Message Queue Peak Shaving</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Single-Role-Node-Architecture"><span class="nav-number">4.3.</span> <span class="nav-text">Single Role Node Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dual-Cluster-Deployment-Strategy"><span class="nav-number">4.4.</span> <span class="nav-text">Dual Cluster Deployment Strategy</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-HA-Monitoring-and-Alerting"><span class="nav-number">5.</span> <span class="nav-text">Advanced HA Monitoring and Alerting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Metrics-to-Monitor"><span class="nav-number">5.1.</span> <span class="nav-text">Key Metrics to Monitor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alerting-Configuration-Example"><span class="nav-number">5.2.</span> <span class="nav-text">Alerting Configuration Example</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Tuning-for-HA"><span class="nav-number">6.</span> <span class="nav-text">Performance Tuning for HA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Index-Lifecycle-Management"><span class="nav-number">6.1.</span> <span class="nav-text">Index Lifecycle Management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hardware-Recommendations"><span class="nav-number">6.2.</span> <span class="nav-text">Hardware Recommendations</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interview-Questions-and-Expert-Answers"><span class="nav-number">7.</span> <span class="nav-text">Interview Questions and Expert Answers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-Considerations-for-HA"><span class="nav-number">8.</span> <span class="nav-text">Security Considerations for HA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Authentication-and-Authorization"><span class="nav-number">8.1.</span> <span class="nav-text">Authentication and Authorization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Best-Practices-Summary"><span class="nav-number">9.</span> <span class="nav-text">Best Practices Summary</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Do%E2%80%99s"><span class="nav-number">9.1.</span> <span class="nav-text">Do’s</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Don%E2%80%99ts"><span class="nav-number">9.2.</span> <span class="nav-text">Don’ts</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References-and-Additional-Resources"><span class="nav-number">10.</span> <span class="nav-text">References and Additional Resources</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/06/17/Elasticsearch-High-Availability-Deep-Dive-Guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Elasticsearch High Availability: Deep Dive Guide | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Elasticsearch High Availability: Deep Dive Guide
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-06-17 17:08:58 / Modified: 17:10:45" itemprop="dateCreated datePublished" datetime="2025-06-17T17:08:58+08:00">2025-06-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/elasticsearch/" itemprop="url" rel="index"><span itemprop="name">elasticsearch</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Shards-and-Replicas-The-Foundation-of-Elasticsearch-HA"><a href="#Shards-and-Replicas-The-Foundation-of-Elasticsearch-HA" class="headerlink" title="Shards and Replicas: The Foundation of Elasticsearch HA"></a>Shards and Replicas: The Foundation of Elasticsearch HA</h2><h3 id="Understanding-Shards"><a href="#Understanding-Shards" class="headerlink" title="Understanding Shards"></a>Understanding Shards</h3><p>Shards are the fundamental building blocks of Elasticsearch’s distributed architecture. Each index is divided into multiple shards, which are essentially independent Lucene indices that can be distributed across different nodes in a cluster.</p>
<p><strong>Primary Shards:</strong></p>
<ul>
<li>Store the original data</li>
<li>Handle write operations</li>
<li>Number is fixed at index creation time</li>
<li>Cannot be changed without reindexing</li>
</ul>
<p><strong>Shard Sizing Best Practices:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.routing.allocation.total_shards_per_node&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Replica-Strategy-for-High-Availability"><a href="#Replica-Strategy-for-High-Availability" class="headerlink" title="Replica Strategy for High Availability"></a>Replica Strategy for High Availability</h3><p>Replicas are exact copies of primary shards that provide both redundancy and increased read throughput.</p>
<p><strong>Production Replica Configuration:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT /production_logs</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.refresh_interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30s&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.translog.durability&quot;</span><span class="punctuation">:</span> <span class="string">&quot;request&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Real-World-Example-E-commerce-Platform"><a href="#Real-World-Example-E-commerce-Platform" class="headerlink" title="Real-World Example: E-commerce Platform"></a>Real-World Example: E-commerce Platform</h3><p>Consider an e-commerce platform handling 1TB of product data:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT /products</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.routing.allocation.require.box_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hot&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;product_id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;double&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<pre>
<code class="mermaid">
graph TB
subgraph &quot;Node 1&quot;
    P1[Primary Shard 1]
    R2[Replica Shard 2]
    R3[Replica Shard 3]
end

subgraph &quot;Node 2&quot;
    P2[Primary Shard 2]
    R1[Replica Shard 1]
    R4[Replica Shard 4]
end

subgraph &quot;Node 3&quot;
    P3[Primary Shard 3]
    P4[Primary Shard 4]
    R5[Replica Shard 5]
end

P1 -.-&gt;|Replicates to| R1
P2 -.-&gt;|Replicates to| R2
P3 -.-&gt;|Replicates to| R3
P4 -.-&gt;|Replicates to| R4
</code>
</pre>

<p><strong>Interview Insight:</strong> <em>“How would you determine the optimal number of shards for a 500GB index with expected 50% growth annually?”</em></p>
<p><strong>Answer:</strong> Calculate based on shard size (aim for 10-50GB per shard), consider node capacity, and factor in growth. For 500GB growing to 750GB: 15-75 shards initially, typically 20-30 shards with 1-2 replicas.</p>
<h2 id="TransLog-Ensuring-Write-Durability"><a href="#TransLog-Ensuring-Write-Durability" class="headerlink" title="TransLog: Ensuring Write Durability"></a>TransLog: Ensuring Write Durability</h2><h3 id="TransLog-Mechanism"><a href="#TransLog-Mechanism" class="headerlink" title="TransLog Mechanism"></a>TransLog Mechanism</h3><p>The Transaction Log (TransLog) is Elasticsearch’s write-ahead log that ensures data durability during unexpected shutdowns or power failures.</p>
<p><strong>How TransLog Works:</strong></p>
<ol>
<li>Write operation received</li>
<li>Data written to in-memory buffer</li>
<li>Operation logged to TransLog</li>
<li>Acknowledgment sent to client</li>
<li>Periodic flush to Lucene segments</li>
</ol>
<h3 id="TransLog-Configuration-for-High-Availability"><a href="#TransLog-Configuration-for-High-Availability" class="headerlink" title="TransLog Configuration for High Availability"></a>TransLog Configuration for High Availability</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT /critical_data</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index.translog.durability&quot;</span><span class="punctuation">:</span> <span class="string">&quot;request&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.translog.sync_interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5s&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.translog.flush_threshold_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;512mb&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.refresh_interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1s&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>TransLog Durability Options:</strong></p>
<ul>
<li><code>request</code>: Fsync after each request (highest durability, lower performance)</li>
<li><code>async</code>: Fsync every sync_interval (better performance, slight risk)</li>
</ul>
<h3 id="Production-Example-Financial-Trading-System"><a href="#Production-Example-Financial-Trading-System" class="headerlink" title="Production Example: Financial Trading System"></a>Production Example: Financial Trading System</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT /trading_transactions</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.translog.durability&quot;</span><span class="punctuation">:</span> <span class="string">&quot;request&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.translog.sync_interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1s&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.refresh_interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1s&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.translog.retention.size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1gb&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.translog.retention.age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;12h&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<pre>
<code class="mermaid">
sequenceDiagram
participant Client
participant ES_Node
participant TransLog
participant Lucene

Client-&gt;&gt;ES_Node: Index Document
ES_Node-&gt;&gt;TransLog: Write to TransLog
TransLog--&gt;&gt;ES_Node: Confirm Write
ES_Node-&gt;&gt;Lucene: Add to In-Memory Buffer
ES_Node--&gt;&gt;Client: Acknowledge Request

Note over ES_Node: Periodic Refresh
ES_Node-&gt;&gt;Lucene: Flush Buffer to Segment
ES_Node-&gt;&gt;TransLog: Clear TransLog Entries
</code>
</pre>

<p><strong>Interview Insight:</strong> <em>“What happens if a node crashes between TransLog write and Lucene flush?”</em></p>
<p><strong>Answer:</strong> On restart, Elasticsearch replays TransLog entries to recover uncommitted operations. The TransLog ensures no acknowledged writes are lost, maintaining data consistency.</p>
<h2 id="Production-HA-Challenges-and-Solutions"><a href="#Production-HA-Challenges-and-Solutions" class="headerlink" title="Production HA Challenges and Solutions"></a>Production HA Challenges and Solutions</h2><h3 id="Common-Production-Issues"><a href="#Common-Production-Issues" class="headerlink" title="Common Production Issues"></a>Common Production Issues</h3><h4 id="Split-Brain-Syndrome"><a href="#Split-Brain-Syndrome" class="headerlink" title="Split-Brain Syndrome"></a>Split-Brain Syndrome</h4><p><strong>Problem:</strong> Network partitions causing multiple master nodes</p>
<p><strong>Solution:</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># elasticsearch.yml</span></span><br><span class="line"><span class="attr">discovery.zen.minimum_master_nodes:</span> <span class="number">2</span>  <span class="comment"># (total_masters / 2) + 1</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;node-1&quot;</span>, <span class="string">&quot;node-2&quot;</span>, <span class="string">&quot;node-3&quot;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="Memory-Pressure-and-GC-Issues"><a href="#Memory-Pressure-and-GC-Issues" class="headerlink" title="Memory Pressure and GC Issues"></a>Memory Pressure and GC Issues</h4><p><strong>Problem:</strong> Large heaps causing long GC pauses</p>
<p><strong>Solution:</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jvm.options</span></span><br><span class="line"><span class="string">-Xms16g</span></span><br><span class="line"><span class="string">-Xmx16g</span></span><br><span class="line"><span class="string">-XX:+UseG1GC</span></span><br><span class="line"><span class="string">-XX:MaxGCPauseMillis=200</span></span><br></pre></td></tr></table></figure>

<h4 id="Uneven-Shard-Distribution"><a href="#Uneven-Shard-Distribution" class="headerlink" title="Uneven Shard Distribution"></a>Uneven Shard Distribution</h4><p><strong>Problem:</strong> Hot spots on specific nodes</p>
<p><strong>Solution:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /_cluster/settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;transient&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;cluster.routing.allocation.balance.shard&quot;</span><span class="punctuation">:</span> <span class="number">0.45</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cluster.routing.allocation.balance.index&quot;</span><span class="punctuation">:</span> <span class="number">0.55</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cluster.routing.allocation.balance.threshold&quot;</span><span class="punctuation">:</span> <span class="number">1.0</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Real-Production-Case-Study-Log-Analytics-Platform"><a href="#Real-Production-Case-Study-Log-Analytics-Platform" class="headerlink" title="Real Production Case Study: Log Analytics Platform"></a>Real Production Case Study: Log Analytics Platform</h3><p><strong>Challenge:</strong> Processing 100GB&#x2F;day of application logs with strict SLA requirements</p>
<p><strong>Architecture:</strong></p>
<pre>
<code class="mermaid">
graph LR
subgraph &quot;Hot Tier&quot;
    H1[Hot Node 1]
    H2[Hot Node 2]
    H3[Hot Node 3]
end

subgraph &quot;Warm Tier&quot;
    W1[Warm Node 1]
    W2[Warm Node 2]
end

subgraph &quot;Cold Tier&quot;
    C1[Cold Node 1]
end

Apps[Applications] --&gt; LB[Load Balancer]
LB --&gt; H1
LB --&gt; H2
LB --&gt; H3

H1 -.-&gt;|Age-based| W1
H2 -.-&gt;|Migration| W2
W1 -.-&gt;|Archive| C1
W2 -.-&gt;|Archive| C1
</code>
</pre>

<p><strong>Index Template Configuration:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT /_index_template/logs_template</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index_patterns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;logs-*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.lifecycle.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;logs_policy&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.routing.allocation.require.box_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hot&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Interview Insight:</strong> <em>“How would you handle a scenario where your Elasticsearch cluster is experiencing high write latency?”</em></p>
<p><strong>Answer:</strong> </p>
<ol>
<li>Check TransLog settings (reduce durability if acceptable)</li>
<li>Optimize refresh intervals</li>
<li>Implement bulk indexing</li>
<li>Scale horizontally by adding nodes</li>
<li>Consider index lifecycle management</li>
</ol>
<h2 id="Optimization-Strategies-for-Production-HA"><a href="#Optimization-Strategies-for-Production-HA" class="headerlink" title="Optimization Strategies for Production HA"></a>Optimization Strategies for Production HA</h2><h3 id="Rate-Limiting-Implementation"><a href="#Rate-Limiting-Implementation" class="headerlink" title="Rate Limiting Implementation"></a>Rate Limiting Implementation</h3><p><strong>Circuit Breaker Pattern:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchCircuitBreaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ElasticsearchClient client;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;IndexResponse&gt; <span class="title function_">indexWithRateLimit</span><span class="params">(</span></span><br><span class="line"><span class="params">            IndexRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> circuitBreaker.executeSupplier(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> client.index(request);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Cluster-level Rate Limiting:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /_cluster/settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;transient&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;indices.memory.index_buffer_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20%&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;indices.memory.min_index_buffer_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;96mb&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thread_pool.write.queue_size&quot;</span><span class="punctuation">:</span> <span class="number">1000</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Message-Queue-Peak-Shaving"><a href="#Message-Queue-Peak-Shaving" class="headerlink" title="Message Queue Peak Shaving"></a>Message Queue Peak Shaving</h3><p><strong>Kafka Integration Example:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchBulkProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;elasticsearch-queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processBulkData</span><span class="params">(List&lt;String&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">        </span><br><span class="line">        documents.forEach(doc -&gt; &#123;</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;logs&quot;</span>)</span><br><span class="line">                .source(doc, XContentType.JSON));</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="type">BulkResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">        handleBulkResponse(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>MQ Configuration for Peak Shaving:</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="attr">max-poll-records:</span> <span class="number">500</span></span><br><span class="line">      <span class="attr">fetch-max-wait:</span> <span class="string">1000ms</span></span><br><span class="line">    <span class="attr">producer:</span></span><br><span class="line">      <span class="attr">batch-size:</span> <span class="number">65536</span></span><br><span class="line">      <span class="attr">linger-ms:</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h3 id="Single-Role-Node-Architecture"><a href="#Single-Role-Node-Architecture" class="headerlink" title="Single Role Node Architecture"></a>Single Role Node Architecture</h3><p><strong>Dedicated Master Nodes:</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># master.yml</span></span><br><span class="line"><span class="attr">node.roles:</span> [<span class="string">master</span>]</span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> [<span class="string">&quot;master-1&quot;</span>, <span class="string">&quot;master-2&quot;</span>, <span class="string">&quot;master-3&quot;</span>]</span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;master-1&quot;</span>, <span class="string">&quot;master-2&quot;</span>, <span class="string">&quot;master-3&quot;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>Data Nodes Configuration:</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data.yml</span></span><br><span class="line"><span class="attr">node.roles:</span> [<span class="string">data</span>, <span class="string">data_content</span>, <span class="string">data_hot</span>, <span class="string">data_warm</span>]</span><br><span class="line"><span class="attr">path.data:</span> [<span class="string">&quot;/data1&quot;</span>, <span class="string">&quot;/data2&quot;</span>, <span class="string">&quot;/data3&quot;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>Coordinating Nodes:</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coordinator.yml</span></span><br><span class="line"><span class="attr">node.roles:</span> []</span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br></pre></td></tr></table></figure>

<h3 id="Dual-Cluster-Deployment-Strategy"><a href="#Dual-Cluster-Deployment-Strategy" class="headerlink" title="Dual Cluster Deployment Strategy"></a>Dual Cluster Deployment Strategy</h3><p><strong>Active-Passive Setup:</strong></p>
<pre>
<code class="mermaid">
graph TB
subgraph &quot;Primary DC&quot;
    P_LB[Load Balancer]
    P_C1[Cluster 1 Node 1]
    P_C2[Cluster 1 Node 2]
    P_C3[Cluster 1 Node 3]
    
    P_LB --&gt; P_C1
    P_LB --&gt; P_C2
    P_LB --&gt; P_C3
end

subgraph &quot;Secondary DC&quot;
    S_C1[Cluster 2 Node 1]
    S_C2[Cluster 2 Node 2]
    S_C3[Cluster 2 Node 3]
end

P_C1 -.-&gt;|Cross Cluster Replication| S_C1
P_C2 -.-&gt;|CCR| S_C2
P_C3 -.-&gt;|CCR| S_C3

Apps[Applications] --&gt; P_LB
</code>
</pre>

<p><strong>Cross-Cluster Replication Setup:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT /_cluster/settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;cluster.remote.secondary&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;seeds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;secondary-cluster:9300&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;transport.compress&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">PUT /primary_index/_ccr/follow</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;remote_cluster&quot;</span><span class="punctuation">:</span> <span class="string">&quot;secondary&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;leader_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;primary_index&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Advanced-HA-Monitoring-and-Alerting"><a href="#Advanced-HA-Monitoring-and-Alerting" class="headerlink" title="Advanced HA Monitoring and Alerting"></a>Advanced HA Monitoring and Alerting</h2><h3 id="Key-Metrics-to-Monitor"><a href="#Key-Metrics-to-Monitor" class="headerlink" title="Key Metrics to Monitor"></a>Key Metrics to Monitor</h3><p><strong>Cluster Health Script:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">CLUSTER_HEALTH=$(curl -s <span class="string">&quot;localhost:9200/_cluster/health&quot;</span>)</span><br><span class="line">STATUS=$(<span class="built_in">echo</span> <span class="variable">$CLUSTER_HEALTH</span> | jq -r <span class="string">&#x27;.status&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$STATUS</span>&quot;</span> != <span class="string">&quot;green&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ALERT: Cluster status is <span class="variable">$STATUS</span>&quot;</span></span><br><span class="line">    <span class="comment"># Send notification</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p><strong>Critical Metrics:</strong></p>
<ul>
<li>Cluster status (green&#x2F;yellow&#x2F;red)</li>
<li>Node availability</li>
<li>Shard allocation status</li>
<li>Memory usage and GC frequency</li>
<li>Search and indexing latency</li>
<li>TransLog size and flush frequency</li>
</ul>
<h3 id="Alerting-Configuration-Example"><a href="#Alerting-Configuration-Example" class="headerlink" title="Alerting Configuration Example"></a>Alerting Configuration Example</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># alertmanager.yml</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">ElasticsearchClusterNotHealthy</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">elasticsearch_cluster_health_status&#123;color=&quot;red&quot;&#125;</span> <span class="string">==</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">0m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Elasticsearch cluster health is RED&quot;</span></span><br><span class="line">      </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">ElasticsearchNodeDown</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">up&#123;job=&quot;elasticsearch&quot;&#125;</span> <span class="string">==</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br></pre></td></tr></table></figure>

<h2 id="Performance-Tuning-for-HA"><a href="#Performance-Tuning-for-HA" class="headerlink" title="Performance Tuning for HA"></a>Performance Tuning for HA</h2><h3 id="Index-Lifecycle-Management"><a href="#Index-Lifecycle-Management" class="headerlink" title="Index Lifecycle Management"></a>Index Lifecycle Management</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">PUT /_ilm/policy/production_policy</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;policy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;phases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;hot&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;rollover&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;max_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10gb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;max_age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1d&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;warm&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7d&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;allocate&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;box_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warm&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;forcemerge&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;max_num_segments&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cold&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30d&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;allocate&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;box_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cold&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Hardware-Recommendations"><a href="#Hardware-Recommendations" class="headerlink" title="Hardware Recommendations"></a>Hardware Recommendations</h3><p><strong>Production Hardware Specs:</strong></p>
<ul>
<li><strong>CPU:</strong> 16+ cores for data nodes</li>
<li><strong>Memory:</strong> 64GB+ RAM (50% for heap, 50% for filesystem cache)</li>
<li><strong>Storage:</strong> NVMe SSDs for hot data, SATA SSDs for warm&#x2F;cold</li>
<li><strong>Network:</strong> 10Gbps+ for inter-node communication</li>
</ul>
<h2 id="Interview-Questions-and-Expert-Answers"><a href="#Interview-Questions-and-Expert-Answers" class="headerlink" title="Interview Questions and Expert Answers"></a>Interview Questions and Expert Answers</h2><p><strong>Q: “How would you recover from a complete cluster failure?”</strong></p>
<p><strong>A:</strong> </p>
<ol>
<li>Restore from snapshot if available</li>
<li>If no snapshots, recover using <code>elasticsearch-node</code> tool</li>
<li>Implement proper backup strategy going forward</li>
<li>Consider cross-cluster replication for future disasters</li>
</ol>
<p><strong>Q: “Explain the difference between <code>index.refresh_interval</code> and TransLog flush.”</strong></p>
<p><strong>A:</strong> </p>
<ul>
<li><code>refresh_interval</code> controls when in-memory documents become searchable</li>
<li>TransLog flush persists data to disk for durability</li>
<li>Refresh affects search visibility, flush affects data safety</li>
</ul>
<p><strong>Q: “How do you handle version conflicts in a distributed environment?”</strong></p>
<p><strong>A:</strong> </p>
<ul>
<li>Use optimistic concurrency control with version numbers</li>
<li>Implement retry logic with exponential backoff</li>
<li>Consider using <code>_seq_no</code> and <code>_primary_term</code> for more granular control</li>
</ul>
<h2 id="Security-Considerations-for-HA"><a href="#Security-Considerations-for-HA" class="headerlink" title="Security Considerations for HA"></a>Security Considerations for HA</h2><h3 id="Authentication-and-Authorization"><a href="#Authentication-and-Authorization" class="headerlink" title="Authentication and Authorization"></a>Authentication and Authorization</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># elasticsearch.yml</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.security.http.ssl.enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">xpack.security.authc.realms.native.native1:</span></span><br><span class="line">  <span class="attr">order:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><strong>Role-Based Access Control:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT /_security/role/log_reader</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;logs-*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;privileges&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;read&quot;</span><span class="punctuation">,</span> <span class="string">&quot;view_index_metadata&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Best-Practices-Summary"><a href="#Best-Practices-Summary" class="headerlink" title="Best Practices Summary"></a>Best Practices Summary</h2><h3 id="Do’s"><a href="#Do’s" class="headerlink" title="Do’s"></a>Do’s</h3><ul>
<li>Always use odd number of master-eligible nodes (3, 5, 7)</li>
<li>Implement proper monitoring and alerting</li>
<li>Use index templates for consistent settings</li>
<li>Regularly test disaster recovery procedures</li>
<li>Implement proper backup strategies</li>
</ul>
<h3 id="Don’ts"><a href="#Don’ts" class="headerlink" title="Don’ts"></a>Don’ts</h3><ul>
<li>Don’t set heap size above 32GB</li>
<li>Don’t disable swap without proper configuration</li>
<li>Don’t ignore yellow cluster status</li>
<li>Don’t use default settings in production</li>
<li>Don’t forget to monitor disk space</li>
</ul>
<h2 id="References-and-Additional-Resources"><a href="#References-and-Additional-Resources" class="headerlink" title="References and Additional Resources"></a>References and Additional Resources</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch Official Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-search-speed.html">Elasticsearch Performance Tuning Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/cloud/current/ec-getting-started.html">Elastic Cloud Architecture Best Practices</a></li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html">Production Deployment Considerations</a></li>
</ul>
<hr>
<p><em>This guide provides a comprehensive foundation for implementing and maintaining highly available Elasticsearch clusters in production environments. Regular updates and testing of these configurations are essential for maintaining optimal performance and reliability.</em></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/elasticsearch/" rel="tag"># elasticsearch</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/16/Design-Video-Image-Structure-Analysis-Platform/" rel="prev" title="Design Video Image Structure Analysis Platform">
                  <i class="fa fa-angle-left"></i> Design Video Image Structure Analysis Platform
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/17/Elasticsearch-Query-Performance-Optimization-Guide/" rel="next" title="Elasticsearch Query Performance Optimization Guide">
                  Elasticsearch Query Performance Optimization Guide <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
