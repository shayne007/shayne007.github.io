<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Redis is an in-memory data structure store that provides multiple persistence mechanisms to ensure data durability. Understanding these mechanisms is crucial for building robust, production-ready appl">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis Data Persistence Mechanism">
<meta property="og:url" content="https://shayne007.github.io/2025/06/17/Redis-Data-Persistence-Mechanism/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="Redis is an in-memory data structure store that provides multiple persistence mechanisms to ensure data durability. Understanding these mechanisms is crucial for building robust, production-ready appl">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-17T12:36:04.000Z">
<meta property="article:modified_time" content="2025-06-18T08:47:04.818Z">
<meta property="article:author" content="Charlie Feng">
<meta property="article:tag" content="redis">
<meta property="article:tag" content="data persistence">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/06/17/Redis-Data-Persistence-Mechanism/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/06/17/Redis-Data-Persistence-Mechanism/","path":"2025/06/17/Redis-Data-Persistence-Mechanism/","title":"Redis Data Persistence Mechanism"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Redis Data Persistence Mechanism | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-Persistence-Mechanisms-Overview"><span class="nav-number">1.</span> <span class="nav-text">Core Persistence Mechanisms Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB-Redis-Database-Snapshots"><span class="nav-number">2.</span> <span class="nav-text">RDB (Redis Database) Snapshots</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mechanism-Deep-Dive"><span class="nav-number">2.1.</span> <span class="nav-text">Mechanism Deep Dive</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuration-Examples"><span class="nav-number">2.2.</span> <span class="nav-text">Configuration Examples</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Manual-Snapshot-Commands"><span class="nav-number">2.3.</span> <span class="nav-text">Manual Snapshot Commands</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Production-Best-Practices"><span class="nav-number">2.4.</span> <span class="nav-text">Production Best Practices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RDB-Advantages-and-Limitations"><span class="nav-number">2.5.</span> <span class="nav-text">RDB Advantages and Limitations</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOF-Append-Only-File-Persistence"><span class="nav-number">3.</span> <span class="nav-text">AOF (Append Only File) Persistence</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mechanism-Deep-Dive-1"><span class="nav-number">3.1.</span> <span class="nav-text">Mechanism Deep Dive</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF-Configuration-Options"><span class="nav-number">3.2.</span> <span class="nav-text">AOF Configuration Options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sync-Policies-Comparison"><span class="nav-number">3.3.</span> <span class="nav-text">Sync Policies Comparison</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF-Rewrite-Process"><span class="nav-number">3.4.</span> <span class="nav-text">AOF Rewrite Process</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Production-Configuration-Example"><span class="nav-number">3.5.</span> <span class="nav-text">Production Configuration Example</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-world-Use-Case-Financial-Transaction-Log"><span class="nav-number">3.6.</span> <span class="nav-text">Real-world Use Case: Financial Transaction Log</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hybrid-Persistence-Mode"><span class="nav-number">4.</span> <span class="nav-text">Hybrid Persistence Mode</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#How-Hybrid-Mode-Works"><span class="nav-number">4.1.</span> <span class="nav-text">How Hybrid Mode Works</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuration"><span class="nav-number">4.2.</span> <span class="nav-text">Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hybrid-Mode-Benefits"><span class="nav-number">4.3.</span> <span class="nav-text">Hybrid Mode Benefits</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB-vs-AOF-vs-Hybrid-Comparison"><span class="nav-number">5.</span> <span class="nav-text">RDB vs AOF vs Hybrid Comparison</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Production-Deployment-Strategies"><span class="nav-number">6.</span> <span class="nav-text">Production Deployment Strategies</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#High-Availability-Setup"><span class="nav-number">6.1.</span> <span class="nav-text">High Availability Setup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monitoring-and-Alerting"><span class="nav-number">6.2.</span> <span class="nav-text">Monitoring and Alerting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backup-Strategy-Implementation"><span class="nav-number">6.3.</span> <span class="nav-text">Backup Strategy Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Disaster-Recovery-Procedures"><span class="nav-number">7.</span> <span class="nav-text">Disaster Recovery Procedures</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Recovery-from-RDB"><span class="nav-number">7.1.</span> <span class="nav-text">Recovery from RDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Recovery-from-AOF"><span class="nav-number">7.2.</span> <span class="nav-text">Recovery from AOF</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Optimization"><span class="nav-number">8.</span> <span class="nav-text">Performance Optimization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory-Optimization"><span class="nav-number">8.1.</span> <span class="nav-text">Memory Optimization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#I-O-Optimization"><span class="nav-number">8.2.</span> <span class="nav-text">I&#x2F;O Optimization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Common-Issues-and-Troubleshooting"><span class="nav-number">9.</span> <span class="nav-text">Common Issues and Troubleshooting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Fork-Failures"><span class="nav-number">9.1.</span> <span class="nav-text">Fork Failures</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF-Growing-Too-Large"><span class="nav-number">9.2.</span> <span class="nav-text">AOF Growing Too Large</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Key-Interview-Questions-and-Answers"><span class="nav-number">10.</span> <span class="nav-text">Key Interview Questions and Answers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Best-Practices-Summary"><span class="nav-number">11.</span> <span class="nav-text">Best Practices Summary</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/06/17/Redis-Data-Persistence-Mechanism/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Redis Data Persistence Mechanism | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis Data Persistence Mechanism
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-06-17 20:36:04" itemprop="dateCreated datePublished" datetime="2025-06-17T20:36:04+08:00">2025-06-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-18 16:47:04" itemprop="dateModified" datetime="2025-06-18T16:47:04+08:00">2025-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>Redis is an in-memory data structure store that provides multiple persistence mechanisms to ensure data durability. Understanding these mechanisms is crucial for building robust, production-ready applications.</p>
<h2 id="Core-Persistence-Mechanisms-Overview"><a href="#Core-Persistence-Mechanisms-Overview" class="headerlink" title="Core Persistence Mechanisms Overview"></a>Core Persistence Mechanisms Overview</h2><p>Redis offers three primary persistence strategies:</p>
<ul>
<li><strong>RDB (Redis Database)</strong>: Point-in-time snapshots</li>
<li><strong>AOF (Append Only File)</strong>: Command logging approach  </li>
<li><strong>Hybrid Mode</strong>: Combination of RDB and AOF for optimal performance and durability</li>
</ul>
<pre>
<code class="mermaid">

A[Redis Memory] --&gt; B{Persistence Strategy}
B --&gt; C[RDB Snapshots]
B --&gt; D[AOF Command Log]
B --&gt; E[Hybrid Mode]

C --&gt; F[Binary Snapshot Files]
D --&gt; G[Command History Files]
E --&gt; H[RDB + AOF Combined]

F --&gt; I[Fast Recovery&lt;br&#x2F;&gt;Larger Data Loss Window]
G --&gt; J[Minimal Data Loss&lt;br&#x2F;&gt;Slower Recovery]
H --&gt; K[Best of Both Worlds]
</code>
</pre>

<h2 id="RDB-Redis-Database-Snapshots"><a href="#RDB-Redis-Database-Snapshots" class="headerlink" title="RDB (Redis Database) Snapshots"></a>RDB (Redis Database) Snapshots</h2><h3 id="Mechanism-Deep-Dive"><a href="#Mechanism-Deep-Dive" class="headerlink" title="Mechanism Deep Dive"></a>Mechanism Deep Dive</h3><p>RDB creates point-in-time snapshots of your dataset at specified intervals. The process involves:</p>
<ol>
<li><strong>Fork Process</strong>: Redis forks a child process to handle snapshot creation</li>
<li><strong>Copy-on-Write</strong>: Leverages OS copy-on-write semantics for memory efficiency</li>
<li><strong>Binary Format</strong>: Creates compact binary files for fast loading</li>
<li><strong>Non-blocking</strong>: Main Redis process continues serving requests</li>
</ol>
<pre>
<code class="mermaid">

participant Client
participant Redis Main
participant Child Process
participant Disk

Client-&gt;&gt;Redis Main: Write Operations
Redis Main-&gt;&gt;Child Process: fork() for BGSAVE
Child Process-&gt;&gt;Disk: Write RDB snapshot
Redis Main-&gt;&gt;Client: Continue serving requests
Child Process-&gt;&gt;Redis Main: Snapshot complete
</code>
</pre>

<h3 id="Configuration-Examples"><a href="#Configuration-Examples" class="headerlink" title="Configuration Examples"></a>Configuration Examples</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Basic RDB configuration in redis.conf</span></span><br><span class="line">save 900 1      <span class="comment"># Save after 900 seconds if at least 1 key changed</span></span><br><span class="line">save 300 10     <span class="comment"># Save after 300 seconds if at least 10 keys changed  </span></span><br><span class="line">save 60 10000   <span class="comment"># Save after 60 seconds if at least 10000 keys changed</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RDB file settings</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"><span class="built_in">dir</span> /var/lib/redis/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compression (recommended for production)</span></span><br><span class="line">rdbcompression <span class="built_in">yes</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h3 id="Manual-Snapshot-Commands"><a href="#Manual-Snapshot-Commands" class="headerlink" title="Manual Snapshot Commands"></a>Manual Snapshot Commands</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Synchronous save (blocks Redis)</span></span><br><span class="line">SAVE</span><br><span class="line"></span><br><span class="line"><span class="comment"># Background save (non-blocking, recommended)</span></span><br><span class="line">BGSAVE</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get last save timestamp</span></span><br><span class="line">LASTSAVE</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if background save is in progress</span></span><br><span class="line">LASTSAVE</span><br></pre></td></tr></table></figure>

<h3 id="Production-Best-Practices"><a href="#Production-Best-Practices" class="headerlink" title="Production Best Practices"></a>Production Best Practices</h3><p><strong>Scheduling Strategy:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># High-frequency writes: More frequent snapshots</span></span><br><span class="line">save 300 10     <span class="comment"># 5 minutes if 10+ changes</span></span><br><span class="line">save 120 100    <span class="comment"># 2 minutes if 100+ changes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Low-frequency writes: Less frequent snapshots  </span></span><br><span class="line">save 900 1      <span class="comment"># 15 minutes if 1+ change</span></span><br><span class="line">save 1800 10    <span class="comment"># 30 minutes if 10+ changes</span></span><br></pre></td></tr></table></figure>

<p><strong>Real-world Use Case: E-commerce Session Store</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Session data with RDB configuration</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">r = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Store user session (will be included in next RDB snapshot)</span></span><br><span class="line">session_data = &#123;</span><br><span class="line">    <span class="string">&#x27;user_id&#x27;</span>: <span class="string">&#x27;12345&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cart_items&#x27;</span>: [<span class="string">&#x27;item1&#x27;</span>, <span class="string">&#x27;item2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;last_activity&#x27;</span>: <span class="string">&#x27;2024-01-15T10:30:00Z&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r.hset(<span class="string">&#x27;session:user:12345&#x27;</span>, mapping=session_data)</span><br><span class="line">r.expire(<span class="string">&#x27;session:user:12345&#x27;</span>, <span class="number">3600</span>)  <span class="comment"># 1 hour TTL</span></span><br></pre></td></tr></table></figure>

<h3 id="RDB-Advantages-and-Limitations"><a href="#RDB-Advantages-and-Limitations" class="headerlink" title="RDB Advantages and Limitations"></a>RDB Advantages and Limitations</h3><p><strong>Advantages:</strong></p>
<ul>
<li>Compact single-file backups</li>
<li>Fast Redis restart times</li>
<li>Good for disaster recovery</li>
<li>Minimal impact on performance</li>
<li>Perfect for backup strategies</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li>Data loss potential between snapshots</li>
<li>Fork can be expensive with large datasets</li>
<li>Not suitable for minimal data loss requirements</li>
</ul>
<p><strong>💡 Interview Insight:</strong> “What happens if Redis crashes between RDB snapshots?”<br><em>Answer: All data written since the last snapshot is lost. This is why RDB alone isn’t suitable for applications requiring minimal data loss.</em></p>
<h2 id="AOF-Append-Only-File-Persistence"><a href="#AOF-Append-Only-File-Persistence" class="headerlink" title="AOF (Append Only File) Persistence"></a>AOF (Append Only File) Persistence</h2><h3 id="Mechanism-Deep-Dive-1"><a href="#Mechanism-Deep-Dive-1" class="headerlink" title="Mechanism Deep Dive"></a>Mechanism Deep Dive</h3><p>AOF logs every write operation received by the server, creating a reconstruction log of dataset operations.</p>
<pre>
<code class="mermaid">

A[Client Write] --&gt; B[Redis Memory]
B --&gt; C[AOF Buffer]
C --&gt; D{Sync Policy}
D --&gt; E[OS Buffer]
E --&gt; F[Disk Write]

D --&gt; G[always: Every Command]
D --&gt; H[everysec: Every Second]  
D --&gt; I[no: OS Decides]
</code>
</pre>

<h3 id="AOF-Configuration-Options"><a href="#AOF-Configuration-Options" class="headerlink" title="AOF Configuration Options"></a>AOF Configuration Options</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enable AOF</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sync policies</span></span><br><span class="line">appendfsync everysec    <span class="comment"># Recommended for most cases</span></span><br><span class="line"><span class="comment"># appendfsync always    # Maximum durability, slower performance</span></span><br><span class="line"><span class="comment"># appendfsync no        # Best performance, less durability</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AOF rewrite configuration</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line"><span class="comment"># Handle AOF corruption</span></span><br><span class="line">aof-load-truncated <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h3 id="Sync-Policies-Comparison"><a href="#Sync-Policies-Comparison" class="headerlink" title="Sync Policies Comparison"></a>Sync Policies Comparison</h3><table>
<thead>
<tr>
<th>Policy</th>
<th>Durability</th>
<th>Performance</th>
<th>Data Loss Risk</th>
</tr>
</thead>
<tbody><tr>
<td><code>always</code></td>
<td>Highest</td>
<td>Slowest</td>
<td>~0 commands</td>
</tr>
<tr>
<td><code>everysec</code></td>
<td>Good</td>
<td>Balanced</td>
<td>~1 second</td>
</tr>
<tr>
<td><code>no</code></td>
<td>Lowest</td>
<td>Fastest</td>
<td>OS buffer size</td>
</tr>
</tbody></table>
<h3 id="AOF-Rewrite-Process"><a href="#AOF-Rewrite-Process" class="headerlink" title="AOF Rewrite Process"></a>AOF Rewrite Process</h3><p>AOF files grow over time, so Redis provides rewrite functionality to optimize file size:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Manual AOF rewrite</span></span><br><span class="line">BGREWRITEAOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check rewrite status</span></span><br><span class="line">INFO persistence</span><br></pre></td></tr></table></figure>

<p><strong>Rewrite Example:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Original AOF commands</span></span><br><span class="line">SET counter 1</span><br><span class="line">INCR counter    <span class="comment"># counter = 2</span></span><br><span class="line">INCR counter    <span class="comment"># counter = 3</span></span><br><span class="line">INCR counter    <span class="comment"># counter = 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># After rewrite, simplified to:</span></span><br><span class="line">SET counter 4</span><br></pre></td></tr></table></figure>

<h3 id="Production-Configuration-Example"><a href="#Production-Configuration-Example" class="headerlink" title="Production Configuration Example"></a>Production Configuration Example</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Production AOF settings</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatic rewrite triggers</span></span><br><span class="line">auto-aof-rewrite-percentage 100    <span class="comment"># Rewrite when file doubles in size</span></span><br><span class="line">auto-aof-rewrite-min-size 64mb     <span class="comment"># Minimum size before considering rewrite</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Rewrite process settings</span></span><br><span class="line">no-appendfsync-on-rewrite no       <span class="comment"># Continue syncing during rewrite</span></span><br><span class="line">aof-rewrite-incremental-fsync <span class="built_in">yes</span>  <span class="comment"># Incremental fsync during rewrite</span></span><br></pre></td></tr></table></figure>

<h3 id="Real-world-Use-Case-Financial-Transaction-Log"><a href="#Real-world-Use-Case-Financial-Transaction-Log" class="headerlink" title="Real-world Use Case: Financial Transaction Log"></a>Real-world Use Case: Financial Transaction Log</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">r = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log_transaction</span>(<span class="params">user_id, amount, transaction_type</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Log financial transaction with AOF persistence&quot;&quot;&quot;</span></span><br><span class="line">    transaction = &#123;</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: user_id,</span><br><span class="line">        <span class="string">&#x27;amount&#x27;</span>: amount,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: transaction_type,</span><br><span class="line">        <span class="string">&#x27;timestamp&#x27;</span>: datetime.now().isoformat(),</span><br><span class="line">        <span class="string">&#x27;transaction_id&#x27;</span>: <span class="string">f&quot;txn_<span class="subst">&#123;user_id&#125;</span>_<span class="subst">&#123;<span class="built_in">int</span>(datetime.now().timestamp())&#125;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># This command will be logged in AOF</span></span><br><span class="line">    pipe = r.pipeline()</span><br><span class="line">    pipe.lpush(<span class="string">f&#x27;transactions:<span class="subst">&#123;user_id&#125;</span>&#x27;</span>, json.dumps(transaction))</span><br><span class="line">    pipe.incr(<span class="string">f&#x27;balance:<span class="subst">&#123;user_id&#125;</span>&#x27;</span>, amount <span class="keyword">if</span> transaction_type == <span class="string">&#x27;credit&#x27;</span> <span class="keyword">else</span> -amount)</span><br><span class="line">    pipe.execute()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> transaction</span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage</span></span><br><span class="line">transaction = log_transaction(<span class="string">&#x27;user123&#x27;</span>, <span class="number">100.00</span>, <span class="string">&#x27;credit&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Transaction logged: <span class="subst">&#123;transaction&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>💡 Interview Insight:</strong> “How does AOF handle partial writes or corruption?”<br><em>Answer: Redis can handle truncated AOF files with <code>aof-load-truncated yes</code>. For corruption in the middle, tools like <code>redis-check-aof --fix</code> can repair the file.</em></p>
<h2 id="Hybrid-Persistence-Mode"><a href="#Hybrid-Persistence-Mode" class="headerlink" title="Hybrid Persistence Mode"></a>Hybrid Persistence Mode</h2><p>Hybrid mode combines RDB and AOF to leverage the benefits of both approaches.</p>
<h3 id="How-Hybrid-Mode-Works"><a href="#How-Hybrid-Mode-Works" class="headerlink" title="How Hybrid Mode Works"></a>How Hybrid Mode Works</h3><pre>
<code class="mermaid">

A[Redis Start] --&gt; B{Check for AOF}
B --&gt;|AOF exists| C[Load AOF file]
B --&gt;|No AOF| D[Load RDB file]

C --&gt; E[Runtime Operations]
D --&gt; E

E --&gt; F[RDB Snapshots]
E --&gt; G[AOF Command Logging]

F --&gt; H[Background Snapshots]
G --&gt; I[Continuous Command Log]

H --&gt; J[Fast Recovery Base]
I --&gt; K[Recent Changes]
</code>
</pre>

<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enable hybrid mode</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">aof-use-rdb-preamble <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This creates AOF files with RDB preamble</span></span><br><span class="line"><span class="comment"># Format: [RDB snapshot][AOF commands since snapshot]</span></span><br></pre></td></tr></table></figure>

<h3 id="Hybrid-Mode-Benefits"><a href="#Hybrid-Mode-Benefits" class="headerlink" title="Hybrid Mode Benefits"></a>Hybrid Mode Benefits</h3><ol>
<li><strong>Fast Recovery</strong>: RDB portion loads quickly</li>
<li><strong>Minimal Data Loss</strong>: AOF portion captures recent changes</li>
<li><strong>Optimal File Size</strong>: RDB compression + incremental AOF</li>
<li><strong>Best of Both</strong>: Performance + durability</li>
</ol>
<h2 id="RDB-vs-AOF-vs-Hybrid-Comparison"><a href="#RDB-vs-AOF-vs-Hybrid-Comparison" class="headerlink" title="RDB vs AOF vs Hybrid Comparison"></a>RDB vs AOF vs Hybrid Comparison</h2><pre>
<code class="mermaid">

A[Persistence Requirements] --&gt; B{Priority?}

B --&gt;|Performance| C[RDB Only]
B --&gt;|Durability| D[AOF Only]
B --&gt;|Balanced| E[Hybrid Mode]

C --&gt; F[Fast restarts&lt;br&#x2F;&gt;Larger data loss window&lt;br&#x2F;&gt;Smaller files]
D --&gt; G[Minimal data loss&lt;br&#x2F;&gt;Slower restarts&lt;br&#x2F;&gt;Larger files]
E --&gt; H[Fast restarts&lt;br&#x2F;&gt;Minimal data loss&lt;br&#x2F;&gt;Optimal file size]
</code>
</pre>

<table>
<thead>
<tr>
<th>Aspect</th>
<th>RDB</th>
<th>AOF</th>
<th>Hybrid</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Recovery Speed</strong></td>
<td>Fast</td>
<td>Slow</td>
<td>Fast</td>
</tr>
<tr>
<td><strong>Data Loss Risk</strong></td>
<td>Higher</td>
<td>Lower</td>
<td>Lower</td>
</tr>
<tr>
<td><strong>File Size</strong></td>
<td>Smaller</td>
<td>Larger</td>
<td>Optimal</td>
</tr>
<tr>
<td><strong>CPU Impact</strong></td>
<td>Lower</td>
<td>Higher</td>
<td>Balanced</td>
</tr>
<tr>
<td><strong>Disk I&#x2F;O</strong></td>
<td>Periodic</td>
<td>Continuous</td>
<td>Balanced</td>
</tr>
<tr>
<td><strong>Backup Strategy</strong></td>
<td>Excellent</td>
<td>Good</td>
<td>Excellent</td>
</tr>
</tbody></table>
<h2 id="Production-Deployment-Strategies"><a href="#Production-Deployment-Strategies" class="headerlink" title="Production Deployment Strategies"></a>Production Deployment Strategies</h2><h3 id="High-Availability-Setup"><a href="#High-Availability-Setup" class="headerlink" title="High Availability Setup"></a>High Availability Setup</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Master node configuration</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">aof-use-rdb-preamble <span class="built_in">yes</span></span><br><span class="line">appendfsync everysec</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replica node configuration  </span></span><br><span class="line">replica-read-only <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># Replicas automatically inherit persistence settings</span></span><br></pre></td></tr></table></figure>

<h3 id="Monitoring-and-Alerting"><a href="#Monitoring-and-Alerting" class="headerlink" title="Monitoring and Alerting"></a>Monitoring and Alerting</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_persistence_health</span>(<span class="params">redis_client</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Monitor Redis persistence health&quot;&quot;&quot;</span></span><br><span class="line">    info = redis_client.info(<span class="string">&#x27;persistence&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    checks = &#123;</span><br><span class="line">        <span class="string">&#x27;rdb_last_save_age&#x27;</span>: info.get(<span class="string">&#x27;rdb_changes_since_last_save&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">        <span class="string">&#x27;aof_enabled&#x27;</span>: info.get(<span class="string">&#x27;aof_enabled&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">        <span class="string">&#x27;aof_rewrite_in_progress&#x27;</span>: info.get(<span class="string">&#x27;aof_rewrite_in_progress&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">        <span class="string">&#x27;rdb_bgsave_in_progress&#x27;</span>: info.get(<span class="string">&#x27;rdb_bgsave_in_progress&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Alert if no save in 30 minutes and changes exist</span></span><br><span class="line">    <span class="keyword">if</span> checks[<span class="string">&#x27;rdb_last_save_age&#x27;</span>] &gt; <span class="number">0</span>:</span><br><span class="line">        last_save_time = info.get(<span class="string">&#x27;rdb_last_save_time&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> (time.time() - last_save_time) &gt; <span class="number">1800</span>:  <span class="comment"># 30 minutes</span></span><br><span class="line">            alert(<span class="string">&quot;RDB: No recent backup with pending changes&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> checks</span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage</span></span><br><span class="line">r = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>)</span><br><span class="line">health = check_persistence_health(r)</span><br></pre></td></tr></table></figure>

<h3 id="Backup-Strategy-Implementation"><a href="#Backup-Strategy-Implementation" class="headerlink" title="Backup Strategy Implementation"></a>Backup Strategy Implementation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Production backup script</span></span><br><span class="line"></span><br><span class="line">REDIS_CLI=<span class="string">&quot;/usr/bin/redis-cli&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup/redis&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create backup directory</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$BACKUP_DIR</span>/<span class="variable">$DATE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Trigger background save</span></span><br><span class="line"><span class="variable">$REDIS_CLI</span> BGSAVE</span><br><span class="line"></span><br><span class="line"><span class="comment"># Wait for save to complete</span></span><br><span class="line"><span class="keyword">while</span> [ $(<span class="variable">$REDIS_CLI</span> LASTSAVE) -eq <span class="variable">$PREV_SAVE</span> ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy files</span></span><br><span class="line"><span class="built_in">cp</span> /var/lib/redis/dump.rdb <span class="variable">$BACKUP_DIR</span>/<span class="variable">$DATE</span>/</span><br><span class="line"><span class="built_in">cp</span> /var/lib/redis/appendonly.aof <span class="variable">$BACKUP_DIR</span>/<span class="variable">$DATE</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compress backup</span></span><br><span class="line">tar -czf <span class="variable">$BACKUP_DIR</span>/redis_backup_<span class="variable">$DATE</span>.tar.gz -C <span class="variable">$BACKUP_DIR</span>/<span class="variable">$DATE</span> .</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Backup completed: redis_backup_<span class="variable">$DATE</span>.tar.gz&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Disaster-Recovery-Procedures"><a href="#Disaster-Recovery-Procedures" class="headerlink" title="Disaster Recovery Procedures"></a>Disaster Recovery Procedures</h2><h3 id="Recovery-from-RDB"><a href="#Recovery-from-RDB" class="headerlink" title="Recovery from RDB"></a>Recovery from RDB</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Stop Redis service</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Replace dump.rdb file</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /backup/dump.rdb /var/lib/redis/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Set proper permissions</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> redis:redis /var/lib/redis/dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Start Redis service</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start redis</span><br></pre></td></tr></table></figure>

<h3 id="Recovery-from-AOF"><a href="#Recovery-from-AOF" class="headerlink" title="Recovery from AOF"></a>Recovery from AOF</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Check AOF integrity</span></span><br><span class="line">redis-check-aof appendonly.aof</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Fix if corrupted</span></span><br><span class="line">redis-check-aof --fix appendonly.aof</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Replace AOF file and restart Redis</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /backup/appendonly.aof /var/lib/redis/</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart redis</span><br></pre></td></tr></table></figure>

<h2 id="Performance-Optimization"><a href="#Performance-Optimization" class="headerlink" title="Performance Optimization"></a>Performance Optimization</h2><h3 id="Memory-Optimization"><a href="#Memory-Optimization" class="headerlink" title="Memory Optimization"></a>Memory Optimization</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Optimize for memory usage</span></span><br><span class="line">rdbcompression <span class="built_in">yes</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AOF optimization</span></span><br><span class="line">aof-rewrite-incremental-fsync <span class="built_in">yes</span></span><br><span class="line">aof-load-truncated <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h3 id="I-O-Optimization"><a href="#I-O-Optimization" class="headerlink" title="I&#x2F;O Optimization"></a>I&#x2F;O Optimization</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Separate data and AOF on different disks</span></span><br><span class="line"><span class="built_in">dir</span> /data/redis/snapshots/</span><br><span class="line">appenddirname /logs/redis/aof/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use faster storage for AOF</span></span><br><span class="line"><span class="comment"># SSD recommended for AOF files</span></span><br></pre></td></tr></table></figure>

<h2 id="Common-Issues-and-Troubleshooting"><a href="#Common-Issues-and-Troubleshooting" class="headerlink" title="Common Issues and Troubleshooting"></a>Common Issues and Troubleshooting</h2><h3 id="Fork-Failures"><a href="#Fork-Failures" class="headerlink" title="Fork Failures"></a>Fork Failures</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Monitor fork issues</span></span><br><span class="line">INFO stats | grep fork</span><br><span class="line"></span><br><span class="line"><span class="comment"># Common solutions:</span></span><br><span class="line"><span class="comment"># 1. Increase vm.overcommit_memory</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;vm.overcommit_memory = 1&#x27;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Monitor memory usage</span></span><br><span class="line"><span class="comment"># 3. Consider using smaller save intervals</span></span><br></pre></td></tr></table></figure>

<h3 id="AOF-Growing-Too-Large"><a href="#AOF-Growing-Too-Large" class="headerlink" title="AOF Growing Too Large"></a>AOF Growing Too Large</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Monitor AOF size</span></span><br><span class="line">INFO persistence | grep aof_current_size</span><br><span class="line"></span><br><span class="line"><span class="comment"># Solutions:</span></span><br><span class="line"><span class="comment"># 1. Adjust rewrite thresholds</span></span><br><span class="line">auto-aof-rewrite-percentage 50</span><br><span class="line">auto-aof-rewrite-min-size 32mb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Manual rewrite during low traffic</span></span><br><span class="line">BGREWRITEAOF</span><br></pre></td></tr></table></figure>

<h2 id="Key-Interview-Questions-and-Answers"><a href="#Key-Interview-Questions-and-Answers" class="headerlink" title="Key Interview Questions and Answers"></a>Key Interview Questions and Answers</h2><p><strong>Q: When would you choose RDB over AOF?</strong><br>A: Choose RDB when you can tolerate some data loss (5-15 minutes) in exchange for better performance, smaller backup files, and faster Redis restarts. Ideal for caching scenarios, analytics data, or when you have other data durability mechanisms.</p>
<p><strong>Q: Explain the AOF rewrite process and why it’s needed.</strong><br>A: AOF files grow indefinitely as they log every write command. Rewrite compacts the file by analyzing the current dataset state and generating the minimum set of commands needed to recreate it. This happens in a child process to avoid blocking the main Redis instance.</p>
<p><strong>Q: What’s the risk of using <code>appendfsync always</code>?</strong><br>A: While it provides maximum durability (virtually zero data loss), it significantly impacts performance as Redis must wait for each write to be committed to disk before acknowledging the client. This can reduce throughput by 100x compared to <code>everysec</code>.</p>
<p><strong>Q: How does hybrid persistence work during recovery?</strong><br>A: Redis first loads the RDB portion (fast bulk recovery), then replays the AOF commands that occurred after the RDB snapshot (recent changes). This provides both fast startup and minimal data loss.</p>
<p><strong>Q: What happens if both RDB and AOF are corrupted?</strong><br>A: Redis will fail to start. You’d need to either fix the files using <code>redis-check-rdb</code> and <code>redis-check-aof</code>, restore from backups, or start with an empty dataset. This highlights the importance of having multiple backup strategies and monitoring persistence health.</p>
<h2 id="Best-Practices-Summary"><a href="#Best-Practices-Summary" class="headerlink" title="Best Practices Summary"></a>Best Practices Summary</h2><ol>
<li><strong>Use Hybrid Mode</strong> for production systems requiring both performance and durability</li>
<li><strong>Monitor Persistence Health</strong> with automated alerts for failed saves or growing files</li>
<li><strong>Implement Regular Backups</strong> with both local and remote storage</li>
<li><strong>Test Recovery Procedures</strong> regularly in non-production environments</li>
<li><strong>Size Your Infrastructure</strong> appropriately for fork operations and I&#x2F;O requirements</li>
<li><strong>Separate Storage</strong> for RDB snapshots and AOF files when possible</li>
<li><strong>Tune Based on Use Case</strong>: More frequent saves for critical data, less frequent for cache-only scenarios</li>
</ol>
<p>Understanding Redis persistence mechanisms is crucial for building reliable systems. The choice between RDB, AOF, or hybrid mode should align with your application’s durability requirements, performance constraints, and operational capabilities.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/redis/" rel="tag"># redis</a>
              <a href="/tags/data-persistence/" rel="tag"># data persistence</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/17/Java-Virtual-Machine-Memory-Structure-Complete-Guide/" rel="prev" title="Java Virtual Machine Memory Structure - Complete Guide">
                  <i class="fa fa-angle-left"></i> Java Virtual Machine Memory Structure - Complete Guide
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
