<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Core Underlying PrinciplesSpring Security is built on several fundamental principles that form the backbone of its architecture and functionality. Understanding these principles is crucial for impleme">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Security Framework - Complete Guide">
<meta property="og:url" content="https://shayne007.github.io/2025/06/25/Spring-Security-Framework-Complete-Guide/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="Core Underlying PrinciplesSpring Security is built on several fundamental principles that form the backbone of its architecture and functionality. Understanding these principles is crucial for impleme">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-25T12:24:29.000Z">
<meta property="article:modified_time" content="2025-06-25T12:26:34.900Z">
<meta property="article:author" content="Charlie Feng">
<meta property="article:tag" content="spring">
<meta property="article:tag" content="spring security">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/06/25/Spring-Security-Framework-Complete-Guide/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/06/25/Spring-Security-Framework-Complete-Guide/","path":"2025/06/25/Spring-Security-Framework-Complete-Guide/","title":"Spring Security Framework - Complete Guide"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Spring Security Framework - Complete Guide | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-Underlying-Principles"><span class="nav-number">1.</span> <span class="nav-text">Core Underlying Principles</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Authentication-vs-Authorization"><span class="nav-number">1.1.</span> <span class="nav-text">Authentication vs Authorization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-Filter-Chain"><span class="nav-number">1.2.</span> <span class="nav-text">Security Filter Chain</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SecurityContext-and-SecurityContextHolder"><span class="nav-number">1.3.</span> <span class="nav-text">SecurityContext and SecurityContextHolder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Principle-of-Least-Privilege"><span class="nav-number">1.4.</span> <span class="nav-text">Principle of Least Privilege</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#When-to-Use-Spring-Security-Framework"><span class="nav-number">2.</span> <span class="nav-text">When to Use Spring Security Framework</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enterprise-Applications"><span class="nav-number">2.1.</span> <span class="nav-text">Enterprise Applications</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Applications-with-User-Management"><span class="nav-number">2.2.</span> <span class="nav-text">Web Applications with User Management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#REST-APIs-and-Microservices"><span class="nav-number">2.3.</span> <span class="nav-text">REST APIs and Microservices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#When-NOT-to-Use-Spring-Security"><span class="nav-number">2.4.</span> <span class="nav-text">When NOT to Use Spring Security</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#User-Login-Logout-and-Session-Management"><span class="nav-number">3.</span> <span class="nav-text">User Login, Logout, and Session Management</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Login-Process-Flow"><span class="nav-number">3.1.</span> <span class="nav-text">Login Process Flow</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-Login-Implementation"><span class="nav-number">3.2.</span> <span class="nav-text">Custom Login Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-Authentication-Success-Handler"><span class="nav-number">3.3.</span> <span class="nav-text">Custom Authentication Success Handler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session-Management"><span class="nav-number">3.4.</span> <span class="nav-text">Session Management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session-Timeout-Configuration"><span class="nav-number">3.5.</span> <span class="nav-text">Session Timeout Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Remember-Me-Functionality"><span class="nav-number">3.6.</span> <span class="nav-text">Remember Me Functionality</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Logout-Process"><span class="nav-number">4.</span> <span class="nav-text">Logout Process</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Comprehensive-Logout-Configuration"><span class="nav-number">4.1.</span> <span class="nav-text">Comprehensive Logout Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-Logout-Handlers"><span class="nav-number">4.2.</span> <span class="nav-text">Custom Logout Handlers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Logout-Flow-Diagram"><span class="nav-number">4.3.</span> <span class="nav-text">Logout Flow Diagram</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-Authentication-Mechanisms"><span class="nav-number">5.</span> <span class="nav-text">Advanced Authentication Mechanisms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JWT-Token-Based-Authentication"><span class="nav-number">5.1.</span> <span class="nav-text">JWT Token-Based Authentication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OAuth2-Integration"><span class="nav-number">5.2.</span> <span class="nav-text">OAuth2 Integration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Method-Level-Security"><span class="nav-number">6.</span> <span class="nav-text">Method-Level Security</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enabling-Method-Security"><span class="nav-number">6.1.</span> <span class="nav-text">Enabling Method Security</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-Annotations-in-Action"><span class="nav-number">6.2.</span> <span class="nav-text">Security Annotations in Action</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-Best-Practices"><span class="nav-number">7.</span> <span class="nav-text">Security Best Practices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Password-Security"><span class="nav-number">7.1.</span> <span class="nav-text">Password Security</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF-Protection"><span class="nav-number">7.2.</span> <span class="nav-text">CSRF Protection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Input-Validation-and-Sanitization"><span class="nav-number">7.3.</span> <span class="nav-text">Input Validation and Sanitization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Common-Security-Vulnerabilities-and-Mitigation"><span class="nav-number">8.</span> <span class="nav-text">Common Security Vulnerabilities and Mitigation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-Injection-Prevention"><span class="nav-number">8.1.</span> <span class="nav-text">SQL Injection Prevention</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XSS-Prevention"><span class="nav-number">8.2.</span> <span class="nav-text">XSS Prevention</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Testing-Spring-Security"><span class="nav-number">9.</span> <span class="nav-text">Testing Spring Security</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-Testing-with-MockMvc"><span class="nav-number">9.1.</span> <span class="nav-text">Security Testing with MockMvc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Integration-Testing-with-TestContainers"><span class="nav-number">9.2.</span> <span class="nav-text">Integration Testing with TestContainers</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Optimization"><span class="nav-number">10.</span> <span class="nav-text">Performance Optimization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-Filter-Chain-Optimization"><span class="nav-number">10.1.</span> <span class="nav-text">Security Filter Chain Optimization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Caching-Security-Context"><span class="nav-number">10.2.</span> <span class="nav-text">Caching Security Context</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshooting-Common-Issues"><span class="nav-number">11.</span> <span class="nav-text">Troubleshooting Common Issues</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Debug-Security-Configuration"><span class="nav-number">11.1.</span> <span class="nav-text">Debug Security Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Common-Configuration-Mistakes"><span class="nav-number">11.2.</span> <span class="nav-text">Common Configuration Mistakes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Monitoring-and-Auditing"><span class="nav-number">12.</span> <span class="nav-text">Monitoring and Auditing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-Events-Logging"><span class="nav-number">12.1.</span> <span class="nav-text">Security Events Logging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Metrics-and-Monitoring"><span class="nav-number">12.2.</span> <span class="nav-text">Metrics and Monitoring</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interview-Questions-and-Answers"><span class="nav-number">13.</span> <span class="nav-text">Interview Questions and Answers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Technical-Deep-Dive-Questions"><span class="nav-number">13.1.</span> <span class="nav-text">Technical Deep Dive Questions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Practical-Implementation-Questions"><span class="nav-number">13.2.</span> <span class="nav-text">Practical Implementation Questions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#External-Resources-and-References"><span class="nav-number">14.</span> <span class="nav-text">External Resources and References</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">15.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/06/25/Spring-Security-Framework-Complete-Guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Spring Security Framework - Complete Guide | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Security Framework - Complete Guide
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-06-25 20:24:29 / Modified: 20:26:34" itemprop="dateCreated datePublished" datetime="2025-06-25T20:24:29+08:00">2025-06-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/spring/" itemprop="url" rel="index"><span itemprop="name">spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Core-Underlying-Principles"><a href="#Core-Underlying-Principles" class="headerlink" title="Core Underlying Principles"></a>Core Underlying Principles</h2><p>Spring Security is built on several fundamental principles that form the backbone of its architecture and functionality. Understanding these principles is crucial for implementing robust security solutions.</p>
<h3 id="Authentication-vs-Authorization"><a href="#Authentication-vs-Authorization" class="headerlink" title="Authentication vs Authorization"></a>Authentication vs Authorization</h3><p><strong>Authentication</strong> answers “Who are you?” while <strong>Authorization</strong> answers “What can you do?” Spring Security treats these as separate concerns, allowing for flexible security configurations.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Authentication - verifying identity</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth.inMemoryAuthentication()</span><br><span class="line">        .withUser(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">        .password(passwordEncoder().encode(<span class="string">&quot;password&quot;</span>))</span><br><span class="line">        .roles(<span class="string">&quot;USER&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Authorization - defining access rules</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">        .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasRole(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">        .anyRequest().authenticated();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Security-Filter-Chain"><a href="#Security-Filter-Chain" class="headerlink" title="Security Filter Chain"></a>Security Filter Chain</h3><p>Spring Security operates through a chain of filters that intercept HTTP requests. Each filter has a specific responsibility and can either process the request or pass it to the next filter.</p>
<pre>
<code class="mermaid">
flowchart TD
A[HTTP Request] --&gt; B[Security Filter Chain]
B --&gt; C[SecurityContextPersistenceFilter]
C --&gt; D[UsernamePasswordAuthenticationFilter]
D --&gt; E[ExceptionTranslationFilter]
E --&gt; F[FilterSecurityInterceptor]
F --&gt; G[Application Controller]

style B fill:#e1f5fe
style G fill:#e8f5e8
</code>
</pre>

<h3 id="SecurityContext-and-SecurityContextHolder"><a href="#SecurityContext-and-SecurityContextHolder" class="headerlink" title="SecurityContext and SecurityContextHolder"></a>SecurityContext and SecurityContextHolder</h3><p>The SecurityContext stores security information for the current thread of execution. The SecurityContextHolder provides access to this context.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Getting current authenticated user</span></span><br><span class="line"><span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = authentication.getAuthorities();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Setting security context programmatically</span></span><br><span class="line"><span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">token</span> <span class="operator">=</span> </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(user, <span class="literal">null</span>, authorities);</span><br><span class="line">SecurityContextHolder.getContext().setAuthentication(token);</span><br></pre></td></tr></table></figure>

<p><strong>Interview Insight</strong>: <em>“How does Spring Security maintain security context across requests?”</em></p>
<blockquote>
<p>Spring Security uses ThreadLocal to store security context, ensuring thread safety. The SecurityContextPersistenceFilter loads the context from HttpSession at the beginning of each request and clears it at the end.</p>
</blockquote>
<h3 id="Principle-of-Least-Privilege"><a href="#Principle-of-Least-Privilege" class="headerlink" title="Principle of Least Privilege"></a>Principle of Least Privilege</h3><p>Spring Security encourages granting minimal necessary permissions. This is implemented through role-based and method-level security.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;) or (hasRole(&#x27;USER&#x27;) and #username == authentication.name)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUserDetails</span><span class="params">(<span class="meta">@PathVariable</span> String username)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findByUsername(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="When-to-Use-Spring-Security-Framework"><a href="#When-to-Use-Spring-Security-Framework" class="headerlink" title="When to Use Spring Security Framework"></a>When to Use Spring Security Framework</h2><h3 id="Enterprise-Applications"><a href="#Enterprise-Applications" class="headerlink" title="Enterprise Applications"></a>Enterprise Applications</h3><p>Spring Security is ideal for enterprise applications requiring:</p>
<ul>
<li>Complex authentication mechanisms (LDAP, OAuth2, SAML)</li>
<li>Fine-grained authorization</li>
<li>Audit trails and compliance requirements</li>
<li>Integration with existing identity providers</li>
</ul>
<h3 id="Web-Applications-with-User-Management"><a href="#Web-Applications-with-User-Management" class="headerlink" title="Web Applications with User Management"></a>Web Applications with User Management</h3><p>Perfect for applications featuring:</p>
<ul>
<li>User registration and login</li>
<li>Role-based access control</li>
<li>Session management</li>
<li>CSRF protection</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/register&quot;</span>, <span class="string">&quot;/login&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/dashboard&quot;</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .logout()</span><br><span class="line">                .logoutSuccessUrl(<span class="string">&quot;/login?logout&quot;</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="REST-APIs-and-Microservices"><a href="#REST-APIs-and-Microservices" class="headerlink" title="REST APIs and Microservices"></a>REST APIs and Microservices</h3><p>Essential for securing REST APIs with:</p>
<ul>
<li>JWT token-based authentication</li>
<li>Stateless security</li>
<li>API rate limiting</li>
<li>Cross-origin resource sharing (CORS)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtSecurityConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JwtAuthenticationEntryPoint <span class="title function_">jwtAuthenticationEntryPoint</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JwtAuthenticationEntryPoint</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JwtRequestFilter <span class="title function_">jwtRequestFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JwtRequestFilter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.csrf().disable()</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/api/auth/**&quot;</span>).permitAll()</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .exceptionHandling().authenticationEntryPoint(jwtAuthenticationEntryPoint)</span><br><span class="line">            .and()</span><br><span class="line">            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);</span><br><span class="line">            </span><br><span class="line">        http.addFilterBefore(jwtRequestFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="When-NOT-to-Use-Spring-Security"><a href="#When-NOT-to-Use-Spring-Security" class="headerlink" title="When NOT to Use Spring Security"></a>When NOT to Use Spring Security</h3><ul>
<li>Simple applications with basic authentication needs</li>
<li>Applications with custom security requirements that conflict with Spring Security’s architecture</li>
<li>Performance-critical applications where the filter chain overhead is unacceptable</li>
<li>Applications requiring non-standard authentication flows</li>
</ul>
<h2 id="User-Login-Logout-and-Session-Management"><a href="#User-Login-Logout-and-Session-Management" class="headerlink" title="User Login, Logout, and Session Management"></a>User Login, Logout, and Session Management</h2><h3 id="Login-Process-Flow"><a href="#Login-Process-Flow" class="headerlink" title="Login Process Flow"></a>Login Process Flow</h3><pre>
<code class="mermaid">
sequenceDiagram
participant U as User
participant B as Browser
participant S as Spring Security
participant A as AuthenticationManager
participant P as AuthenticationProvider
participant D as UserDetailsService

U-&gt;&gt;B: Enter credentials
B-&gt;&gt;S: POST &#x2F;login
S-&gt;&gt;A: Authenticate request
A-&gt;&gt;P: Delegate authentication
P-&gt;&gt;D: Load user details
D--&gt;&gt;P: Return UserDetails
P--&gt;&gt;A: Authentication result
A--&gt;&gt;S: Authenticated user
S-&gt;&gt;B: Redirect to success URL
B-&gt;&gt;U: Display protected resource
</code>
</pre>

<h3 id="Custom-Login-Implementation"><a href="#Custom-Login-Implementation" class="headerlink" title="Custom Login Implementation"></a>Custom Login Implementation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomUserDetailsService userDetailsService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomAuthenticationSuccessHandler successHandler;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomAuthenticationFailureHandler failureHandler;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/custom-login&quot;</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/perform-login&quot;</span>)</span><br><span class="line">                .usernameParameter(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">                .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">                .successHandler(successHandler)</span><br><span class="line">                .failureHandler(failureHandler)</span><br><span class="line">            .and()</span><br><span class="line">            .logout()</span><br><span class="line">                .logoutUrl(<span class="string">&quot;/perform-logout&quot;</span>)</span><br><span class="line">                .logoutSuccessHandler(customLogoutSuccessHandler())</span><br><span class="line">                .deleteCookies(<span class="string">&quot;JSESSIONID&quot;</span>)</span><br><span class="line">                .invalidateHttpSession(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CustomLogoutSuccessHandler <span class="title function_">customLogoutSuccessHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomLogoutSuccessHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Custom-Authentication-Success-Handler"><a href="#Custom-Authentication-Success-Handler" class="headerlink" title="Custom Authentication Success Handler"></a>Custom Authentication Success Handler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomAuthenticationSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationSuccessHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(CustomAuthenticationSuccessHandler.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, </span></span><br><span class="line"><span class="params">                                      HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                      Authentication authentication)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Log successful login</span></span><br><span class="line">        logger.info(<span class="string">&quot;User &#123;&#125; logged in successfully&quot;</span>, authentication.getName());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update last login timestamp</span></span><br><span class="line">        updateLastLoginTime(authentication.getName());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Redirect based on role</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> determineTargetUrl(authentication);</span><br><span class="line">        response.sendRedirect(redirectUrl);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">determineTargetUrl</span><span class="params">(Authentication authentication)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isAdmin</span> <span class="operator">=</span> authentication.getAuthorities().stream()</span><br><span class="line">            .anyMatch(authority -&gt; authority.getAuthority().equals(<span class="string">&quot;ROLE_ADMIN&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> isAdmin ? <span class="string">&quot;/admin/dashboard&quot;</span> : <span class="string">&quot;/user/dashboard&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateLastLoginTime</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation to update user&#x27;s last login time</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Session-Management"><a href="#Session-Management" class="headerlink" title="Session Management"></a>Session Management</h3><p>Spring Security provides comprehensive session management capabilities:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">        .sessionManagement()</span><br><span class="line">            .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)</span><br><span class="line">            .maximumSessions(<span class="number">1</span>)</span><br><span class="line">            .maxSessionsPreventsLogin(<span class="literal">false</span>)</span><br><span class="line">            .sessionRegistry(sessionRegistry())</span><br><span class="line">            .and()</span><br><span class="line">        .sessionFixation().migrateSession()</span><br><span class="line">        .invalidSessionUrl(<span class="string">&quot;/login?expired&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> HttpSessionEventPublisher <span class="title function_">httpSessionEventPublisher</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpSessionEventPublisher</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SessionRegistry <span class="title function_">sessionRegistry</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SessionRegistryImpl</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Insight</strong>: <em>“How does Spring Security handle concurrent sessions?”</em></p>
<blockquote>
<p>Spring Security can limit concurrent sessions per user through SessionRegistry. When maximum sessions are exceeded, it can either prevent new logins or invalidate existing sessions based on configuration.</p>
</blockquote>
<h3 id="Session-Timeout-Configuration"><a href="#Session-Timeout-Configuration" class="headerlink" title="Session Timeout Configuration"></a>Session Timeout Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In application.properties</span></span><br><span class="line">server.servlet.session.timeout=30m</span><br><span class="line"></span><br><span class="line"><span class="comment">// Programmatic configuration</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">        .sessionManagement()</span><br><span class="line">            .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)</span><br><span class="line">            .and()</span><br><span class="line">        .rememberMe()</span><br><span class="line">            .key(<span class="string">&quot;uniqueAndSecret&quot;</span>)</span><br><span class="line">            .tokenValiditySeconds(<span class="number">86400</span>) <span class="comment">// 24 hours</span></span><br><span class="line">            .userDetailsService(userDetailsService);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Remember-Me-Functionality"><a href="#Remember-Me-Functionality" class="headerlink" title="Remember Me Functionality"></a>Remember Me Functionality</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RememberMeConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PersistentTokenRepository <span class="title function_">persistentTokenRepository</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JdbcTokenRepositoryImpl</span> <span class="variable">tokenRepository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTokenRepositoryImpl</span>();</span><br><span class="line">        tokenRepository.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> tokenRepository;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            .rememberMe()</span><br><span class="line">                .rememberMeParameter(<span class="string">&quot;remember-me&quot;</span>)</span><br><span class="line">                .tokenRepository(persistentTokenRepository())</span><br><span class="line">                .tokenValiditySeconds(<span class="number">86400</span>)</span><br><span class="line">                .userDetailsService(userDetailsService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Logout-Process"><a href="#Logout-Process" class="headerlink" title="Logout Process"></a>Logout Process</h2><p>Proper logout implementation is essential for security, ensuring complete cleanup of user sessions and security contexts.</p>
<h3 id="Comprehensive-Logout-Configuration"><a href="#Comprehensive-Logout-Configuration" class="headerlink" title="Comprehensive Logout Configuration"></a>Comprehensive Logout Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogoutConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">logoutFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> http</span><br><span class="line">            .logout(logout -&gt; logout</span><br><span class="line">                .logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">                .logoutRequestMatcher(<span class="keyword">new</span> <span class="title class_">AntPathRequestMatcher</span>(<span class="string">&quot;/logout&quot;</span>, <span class="string">&quot;POST&quot;</span>))</span><br><span class="line">                .logoutSuccessUrl(<span class="string">&quot;/login?logout=true&quot;</span>)</span><br><span class="line">                .logoutSuccessHandler(customLogoutSuccessHandler())</span><br><span class="line">                .invalidateHttpSession(<span class="literal">true</span>)</span><br><span class="line">                .clearAuthentication(<span class="literal">true</span>)</span><br><span class="line">                .deleteCookies(<span class="string">&quot;JSESSIONID&quot;</span>, <span class="string">&quot;remember-me&quot;</span>)</span><br><span class="line">                .addLogoutHandler(customLogoutHandler())</span><br><span class="line">            )</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LogoutSuccessHandler <span class="title function_">customLogoutSuccessHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomLogoutSuccessHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LogoutHandler <span class="title function_">customLogoutHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomLogoutHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Custom-Logout-Handlers"><a href="#Custom-Logout-Handlers" class="headerlink" title="Custom Logout Handlers"></a>Custom Logout Handlers</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomLogoutHandler</span> <span class="keyword">implements</span> <span class="title class_">LogoutHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SessionRegistry sessionRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response, </span></span><br><span class="line"><span class="params">            Authentication authentication)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (authentication != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Clear user-specific cache</span></span><br><span class="line">            redisTemplate.delete(<span class="string">&quot;user:cache:&quot;</span> + username);</span><br><span class="line">            redisTemplate.delete(<span class="string">&quot;user:permissions:&quot;</span> + username);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Log logout event</span></span><br><span class="line">            logger.info(<span class="string">&quot;User &#123;&#125; logged out from IP: &#123;&#125;&quot;</span>, username, getClientIP(request));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Invalidate all sessions for this user (optional)</span></span><br><span class="line">            sessionRegistry.getAllPrincipals().stream()</span><br><span class="line">                .filter(principal -&gt; principal <span class="keyword">instanceof</span> UserDetails)</span><br><span class="line">                .filter(principal -&gt; ((UserDetails) principal).getUsername().equals(username))</span><br><span class="line">                .forEach(principal -&gt; </span><br><span class="line">                    sessionRegistry.getAllSessions(principal, <span class="literal">false</span>)</span><br><span class="line">                        .forEach(SessionInformation::expireNow)</span><br><span class="line">                );</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Clear security context</span></span><br><span class="line">        SecurityContextHolder.clearContext();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomLogoutSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">LogoutSuccessHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLogoutSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, </span></span><br><span class="line"><span class="params">            Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add logout timestamp to response headers</span></span><br><span class="line">        response.addHeader(<span class="string">&quot;Logout-Time&quot;</span>, Instant.now().toString());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Redirect based on user agent or request parameter</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> <span class="string">&quot;/login?logout=true&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userAgent</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;User-Agent&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (userAgent != <span class="literal">null</span> &amp;&amp; userAgent.contains(<span class="string">&quot;Mobile&quot;</span>)) &#123;</span><br><span class="line">            redirectUrl = <span class="string">&quot;/mobile/login?logout=true&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        response.sendRedirect(redirectUrl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Logout-Flow-Diagram"><a href="#Logout-Flow-Diagram" class="headerlink" title="Logout Flow Diagram"></a>Logout Flow Diagram</h3><pre>
<code class="mermaid">
sequenceDiagram
participant User
participant Browser
participant LogoutFilter
participant LogoutHandler
participant SessionRegistry
participant RedisCache
participant Database

User-&gt;&gt;Browser: Click logout
Browser-&gt;&gt;LogoutFilter: POST &#x2F;logout
LogoutFilter-&gt;&gt;LogoutHandler: Handle logout
LogoutHandler-&gt;&gt;SessionRegistry: Invalidate sessions
LogoutHandler-&gt;&gt;RedisCache: Clear user cache
LogoutHandler-&gt;&gt;Database: Log logout event
LogoutHandler--&gt;&gt;LogoutFilter: Cleanup complete
LogoutFilter-&gt;&gt;LogoutFilter: Clear SecurityContext
LogoutFilter--&gt;&gt;Browser: Redirect to login
Browser--&gt;&gt;User: Login page with logout message
</code>
</pre>

<h2 id="Advanced-Authentication-Mechanisms"><a href="#Advanced-Authentication-Mechanisms" class="headerlink" title="Advanced Authentication Mechanisms"></a>Advanced Authentication Mechanisms</h2><h3 id="JWT-Token-Based-Authentication"><a href="#JWT-Token-Based-Authentication" class="headerlink" title="JWT Token-Based Authentication"></a>JWT Token-Based Authentication</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtTokenUtil</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECRET</span> <span class="operator">=</span> <span class="string">&quot;mySecretKey&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">JWT_TOKEN_VALIDITY</span> <span class="operator">=</span> <span class="number">5</span> * <span class="number">60</span> * <span class="number">60</span>; <span class="comment">// 5 hours</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateToken</span><span class="params">(UserDetails userDetails)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> createToken(claims, userDetails.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">createToken</span><span class="params">(Map&lt;String, Object&gt; claims, String subject)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">            .setClaims(claims)</span><br><span class="line">            .setSubject(subject)</span><br><span class="line">            .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis()))</span><br><span class="line">            .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + JWT_TOKEN_VALIDITY * <span class="number">1000</span>))</span><br><span class="line">            .signWith(SignatureAlgorithm.HS512, SECRET)</span><br><span class="line">            .compact();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">validateToken</span><span class="params">(String token, UserDetails userDetails)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromToken(token);</span><br><span class="line">        <span class="keyword">return</span> (username.equals(userDetails.getUsername()) &amp;&amp; !isTokenExpired(token));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OAuth2-Integration"><a href="#OAuth2-Integration" class="headerlink" title="OAuth2 Integration"></a>OAuth2 Integration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableOAuth2Client</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OAuth2Config</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OAuth2RestTemplate <span class="title function_">oauth2RestTemplate</span><span class="params">(OAuth2ClientContext oauth2ClientContext)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OAuth2RestTemplate</span>(googleOAuth2ResourceDetails(), oauth2ClientContext);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OAuth2ProtectedResourceDetails <span class="title function_">googleOAuth2ResourceDetails</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AuthorizationCodeResourceDetails</span> <span class="variable">details</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthorizationCodeResourceDetails</span>();</span><br><span class="line">        details.setClientId(<span class="string">&quot;your-client-id&quot;</span>);</span><br><span class="line">        details.setClientSecret(<span class="string">&quot;your-client-secret&quot;</span>);</span><br><span class="line">        details.setAccessTokenUri(<span class="string">&quot;https://oauth2.googleapis.com/token&quot;</span>);</span><br><span class="line">        details.setUserAuthorizationUri(<span class="string">&quot;https://accounts.google.com/o/oauth2/auth&quot;</span>);</span><br><span class="line">        details.setScope(Arrays.asList(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;profile&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> details;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Method-Level-Security"><a href="#Method-Level-Security" class="headerlink" title="Method-Level Security"></a>Method-Level Security</h2><h3 id="Enabling-Method-Security"><a href="#Enabling-Method-Security" class="headerlink" title="Enabling Method Security"></a>Enabling Method Security</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(</span></span><br><span class="line"><span class="meta">    prePostEnabled = true,</span></span><br><span class="line"><span class="meta">    securedEnabled = true,</span></span><br><span class="line"><span class="meta">    jsr250Enabled = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">GlobalMethodSecurityConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> MethodSecurityExpressionHandler <span class="title function_">createExpressionHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultMethodSecurityExpressionHandler</span> <span class="variable">expressionHandler</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DefaultMethodSecurityExpressionHandler</span>();</span><br><span class="line">        expressionHandler.setPermissionEvaluator(<span class="keyword">new</span> <span class="title class_">CustomPermissionEvaluator</span>());</span><br><span class="line">        <span class="keyword">return</span> expressionHandler;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Security-Annotations-in-Action"><a href="#Security-Annotations-in-Action" class="headerlink" title="Security Annotations in Action"></a>Security Annotations in Action</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDocument</span><span class="params">(Long documentId)</span> &#123;</span><br><span class="line">        <span class="comment">// Only admins can delete documents</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;USER&#x27;) and #document.owner == authentication.name&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">editDocument</span><span class="params">(<span class="meta">@P(&quot;document&quot;)</span> Document document)</span> &#123;</span><br><span class="line">        <span class="comment">// Users can only edit their own documents</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostAuthorize(&quot;returnObject.owner == authentication.name or hasRole(&#x27;ADMIN&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Document <span class="title function_">getDocument</span><span class="params">(Long documentId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> documentRepository.findById(documentId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreFilter(&quot;filterObject.owner == authentication.name&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processDocuments</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="comment">// Process only documents owned by the current user</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Insight</strong>: <em>“What’s the difference between @PreAuthorize and @Secured?”</em></p>
<blockquote>
<p>@PreAuthorize supports SpEL expressions for complex authorization logic, while @Secured only supports role-based authorization. @PreAuthorize is more flexible and powerful.</p>
</blockquote>
<h2 id="Security-Best-Practices"><a href="#Security-Best-Practices" class="headerlink" title="Security Best Practices"></a>Security Best Practices</h2><h3 id="Password-Security"><a href="#Password-Security" class="headerlink" title="Password Security"></a>Password Security</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>(<span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordValidator <span class="title function_">passwordValidator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PasswordValidator</span>(Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LengthRule</span>(<span class="number">8</span>, <span class="number">30</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CharacterRule</span>(EnglishCharacterData.UpperCase, <span class="number">1</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CharacterRule</span>(EnglishCharacterData.LowerCase, <span class="number">1</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CharacterRule</span>(EnglishCharacterData.Digit, <span class="number">1</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CharacterRule</span>(EnglishCharacterData.Special, <span class="number">1</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">WhitespaceRule</span>()</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CSRF-Protection"><a href="#CSRF-Protection" class="headerlink" title="CSRF Protection"></a>CSRF Protection</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">        .csrf()</span><br><span class="line">            .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())</span><br><span class="line">            .ignoringAntMatchers(<span class="string">&quot;/api/public/**&quot;</span>)</span><br><span class="line">        .and()</span><br><span class="line">        .headers()</span><br><span class="line">            .frameOptions().deny()</span><br><span class="line">            .contentTypeOptions().and()</span><br><span class="line">            .httpStrictTransportSecurity(hstsConfig -&gt; hstsConfig</span><br><span class="line">                .maxAgeInSeconds(<span class="number">31536000</span>)</span><br><span class="line">                .includeSubdomains(<span class="literal">true</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Input-Validation-and-Sanitization"><a href="#Input-Validation-and-Sanitization" class="headerlink" title="Input Validation and Sanitization"></a>Input Validation and Sanitization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> CreateUserRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Validation handled by @Valid annotation</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.createUser(request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateUserRequest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;Username is required&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 3, max = 20, message = &quot;Username must be between 3 and 20 characters&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[a-zA-Z0-9._-]+$&quot;, message = &quot;Username contains invalid characters&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;Email is required&quot;)</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;Invalid email format&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;Password is required&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 8, message = &quot;Password must be at least 8 characters&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Common-Security-Vulnerabilities-and-Mitigation"><a href="#Common-Security-Vulnerabilities-and-Mitigation" class="headerlink" title="Common Security Vulnerabilities and Mitigation"></a>Common Security Vulnerabilities and Mitigation</h2><h3 id="SQL-Injection-Prevention"><a href="#SQL-Injection-Prevention" class="headerlink" title="SQL Injection Prevention"></a>SQL Injection Prevention</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Vulnerable code (DON&#x27;T DO THIS)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findByUsernameUnsafe</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users WHERE username = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, User.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Secure code (DO THIS)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findByUsernameSafe</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users WHERE username = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;username&#125;, User.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="XSS-Prevention"><a href="#XSS-Prevention" class="headerlink" title="XSS Prevention"></a>XSS Prevention</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityHeadersConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean&lt;XSSFilter&gt; <span class="title function_">xssPreventFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        FilterRegistrationBean&lt;XSSFilter&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;();</span><br><span class="line">        registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">XSSFilter</span>());</span><br><span class="line">        registrationBean.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XSSFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, </span></span><br><span class="line"><span class="params">                        FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">XSSRequestWrapper</span> <span class="variable">wrappedRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSRequestWrapper</span>((HttpServletRequest) request);</span><br><span class="line">        chain.doFilter(wrappedRequest, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Testing-Spring-Security"><a href="#Testing-Spring-Security" class="headerlink" title="Testing Spring Security"></a>Testing Spring Security</h2><h3 id="Security-Testing-with-MockMvc"><a href="#Security-Testing-with-MockMvc" class="headerlink" title="Security Testing with MockMvc"></a>Security Testing with MockMvc</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@WebMvcTest(UserController.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerSecurityTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@WithMockUser(roles = &quot;ADMIN&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdminAccessToUserData</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/admin/users&quot;</span>))</span><br><span class="line">            .andExpect(status().isOk());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@WithMockUser(roles = &quot;USER&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserAccessToAdminEndpoint</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/admin/users&quot;</span>))</span><br><span class="line">            .andExpect(status().isForbidden());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUnauthenticatedAccess</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/user/profile&quot;</span>))</span><br><span class="line">            .andExpect(status().isUnauthorized());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Integration-Testing-with-TestContainers"><a href="#Integration-Testing-with-TestContainers" class="headerlink" title="Integration Testing with TestContainers"></a>Integration Testing with TestContainers</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Testcontainers</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityIntegrationTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Container</span></span><br><span class="line">    <span class="keyword">static</span> PostgreSQLContainer&lt;?&gt; postgres = <span class="keyword">new</span> <span class="title class_">PostgreSQLContainer</span>&lt;&gt;(<span class="string">&quot;postgres:13&quot;</span>)</span><br><span class="line">        .withDatabaseName(<span class="string">&quot;testdb&quot;</span>)</span><br><span class="line">        .withUsername(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">        .withPassword(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TestRestTemplate restTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFullAuthenticationFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Test user registration</span></span><br><span class="line">        ResponseEntity&lt;String&gt; registerResponse = restTemplate.postForEntity(</span><br><span class="line">            <span class="string">&quot;/api/auth/register&quot;</span>, </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RegisterRequest</span>(<span class="string">&quot;test@example.com&quot;</span>, <span class="string">&quot;password123&quot;</span>),</span><br><span class="line">            String.class</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        assertThat(registerResponse.getStatusCode()).isEqualTo(HttpStatus.CREATED);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Test user login</span></span><br><span class="line">        ResponseEntity&lt;LoginResponse&gt; loginResponse = restTemplate.postForEntity(</span><br><span class="line">            <span class="string">&quot;/api/auth/login&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LoginRequest</span>(<span class="string">&quot;test@example.com&quot;</span>, <span class="string">&quot;password123&quot;</span>),</span><br><span class="line">            LoginResponse.class</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        assertThat(loginResponse.getStatusCode()).isEqualTo(HttpStatus.OK);</span><br><span class="line">        assertThat(loginResponse.getBody().getToken()).isNotNull();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Performance-Optimization"><a href="#Performance-Optimization" class="headerlink" title="Performance Optimization"></a>Performance Optimization</h2><h3 id="Security-Filter-Chain-Optimization"><a href="#Security-Filter-Chain-Optimization" class="headerlink" title="Security Filter Chain Optimization"></a>Security Filter Chain Optimization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedSecurityConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            <span class="comment">// Disable unnecessary features for API-only applications</span></span><br><span class="line">            .csrf().disable()</span><br><span class="line">            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// Order matters - put most specific patterns first</span></span><br><span class="line">            .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/api/public/**&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(HttpMethod.GET, <span class="string">&quot;/api/products/**&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/api/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Caching-Security-Context"><a href="#Caching-Security-Context" class="headerlink" title="Caching Security Context"></a>Caching Security Context</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityCacheConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcurrentMapCacheManager</span>(<span class="string">&quot;userCache&quot;</span>, <span class="string">&quot;permissionCache&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Service</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachedUserDetailsService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Cacheable(value = &quot;userCache&quot;, key = &quot;#username&quot;)</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">            <span class="keyword">return</span> userRepository.findByUsername(username)</span><br><span class="line">                .map(<span class="built_in">this</span>::createUserPrincipal)</span><br><span class="line">                .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;User not found: &quot;</span> + username));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Troubleshooting-Common-Issues"><a href="#Troubleshooting-Common-Issues" class="headerlink" title="Troubleshooting Common Issues"></a>Troubleshooting Common Issues</h2><h3 id="Debug-Security-Configuration"><a href="#Debug-Security-Configuration" class="headerlink" title="Debug Security Configuration"></a>Debug Security Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DebugSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        web.debug(<span class="literal">true</span>); <span class="comment">// Enable security debugging</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger <span class="title function_">securityLogger</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;org.springframework.security&quot;</span>);</span><br><span class="line">        ((ch.qos.logback.classic.Logger) logger).setLevel(Level.DEBUG);</span><br><span class="line">        <span class="keyword">return</span> logger;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Common-Configuration-Mistakes"><a href="#Common-Configuration-Mistakes" class="headerlink" title="Common Configuration Mistakes"></a>Common Configuration Mistakes</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WRONG: Ordering matters in security configuration</span></span><br><span class="line">http.authorizeRequests()</span><br><span class="line">    .anyRequest().authenticated()  <span class="comment">// This catches everything</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/public/**&quot;</span>).permitAll(); <span class="comment">// This never gets reached</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CORRECT: Specific patterns first</span></span><br><span class="line">http.authorizeRequests()</span><br><span class="line">    .antMatchers(<span class="string">&quot;/public/**&quot;</span>).permitAll()</span><br><span class="line">    .anyRequest().authenticated();</span><br></pre></td></tr></table></figure>

<p><strong>Interview Insight</strong>: <em>“What happens when Spring Security configuration conflicts occur?”</em></p>
<blockquote>
<p>Spring Security evaluates rules in order. The first matching rule wins, so specific patterns must come before general ones. Always place more restrictive rules before less restrictive ones.</p>
</blockquote>
<h2 id="Monitoring-and-Auditing"><a href="#Monitoring-and-Auditing" class="headerlink" title="Monitoring and Auditing"></a>Monitoring and Auditing</h2><h3 id="Security-Events-Logging"><a href="#Security-Events-Logging" class="headerlink" title="Security Events Logging"></a>Security Events Logging</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityEventListener</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(SecurityEventListener.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleAuthenticationSuccess</span><span class="params">(AuthenticationSuccessEvent event)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;User &#x27;&#123;&#125;&#x27; logged in successfully from IP: &#123;&#125;&quot;</span>, </span><br><span class="line">            event.getAuthentication().getName(),</span><br><span class="line">            getClientIpAddress());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleAuthenticationFailure</span><span class="params">(AbstractAuthenticationFailureEvent event)</span> &#123;</span><br><span class="line">        logger.warn(<span class="string">&quot;Authentication failed for user &#x27;&#123;&#125;&#x27;: &#123;&#125;&quot;</span>, </span><br><span class="line">            event.getAuthentication().getName(),</span><br><span class="line">            event.getException().getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleAuthorizationFailure</span><span class="params">(AuthorizationFailureEvent event)</span> &#123;</span><br><span class="line">        logger.warn(<span class="string">&quot;Authorization failed for user &#x27;&#123;&#125;&#x27; accessing resource: &#123;&#125;&quot;</span>, </span><br><span class="line">            event.getAuthentication().getName(),</span><br><span class="line">            event.getRequestUrl());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Metrics-and-Monitoring"><a href="#Metrics-and-Monitoring" class="headerlink" title="Metrics and Monitoring"></a>Metrics and Monitoring</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter loginAttempts;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter loginFailures;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SecurityMetrics</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        <span class="built_in">this</span>.loginAttempts = Counter.builder(<span class="string">&quot;security.login.attempts&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Total login attempts&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">        <span class="built_in">this</span>.loginFailures = Counter.builder(<span class="string">&quot;security.login.failures&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Failed login attempts&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoginAttempt</span><span class="params">(AuthenticationSuccessEvent event)</span> &#123;</span><br><span class="line">        loginAttempts.increment();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoginFailure</span><span class="params">(AbstractAuthenticationFailureEvent event)</span> &#123;</span><br><span class="line">        loginAttempts.increment();</span><br><span class="line">        loginFailures.increment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Interview-Questions-and-Answers"><a href="#Interview-Questions-and-Answers" class="headerlink" title="Interview Questions and Answers"></a>Interview Questions and Answers</h2><h3 id="Technical-Deep-Dive-Questions"><a href="#Technical-Deep-Dive-Questions" class="headerlink" title="Technical Deep Dive Questions"></a>Technical Deep Dive Questions</h3><p><strong>Q: Explain the difference between authentication and authorization in Spring Security.</strong><br>A: Authentication verifies identity (“who are you?”) while authorization determines permissions (“what can you do?”). Spring Security separates these concerns - AuthenticationManager handles authentication, while AccessDecisionManager handles authorization decisions.</p>
<p><strong>Q: How does Spring Security handle stateless authentication?</strong><br>A: For stateless authentication, Spring Security doesn’t maintain session state. Instead, it uses tokens (like JWT) passed with each request. Configure with <code>SessionCreationPolicy.STATELESS</code> and implement token-based filters.</p>
<p><strong>Q: What is the purpose of SecurityContextHolder?</strong><br>A: SecurityContextHolder provides access to the SecurityContext, which stores authentication information for the current thread. It uses ThreadLocal to ensure thread safety and provides three strategies: ThreadLocal (default), InheritableThreadLocal, and Global.</p>
<p><strong>Q: How do you implement custom authentication in Spring Security?</strong><br>A: Implement custom authentication by:</p>
<ol>
<li>Creating a custom AuthenticationProvider</li>
<li>Implementing authenticate() method</li>
<li>Registering the provider with AuthenticationManager</li>
<li>Optionally creating custom Authentication tokens</li>
</ol>
<h3 id="Practical-Implementation-Questions"><a href="#Practical-Implementation-Questions" class="headerlink" title="Practical Implementation Questions"></a>Practical Implementation Questions</h3><p><strong>Q: How would you secure a REST API with JWT tokens?</strong><br>A: Implement JWT security by:</p>
<ol>
<li>Creating JWT utility class for token generation&#x2F;validation</li>
<li>Implementing JwtAuthenticationEntryPoint for unauthorized access</li>
<li>Creating JwtRequestFilter to validate tokens</li>
<li>Configuring HttpSecurity with stateless session management</li>
<li>Adding JWT filter before UsernamePasswordAuthenticationFilter</li>
</ol>
<p><strong>Q: What are the security implications of CSRF and how does Spring Security handle it?</strong><br>A: CSRF attacks trick users into performing unwanted actions. Spring Security provides CSRF protection by:</p>
<ol>
<li>Generating unique tokens for each session</li>
<li>Validating tokens on state-changing requests</li>
<li>Storing tokens in HttpSession or cookies</li>
<li>Automatically including tokens in forms via Thymeleaf integration</li>
</ol>
<h2 id="External-Resources-and-References"><a href="#External-Resources-and-References" class="headerlink" title="External Resources and References"></a>External Resources and References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/reference/">Spring Security Reference Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/guides/tutorials/spring-boot-oauth2/">Spring Security OAuth2 Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://owasp.org/www-project-top-ten/">OWASP Security Guidelines</a></li>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc8725">JWT Best Practices</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web.security">Spring Boot Security Auto-configuration</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/reference/servlet/test/index.html">Spring Security Test Documentation</a></li>
</ul>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Spring Security provides a comprehensive, flexible framework for securing Java applications. Its architecture based on filters, authentication managers, and security contexts allows for sophisticated security implementations while maintaining clean separation of concerns. Success with Spring Security requires understanding its core principles, proper configuration, and adherence to security best practices.</p>
<p>The framework’s strength lies in its ability to handle complex security requirements while providing sensible defaults for common use cases. Whether building traditional web applications or modern microservices, Spring Security offers the tools and flexibility needed to implement robust security solutions.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/spring/" rel="tag"># spring</a>
              <a href="/tags/spring-security/" rel="tag"># spring security</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/19/Java-Virtual-Machine-Garbage-Collection-Complete-Guide/" rel="prev" title="Java Virtual Machine Garbage Collection - Complete Guide">
                  <i class="fa fa-angle-left"></i> Java Virtual Machine Garbage Collection - Complete Guide
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
