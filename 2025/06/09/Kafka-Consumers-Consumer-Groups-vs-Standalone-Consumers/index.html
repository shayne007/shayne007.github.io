<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="IntroductionApache Kafka provides two primary consumption patterns: Consumer Groups and Standalone Consumers. Understanding when and how to use each pattern is crucial for building scalable, fault-tol">
<meta property="og:type" content="article">
<meta property="og:title" content="Kafka Consumers: Consumer Groups vs. Standalone Consumers">
<meta property="og:url" content="https://shayne007.github.io/2025/06/09/Kafka-Consumers-Consumer-Groups-vs-Standalone-Consumers/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="IntroductionApache Kafka provides two primary consumption patterns: Consumer Groups and Standalone Consumers. Understanding when and how to use each pattern is crucial for building scalable, fault-tol">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-09T10:42:43.000Z">
<meta property="article:modified_time" content="2025-06-09T12:14:11.126Z">
<meta property="article:author" content="Charlie Feng">
<meta property="article:tag" content="kafka">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/06/09/Kafka-Consumers-Consumer-Groups-vs-Standalone-Consumers/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/06/09/Kafka-Consumers-Consumer-Groups-vs-Standalone-Consumers/","path":"2025/06/09/Kafka-Consumers-Consumer-Groups-vs-Standalone-Consumers/","title":"Kafka Consumers: Consumer Groups vs. Standalone Consumers"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Kafka Consumers: Consumer Groups vs. Standalone Consumers | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Consumer-Groups-Deep-Dive"><span class="nav-number">2.</span> <span class="nav-text">Consumer Groups Deep Dive</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What-are-Consumer-Groups"><span class="nav-number">2.1.</span> <span class="nav-text">What are Consumer Groups?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Characteristics"><span class="nav-number">2.2.</span> <span class="nav-text">Key Characteristics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Automatic-Partition-Assignment"><span class="nav-number">2.2.1.</span> <span class="nav-text">1. Automatic Partition Assignment</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Offset-Management"><span class="nav-number">2.2.2.</span> <span class="nav-text">2. Offset Management</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Consumer-Group-Configuration"><span class="nav-number">2.3.</span> <span class="nav-text">Consumer Group Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-Strategies"><span class="nav-number">2.4.</span> <span class="nav-text">Assignment Strategies</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Range-Assignment-Default"><span class="nav-number">2.4.1.</span> <span class="nav-text">Range Assignment (Default)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cooperative-Sticky-Assignment-Recommended"><span class="nav-number">2.4.2.</span> <span class="nav-text">Cooperative Sticky Assignment (Recommended)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Consumer-Group-Rebalancing"><span class="nav-number">2.5.</span> <span class="nav-text">Consumer Group Rebalancing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Standalone-Consumers"><span class="nav-number">3.</span> <span class="nav-text">Standalone Consumers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#When-to-Use-Standalone-Consumers"><span class="nav-number">3.1.</span> <span class="nav-text">When to Use Standalone Consumers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-Example"><span class="nav-number">3.2.</span> <span class="nav-text">Implementation Example</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-Offset-Storage"><span class="nav-number">3.3.</span> <span class="nav-text">Custom Offset Storage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Comparison-and-Use-Cases"><span class="nav-number">4.</span> <span class="nav-text">Comparison and Use Cases</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Feature-Comparison-Matrix"><span class="nav-number">4.1.</span> <span class="nav-text">Feature Comparison Matrix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Decision-Flow-Chart"><span class="nav-number">4.2.</span> <span class="nav-text">Decision Flow Chart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-Examples"><span class="nav-number">4.3.</span> <span class="nav-text">Use Case Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Consumer-Groups-Best-For"><span class="nav-number">4.3.1.</span> <span class="nav-text">Consumer Groups - Best For:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Standalone-Consumers-Best-For"><span class="nav-number">4.3.2.</span> <span class="nav-text">Standalone Consumers - Best For:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Offset-Management"><span class="nav-number">5.</span> <span class="nav-text">Offset Management</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Automatic-vs-Manual-Offset-Commits"><span class="nav-number">5.1.</span> <span class="nav-text">Automatic vs Manual Offset Commits</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Best-Practice-Manual-Offset-Management"><span class="nav-number">5.2.</span> <span class="nav-text">Best Practice: Manual Offset Management</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rebalancing-Mechanisms"><span class="nav-number">6.</span> <span class="nav-text">Rebalancing Mechanisms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Types-of-Rebalancing"><span class="nav-number">6.1.</span> <span class="nav-text">Types of Rebalancing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Minimizing-Rebalancing-Impact"><span class="nav-number">6.2.</span> <span class="nav-text">Minimizing Rebalancing Impact</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rebalancing-Listener-Implementation"><span class="nav-number">6.3.</span> <span class="nav-text">Rebalancing Listener Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Optimization"><span class="nav-number">7.</span> <span class="nav-text">Performance Optimization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Consumer-Configuration-Tuning"><span class="nav-number">7.1.</span> <span class="nav-text">Consumer Configuration Tuning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Parallel-Processing-Pattern"><span class="nav-number">7.2.</span> <span class="nav-text">Parallel Processing Pattern</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monitoring-and-Metrics"><span class="nav-number">7.3.</span> <span class="nav-text">Monitoring and Metrics</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshooting-Common-Issues"><span class="nav-number">8.</span> <span class="nav-text">Troubleshooting Common Issues</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Consumer-Lag-Investigation"><span class="nav-number">8.1.</span> <span class="nav-text">Consumer Lag Investigation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Common-Issues-and-Solutions"><span class="nav-number">8.2.</span> <span class="nav-text">Common Issues and Solutions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Rebalancing-Loops"><span class="nav-number">8.2.1.</span> <span class="nav-text">1. Rebalancing Loops</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Memory-Issues-with-Large-Messages"><span class="nav-number">8.2.2.</span> <span class="nav-text">2. Memory Issues with Large Messages</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Handling-Consumer-Failures"><span class="nav-number">8.2.3.</span> <span class="nav-text">3. Handling Consumer Failures</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Best-Practices-Summary"><span class="nav-number">9.</span> <span class="nav-text">Best Practices Summary</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Consumer-Groups-Best-Practices"><span class="nav-number">9.1.</span> <span class="nav-text">Consumer Groups Best Practices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Standalone-Consumer-Best-Practices"><span class="nav-number">9.2.</span> <span class="nav-text">Standalone Consumer Best Practices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Universal-Best-Practices"><span class="nav-number">9.3.</span> <span class="nav-text">Universal Best Practices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Takeaways"><span class="nav-number">9.4.</span> <span class="nav-text">Key Takeaways</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/06/09/Kafka-Consumers-Consumer-Groups-vs-Standalone-Consumers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Kafka Consumers: Consumer Groups vs. Standalone Consumers | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kafka Consumers: Consumer Groups vs. Standalone Consumers
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-06-09 18:42:43 / Modified: 20:14:11" itemprop="dateCreated datePublished" datetime="2025-06-09T18:42:43+08:00">2025-06-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/kafka/" itemprop="url" rel="index"><span itemprop="name">kafka</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Apache Kafka provides two primary consumption patterns: <strong>Consumer Groups</strong> and <strong>Standalone Consumers</strong>. Understanding when and how to use each pattern is crucial for building scalable, fault-tolerant streaming applications.</p>
<p><strong>🎯 Interview Insight</strong>: <em>Interviewers often ask: “When would you choose consumer groups over standalone consumers?” The key is understanding that consumer groups provide automatic load balancing and fault tolerance, while standalone consumers offer more control but require manual management.</em></p>
<h2 id="Consumer-Groups-Deep-Dive"><a href="#Consumer-Groups-Deep-Dive" class="headerlink" title="Consumer Groups Deep Dive"></a>Consumer Groups Deep Dive</h2><h3 id="What-are-Consumer-Groups"><a href="#What-are-Consumer-Groups" class="headerlink" title="What are Consumer Groups?"></a>What are Consumer Groups?</h3><p>Consumer groups enable multiple consumer instances to work together to consume messages from a topic. Each message is delivered to only one consumer instance within the group, providing natural load balancing.</p>
<pre>
<code class="mermaid">
graph TD
A[Topic: orders] --&gt; B[Partition 0]
A --&gt; C[Partition 1] 
A --&gt; D[Partition 2]
A --&gt; E[Partition 3]

B --&gt; F[Consumer 1&lt;br&#x2F;&gt;Group: order-processors]
C --&gt; F
D --&gt; G[Consumer 2&lt;br&#x2F;&gt;Group: order-processors]
E --&gt; G

style F fill:#e1f5fe
style G fill:#e1f5fe
</code>
</pre>

<h3 id="Key-Characteristics"><a href="#Key-Characteristics" class="headerlink" title="Key Characteristics"></a>Key Characteristics</h3><h4 id="1-Automatic-Partition-Assignment"><a href="#1-Automatic-Partition-Assignment" class="headerlink" title="1. Automatic Partition Assignment"></a>1. Automatic Partition Assignment</h4><ul>
<li>Kafka automatically assigns partitions to consumers within a group</li>
<li>Uses configurable assignment strategies (Range, RoundRobin, Sticky, Cooperative Sticky)</li>
<li>Handles consumer failures gracefully through rebalancing</li>
</ul>
<h4 id="2-Offset-Management"><a href="#2-Offset-Management" class="headerlink" title="2. Offset Management"></a>2. Offset Management</h4><ul>
<li>Group coordinator manages offset commits</li>
<li>Provides exactly-once or at-least-once delivery guarantees</li>
<li>Automatic offset commits can be enabled for convenience</li>
</ul>
<h3 id="Consumer-Group-Configuration"><a href="#Consumer-Group-Configuration" class="headerlink" title="Consumer Group Configuration"></a>Consumer Group Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>);</span><br><span class="line">props.put(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;order-processing-group&quot;</span>);</span><br><span class="line">props.put(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">props.put(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Assignment strategy - crucial for performance</span></span><br><span class="line">props.put(<span class="string">&quot;partition.assignment.strategy&quot;</span>, </span><br><span class="line">          <span class="string">&quot;org.apache.kafka.clients.consumer.CooperativeStickyAssignor&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Offset management</span></span><br><span class="line">props.put(<span class="string">&quot;enable.auto.commit&quot;</span>, <span class="string">&quot;false&quot;</span>); <span class="comment">// Manual commit for reliability</span></span><br><span class="line">props.put(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Session and heartbeat configuration</span></span><br><span class="line">props.put(<span class="string">&quot;session.timeout.ms&quot;</span>, <span class="string">&quot;30000&quot;</span>);</span><br><span class="line">props.put(<span class="string">&quot;heartbeat.interval.ms&quot;</span>, <span class="string">&quot;3000&quot;</span>);</span><br><span class="line">props.put(<span class="string">&quot;max.poll.interval.ms&quot;</span>, <span class="string">&quot;300000&quot;</span>);</span><br><span class="line"></span><br><span class="line">KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> <span class="title class_">KafkaConsumer</span>&lt;&gt;(props);</span><br><span class="line">consumer.subscribe(Arrays.asList(<span class="string">&quot;orders&quot;</span>, <span class="string">&quot;payments&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><strong>🎯 Interview Insight</strong>: <em>Common question: “What happens if a consumer in a group fails?” Answer should cover: immediate detection via heartbeat mechanism, partition reassignment to healthy consumers, and the role of session.timeout.ms in failure detection speed.</em></p>
<h3 id="Assignment-Strategies"><a href="#Assignment-Strategies" class="headerlink" title="Assignment Strategies"></a>Assignment Strategies</h3><h4 id="Range-Assignment-Default"><a href="#Range-Assignment-Default" class="headerlink" title="Range Assignment (Default)"></a>Range Assignment (Default)</h4><pre>
<code class="mermaid">
graph LR
subgraph &quot;Topic: orders (6 partitions)&quot;
    P0[P0] 
    P1[P1]
    P2[P2]
    P3[P3]
    P4[P4]
    P5[P5]
end

subgraph &quot;Consumer Group&quot;
    C1[Consumer 1]
    C2[Consumer 2]
    C3[Consumer 3]
end

P0 --&gt; C1
P1 --&gt; C1
P2 --&gt; C2
P3 --&gt; C2
P4 --&gt; C3
P5 --&gt; C3
</code>
</pre>

<h4 id="Cooperative-Sticky-Assignment-Recommended"><a href="#Cooperative-Sticky-Assignment-Recommended" class="headerlink" title="Cooperative Sticky Assignment (Recommended)"></a>Cooperative Sticky Assignment (Recommended)</h4><ul>
<li>Minimizes partition reassignments during rebalancing</li>
<li>Maintains consumer-to-partition affinity when possible</li>
<li>Reduces processing interruptions</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Best practice implementation with Cooperative Sticky</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedConsumerGroup</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startConsumption</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">1000</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Process records in batches for efficiency</span></span><br><span class="line">            Map&lt;TopicPartition, List&lt;ConsumerRecord&lt;String, String&gt;&gt;&gt; partitionRecords </span><br><span class="line">                = records.partitions().stream()</span><br><span class="line">                    .collect(Collectors.toMap(</span><br><span class="line">                        partition -&gt; partition,</span><br><span class="line">                        partition -&gt; records.records(partition)</span><br><span class="line">                    ));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;TopicPartition, List&lt;ConsumerRecord&lt;String, String&gt;&gt;&gt; entry : </span><br><span class="line">                 partitionRecords.entrySet()) &#123;</span><br><span class="line">                </span><br><span class="line">                processPartitionBatch(entry.getKey(), entry.getValue());</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Commit offsets per partition for better fault tolerance</span></span><br><span class="line">                Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                offsets.put(entry.getKey(), </span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">OffsetAndMetadata</span>(</span><br><span class="line">                        entry.getValue().get(entry.getValue().size() - <span class="number">1</span>).offset() + <span class="number">1</span>));</span><br><span class="line">                consumer.commitSync(offsets);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Consumer-Group-Rebalancing"><a href="#Consumer-Group-Rebalancing" class="headerlink" title="Consumer Group Rebalancing"></a>Consumer Group Rebalancing</h3><pre>
<code class="mermaid">
sequenceDiagram
participant C1 as Consumer1
participant C2 as Consumer2
participant GC as GroupCoordinator
participant C3 as Consumer3New

Note over C1,C2: Normal Processing
C3-&gt;&gt;GC: Join Group Request
GC-&gt;&gt;C1: Rebalance Notification
GC-&gt;&gt;C2: Rebalance Notification

C1-&gt;&gt;GC: Leave Group - stop processing
C2-&gt;&gt;GC: Leave Group - stop processing

GC-&gt;&gt;C1: New Assignment P0 and P1
GC-&gt;&gt;C2: New Assignment P2 and P3
GC-&gt;&gt;C3: New Assignment P4 and P5

Note over C1,C3: Resume Processing with New Assignments
</code>
</pre>

<p><strong>🎯 Interview Insight</strong>: <em>Key question: “How do you minimize rebalancing impact?” Best practices include: using cooperative rebalancing, proper session timeout configuration, avoiding long-running message processing, and implementing graceful shutdown.</em></p>
<h2 id="Standalone-Consumers"><a href="#Standalone-Consumers" class="headerlink" title="Standalone Consumers"></a>Standalone Consumers</h2><h3 id="When-to-Use-Standalone-Consumers"><a href="#When-to-Use-Standalone-Consumers" class="headerlink" title="When to Use Standalone Consumers"></a>When to Use Standalone Consumers</h3><p>Standalone consumers assign partitions manually and don’t participate in consumer groups. They’re ideal when you need:</p>
<ul>
<li><strong>Precise partition control</strong>: Processing specific partitions with custom logic</li>
<li><strong>No automatic rebalancing</strong>: When you want to manage partition assignment manually</li>
<li><strong>Custom offset management</strong>: Storing offsets in external systems</li>
<li><strong>Simple scenarios</strong>: Single consumer applications</li>
</ul>
<h3 id="Implementation-Example"><a href="#Implementation-Example" class="headerlink" title="Implementation Example"></a>Implementation Example</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StandaloneConsumerExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumeWithManualAssignment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.put(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>);</span><br><span class="line">        <span class="comment">// Note: No group.id for standalone consumer</span></span><br><span class="line">        props.put(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        props.put(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        props.put(<span class="string">&quot;enable.auto.commit&quot;</span>, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> <span class="title class_">KafkaConsumer</span>&lt;&gt;(props);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Manual partition assignment</span></span><br><span class="line">        <span class="type">TopicPartition</span> <span class="variable">partition0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TopicPartition</span>(<span class="string">&quot;orders&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="type">TopicPartition</span> <span class="variable">partition1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TopicPartition</span>(<span class="string">&quot;orders&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        consumer.assign(Arrays.asList(partition0, partition1));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Seek to specific offset if needed</span></span><br><span class="line">        consumer.seekToBeginning(Arrays.asList(partition0, partition1));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">1000</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                processRecord(record);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Manual offset management</span></span><br><span class="line">                storeOffsetInExternalSystem(record.topic(), record.partition(), record.offset());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Custom-Offset-Storage"><a href="#Custom-Offset-Storage" class="headerlink" title="Custom Offset Storage"></a>Custom Offset Storage</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomOffsetManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">storeOffset</span><span class="params">(String topic, <span class="type">int</span> partition, <span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            INSERT INTO consumer_offsets (topic, partition, offset, updated_at) </span></span><br><span class="line"><span class="string">            VALUES (?, ?, ?, ?) </span></span><br><span class="line"><span class="string">            ON DUPLICATE KEY UPDATE offset = ?, updated_at = ?</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Timestamp</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timestamp</span>(System.currentTimeMillis());</span><br><span class="line">        jdbcTemplate.update(sql, topic, partition, offset, now, offset, now);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getStoredOffset</span><span class="params">(String topic, <span class="type">int</span> partition)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT offset FROM consumer_offsets WHERE topic = ? AND partition = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, Long.class, topic, partition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>🎯 Interview Insight</strong>: <em>Interviewers may ask: “What are the trade-offs of using standalone consumers?” Key points: more control but more complexity, manual fault tolerance, no automatic load balancing, and the need for custom monitoring.</em></p>
<h2 id="Comparison-and-Use-Cases"><a href="#Comparison-and-Use-Cases" class="headerlink" title="Comparison and Use Cases"></a>Comparison and Use Cases</h2><h3 id="Feature-Comparison-Matrix"><a href="#Feature-Comparison-Matrix" class="headerlink" title="Feature Comparison Matrix"></a>Feature Comparison Matrix</h3><table>
<thead>
<tr>
<th>Feature</th>
<th>Consumer Groups</th>
<th>Standalone Consumers</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Partition Assignment</strong></td>
<td>Automatic</td>
<td>Manual</td>
</tr>
<tr>
<td><strong>Load Balancing</strong></td>
<td>Built-in</td>
<td>Manual implementation</td>
</tr>
<tr>
<td><strong>Fault Tolerance</strong></td>
<td>Automatic rebalancing</td>
<td>Manual handling required</td>
</tr>
<tr>
<td><strong>Offset Management</strong></td>
<td>Kafka-managed</td>
<td>Custom implementation</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>Horizontal scaling</td>
<td>Limited scaling</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td>Lower</td>
<td>Higher</td>
</tr>
<tr>
<td><strong>Control</strong></td>
<td>Limited</td>
<td>Full control</td>
</tr>
</tbody></table>
<h3 id="Decision-Flow-Chart"><a href="#Decision-Flow-Chart" class="headerlink" title="Decision Flow Chart"></a>Decision Flow Chart</h3><pre>
<code class="mermaid">
flowchart TD
A[Need to consume from Kafka?] --&gt; B{Multiple consumers needed?}
B --&gt;|Yes| C{Need automatic load balancing?}
B --&gt;|No| D[Consider Standalone Consumer]

C --&gt;|Yes| E[Use Consumer Groups]
C --&gt;|No| F{Need custom partition logic?}

F --&gt;|Yes| D
F --&gt;|No| E

D --&gt; G{Custom offset storage needed?}
G --&gt;|Yes| H[Implement custom offset management]
G --&gt;|No| I[Use Kafka offset storage]

E --&gt; J[Configure appropriate assignment strategy]

style E fill:#c8e6c9
style D fill:#ffecb3
</code>
</pre>

<h3 id="Use-Case-Examples"><a href="#Use-Case-Examples" class="headerlink" title="Use Case Examples"></a>Use Case Examples</h3><h4 id="Consumer-Groups-Best-For"><a href="#Consumer-Groups-Best-For" class="headerlink" title="Consumer Groups - Best For:"></a>Consumer Groups - Best For:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// E-commerce order processing with multiple workers</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderProcessingService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;orders&quot;, groupId = &quot;order-processors&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(OrderEvent order)</span> &#123;</span><br><span class="line">        <span class="comment">// Automatic load balancing across multiple instances</span></span><br><span class="line">        validateOrder(order);</span><br><span class="line">        updateInventory(order);</span><br><span class="line">        processPayment(order);</span><br><span class="line">        sendConfirmation(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Standalone-Consumers-Best-For"><a href="#Standalone-Consumers-Best-For" class="headerlink" title="Standalone Consumers - Best For:"></a>Standalone Consumers - Best For:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Data archival service processing specific partitions</span></span><br><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataArchivalService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">archivePartitionData</span><span class="params">(<span class="type">int</span> partitionId)</span> &#123;</span><br><span class="line">        <span class="comment">// Process only specific partitions for compliance</span></span><br><span class="line">        <span class="type">TopicPartition</span> <span class="variable">partition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TopicPartition</span>(<span class="string">&quot;user-events&quot;</span>, partitionId);</span><br><span class="line">        consumer.assign(Collections.singletonList(partition));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Custom offset management for compliance tracking</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">lastArchivedOffset</span> <span class="operator">=</span> getLastArchivedOffset(partitionId);</span><br><span class="line">        consumer.seek(partition, lastArchivedOffset + <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">            archiveToComplianceSystem(records);</span><br><span class="line">            updateArchivedOffset(partitionId, getLastOffset(records));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Offset-Management"><a href="#Offset-Management" class="headerlink" title="Offset Management"></a>Offset Management</h2><h3 id="Automatic-vs-Manual-Offset-Commits"><a href="#Automatic-vs-Manual-Offset-Commits" class="headerlink" title="Automatic vs Manual Offset Commits"></a>Automatic vs Manual Offset Commits</h3><pre>
<code class="mermaid">
graph TD
A[Offset Management Strategies] --&gt; B[Automatic Commits]
A --&gt; C[Manual Commits]

B --&gt; D[enable.auto.commit&#x3D;true]
B --&gt; E[Pros: Simple, Less code]
B --&gt; F[Cons: Potential message loss, Duplicates]

C --&gt; G[Synchronous Commits]
C --&gt; H[Asynchronous Commits]
C --&gt; I[Batch Commits]

G --&gt; J[commitSync]
H --&gt; K[commitAsync]
I --&gt; L[Commit after batch processing]

style G fill:#c8e6c9
style I fill:#c8e6c9
</code>
</pre>

<h3 id="Best-Practice-Manual-Offset-Management"><a href="#Best-Practice-Manual-Offset-Management" class="headerlink" title="Best Practice: Manual Offset Management"></a>Best Practice: Manual Offset Management</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobustConsumerImplementation</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumeWithReliableOffsetManagement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">1000</span>));</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Process records in order</span></span><br><span class="line">                <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        processRecord(record);</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">// Commit immediately after successful processing</span></span><br><span class="line">                        Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets = Map.of(</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">TopicPartition</span>(record.topic(), record.partition()),</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">OffsetAndMetadata</span>(record.offset() + <span class="number">1</span>)</span><br><span class="line">                        );</span><br><span class="line">                        </span><br><span class="line">                        consumer.commitSync(offsets);</span><br><span class="line">                        </span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        log.error(<span class="string">&quot;Failed to process record at offset &#123;&#125;&quot;</span>, record.offset(), e);</span><br><span class="line">                        <span class="comment">// Implement retry logic or dead letter queue</span></span><br><span class="line">                        handleProcessingFailure(record, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Consumer error&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            consumer.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>🎯 Interview Insight</strong>: <em>Critical question: “How do you handle exactly-once processing?” Key concepts: idempotent processing, transactional producers&#x2F;consumers, and the importance of offset management in achieving exactly-once semantics.</em></p>
<h2 id="Rebalancing-Mechanisms"><a href="#Rebalancing-Mechanisms" class="headerlink" title="Rebalancing Mechanisms"></a>Rebalancing Mechanisms</h2><h3 id="Types-of-Rebalancing"><a href="#Types-of-Rebalancing" class="headerlink" title="Types of Rebalancing"></a>Types of Rebalancing</h3><pre>
<code class="mermaid">
graph TB
A[Rebalancing Triggers] --&gt; B[Consumer Join&#x2F;Leave]
A --&gt; C[Partition Count Change]  
A --&gt; D[Consumer Failure]
A --&gt; E[Configuration Change]

B --&gt; F[Cooperative Rebalancing]
B --&gt; G[Eager Rebalancing]

F --&gt; H[Incremental Assignment]
F --&gt; I[Minimal Disruption]

G --&gt; J[Stop-the-world]
G --&gt; K[All Partitions Reassigned]

style F fill:#c8e6c9
style H fill:#c8e6c9
style I fill:#c8e6c9
</code>
</pre>

<h3 id="Minimizing-Rebalancing-Impact"><a href="#Minimizing-Rebalancing-Impact" class="headerlink" title="Minimizing Rebalancing Impact"></a>Minimizing Rebalancing Impact</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimalConsumerConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConsumerFactory&lt;String, String&gt; <span class="title function_">consumerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; props = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Rebalancing optimization</span></span><br><span class="line">        props.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, </span><br><span class="line">                 CooperativeStickyAssignor.class.getName());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Heartbeat configuration</span></span><br><span class="line">        props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, <span class="string">&quot;30000&quot;</span>);</span><br><span class="line">        props.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, <span class="string">&quot;3000&quot;</span>);</span><br><span class="line">        props.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, <span class="string">&quot;300000&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Processing optimization</span></span><br><span class="line">        props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, <span class="string">&quot;500&quot;</span>);</span><br><span class="line">        props.put(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG, <span class="string">&quot;500&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultKafkaConsumerFactory</span>&lt;&gt;(props);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Rebalancing-Listener-Implementation"><a href="#Rebalancing-Listener-Implementation" class="headerlink" title="Rebalancing Listener Implementation"></a>Rebalancing Listener Implementation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RebalanceAwareConsumer</span> <span class="keyword">implements</span> <span class="title class_">ConsumerRebalanceListener</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> KafkaConsumer&lt;String, String&gt; consumer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;TopicPartition, Long&gt; currentOffsets = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPartitionsRevoked</span><span class="params">(Collection&lt;TopicPartition&gt; partitions)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Partitions revoked: &#123;&#125;&quot;</span>, partitions);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Commit current offsets before losing partitions</span></span><br><span class="line">        commitCurrentOffsets();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Gracefully finish processing current batch</span></span><br><span class="line">        finishCurrentProcessing();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPartitionsAssigned</span><span class="params">(Collection&lt;TopicPartition&gt; partitions)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Partitions assigned: &#123;&#125;&quot;</span>, partitions);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Initialize any partition-specific resources</span></span><br><span class="line">        initializePartitionResources(partitions);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Seek to appropriate starting position if needed</span></span><br><span class="line">        seekToDesiredPosition(partitions);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">commitCurrentOffsets</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!currentOffsets.isEmpty()) &#123;</span><br><span class="line">            Map&lt;TopicPartition, OffsetAndMetadata&gt; offsetsToCommit = </span><br><span class="line">                currentOffsets.entrySet().stream()</span><br><span class="line">                    .collect(Collectors.toMap(</span><br><span class="line">                        Map.Entry::getKey,</span><br><span class="line">                        entry -&gt; <span class="keyword">new</span> <span class="title class_">OffsetAndMetadata</span>(entry.getValue() + <span class="number">1</span>)</span><br><span class="line">                    ));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                consumer.commitSync(offsetsToCommit);</span><br><span class="line">                log.info(<span class="string">&quot;Committed offsets: &#123;&#125;&quot;</span>, offsetsToCommit);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Failed to commit offsets during rebalance&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>🎯 Interview Insight</strong>: <em>Scenario-based question: “Your consumer group is experiencing frequent rebalancing. How would you troubleshoot?” Look for: session timeout analysis, processing time optimization, network issues investigation, and proper rebalance listener implementation.</em></p>
<h2 id="Performance-Optimization"><a href="#Performance-Optimization" class="headerlink" title="Performance Optimization"></a>Performance Optimization</h2><h3 id="Consumer-Configuration-Tuning"><a href="#Consumer-Configuration-Tuning" class="headerlink" title="Consumer Configuration Tuning"></a>Consumer Configuration Tuning</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HighPerformanceConsumerConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getOptimizedConsumerProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Network optimization</span></span><br><span class="line">        props.put(<span class="string">&quot;fetch.min.bytes&quot;</span>, <span class="string">&quot;50000&quot;</span>);           <span class="comment">// Batch fetching</span></span><br><span class="line">        props.put(<span class="string">&quot;fetch.max.wait.ms&quot;</span>, <span class="string">&quot;500&quot;</span>);           <span class="comment">// Reduce latency</span></span><br><span class="line">        props.put(<span class="string">&quot;max.partition.fetch.bytes&quot;</span>, <span class="string">&quot;1048576&quot;</span>); <span class="comment">// 1MB per partition</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Processing optimization  </span></span><br><span class="line">        props.put(<span class="string">&quot;max.poll.records&quot;</span>, <span class="string">&quot;1000&quot;</span>);           <span class="comment">// Larger batches</span></span><br><span class="line">        props.put(<span class="string">&quot;max.poll.interval.ms&quot;</span>, <span class="string">&quot;600000&quot;</span>);     <span class="comment">// 10 minutes</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Memory optimization</span></span><br><span class="line">        props.put(<span class="string">&quot;receive.buffer.bytes&quot;</span>, <span class="string">&quot;65536&quot;</span>);      <span class="comment">// 64KB</span></span><br><span class="line">        props.put(<span class="string">&quot;send.buffer.bytes&quot;</span>, <span class="string">&quot;131072&quot;</span>);        <span class="comment">// 128KB</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> props;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Parallel-Processing-Pattern"><a href="#Parallel-Processing-Pattern" class="headerlink" title="Parallel Processing Pattern"></a>Parallel Processing Pattern</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelProcessingConsumer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">processingPool</span> <span class="operator">=</span> </span><br><span class="line">        Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumeWithParallelProcessing</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">1000</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!records.isEmpty()) &#123;</span><br><span class="line">                <span class="comment">// Group records by partition to maintain order within partition</span></span><br><span class="line">                Map&lt;TopicPartition, List&lt;ConsumerRecord&lt;String, String&gt;&gt;&gt; partitionGroups = </span><br><span class="line">                    records.partitions().stream()</span><br><span class="line">                        .collect(Collectors.toMap(</span><br><span class="line">                            Function.identity(),</span><br><span class="line">                            partition -&gt; records.records(partition)</span><br><span class="line">                        ));</span><br><span class="line">                </span><br><span class="line">                List&lt;CompletableFuture&lt;Void&gt;&gt; futures = partitionGroups.entrySet().stream()</span><br><span class="line">                    .map(entry -&gt; CompletableFuture.runAsync(</span><br><span class="line">                        () -&gt; processPartitionRecords(entry.getKey(), entry.getValue()),</span><br><span class="line">                        processingPool</span><br><span class="line">                    ))</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Wait for all partitions to complete processing</span></span><br><span class="line">                CompletableFuture.allOf(futures.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]))</span><br><span class="line">                    .thenRun(() -&gt; commitOffsetsAfterProcessing(partitionGroups))</span><br><span class="line">                    .join();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processPartitionRecords</span><span class="params">(TopicPartition partition, </span></span><br><span class="line"><span class="params">                                       List&lt;ConsumerRecord&lt;String, String&gt;&gt; records)</span> &#123;</span><br><span class="line">        <span class="comment">// Process records from single partition sequentially to maintain order</span></span><br><span class="line">        <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">            processRecord(record);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Monitoring-and-Metrics"><a href="#Monitoring-and-Metrics" class="headerlink" title="Monitoring and Metrics"></a>Monitoring and Metrics</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerMetricsCollector</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer processingTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter processedRecords;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge lagGauge;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConsumerMetricsCollector</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        <span class="built_in">this</span>.processingTimer = Timer.builder(<span class="string">&quot;kafka.consumer.processing.time&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">        <span class="built_in">this</span>.processedRecords = Counter.builder(<span class="string">&quot;kafka.consumer.records.processed&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordProcessingMetrics</span><span class="params">(ConsumerRecord&lt;String, String&gt; record, </span></span><br><span class="line"><span class="params">                                      Duration processingTime)</span> &#123;</span><br><span class="line">        processingTimer.record(processingTime);</span><br><span class="line">        processedRecords.increment();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Record lag metrics</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">currentLag</span> <span class="operator">=</span> System.currentTimeMillis() - record.timestamp();</span><br><span class="line">        Gauge.builder(<span class="string">&quot;kafka.consumer.lag.ms&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;topic&quot;</span>, record.topic())</span><br><span class="line">            .tag(<span class="string">&quot;partition&quot;</span>, String.valueOf(record.partition()))</span><br><span class="line">            .register(meterRegistry, () -&gt; currentLag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>🎯 Interview Insight</strong>: <em>Performance question: “How do you measure and optimize consumer performance?” Key metrics: consumer lag, processing rate, rebalancing frequency, and memory usage. Tools: JMX metrics, Kafka Manager, and custom monitoring.</em></p>
<h2 id="Troubleshooting-Common-Issues"><a href="#Troubleshooting-Common-Issues" class="headerlink" title="Troubleshooting Common Issues"></a>Troubleshooting Common Issues</h2><h3 id="Consumer-Lag-Investigation"><a href="#Consumer-Lag-Investigation" class="headerlink" title="Consumer Lag Investigation"></a>Consumer Lag Investigation</h3><pre>
<code class="mermaid">
flowchart TD
A[High Consumer Lag Detected] --&gt; B{Check Consumer Health}
B --&gt;|Healthy| C[Analyze Processing Time]
B --&gt;|Unhealthy| D[Check Resource Usage]

C --&gt; E{Processing Time &gt; Poll Interval?}
E --&gt;|Yes| F[Optimize Processing Logic]
E --&gt;|No| G[Check Partition Distribution]

D --&gt; H[CPU&#x2F;Memory Issues?]
H --&gt;|Yes| I[Scale Resources]
H --&gt;|No| J[Check Network Connectivity]

F --&gt; K[Increase max.poll.interval.ms]
F --&gt; L[Implement Async Processing]
F --&gt; M[Reduce max.poll.records]

G --&gt; N[Rebalance Consumer Group]
G --&gt; O[Add More Consumers]
</code>
</pre>

<h3 id="Common-Issues-and-Solutions"><a href="#Common-Issues-and-Solutions" class="headerlink" title="Common Issues and Solutions"></a>Common Issues and Solutions</h3><h4 id="1-Rebalancing-Loops"><a href="#1-Rebalancing-Loops" class="headerlink" title="1. Rebalancing Loops"></a>1. Rebalancing Loops</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Problem: Frequent rebalancing due to long processing</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProblematicConsumer</span> &#123;</span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;slow-topic&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processSlowly</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// This takes too long - causes rebalancing</span></span><br><span class="line">        Thread.sleep(<span class="number">60000</span>); <span class="comment">// 1 minute processing</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Solution: Optimize processing or increase timeouts</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedConsumer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;slow-topic&quot;, </span></span><br><span class="line"><span class="meta">                  containerFactory = &quot;optimizedKafkaListenerContainerFactory&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processEfficiently</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// Process quickly or use async processing</span></span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            performLongRunningTask(message);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ConcurrentKafkaListenerContainerFactory&lt;String, String&gt; </span><br><span class="line">    <span class="title function_">optimizedKafkaListenerContainerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    ConcurrentKafkaListenerContainerFactory&lt;String, String&gt; factory = </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConcurrentKafkaListenerContainerFactory</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Increase timeouts to prevent rebalancing</span></span><br><span class="line">    factory.getContainerProperties().setPollTimeout(Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line">    factory.getContainerProperties().setMaxPollInterval(Duration.ofMinutes(<span class="number">10</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-Memory-Issues-with-Large-Messages"><a href="#2-Memory-Issues-with-Large-Messages" class="headerlink" title="2. Memory Issues with Large Messages"></a>2. Memory Issues with Large Messages</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemoryOptimizedConsumer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumeWithMemoryManagement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Limit fetch size to prevent OOM</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.put(<span class="string">&quot;max.partition.fetch.bytes&quot;</span>, <span class="string">&quot;1048576&quot;</span>); <span class="comment">// 1MB limit</span></span><br><span class="line">        props.put(<span class="string">&quot;max.poll.records&quot;</span>, <span class="string">&quot;100&quot;</span>);              <span class="comment">// Process smaller batches</span></span><br><span class="line">        </span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> <span class="title class_">KafkaConsumer</span>&lt;&gt;(props);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Process and release memory promptly</span></span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                processRecord(record);</span><br><span class="line">                <span class="comment">// Clear references to help GC</span></span><br><span class="line">                record = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Explicit GC hint for large message processing</span></span><br><span class="line">            <span class="keyword">if</span> (records.count() &gt; <span class="number">50</span>) &#123;</span><br><span class="line">                System.gc();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-Handling-Consumer-Failures"><a href="#3-Handling-Consumer-Failures" class="headerlink" title="3. Handling Consumer Failures"></a>3. Handling Consumer Failures</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResilientConsumer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RetryTemplate retryTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResilientConsumer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.retryTemplate = RetryTemplate.builder()</span><br><span class="line">            .maxAttempts(MAX_RETRIES)</span><br><span class="line">            .exponentialBackoff(<span class="number">1000</span>, <span class="number">2</span>, <span class="number">10000</span>)</span><br><span class="line">            .retryOn(TransientException.class)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;orders&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processWithRetry</span><span class="params">(ConsumerRecord&lt;String, String&gt; record)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            retryTemplate.execute(context -&gt; &#123;</span><br><span class="line">                processRecord(record);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// Send to dead letter queue after max retries</span></span><br><span class="line">            sendToDeadLetterQueue(record, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendToDeadLetterQueue</span><span class="params">(ConsumerRecord&lt;String, String&gt; record, Exception error)</span> &#123;</span><br><span class="line">        <span class="type">DeadLetterRecord</span> <span class="variable">dlq</span> <span class="operator">=</span> DeadLetterRecord.builder()</span><br><span class="line">            .originalTopic(record.topic())</span><br><span class="line">            .originalPartition(record.partition())</span><br><span class="line">            .originalOffset(record.offset())</span><br><span class="line">            .payload(record.value())</span><br><span class="line">            .error(error.getMessage())</span><br><span class="line">            .timestamp(Instant.now())</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        kafkaTemplate.send(<span class="string">&quot;dead-letter-topic&quot;</span>, dlq);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>🎯 Interview Insight</strong>: <em>Troubleshooting question: “A consumer group stops processing messages. Walk me through your debugging approach.” Expected steps: check consumer logs, verify group coordination, examine partition assignments, monitor resource usage, and validate network connectivity.</em></p>
<h2 id="Best-Practices-Summary"><a href="#Best-Practices-Summary" class="headerlink" title="Best Practices Summary"></a>Best Practices Summary</h2><h3 id="Consumer-Groups-Best-Practices"><a href="#Consumer-Groups-Best-Practices" class="headerlink" title="Consumer Groups Best Practices"></a>Consumer Groups Best Practices</h3><ol>
<li><p><strong>Use Cooperative Sticky Assignment</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">props.put(<span class="string">&quot;partition.assignment.strategy&quot;</span>, </span><br><span class="line">         <span class="string">&quot;org.apache.kafka.clients.consumer.CooperativeStickyAssignor&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Implement Proper Error Handling</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RetryableTopic(attempts = &quot;3&quot;, </span></span><br><span class="line"><span class="meta">                backoff = @Backoff(delay = 1000, multiplier = 2))</span></span><br><span class="line"><span class="meta">@KafkaListener(topics = &quot;orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="comment">// Processing logic with automatic retry</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Monitor Consumer Lag</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(fixedRate = 30000)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">monitorConsumerLag</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">AdminClient</span> <span class="variable">adminClient</span> <span class="operator">=</span> AdminClient.create(adminProps);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Check lag for all consumer groups</span></span><br><span class="line">    Map&lt;String, ConsumerGroupDescription&gt; groups = </span><br><span class="line">        adminClient.describeConsumerGroups(groupIds).all().get();</span><br><span class="line">        </span><br><span class="line">    groups.forEach((groupId, description) -&gt; &#123;</span><br><span class="line">        <span class="comment">// Calculate and alert on high lag</span></span><br><span class="line">        checkLagThresholds(groupId, description);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Standalone-Consumer-Best-Practices"><a href="#Standalone-Consumer-Best-Practices" class="headerlink" title="Standalone Consumer Best Practices"></a>Standalone Consumer Best Practices</h3><ol>
<li><strong>Implement Custom Offset Management</strong></li>
<li><strong>Handle Partition Changes Gracefully</strong>  </li>
<li><strong>Monitor Processing Health</strong></li>
<li><strong>Implement Circuit Breakers</strong></li>
</ol>
<h3 id="Universal-Best-Practices"><a href="#Universal-Best-Practices" class="headerlink" title="Universal Best Practices"></a>Universal Best Practices</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UniversalBestPractices</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. Always close consumers properly</span></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanup</span><span class="params">()</span> &#123;</span><br><span class="line">        consumer.close(Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. Use appropriate serialization</span></span><br><span class="line">    props.put(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;io.confluent.kafka.serializers.KafkaAvroDeserializer&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. Configure timeouts appropriately</span></span><br><span class="line">    props.put(<span class="string">&quot;request.timeout.ms&quot;</span>, <span class="string">&quot;30000&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;session.timeout.ms&quot;</span>, <span class="string">&quot;10000&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. Enable security when needed</span></span><br><span class="line">    props.put(<span class="string">&quot;security.protocol&quot;</span>, <span class="string">&quot;SASL_SSL&quot;</span>);</span><br><span class="line">    props.put(<span class="string">&quot;sasl.mechanism&quot;</span>, <span class="string">&quot;PLAIN&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>🎯 Interview Insight</strong>: <em>Final synthesis question: “Design a robust consumer architecture for a high-throughput e-commerce platform.” Look for: proper consumer group strategy, error handling, monitoring, scaling considerations, and failure recovery mechanisms.</em></p>
<h3 id="Key-Takeaways"><a href="#Key-Takeaways" class="headerlink" title="Key Takeaways"></a>Key Takeaways</h3><ul>
<li><strong>Consumer Groups</strong>: Best for distributed processing with automatic load balancing</li>
<li><strong>Standalone Consumers</strong>: Best for precise control and custom logic requirements  </li>
<li><strong>Offset Management</strong>: Critical for exactly-once or at-least-once processing guarantees</li>
<li><strong>Rebalancing</strong>: Minimize impact through proper configuration and cooperative assignment</li>
<li><strong>Monitoring</strong>: Essential for maintaining healthy consumer performance</li>
<li><strong>Error Handling</strong>: Implement retries, dead letter queues, and circuit breakers</li>
</ul>
<p>Choose the right pattern based on your specific requirements for control, scalability, and fault tolerance. Both patterns have their place in a well-architected Kafka ecosystem.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/kafka/" rel="tag"># kafka</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/09/Kafka-ISR-High-Watermark-Leader-Epoch-Deep-Dive-Guide/" rel="prev" title="Kafka ISR, High Watermark &amp; Leader Epoch - Deep Dive Guide">
                  <i class="fa fa-angle-left"></i> Kafka ISR, High Watermark & Leader Epoch - Deep Dive Guide
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/09/Kafka-Performance-Theory-Best-Practices/" rel="next" title="Kafka Performance: Theory, Best Practices">
                  Kafka Performance: Theory, Best Practices <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
