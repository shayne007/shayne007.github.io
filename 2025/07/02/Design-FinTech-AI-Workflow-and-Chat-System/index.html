<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="System OverviewThe FinTech AI Workflow and Chat System represents a cutting-edge approach to automated lending processes, combining traditional workflow engines with AI-powered decision-making capabil">
<meta property="og:type" content="article">
<meta property="og:title" content="Design FinTech AI Workflow and Chat System">
<meta property="og:url" content="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="System OverviewThe FinTech AI Workflow and Chat System represents a cutting-edge approach to automated lending processes, combining traditional workflow engines with AI-powered decision-making capabil">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-07-02T09:39:48.000Z">
<meta property="article:modified_time" content="2025-07-03T08:32:17.477Z">
<meta property="article:author" content="Charlie Feng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/","path":"2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/","title":"Design FinTech AI Workflow and Chat System"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Design FinTech AI Workflow and Chat System | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#System-Overview"><span class="nav-number">1.</span> <span class="nav-text">System Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Architecture-Diagram"><span class="nav-number">1.1.</span> <span class="nav-text">Architecture Diagram</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-Components-Deep-Dive"><span class="nav-number">2.</span> <span class="nav-text">Core Components Deep Dive</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WorkflowEngineService-Traditional-Foundation"><span class="nav-number">2.1.</span> <span class="nav-text">WorkflowEngineService - Traditional Foundation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Three-Stage-Review-Process"><span class="nav-number">2.1.1.</span> <span class="nav-text">Three-Stage Review Process</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AIWorkflowEngineService-AI-Powered-Enhancement"><span class="nav-number">2.2.</span> <span class="nav-text">AIWorkflowEngineService - AI-Powered Enhancement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ReAct-Pattern-Implementation"><span class="nav-number">2.3.</span> <span class="nav-text">ReAct Pattern Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RAG-Based-Knowledge-Management"><span class="nav-number">2.4.</span> <span class="nav-text">RAG-Based Knowledge Management</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Infrastructure-Components"><span class="nav-number">3.</span> <span class="nav-text">Infrastructure Components</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Higress-AI-Gateway-with-Multi-Model-Load-Balancing"><span class="nav-number">3.1.</span> <span class="nav-text">Higress AI Gateway with Multi-Model Load Balancing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mem0-Context-Memory-Integration"><span class="nav-number">3.2.</span> <span class="nav-text">Mem0 Context Memory Integration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nacos-Configuration-Management"><span class="nav-number">3.3.</span> <span class="nav-text">Nacos Configuration Management</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chat-System-Implementation"><span class="nav-number">4.</span> <span class="nav-text">Chat System Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WebSocket-Chat-Handler"><span class="nav-number">4.1.</span> <span class="nav-text">WebSocket Chat Handler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multi-Modal-Message-Processing"><span class="nav-number">4.2.</span> <span class="nav-text">Multi-Modal Message Processing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Optimization-and-Scalability"><span class="nav-number">5.</span> <span class="nav-text">Performance Optimization and Scalability</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Context-Caching-Strategy"><span class="nav-number">5.1.</span> <span class="nav-text">Context Caching Strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Concurrent-Request-Handling"><span class="nav-number">5.2.</span> <span class="nav-text">Concurrent Request Handling</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Real-World-Use-Cases"><span class="nav-number">6.</span> <span class="nav-text">Real-World Use Cases</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-1-Intelligent-Document-Processing"><span class="nav-number">6.1.</span> <span class="nav-text">Use Case 1: Intelligent Document Processing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-2-Conversational-Loan-Application"><span class="nav-number">6.2.</span> <span class="nav-text">Use Case 2: Conversational Loan Application</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-and-Compliance"><span class="nav-number">7.</span> <span class="nav-text">Security and Compliance</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-Privacy-and-Encryption"><span class="nav-number">7.1.</span> <span class="nav-text">Data Privacy and Encryption</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rate-Limiting-and-Abuse-Prevention"><span class="nav-number">7.2.</span> <span class="nav-text">Rate Limiting and Abuse Prevention</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Monitoring-and-Observability"><span class="nav-number">8.</span> <span class="nav-text">Monitoring and Observability</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Comprehensive-Metrics-Collection"><span class="nav-number">8.1.</span> <span class="nav-text">Comprehensive Metrics Collection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Production-Best-Practices-and-Lessons-Learned"><span class="nav-number">9.</span> <span class="nav-text">Production Best Practices and Lessons Learned</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Circuit-Breaker-Implementation"><span class="nav-number">9.1.</span> <span class="nav-text">Circuit Breaker Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-Handling-and-Recovery"><span class="nav-number">9.2.</span> <span class="nav-text">Error Handling and Recovery</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interview-Questions-and-Technical-Insights"><span class="nav-number">10.</span> <span class="nav-text">Interview Questions and Technical Insights</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#External-Resources-and-References"><span class="nav-number">11.</span> <span class="nav-text">External Resources and References</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-Implementation-Patterns"><span class="nav-number">12.</span> <span class="nav-text">Advanced Implementation Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MCP-Server-Integration-for-Specialized-Agents"><span class="nav-number">12.1.</span> <span class="nav-text">MCP Server Integration for Specialized Agents</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Advanced-RAG-Pipeline-with-Financial-Domain-Optimization"><span class="nav-number">12.2.</span> <span class="nav-text">Advanced RAG Pipeline with Financial Domain Optimization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conversation-Flow-Management-with-State-Machines"><span class="nav-number">12.3.</span> <span class="nav-text">Conversation Flow Management with State Machines</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multi-Modal-Document-Processing"><span class="nav-number">12.4.</span> <span class="nav-text">Multi-Modal Document Processing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-Time-Fraud-Detection-Integration"><span class="nav-number">12.5.</span> <span class="nav-text">Real-Time Fraud Detection Integration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Advanced-Monitoring-and-Alerting"><span class="nav-number">12.6.</span> <span class="nav-text">Advanced Monitoring and Alerting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Performance-Optimization-Strategies"><span class="nav-number">12.7.</span> <span class="nav-text">Performance Optimization Strategies</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion-and-Future-Roadmap"><span class="nav-number">13.</span> <span class="nav-text">Conclusion and Future Roadmap</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Success-Factors"><span class="nav-number">13.1.</span> <span class="nav-text">Key Success Factors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Performance-Achievements"><span class="nav-number">13.2.</span> <span class="nav-text">Performance Achievements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Future-Enhancement-Opportunities"><span class="nav-number">13.3.</span> <span class="nav-text">Future Enhancement Opportunities</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Design FinTech AI Workflow and Chat System | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Design FinTech AI Workflow and Chat System
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-07-02 17:39:48" itemprop="dateCreated datePublished" datetime="2025-07-02T17:39:48+08:00">2025-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-07-03 16:32:17" itemprop="dateModified" datetime="2025-07-03T16:32:17+08:00">2025-07-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="System-Overview"><a href="#System-Overview" class="headerlink" title="System Overview"></a>System Overview</h2><p>The FinTech AI Workflow and Chat System represents a cutting-edge approach to automated lending processes, combining traditional workflow engines with AI-powered decision-making capabilities. The system orchestrates multiple microservices to provide automated loan processing, intelligent customer service, and real-time decision support. It revolutionizes personal loan processing through intelligent automation while maintaining compliance and risk management standards.</p>
<h3 id="Architecture-Diagram"><a href="#Architecture-Diagram" class="headerlink" title="Architecture Diagram"></a>Architecture Diagram</h3><pre>
<code class="mermaid">
flowchart TB
subgraph &quot;Frontend Layer&quot;
    UI[ChatWebUI]
    UI --&gt; |Text&#x2F;Files&#x2F;Audio| Gateway
end

subgraph &quot;API Gateway Layer&quot;
    Gateway[Higress AI Gateway]
    Gateway --&gt; |Load Balance| LLM1[LLM Provider 1]
    Gateway --&gt; |Load Balance| LLM2[LLM Provider 2]
    Gateway --&gt; |Load Balance| LLM3[LLM Provider 3]
end

subgraph &quot;AI Engine Layer&quot;
    AIWorkflow[AIWorkflowEngineService]
    KnowledgeBase[KnowledgeBaseService]
    Classifier[ReAct Question Classifier]
end

subgraph &quot;Traditional Services&quot;
    Workflow[WorkflowEngineService]
    RuleEngine[Rule Engine]
end

subgraph &quot;External Systems&quot;
    BankCredit[BankCreditSystem]
    Tax[TaxSystem]
    SocialSecurity[SocialSecuritySystem]
end

subgraph &quot;Infrastructure&quot;
    Nacos[Nacos Config Center]
    Mem0[Mem0 Context Memory]
    RAG[RAG PDF Parser]
    MCP[MCP Server Agents]
end

Gateway --&gt; AIWorkflow
Gateway --&gt; KnowledgeBase
AIWorkflow --&gt; Classifier
AIWorkflow --&gt; Workflow
Workflow --&gt; RuleEngine
Workflow --&gt; BankCredit
Workflow --&gt; Tax
Workflow --&gt; SocialSecurity
KnowledgeBase --&gt; RAG
AIWorkflow --&gt; Nacos
AIWorkflow --&gt; Mem0
AIWorkflow --&gt; MCP
</code>
</pre>

<h2 id="Core-Components-Deep-Dive"><a href="#Core-Components-Deep-Dive" class="headerlink" title="Core Components Deep Dive"></a>Core Components Deep Dive</h2><h3 id="WorkflowEngineService-Traditional-Foundation"><a href="#WorkflowEngineService-Traditional-Foundation" class="headerlink" title="WorkflowEngineService - Traditional Foundation"></a>WorkflowEngineService - Traditional Foundation</h3><p>The <strong>WorkflowEngineService</strong> serves as the backbone of the lending process, implementing a three-stage review pipeline that ensures thorough evaluation of personal loan applications.</p>
<h4 id="Three-Stage-Review-Process"><a href="#Three-Stage-Review-Process" class="headerlink" title="Three-Stage Review Process"></a>Three-Stage Review Process</h4><pre>
<code class="mermaid">
stateDiagram-v2
[*] --&gt; InitialReview
InitialReview --&gt; Review : Pass Basic Checks
InitialReview --&gt; Rejected : Fail Basic Checks
Review --&gt; FinalReview : Score &gt;&#x3D; Threshold
Review --&gt; Rejected : Score &lt; Threshold
FinalReview --&gt; Approved : Final Validation Pass
FinalReview --&gt; Rejected : Final Validation Fail
Approved --&gt; [*]
Rejected --&gt; [*]
</code>
</pre>

<p><strong>Implementation Example:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkflowEngineService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BankCreditSystemClient creditClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaxSystemClient taxClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SocialSecuritySystemClient ssClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuleEngineService ruleEngine;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> LoanApplicationResult <span class="title function_">processLoanApplication</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Stage 1: Initial Review</span></span><br><span class="line">            <span class="type">InitialReviewResult</span> <span class="variable">initialResult</span> <span class="operator">=</span> performInitialReview(application);</span><br><span class="line">            <span class="keyword">if</span> (!initialResult.isPassed()) &#123;</span><br><span class="line">                <span class="keyword">return</span> LoanApplicationResult.rejected(<span class="string">&quot;Failed initial review&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Stage 2: Comprehensive Review</span></span><br><span class="line">            <span class="type">ReviewResult</span> <span class="variable">reviewResult</span> <span class="operator">=</span> performComprehensiveReview(application);</span><br><span class="line">            <span class="keyword">if</span> (!reviewResult.isPassed()) &#123;</span><br><span class="line">                <span class="keyword">return</span> LoanApplicationResult.rejected(<span class="string">&quot;Failed comprehensive review&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Stage 3: Final Review and Decision</span></span><br><span class="line">            <span class="type">FinalReviewResult</span> <span class="variable">finalResult</span> <span class="operator">=</span> performFinalReview(application, reviewResult);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> LoanApplicationResult.approved(finalResult.getApprovedAmount());</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Error processing loan application: &#123;&#125;&quot;</span>, application.getId(), e);</span><br><span class="line">            <span class="keyword">return</span> LoanApplicationResult.error(<span class="string">&quot;System error occurred&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> InitialReviewResult <span class="title function_">performInitialReview</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="comment">// Basic validation and preliminary scoring</span></span><br><span class="line">        <span class="type">ValidationResult</span> <span class="variable">validation</span> <span class="operator">=</span> validateBasicInfo(application);</span><br><span class="line">        <span class="keyword">if</span> (!validation.isValid()) &#123;</span><br><span class="line">            <span class="keyword">return</span> InitialReviewResult.failed(validation.getErrors());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Quick credit check</span></span><br><span class="line">        <span class="type">CreditScore</span> <span class="variable">quickScore</span> <span class="operator">=</span> creditClient.getQuickCreditScore(application.getSsn());</span><br><span class="line">        <span class="keyword">if</span> (quickScore.getScore() &lt; <span class="number">500</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> InitialReviewResult.failed(<span class="string">&quot;Credit score too low&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> InitialReviewResult.passed();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ReviewResult <span class="title function_">performComprehensiveReview</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        CompletableFuture&lt;CreditReport&gt; creditFuture = </span><br><span class="line">            CompletableFuture.supplyAsync(() -&gt; creditClient.getFullCreditReport(application.getSsn()));</span><br><span class="line">        </span><br><span class="line">        CompletableFuture&lt;TaxRecord&gt; taxFuture = </span><br><span class="line">            CompletableFuture.supplyAsync(() -&gt; taxClient.getTaxRecord(application.getSsn()));</span><br><span class="line">        </span><br><span class="line">        CompletableFuture&lt;SocialSecurityRecord&gt; ssFuture = </span><br><span class="line">            CompletableFuture.supplyAsync(() -&gt; ssClient.getRecord(application.getSsn()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            CompletableFuture.allOf(creditFuture, taxFuture, ssFuture).join();</span><br><span class="line">            </span><br><span class="line">            <span class="type">CreditReport</span> <span class="variable">creditReport</span> <span class="operator">=</span> creditFuture.get();</span><br><span class="line">            <span class="type">TaxRecord</span> <span class="variable">taxRecord</span> <span class="operator">=</span> taxFuture.get();</span><br><span class="line">            <span class="type">SocialSecurityRecord</span> <span class="variable">ssRecord</span> <span class="operator">=</span> ssFuture.get();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Calculate comprehensive score using rule engine</span></span><br><span class="line">            <span class="type">RuleInput</span> <span class="variable">ruleInput</span> <span class="operator">=</span> RuleInput.builder()</span><br><span class="line">                .creditReport(creditReport)</span><br><span class="line">                .taxRecord(taxRecord)</span><br><span class="line">                .socialSecurityRecord(ssRecord)</span><br><span class="line">                .application(application)</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            <span class="type">RuleResult</span> <span class="variable">ruleResult</span> <span class="operator">=</span> ruleEngine.evaluate(ruleInput);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> ReviewResult.builder()</span><br><span class="line">                .score(ruleResult.getScore())</span><br><span class="line">                .riskLevel(ruleResult.getRiskLevel())</span><br><span class="line">                .recommendations(ruleResult.getRecommendations())</span><br><span class="line">                .passed(ruleResult.getScore() &gt;= <span class="number">650</span>)</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ReviewException</span>(<span class="string">&quot;Failed to complete comprehensive review&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>Interview Insight:</strong> <em>“How would you handle external service failures in a critical lending workflow?”</em></p>
<p><strong>Answer:</strong> Implement circuit breaker patterns with Hystrix or Resilience4j, fallback mechanisms for non-critical services, and timeout configurations. For critical services like credit checks, implement retry logic with exponential backoff and maintain audit trails for compliance.</p>
<h3 id="AIWorkflowEngineService-AI-Powered-Enhancement"><a href="#AIWorkflowEngineService-AI-Powered-Enhancement" class="headerlink" title="AIWorkflowEngineService - AI-Powered Enhancement"></a>AIWorkflowEngineService - AI-Powered Enhancement</h3><p>The <strong>AIWorkflowEngineService</strong> leverages Spring AI framework to introduce intelligent automation while maintaining the robustness of traditional workflows.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIWorkflowEngineService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DocumentReader documentReader;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AIWorkflowEngineService</span><span class="params">(ChatClient.Builder chatClientBuilder, </span></span><br><span class="line"><span class="params">                                 VectorStore vectorStore,</span></span><br><span class="line"><span class="params">                                 DocumentReader documentReader)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClientBuilder</span><br><span class="line">            .defaultSystem(<span class="string">&quot;You are a financial loan officer with expertise in risk assessment.&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">        <span class="built_in">this</span>.vectorStore = vectorStore;</span><br><span class="line">        <span class="built_in">this</span>.documentReader = documentReader;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> LoanApplicationResult <span class="title function_">processWithAI</span><span class="params">(LoanApplication application, </span></span><br><span class="line"><span class="params">                                             List&lt;Document&gt; supportingDocs)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Stage 1: AI-Powered Document Analysis</span></span><br><span class="line">            <span class="type">DocumentAnalysisResult</span> <span class="variable">docAnalysis</span> <span class="operator">=</span> analyzeDocuments(supportingDocs);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Stage 2: Intelligent Risk Assessment</span></span><br><span class="line">            <span class="type">RiskAssessmentResult</span> <span class="variable">riskAssessment</span> <span class="operator">=</span> performAIRiskAssessment(application, docAnalysis);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Stage 3: AI Decision Making with Human Oversight</span></span><br><span class="line">            <span class="type">DecisionResult</span> <span class="variable">decision</span> <span class="operator">=</span> makeAIDecision(application, docAnalysis, riskAssessment);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> LoanApplicationResult.fromDecision(decision);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;AI workflow processing failed for application: &#123;&#125;&quot;</span>, application.getId(), e);</span><br><span class="line">            <span class="keyword">return</span> fallbackToTraditionalWorkflow(application);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> DocumentAnalysisResult <span class="title function_">analyzeDocuments</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        prompt.append(<span class="string">&quot;Analyze the following financial documents and extract key information:\n\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Document doc : documents) &#123;</span><br><span class="line">            prompt.append(<span class="string">&quot;Document Type: &quot;</span>).append(doc.getMetadata().get(<span class="string">&quot;type&quot;</span>)).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            prompt.append(<span class="string">&quot;Content: &quot;</span>).append(doc.getContent()).append(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        prompt.append(<span class="string">&quot;Please provide:\n&quot;</span>);</span><br><span class="line">        prompt.append(<span class="string">&quot;1. Income verification details\n&quot;</span>);</span><br><span class="line">        prompt.append(<span class="string">&quot;2. Employment status and stability\n&quot;</span>);</span><br><span class="line">        prompt.append(<span class="string">&quot;3. Asset information\n&quot;</span>);</span><br><span class="line">        prompt.append(<span class="string">&quot;4. Any red flags or concerns\n&quot;</span>);</span><br><span class="line">        prompt.append(<span class="string">&quot;5. Overall document quality assessment\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(prompt.toString());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> DocumentAnalysisResult.fromAIResponse(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> RiskAssessmentResult <span class="title function_">performAIRiskAssessment</span><span class="params">(LoanApplication application, </span></span><br><span class="line"><span class="params">                                                       DocumentAnalysisResult docAnalysis)</span> &#123;</span><br><span class="line">        <span class="comment">// Retrieve similar cases from vector database</span></span><br><span class="line">        List&lt;Document&gt; similarCases = vectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(application.toSearchableText()).withTopK(<span class="number">5</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Based on the loan application and document analysis, perform a comprehensive risk assessment:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Application Details:</span></span><br><span class="line"><span class="string">            - Requested Amount: $%,.2f</span></span><br><span class="line"><span class="string">            - Purpose: %s</span></span><br><span class="line"><span class="string">            - Credit Score: %d</span></span><br><span class="line"><span class="string">            - Annual Income: $%,.2f</span></span><br><span class="line"><span class="string">            - Employment: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Document Analysis Results:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Similar Historical Cases:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Provide:</span></span><br><span class="line"><span class="string">            1. Risk score (0-100, where 0 is lowest risk)</span></span><br><span class="line"><span class="string">            2. Primary risk factors</span></span><br><span class="line"><span class="string">            3. Mitigation strategies</span></span><br><span class="line"><span class="string">            4. Recommended loan terms</span></span><br><span class="line"><span class="string">            5. Decision confidence level</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>,</span><br><span class="line">            application.getRequestedAmount(),</span><br><span class="line">            application.getPurpose(),</span><br><span class="line">            application.getCreditScore(),</span><br><span class="line">            application.getAnnualIncome(),</span><br><span class="line">            application.getEmploymentStatus(),</span><br><span class="line">            docAnalysis.getSummary(),</span><br><span class="line">            formatSimilarCases(similarCases)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(prompt);</span><br><span class="line">        <span class="keyword">return</span> RiskAssessmentResult.fromAIResponse(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Interview Question</strong>: <em>“How do you ensure AI decisions in financial lending are explainable and compliant with regulations?”</em></p>
<p><strong>Answer</strong>: Implement explainable AI techniques by maintaining decision audit trails, using rule-based systems alongside ML models, storing reasoning chains from LLM responses, implementing LIME&#x2F;SHAP for model interpretability, and creating human-readable decision summaries. Always maintain human oversight for final decisions and log all AI reasoning steps for compliance audits.</p>
<h3 id="ReAct-Pattern-Implementation"><a href="#ReAct-Pattern-Implementation" class="headerlink" title="ReAct Pattern Implementation"></a>ReAct Pattern Implementation</h3><p>The ReAct (Reasoning + Acting) pattern enables the system to make decisions through structured reasoning, inspired by LangGraph workflows.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReActLoanProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Tool&gt; availableTools;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ActionPlanner actionPlanner;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> LoanDecision <span class="title function_">processWithReAct</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="type">ReActState</span> <span class="variable">state</span> <span class="operator">=</span> ReActState.initial(application);</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxIterations</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">iteration</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (!state.isTerminal() &amp;&amp; iteration &lt; maxIterations) &#123;</span><br><span class="line">            iteration++;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Thought: Analyze current situation</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">thought</span> <span class="operator">=</span> generateThought(state);</span><br><span class="line">            state.addThought(thought);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Action: Decide what to do next</span></span><br><span class="line">            <span class="type">Action</span> <span class="variable">action</span> <span class="operator">=</span> selectAction(state, thought);</span><br><span class="line">            state.addAction(action);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Execute action and get observation</span></span><br><span class="line">            <span class="type">ActionResult</span> <span class="variable">result</span> <span class="operator">=</span> executeAction(action, state);</span><br><span class="line">            state.addObservation(result);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Update state based on observation</span></span><br><span class="line">            state = updateState(state, result);</span><br><span class="line">            </span><br><span class="line">            log.info(<span class="string">&quot;ReAct iteration &#123;&#125;: Thought: &#123;&#125;, Action: &#123;&#125;, Result: &#123;&#125;&quot;</span>,</span><br><span class="line">                iteration, thought, action.getType(), result.isSuccess());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> generateFinalDecision(state);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateThought</span><span class="params">(ReActState state)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Current loan application analysis state:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Application Details:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Previous Thoughts and Actions:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Available Information:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Think step by step about what information is still needed to make a loan decision.</span></span><br><span class="line"><span class="string">            What should be the next logical step in the analysis process?</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Provide your reasoning in 2-3 sentences.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>,</span><br><span class="line">            state.getApplication().getSummary(),</span><br><span class="line">            formatPreviousSteps(state),</span><br><span class="line">            formatAvailableInfo(state)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chatClient.call(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Action <span class="title function_">selectAction</span><span class="params">(ReActState state, String thought)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Based on the following analysis:</span></span><br><span class="line"><span class="string">            Thought: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Current State: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Available Actions:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Select the most appropriate action to take next. Return only the action name and parameters.</span></span><br><span class="line"><span class="string">            Format: ACTION_NAME(parameter1=value1, parameter2=value2)</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>,</span><br><span class="line">            thought,</span><br><span class="line">            state.getCurrentStatus(),</span><br><span class="line">            formatAvailableActions()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">actionString</span> <span class="operator">=</span> chatClient.call(prompt);</span><br><span class="line">        <span class="keyword">return</span> parseAction(actionString);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ActionResult <span class="title function_">executeAction</span><span class="params">(Action action, ReActState state)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (action.getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> CHECK_CREDIT_SCORE:</span><br><span class="line">                <span class="keyword">return</span> checkCreditScore(action.getParameter(<span class="string">&quot;ssn&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">case</span> VERIFY_INCOME:</span><br><span class="line">                <span class="keyword">return</span> verifyIncome(</span><br><span class="line">                    action.getParameter(<span class="string">&quot;employer&quot;</span>),</span><br><span class="line">                    action.getParameter(<span class="string">&quot;claimed_income&quot;</span>)</span><br><span class="line">                );</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">case</span> ASSESS_DEBT_TO_INCOME:</span><br><span class="line">                <span class="keyword">return</span> assessDebtToIncome(state.getApplication());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">case</span> CHECK_EMPLOYMENT_HISTORY:</span><br><span class="line">                <span class="keyword">return</span> checkEmploymentHistory(</span><br><span class="line">                    action.getParameter(<span class="string">&quot;ssn&quot;</span>),</span><br><span class="line">                    Integer.parseInt(action.getParameter(<span class="string">&quot;years&quot;</span>))</span><br><span class="line">                );</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">case</span> CALCULATE_RISK_SCORE:</span><br><span class="line">                <span class="keyword">return</span> calculateRiskScore(state);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">case</span> MAKE_DECISION:</span><br><span class="line">                <span class="keyword">return</span> makeDecision(state);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> ActionResult.error(<span class="string">&quot;Unknown action: &quot;</span> + action.getType());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ActionResult <span class="title function_">checkCreditScore</span><span class="params">(String ssn)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">CreditReport</span> <span class="variable">report</span> <span class="operator">=</span> creditService.getFullReport(ssn);</span><br><span class="line">            <span class="keyword">return</span> ActionResult.success(</span><br><span class="line">                String.format(<span class="string">&quot;Credit score: %d, Payment history: %s, Credit utilization: %.1f%%&quot;</span>,</span><br><span class="line">                    report.getScore(),</span><br><span class="line">                    report.getPaymentHistory(),</span><br><span class="line">                    report.getCreditUtilization() * <span class="number">100</span>)</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ActionResult.error(<span class="string">&quot;Failed to retrieve credit score: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> LoanDecision <span class="title function_">generateFinalDecision</span><span class="params">(ReActState state)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Based on the complete analysis performed:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Application: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Analysis Steps Taken:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Information Gathered:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Please provide a final loan decision with:</span></span><br><span class="line"><span class="string">            1. Decision (APPROVED/REJECTED/NEEDS_REVIEW)</span></span><br><span class="line"><span class="string">            2. Approved amount (if applicable)</span></span><br><span class="line"><span class="string">            3. Interest rate recommendation</span></span><br><span class="line"><span class="string">            4. Key decision factors</span></span><br><span class="line"><span class="string">            5. Risk mitigation requirements</span></span><br><span class="line"><span class="string">            6. Confidence level (1-10)</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Format as JSON.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>,</span><br><span class="line">            state.getApplication().getSummary(),</span><br><span class="line">            formatAnalysisSteps(state),</span><br><span class="line">            formatGatheredInfo(state)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">decisionJson</span> <span class="operator">=</span> chatClient.call(prompt);</span><br><span class="line">        <span class="keyword">return</span> LoanDecision.fromJson(decisionJson);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RAG-Based-Knowledge-Management"><a href="#RAG-Based-Knowledge-Management" class="headerlink" title="RAG-Based Knowledge Management"></a>RAG-Based Knowledge Management</h3><p>The <strong>KnowledgeBaseService</strong> implements Retrieval-Augmented Generation for financial domain expertise.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KnowledgeBaseService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorStore vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DocumentProcessor documentProcessor;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ChatResponse <span class="title function_">answerFinancialQuestion</span><span class="params">(String question, ConversationHistory history)</span> &#123;</span><br><span class="line">        <span class="comment">// Retrieve relevant documents</span></span><br><span class="line">        List&lt;Document&gt; relevantDocs = vectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(question).withTopK(<span class="number">5</span>).withSimilarityThreshold(<span class="number">0.7</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// Construct RAG prompt</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">context</span> <span class="operator">=</span> relevantDocs.stream()</span><br><span class="line">            .map(Document::getContent)</span><br><span class="line">            .collect(Collectors.joining(<span class="string">&quot;\n\n&quot;</span>));</span><br><span class="line">            </span><br><span class="line">        <span class="type">String</span> <span class="variable">ragPrompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            You are a financial expert assistant. Use the following context to answer the question.</span></span><br><span class="line"><span class="string">            If the context doesn&#x27;t contain relevant information, clearly state that.</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Context:</span></span><br><span class="line"><span class="string">            &#123;context&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Question: &#123;question&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Conversation History:</span></span><br><span class="line"><span class="string">            &#123;history&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Answer:</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> chatClient.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(ragPrompt</span><br><span class="line">            .replace(<span class="string">&quot;&#123;context&#125;&quot;</span>, context)</span><br><span class="line">            .replace(<span class="string">&quot;&#123;question&#125;&quot;</span>, question)</span><br><span class="line">            .replace(<span class="string">&quot;&#123;history&#125;&quot;</span>, history.toString())</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDocumentUploaded</span><span class="params">(DocumentUploadedEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Process PDF and extract structured data</span></span><br><span class="line">            <span class="type">ProcessedDocument</span> <span class="variable">processed</span> <span class="operator">=</span> documentProcessor.processPDF(event.getDocument());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Convert to vector embeddings and store</span></span><br><span class="line">            List&lt;Document&gt; chunks = chunkDocument(processed);</span><br><span class="line">            vectorStore.add(chunks);</span><br><span class="line">            </span><br><span class="line">            log.info(<span class="string">&quot;Added &#123;&#125; chunks to knowledge base&quot;</span>, chunks.size());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to process uploaded document&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PDF Processing and Document Ingestion.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentIngestionService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DocumentReader pdfReader;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TextSplitter textSplitter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EmbeddingClient embeddingClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ingestFinancialDocuments</span><span class="params">(List&lt;String&gt; documentPaths)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String path : documentPaths) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                processDocument(path);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Failed to process document: &#123;&#125;&quot;</span>, path, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processDocument</span><span class="params">(String documentPath)</span> &#123;</span><br><span class="line">        <span class="comment">// Step 1: Extract text from PDF</span></span><br><span class="line">        List&lt;Document&gt; rawDocuments = pdfReader.read(documentPath);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 2: Clean and preprocess text</span></span><br><span class="line">        List&lt;Document&gt; cleanedDocuments = rawDocuments.stream()</span><br><span class="line">            .map(<span class="built_in">this</span>::cleanDocument)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 3: Split into chunks with overlap</span></span><br><span class="line">        List&lt;Document&gt; chunks = textSplitter.apply(cleanedDocuments);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 4: Enhance with metadata</span></span><br><span class="line">        List&lt;Document&gt; enhancedChunks = chunks.stream()</span><br><span class="line">            .map(chunk -&gt; enhanceWithMetadata(chunk, documentPath))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 5: Generate embeddings and store</span></span><br><span class="line">        vectorStore.add(enhancedChunks);</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;Successfully ingested document: &#123;&#125; with &#123;&#125; chunks&quot;</span>, </span><br><span class="line">                documentPath, enhancedChunks.size());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Document <span class="title function_">enhanceWithMetadata</span><span class="params">(Document chunk, String documentPath)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; metadata = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(chunk.getMetadata());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add document classification</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">documentType</span> <span class="operator">=</span> classifyDocument(chunk.getContent());</span><br><span class="line">        metadata.put(<span class="string">&quot;document_type&quot;</span>, documentType);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add financial domain tags</span></span><br><span class="line">        List&lt;String&gt; financialTags = extractFinancialTags(chunk.getContent());</span><br><span class="line">        metadata.put(<span class="string">&quot;financial_tags&quot;</span>, financialTags);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add compliance level</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">complianceLevel</span> <span class="operator">=</span> determineComplianceLevel(chunk.getContent());</span><br><span class="line">        metadata.put(<span class="string">&quot;compliance_level&quot;</span>, complianceLevel);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add source information</span></span><br><span class="line">        metadata.put(<span class="string">&quot;source_path&quot;</span>, documentPath);</span><br><span class="line">        metadata.put(<span class="string">&quot;ingestion_timestamp&quot;</span>, Instant.now().toString());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Document.builder()</span><br><span class="line">            .content(chunk.getContent())</span><br><span class="line">            .metadata(metadata)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Infrastructure-Components"><a href="#Infrastructure-Components" class="headerlink" title="Infrastructure Components"></a>Infrastructure Components</h2><h3 id="Higress-AI-Gateway-with-Multi-Model-Load-Balancing"><a href="#Higress-AI-Gateway-with-Multi-Model-Load-Balancing" class="headerlink" title="Higress AI Gateway with Multi-Model Load Balancing"></a>Higress AI Gateway with Multi-Model Load Balancing</h3><p>The AI Gateway serves as the intelligent routing and enhancement layer, providing crucial production features like load balancing, content filtering, and prompt optimization.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Higress Configuration</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.higress.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ai-gateway-config</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">HTTP_FILTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">SIDECAR_INBOUND</span></span><br><span class="line">      <span class="attr">listener:</span></span><br><span class="line">        <span class="attr">filterChain:</span></span><br><span class="line">          <span class="attr">filter:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">&quot;envoy.filters.network.http_connection_manager&quot;</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">INSERT_BEFORE</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">envoy.filters.http.wasm</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="attr">&quot;@type&quot;:</span> <span class="string">type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">&quot;ai-gateway&quot;</span></span><br><span class="line">            <span class="attr">root_id:</span> <span class="string">&quot;ai-gateway&quot;</span></span><br><span class="line">            <span class="attr">configuration:</span></span><br><span class="line">              <span class="attr">&quot;@type&quot;:</span> <span class="string">type.googleapis.com/google.protobuf.StringValue</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                  &quot;providers&quot;: [</span></span><br><span class="line"><span class="string">                    &#123;</span></span><br><span class="line"><span class="string">                      &quot;name&quot;: &quot;openai&quot;,</span></span><br><span class="line"><span class="string">                      &quot;endpoint&quot;: &quot;https://api.openai.com/v1&quot;,</span></span><br><span class="line"><span class="string">                      &quot;weight&quot;: 40,</span></span><br><span class="line"><span class="string">                      &quot;models&quot;: [&quot;gpt-4&quot;, &quot;gpt-3.5-turbo&quot;]</span></span><br><span class="line"><span class="string">                    &#125;,</span></span><br><span class="line"><span class="string">                    &#123;</span></span><br><span class="line"><span class="string">                      &quot;name&quot;: &quot;anthropic&quot;,</span></span><br><span class="line"><span class="string">                      &quot;endpoint&quot;: &quot;https://api.anthropic.com/v1&quot;,</span></span><br><span class="line"><span class="string">                      &quot;weight&quot;: 30,</span></span><br><span class="line"><span class="string">                      &quot;models&quot;: [&quot;claude-3-opus&quot;, &quot;claude-3-sonnet&quot;]</span></span><br><span class="line"><span class="string">                    &#125;,</span></span><br><span class="line"><span class="string">                    &#123;</span></span><br><span class="line"><span class="string">                      &quot;name&quot;: &quot;local-llm&quot;,</span></span><br><span class="line"><span class="string">                      &quot;endpoint&quot;: &quot;http://local-llm-service:8080/v1&quot;,</span></span><br><span class="line"><span class="string">                      &quot;weight&quot;: 30,</span></span><br><span class="line"><span class="string">                      &quot;models&quot;: [&quot;llama-2-70b&quot;, &quot;mistral-7b&quot;]</span></span><br><span class="line"><span class="string">                    &#125;</span></span><br><span class="line"><span class="string">                  ],</span></span><br><span class="line"><span class="string">                  &quot;load_balancing&quot;: &quot;weighted_round_robin&quot;,</span></span><br><span class="line"><span class="string">                  &quot;health_check&quot;: &#123;</span></span><br><span class="line"><span class="string">                    &quot;interval&quot;: &quot;30s&quot;,</span></span><br><span class="line"><span class="string">                    &quot;timeout&quot;: &quot;5s&quot;</span></span><br><span class="line"><span class="string">                  &#125;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Mem0-Context-Memory-Integration"><a href="#Mem0-Context-Memory-Integration" class="headerlink" title="Mem0 Context Memory Integration"></a>Mem0 Context Memory Integration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextMemoryService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Mem0Client mem0Client;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">storeConversationContext</span><span class="params">(String userId, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MemoryRecord</span> <span class="variable">record</span> <span class="operator">=</span> MemoryRecord.builder()</span><br><span class="line">                .userId(userId)</span><br><span class="line">                .sessionId(context.getSessionId())</span><br><span class="line">                .content(context.toJson())</span><br><span class="line">                .metadata(Map.of(</span><br><span class="line">                    <span class="string">&quot;timestamp&quot;</span>, Instant.now().toString(),</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>, <span class="string">&quot;conversation_context&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;loan_application_id&quot;</span>, context.getLoanApplicationId()</span><br><span class="line">                ))</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">            mem0Client.store(record);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to store conversation context&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ConversationContext <span class="title function_">retrieveContext</span><span class="params">(String userId, String sessionId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;MemoryRecord&gt; records = mem0Client.search(</span><br><span class="line">                SearchQuery.builder()</span><br><span class="line">                    .userId(userId)</span><br><span class="line">                    .sessionId(sessionId)</span><br><span class="line">                    .type(<span class="string">&quot;conversation_context&quot;</span>)</span><br><span class="line">                    .limit(<span class="number">10</span>)</span><br><span class="line">                    .build()</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> reconstructContext(records);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to retrieve conversation context&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> ConversationContext.empty();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Nacos-Configuration-Management"><a href="#Nacos-Configuration-Management" class="headerlink" title="Nacos Configuration Management"></a>Nacos Configuration Management</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;ai.prompts&quot;)</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromptTemplateService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NacosValue(value = &quot;$&#123;ai.prompts.document-analysis&#125;&quot;, autoRefreshed = true)</span></span><br><span class="line">    <span class="keyword">private</span> String documentAnalysisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NacosValue(value = &quot;$&#123;ai.prompts.risk-assessment&#125;&quot;, autoRefreshed = true)</span></span><br><span class="line">    <span class="keyword">private</span> String riskAssessmentTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NacosValue(value = &quot;$&#123;ai.prompts.customer-service&#125;&quot;, autoRefreshed = true)</span></span><br><span class="line">    <span class="keyword">private</span> String customerServiceTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTemplate</span><span class="params">(String templateName)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (templateName) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;document-analysis&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> documentAnalysisTemplate;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;risk-assessment&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> riskAssessmentTemplate;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;customer-service&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> customerServiceTemplate;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unknown template: &quot;</span> + templateName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onConfigChange</span><span class="params">(ConfigChangeEvent event)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Prompt template updated: &#123;&#125;&quot;</span>, event.getPropertyName());</span><br><span class="line">        <span class="comment">// Templates are automatically refreshed due to @RefreshScope</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Chat-System-Implementation"><a href="#Chat-System-Implementation" class="headerlink" title="Chat System Implementation"></a>Chat System Implementation</h2><p>The ChatWebUI and supporting services provide a sophisticated conversational interface with multi-modal support.</p>
<pre>
<code class="mermaid">
sequenceDiagram
participant U as User
participant UI as ChatWebUI
participant WS as WebSocket
participant CS as ChatService
participant AI as AIWorkflowEngine
participant KB as KnowledgeBase
participant ES as External Systems

U-&gt;&gt;UI: Send message&#x2F;file
UI-&gt;&gt;WS: Establish connection
WS-&gt;&gt;CS: Route message
CS-&gt;&gt;CS: Classify intent

alt Loan Application
    CS-&gt;&gt;AI: Process application
    AI-&gt;&gt;ES: Query external systems
    ES--&gt;&gt;AI: Return data
    AI--&gt;&gt;CS: Decision result
else General Inquiry
    CS-&gt;&gt;KB: Query knowledge base
    KB--&gt;&gt;CS: Contextual response
end

CS-&gt;&gt;WS: Stream response
WS-&gt;&gt;UI: Update chat
UI-&gt;&gt;U: Display response
</code>
</pre>

<h3 id="WebSocket-Chat-Handler"><a href="#WebSocket-Chat-Handler" class="headerlink" title="WebSocket Chat Handler"></a>WebSocket Chat Handler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatWebSocketHandler</span> <span class="keyword">extends</span> <span class="title class_">TextWebSocketHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatService chatService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SessionManager sessionManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MessageQueue messageQueue;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> extractUserId(session);</span><br><span class="line">        sessionManager.registerSession(userId, session);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Send welcome message with capabilities</span></span><br><span class="line">        <span class="type">WelcomeMessage</span> <span class="variable">welcome</span> <span class="operator">=</span> WelcomeMessage.builder()</span><br><span class="line">            .capabilities(Arrays.asList(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;file_upload&quot;</span>, <span class="string">&quot;voice&quot;</span>, <span class="string">&quot;loan_application&quot;</span>))</span><br><span class="line">            .suggestedActions(getSuggestedActions(userId))</span><br><span class="line">            .build();</span><br><span class="line">        </span><br><span class="line">        sendMessage(session, welcome);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">handleTextMessage</span><span class="params">(WebSocketSession session, TextMessage message)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ChatMessage</span> <span class="variable">chatMessage</span> <span class="operator">=</span> objectMapper.readValue(message.getPayload(), ChatMessage.class);</span><br><span class="line">            <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> sessionManager.getUserId(session);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Add to processing queue for async handling</span></span><br><span class="line">            messageQueue.enqueue(MessageTask.builder()</span><br><span class="line">                .userId(userId)</span><br><span class="line">                .sessionId(session.getId())</span><br><span class="line">                .message(chatMessage)</span><br><span class="line">                .timestamp(Instant.now())</span><br><span class="line">                .build());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Send immediate acknowledgment</span></span><br><span class="line">            sendMessage(session, AckMessage.received(chatMessage.getId()));</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Error handling message&quot;</span>, e);</span><br><span class="line">            sendMessage(session, ErrorMessage.processingError());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleChatResponse</span><span class="params">(ChatResponseEvent event)</span> &#123;</span><br><span class="line">        <span class="type">WebSocketSession</span> <span class="variable">session</span> <span class="operator">=</span> sessionManager.getSession(event.getUserId());</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="literal">null</span> &amp;&amp; session.isOpen()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sendMessage(session, event.getResponse());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Failed to send response to user: &#123;&#125;&quot;</span>, event.getUserId(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Multi-Modal-Message-Processing"><a href="#Multi-Modal-Message-Processing" class="headerlink" title="Multi-Modal Message Processing"></a>Multi-Modal Message Processing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiModalChatService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;MessageType, MessageProcessor&gt; processors;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FileStorageService fileStorage;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AudioTranscriptionService audioService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ImageAnalysisService imageService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ChatResponse <span class="title function_">processMessage</span><span class="params">(ChatMessage message)</span> &#123;</span><br><span class="line">        <span class="type">MessageProcessor</span> <span class="variable">processor</span> <span class="operator">=</span> processors.get(message.getType());</span><br><span class="line">        <span class="keyword">if</span> (processor == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedMessageTypeException</span>(message.getType());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> processor.process(message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Component</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FileMessageProcessor</span> <span class="keyword">implements</span> <span class="title class_">MessageProcessor</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> ChatResponse <span class="title function_">process</span><span class="params">(ChatMessage message)</span> &#123;</span><br><span class="line">            <span class="type">FileMessage</span> <span class="variable">fileMessage</span> <span class="operator">=</span> (FileMessage) message;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileUrl</span> <span class="operator">=</span> fileMessage.getFileUrl();</span><br><span class="line">            <span class="type">String</span> <span class="variable">mimeType</span> <span class="operator">=</span> fileMessage.getMimeType();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (mimeType.startsWith(<span class="string">&quot;image/&quot;</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> processImage(fileUrl, fileMessage.getText());</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mimeType.startsWith(<span class="string">&quot;audio/&quot;</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> processAudio(fileUrl);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;application/pdf&quot;</span>.equals(mimeType)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> processPDF(fileUrl, fileMessage.getText());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> ChatResponse.error(<span class="string">&quot;Unsupported file type: &quot;</span> + mimeType);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Error processing file: &#123;&#125;&quot;</span>, fileUrl, e);</span><br><span class="line">                <span class="keyword">return</span> ChatResponse.error(<span class="string">&quot;Failed to process file&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> ChatResponse <span class="title function_">processImage</span><span class="params">(String imageUrl, String userQuestion)</span> &#123;</span><br><span class="line">            <span class="type">ImageAnalysisResult</span> <span class="variable">analysis</span> <span class="operator">=</span> imageService.analyzeFinancialDocument(imageUrl);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (analysis.isFinancialDocument()) &#123;</span><br><span class="line">                <span class="comment">// Extract text and process as document</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">extractedText</span> <span class="operator">=</span> analysis.getExtractedText();</span><br><span class="line">                <span class="keyword">return</span> processExtractedFinancialData(extractedText, userQuestion);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> ChatResponse.builder()</span><br><span class="line">                    .text(<span class="string">&quot;I can see the image, but it doesn&#x27;t appear to be a financial document. &quot;</span> +</span><br><span class="line">                          <span class="string">&quot;Please upload bank statements, pay stubs, or other financial documents for loan processing.&quot;</span>)</span><br><span class="line">                    .suggestions(Arrays.asList(</span><br><span class="line">                        <span class="string">&quot;Upload bank statement&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Upload pay stub&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Ask about loan requirements&quot;</span></span><br><span class="line">                    ))</span><br><span class="line">                    .build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> ChatResponse <span class="title function_">processAudio</span><span class="params">(String audioUrl)</span> &#123;</span><br><span class="line">            <span class="type">TranscriptionResult</span> <span class="variable">transcription</span> <span class="operator">=</span> audioService.transcribe(audioUrl);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (transcription.isSuccessful()) &#123;</span><br><span class="line">                <span class="comment">// Process transcribed text as regular chat message</span></span><br><span class="line">                <span class="type">ChatMessage</span> <span class="variable">textMessage</span> <span class="operator">=</span> ChatMessage.text(transcription.getText());</span><br><span class="line">                <span class="keyword">return</span> chatService.processTextMessage(textMessage);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> ChatResponse.error(<span class="string">&quot;Unable to transcribe audio. Please try again or send a text message.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Performance-Optimization-and-Scalability"><a href="#Performance-Optimization-and-Scalability" class="headerlink" title="Performance Optimization and Scalability"></a>Performance Optimization and Scalability</h2><p>Achieving 2000+ concurrent conversations requires sophisticated caching and performance optimization strategies.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        RedisCacheManager.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> RedisCacheManager</span><br><span class="line">            .RedisCacheManagerBuilder</span><br><span class="line">            .fromConnectionFactory(redisConnectionFactory())</span><br><span class="line">            .cacheDefaults(cacheConfiguration());</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, RedisCacheConfiguration&gt; cacheConfigurations = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Different cache strategies for different data types</span></span><br><span class="line">        cacheConfigurations.put(<span class="string">&quot;user-sessions&quot;</span>, </span><br><span class="line">            RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofMinutes(<span class="number">30</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>()))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>())));</span><br><span class="line">        </span><br><span class="line">        cacheConfigurations.put(<span class="string">&quot;ai-responses&quot;</span>,</span><br><span class="line">            RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofMinutes(<span class="number">5</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>()))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>())));</span><br><span class="line">        </span><br><span class="line">        cacheConfigurations.put(<span class="string">&quot;external-api-calls&quot;</span>,</span><br><span class="line">            RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofMinutes(<span class="number">10</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>()))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>())));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> builder.withInitialCacheConfigurations(cacheConfigurations).build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory());</span><br><span class="line">        template.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        template.setValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line">        template.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        template.setHashValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedChatService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LoadingCache&lt;String, AIResponse&gt; responseCache;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OptimizedChatService</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">        <span class="built_in">this</span>.responseCache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">10000</span>)</span><br><span class="line">            .expireAfterWrite(Duration.ofMinutes(<span class="number">5</span>))</span><br><span class="line">            .recordStats()</span><br><span class="line">            .build(<span class="built_in">this</span>::generateAIResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;ai-responses&quot;, key = &quot;#request.hash()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;ChatResponse&gt; <span class="title function_">processMessageAsync</span><span class="params">(ChatRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Check L1 cache (in-memory)</span></span><br><span class="line">                <span class="type">AIResponse</span> <span class="variable">cachedResponse</span> <span class="operator">=</span> responseCache.get(request.getCacheKey());</span><br><span class="line">                <span class="keyword">if</span> (cachedResponse != <span class="literal">null</span> &amp;&amp; !cachedResponse.isExpired()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ChatResponse.fromCache(cachedResponse);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Process with AI</span></span><br><span class="line">                <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> processWithAI(request);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Store in cache for future requests</span></span><br><span class="line">                cacheResponse(request.getCacheKey(), response);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Error processing chat message&quot;</span>, e);</span><br><span class="line">                <span class="keyword">return</span> ChatResponse.error(<span class="string">&quot;Processing failed&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, asyncExecutor);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cacheResponse</span><span class="params">(String key, ChatResponse response)</span> &#123;</span><br><span class="line">        <span class="comment">// Multi-level caching strategy</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// L1: In-memory cache</span></span><br><span class="line">            responseCache.put(key, AIResponse.fromChatResponse(response));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// L2: Redis cache with longer TTL</span></span><br><span class="line">            redisTemplate.opsForValue().set(</span><br><span class="line">                <span class="string">&quot;chat:response:&quot;</span> + key, </span><br><span class="line">                response, </span><br><span class="line">                Duration.ofMinutes(<span class="number">15</span>)</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;Failed to cache response for key: &#123;&#125;&quot;</span>, key, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Context-Caching-Strategy"><a href="#Context-Caching-Strategy" class="headerlink" title="Context Caching Strategy"></a>Context Caching Strategy</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextCacheService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONTEXT_CACHE_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;ai:context:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Duration</span> <span class="variable">CACHE_TTL</span> <span class="operator">=</span> Duration.ofMinutes(<span class="number">30</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheContext</span><span class="params">(String sessionId, ProcessedContext context)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CONTEXT_CACHE_PREFIX + sessionId;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Compress context for storage efficiency</span></span><br><span class="line">        <span class="type">byte</span>[] compressed = compressionService.compress(context.toJson());</span><br><span class="line">        </span><br><span class="line">        redisTemplate.opsForValue().set(key, compressed, CACHE_TTL);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update cache statistics</span></span><br><span class="line">        meterRegistry.counter(<span class="string">&quot;context.cache.writes&quot;</span>).increment();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Optional&lt;ProcessedContext&gt; <span class="title function_">getCachedContext</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CONTEXT_CACHE_PREFIX + sessionId;</span><br><span class="line">        </span><br><span class="line">        <span class="type">byte</span>[] compressed = (<span class="type">byte</span>[]) redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span> (compressed != <span class="literal">null</span>) &#123;</span><br><span class="line">            meterRegistry.counter(<span class="string">&quot;context.cache.hits&quot;</span>).increment();</span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> compressionService.decompress(compressed);</span><br><span class="line">            <span class="keyword">return</span> Optional.of(ProcessedContext.fromJson(json));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        meterRegistry.counter(<span class="string">&quot;context.cache.misses&quot;</span>).increment();</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Concurrent-Request-Handling"><a href="#Concurrent-Request-Handling" class="headerlink" title="Concurrent Request Handling"></a>Concurrent Request Handling</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AIWorkflowEngineService aiWorkflowService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AsyncTaskExecutor asyncExecutor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/process&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;ResponseEntity&lt;ChatResponse&gt;&gt; <span class="title function_">processMessage</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> ChatRequest request,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(&quot;Session-Id&quot;)</span> String sessionId)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> CompletableFuture</span><br><span class="line">            .supplyAsync(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// Process with timeout to prevent hanging requests</span></span><br><span class="line">                    <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> aiWorkflowService</span><br><span class="line">                        .processWithTimeout(request, Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ResponseEntity.status(<span class="number">408</span>)</span><br><span class="line">                        .body(ChatResponse.timeout(<span class="string">&quot;Request timed out&quot;</span>));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;Error processing chat request&quot;</span>, e);</span><br><span class="line">                    <span class="keyword">return</span> ResponseEntity.status(<span class="number">500</span>)</span><br><span class="line">                        .body(ChatResponse.error(<span class="string">&quot;Internal server error&quot;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, asyncExecutor)</span><br><span class="line">            .exceptionally(throwable -&gt; &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Unexpected error in async processing&quot;</span>, throwable);</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.status(<span class="number">500</span>)</span><br><span class="line">                    .body(ChatResponse.error(<span class="string">&quot;System error&quot;</span>));</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Real-World-Use-Cases"><a href="#Real-World-Use-Cases" class="headerlink" title="Real-World Use Cases"></a>Real-World Use Cases</h2><h3 id="Use-Case-1-Intelligent-Document-Processing"><a href="#Use-Case-1-Intelligent-Document-Processing" class="headerlink" title="Use Case 1: Intelligent Document Processing"></a>Use Case 1: Intelligent Document Processing</h3><p><strong>Scenario:</strong> A customer uploads bank statements, pay stubs, and tax returns for loan verification.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentIntelligenceService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> DocumentProcessingResult <span class="title function_">processLoanDocuments</span><span class="params">(</span></span><br><span class="line"><span class="params">            List&lt;MultipartFile&gt; documents, </span></span><br><span class="line"><span class="params">            String applicationId)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        List&lt;ProcessedDocument&gt; processedDocs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (MultipartFile file : documents) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Extract text using OCR/PDF parsing</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">extractedText</span> <span class="operator">=</span> extractText(file);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Classify document type using AI</span></span><br><span class="line">                <span class="type">DocumentType</span> <span class="variable">type</span> <span class="operator">=</span> classifyDocument(extractedText);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Extract structured data based on document type</span></span><br><span class="line">                <span class="type">StructuredData</span> <span class="variable">data</span> <span class="operator">=</span> extractStructuredData(extractedText, type);</span><br><span class="line">                </span><br><span class="line">                processedDocs.add(ProcessedDocument.builder()</span><br><span class="line">                    .originalFilename(file.getOriginalFilename())</span><br><span class="line">                    .documentType(type)</span><br><span class="line">                    .extractedText(extractedText)</span><br><span class="line">                    .structuredData(data)</span><br><span class="line">                    .confidence(data.getConfidenceScore())</span><br><span class="line">                    .build());</span><br><span class="line">                    </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Failed to process document: &#123;&#125;&quot;</span>, file.getOriginalFilename(), e);</span><br><span class="line">                processedDocs.add(ProcessedDocument.failed(file.getOriginalFilename(), e.getMessage()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> DocumentProcessingResult.builder()</span><br><span class="line">            .applicationId(applicationId)</span><br><span class="line">            .processedDocuments(processedDocs)</span><br><span class="line">            .overallConfidence(calculateOverallConfidence(processedDocs))</span><br><span class="line">            .recommendedAction(determineRecommendedAction(processedDocs))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> DocumentType <span class="title function_">classifyDocument</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">classificationPrompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Classify the following financial document into one of these categories:</span></span><br><span class="line"><span class="string">            - BANK_STATEMENT</span></span><br><span class="line"><span class="string">            - PAY_STUB</span></span><br><span class="line"><span class="string">            - TAX_RETURN</span></span><br><span class="line"><span class="string">            - EMPLOYMENT_LETTER</span></span><br><span class="line"><span class="string">            - UTILITY_BILL</span></span><br><span class="line"><span class="string">            - OTHER</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Document content:</span></span><br><span class="line"><span class="string">            &#123;text&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Classification:</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(</span><br><span class="line">            classificationPrompt.replace(<span class="string">&quot;&#123;text&#125;&quot;</span>, text.substring(<span class="number">0</span>, Math.min(text.length(), <span class="number">2000</span>)))</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> DocumentType.valueOf(</span><br><span class="line">            response.getResult().getOutput().getContent().trim().toUpperCase()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Use-Case-2-Conversational-Loan-Application"><a href="#Use-Case-2-Conversational-Loan-Application" class="headerlink" title="Use Case 2: Conversational Loan Application"></a>Use Case 2: Conversational Loan Application</h3><p><strong>Scenario:</strong> A customer completes their loan application through natural conversation.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConversationalLoanService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoanApplicationBuilder applicationBuilder;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ChatResponse <span class="title function_">handleConversationStep</span><span class="params">(</span></span><br><span class="line"><span class="params">            String userMessage, </span></span><br><span class="line"><span class="params">            String sessionId,</span></span><br><span class="line"><span class="params">            ConversationState currentState)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Determine what information we&#x27;re trying to collect</span></span><br><span class="line">        <span class="type">ApplicationField</span> <span class="variable">targetField</span> <span class="operator">=</span> determineTargetField(currentState);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Extract information from user message</span></span><br><span class="line">        <span class="type">ExtractionResult</span> <span class="variable">extraction</span> <span class="operator">=</span> extractInformation(userMessage, targetField);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (extraction.isSuccessful()) &#123;</span><br><span class="line">            <span class="comment">// Update application with extracted information</span></span><br><span class="line">            applicationBuilder.updateField(sessionId, targetField, extraction.getValue());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Determine next step</span></span><br><span class="line">            <span class="type">ConversationStep</span> <span class="variable">nextStep</span> <span class="operator">=</span> determineNextStep(sessionId);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> generateResponse(nextStep, extraction);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Ask for clarification</span></span><br><span class="line">            <span class="keyword">return</span> generateClarificationRequest(targetField, extraction.getIssues());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ExtractionResult <span class="title function_">extractInformation</span><span class="params">(String message, ApplicationField field)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">extractionPrompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Extract &#123;field_type&#125; information from the user&#x27;s message.</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            User message: &quot;&#123;message&#125;&quot;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Field to extract: &#123;field_description&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Rules:</span></span><br><span class="line"><span class="string">            &#123;validation_rules&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Response format:</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;success&quot;: true/false,</span></span><br><span class="line"><span class="string">              &quot;value&quot;: &quot;extracted_value&quot;,</span></span><br><span class="line"><span class="string">              &quot;confidence&quot;: 0.0-1.0,</span></span><br><span class="line"><span class="string">              &quot;issues&quot;: [&quot;any issues found&quot;]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Implementation details for extraction logic</span></span><br><span class="line">        <span class="keyword">return</span> performExtraction(extractionPrompt, message, field);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Security-and-Compliance"><a href="#Security-and-Compliance" class="headerlink" title="Security and Compliance"></a>Security and Compliance</h2><h3 id="Data-Privacy-and-Encryption"><a href="#Data-Privacy-and-Encryption" class="headerlink" title="Data Privacy and Encryption"></a>Data Privacy and Encryption</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureDataService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EncryptionService encryptionService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuditService auditService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">storeSensitiveData</span><span class="params">(String userId, SensitiveData data)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Encrypt PII data before storage</span></span><br><span class="line">            <span class="type">EncryptedData</span> <span class="variable">encrypted</span> <span class="operator">=</span> encryptionService.encrypt(data.toJson());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Store with audit trail</span></span><br><span class="line">            dataRepository.save(SecureDataRecord.builder()</span><br><span class="line">                .userId(userId)</span><br><span class="line">                .encryptedData(encrypted.getEncryptedBytes())</span><br><span class="line">                .encryptionKeyId(encrypted.getKeyId())</span><br><span class="line">                .timestamp(Instant.now())</span><br><span class="line">                .build());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Log access for compliance</span></span><br><span class="line">            auditService.logDataAccess(AuditEvent.builder()</span><br><span class="line">                .userId(userId)</span><br><span class="line">                .action(<span class="string">&quot;DATA_STORE&quot;</span>)</span><br><span class="line">                .dataType(data.getType())</span><br><span class="line">                .timestamp(Instant.now())</span><br><span class="line">                .ipAddress(getCurrentUserIp())</span><br><span class="line">                .build());</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to store sensitive data&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DataSecurityException</span>(<span class="string">&quot;Failed to secure data&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Rate-Limiting-and-Abuse-Prevention"><a href="#Rate-Limiting-and-Abuse-Prevention" class="headerlink" title="Rate Limiting and Abuse Prevention"></a>Rate Limiting and Abuse Prevention</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitingFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_REQUESTS_PER_MINUTE</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RATE_LIMIT_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;rate_limit:&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, </span></span><br><span class="line"><span class="params">                        FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">String</span> <span class="variable">clientId</span> <span class="operator">=</span> getClientIdentifier(httpRequest);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (isRateLimited(clientId)) &#123;</span><br><span class="line">            <span class="type">HttpServletResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line">            httpResponse.setStatus(<span class="number">429</span>);</span><br><span class="line">            httpResponse.getWriter().write(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;Rate limit exceeded\&quot;&#125;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isRateLimited</span><span class="params">(String clientId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RATE_LIMIT_PREFIX + clientId;</span><br><span class="line">        <span class="type">String</span> <span class="variable">currentCount</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (currentCount == <span class="literal">null</span>) &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, <span class="string">&quot;1&quot;</span>, Duration.ofMinutes(<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> Integer.parseInt(currentCount);</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= MAX_REQUESTS_PER_MINUTE) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        redisTemplate.opsForValue().increment(key);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Monitoring-and-Observability"><a href="#Monitoring-and-Observability" class="headerlink" title="Monitoring and Observability"></a>Monitoring and Observability</h2><h3 id="Comprehensive-Metrics-Collection"><a href="#Comprehensive-Metrics-Collection" class="headerlink" title="Comprehensive Metrics Collection"></a>Comprehensive Metrics Collection</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AISystemMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer responseTimeTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter requestCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge activeSessionsGauge;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AISystemMetrics</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        <span class="built_in">this</span>.responseTimeTimer = Timer.builder(<span class="string">&quot;ai.response.time&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;AI response processing time&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">        <span class="built_in">this</span>.requestCounter = Counter.builder(<span class="string">&quot;ai.requests.total&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Total AI requests processed&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">        <span class="built_in">this</span>.activeSessionsGauge = Gauge.builder(<span class="string">&quot;ai.sessions.active&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Number of active chat sessions&quot;</span>)</span><br><span class="line">            .register(meterRegistry, <span class="built_in">this</span>, AISystemMetrics::getActiveSessionCount);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordResponseTime</span><span class="params">(Duration duration, String endpoint)</span> &#123;</span><br><span class="line">        responseTimeTimer.record(duration);</span><br><span class="line">        requestCounter.increment(Tags.of(<span class="string">&quot;endpoint&quot;</span>, endpoint));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">getActiveSessionCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation to get active session count</span></span><br><span class="line">        <span class="keyword">return</span> sessionManager.getActiveSessionCount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Production-Best-Practices-and-Lessons-Learned"><a href="#Production-Best-Practices-and-Lessons-Learned" class="headerlink" title="Production Best Practices and Lessons Learned"></a>Production Best Practices and Lessons Learned</h2><h3 id="Circuit-Breaker-Implementation"><a href="#Circuit-Breaker-Implementation" class="headerlink" title="Circuit Breaker Implementation"></a>Circuit Breaker Implementation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResilientExternalServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CircuitBreaker(name = &quot;bank-credit-service&quot;, fallbackMethod = &quot;getCreditReportFallback&quot;)</span></span><br><span class="line">    <span class="meta">@Retry(name = &quot;bank-credit-service&quot;)</span></span><br><span class="line">    <span class="meta">@TimeLimiter(name = &quot;bank-credit-service&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;CreditReport&gt; <span class="title function_">getCreditReport</span><span class="params">(String ssn)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// Call external service</span></span><br><span class="line">            <span class="keyword">return</span> bankCreditClient.getCreditReport(ssn);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;CreditReport&gt; <span class="title function_">getCreditReportFallback</span><span class="params">(String ssn, Exception ex)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;Credit service unavailable, using fallback for SSN: &#123;&#125;&quot;</span>, ssn, ex);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Return cached data or default assessment</span></span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.completedFuture(</span><br><span class="line">            CreditReport.fallback(<span class="string">&quot;Service temporarily unavailable&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Error-Handling-and-Recovery"><a href="#Error-Handling-and-Recovery" class="headerlink" title="Error Handling and Recovery"></a>Error Handling and Recovery</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(AIProcessingException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleAIProcessingException</span><span class="params">(</span></span><br><span class="line"><span class="params">            AIProcessingException ex)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        log.error(<span class="string">&quot;AI processing failed&quot;</span>, ex);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.SERVICE_UNAVAILABLE)</span><br><span class="line">            .body(ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;AI_PROCESSING_FAILED&quot;</span>)</span><br><span class="line">                .message(<span class="string">&quot;AI service temporarily unavailable&quot;</span>)</span><br><span class="line">                .fallbackAvailable(<span class="literal">true</span>)</span><br><span class="line">                .timestamp(Instant.now())</span><br><span class="line">                .build());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ExternalServiceException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleExternalServiceException</span><span class="params">(</span></span><br><span class="line"><span class="params">            ExternalServiceException ex)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_GATEWAY)</span><br><span class="line">            .body(ErrorResponse.builder()</span><br><span class="line">                .code(<span class="string">&quot;EXTERNAL_SERVICE_ERROR&quot;</span>)</span><br><span class="line">                .message(<span class="string">&quot;External service integration failed&quot;</span>)</span><br><span class="line">                .retryAfter(Duration.ofMinutes(<span class="number">5</span>))</span><br><span class="line">                .timestamp(Instant.now())</span><br><span class="line">                .build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Interview-Questions-and-Technical-Insights"><a href="#Interview-Questions-and-Technical-Insights" class="headerlink" title="Interview Questions and Technical Insights"></a>Interview Questions and Technical Insights</h2><p><strong>Q: How do you ensure consistency between AI-generated decisions and rule-based systems?</strong></p>
<p><strong>A:</strong> Implement a hybrid validation approach where AI recommendations are cross-validated against rule engine outputs. Use confidence scoring to determine when AI decisions require human review. Maintain audit trails for decision reconciliation and implement feedback loops to improve AI model accuracy over time.</p>
<p><strong>Q: How do you handle model drift in production AI systems?</strong></p>
<p><strong>A:</strong> Monitor key performance indicators like prediction accuracy, response relevance, and user satisfaction scores. Implement A&#x2F;B testing frameworks to compare model versions. Use continuous training pipelines with fresh data and establish baseline metrics for automated alerts when performance degrades beyond acceptable thresholds.</p>
<p><strong>Q: What strategies do you use for handling high-volume concurrent requests?</strong></p>
<p><strong>A:</strong> Implement request queuing with priority-based processing, connection pooling for database access, and caching strategies for frequently accessed data. Use load balancing across multiple AI model instances and implement graceful degradation when system resources are constrained.</p>
<h2 id="External-Resources-and-References"><a href="#External-Resources-and-References" class="headerlink" title="External Resources and References"></a>External Resources and References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/docs/current/reference/html/">Spring AI Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://higress.io/docs/latest/user/ai-gateway/">Higress AI Gateway</a></li>
<li><a target="_blank" rel="noopener" href="https://mem0.ai/docs">Mem0 Context Memory</a></li>
<li><a target="_blank" rel="noopener" href="https://nacos.io/en-us/">Nacos Configuration Management</a></li>
<li><a target="_blank" rel="noopener" href="https://python.langchain.com/docs/langgraph">LangGraph Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2210.03629">ReAct Pattern Paper</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.langchain.com/docs/use-cases/question-answering">RAG Implementation Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/guides/gs/circuit-breaker/">Spring Boot Circuit Breaker</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/docs/manual/config/">Redis Caching Strategies</a></li>
</ul>
<h2 id="Advanced-Implementation-Patterns"><a href="#Advanced-Implementation-Patterns" class="headerlink" title="Advanced Implementation Patterns"></a>Advanced Implementation Patterns</h2><h3 id="MCP-Server-Integration-for-Specialized-Agents"><a href="#MCP-Server-Integration-for-Specialized-Agents" class="headerlink" title="MCP Server Integration for Specialized Agents"></a>MCP Server Integration for Specialized Agents</h3><p>The Model Context Protocol (MCP) enables seamless integration of specialized agents for different financial domains.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MCPAgentOrchestrator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MCPClientRegistry mcpClientRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; agentMappings = Map.of(</span><br><span class="line">        <span class="string">&quot;credit-analysis&quot;</span>, <span class="string">&quot;mcp://credit-agent-server:3001&quot;</span>,</span><br><span class="line">        <span class="string">&quot;risk-assessment&quot;</span>, <span class="string">&quot;mcp://risk-agent-server:3002&quot;</span>,</span><br><span class="line">        <span class="string">&quot;document-validation&quot;</span>, <span class="string">&quot;mcp://doc-agent-server:3003&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fraud-detection&quot;</span>, <span class="string">&quot;mcp://fraud-agent-server:3004&quot;</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> AgentResponse <span class="title function_">delegateToSpecializedAgent</span><span class="params">(</span></span><br><span class="line"><span class="params">            String agentType, </span></span><br><span class="line"><span class="params">            AgentRequest request)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MCPClient</span> <span class="variable">client</span> <span class="operator">=</span> mcpClientRegistry.getClient(agentMappings.get(agentType));</span><br><span class="line">            </span><br><span class="line">            <span class="type">MCPRequest</span> <span class="variable">mcpRequest</span> <span class="operator">=</span> MCPRequest.builder()</span><br><span class="line">                .method(<span class="string">&quot;process&quot;</span>)</span><br><span class="line">                .params(Map.of(</span><br><span class="line">                    <span class="string">&quot;requestType&quot;</span>, request.getType(),</span><br><span class="line">                    <span class="string">&quot;data&quot;</span>, request.getData(),</span><br><span class="line">                    <span class="string">&quot;context&quot;</span>, request.getContext()</span><br><span class="line">                ))</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            <span class="type">MCPResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.call(mcpRequest);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> AgentResponse.builder()</span><br><span class="line">                .agentType(agentType)</span><br><span class="line">                .result(response.getResult())</span><br><span class="line">                .confidence(response.getConfidence())</span><br><span class="line">                .executionTime(response.getExecutionTime())</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;MCP agent call failed for type: &#123;&#125;&quot;</span>, agentType, e);</span><br><span class="line">            <span class="keyword">return</span> AgentResponse.error(agentType, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;List&lt;AgentResponse&gt;&gt; <span class="title function_">executeParallelAgents</span><span class="params">(</span></span><br><span class="line"><span class="params">            List&lt;String&gt; agentTypes, </span></span><br><span class="line"><span class="params">            AgentRequest request)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        List&lt;CompletableFuture&lt;AgentResponse&gt;&gt; futures = agentTypes.stream()</span><br><span class="line">            .map(agentType -&gt; CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">                delegateToSpecializedAgent(agentType, request)))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.allOf(futures.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]))</span><br><span class="line">            .thenApply(v -&gt; futures.stream()</span><br><span class="line">                .map(CompletableFuture::join)</span><br><span class="line">                .collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Advanced-RAG-Pipeline-with-Financial-Domain-Optimization"><a href="#Advanced-RAG-Pipeline-with-Financial-Domain-Optimization" class="headerlink" title="Advanced RAG Pipeline with Financial Domain Optimization"></a>Advanced RAG Pipeline with Financial Domain Optimization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FinancialRAGService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorStore vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DocumentChunker documentChunker;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FinancialEntityExtractor entityExtractor;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">indexFinancialDocument</span><span class="params">(Document document)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Extract financial entities (amounts, dates, rates, etc.)</span></span><br><span class="line">            List&lt;FinancialEntity&gt; entities = entityExtractor.extract(document.getContent());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Create domain-specific chunks with entity awareness</span></span><br><span class="line">            List&lt;DocumentChunk&gt; chunks = documentChunker.chunkWithEntityBoundaries(</span><br><span class="line">                document, entities);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Enrich chunks with financial metadata</span></span><br><span class="line">            List&lt;Document&gt; enrichedChunks = chunks.stream()</span><br><span class="line">                .map(chunk -&gt; enrichChunkWithFinancialMetadata(chunk, entities))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Store in vector database with financial-specific embeddings</span></span><br><span class="line">            vectorStore.add(enrichedChunks);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Index entities separately for structured queries</span></span><br><span class="line">            indexFinancialEntities(document.getId(), entities);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to index financial document&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Document <span class="title function_">enrichChunkWithFinancialMetadata</span><span class="params">(</span></span><br><span class="line"><span class="params">            DocumentChunk chunk, </span></span><br><span class="line"><span class="params">            List&lt;FinancialEntity&gt; entities)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; metadata = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(chunk.getMetadata());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add financial-specific metadata</span></span><br><span class="line">        List&lt;FinancialEntity&gt; chunkEntities = entities.stream()</span><br><span class="line">            .filter(entity -&gt; isEntityInChunk(entity, chunk))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        metadata.put(<span class="string">&quot;financial_entities&quot;</span>, chunkEntities.stream()</span><br><span class="line">            .map(FinancialEntity::getType)</span><br><span class="line">            .distinct()</span><br><span class="line">            .collect(Collectors.toList()));</span><br><span class="line">        </span><br><span class="line">        metadata.put(<span class="string">&quot;contains_amounts&quot;</span>, chunkEntities.stream()</span><br><span class="line">            .anyMatch(e -&gt; e.getType() == EntityType.MONETARY_AMOUNT));</span><br><span class="line">        </span><br><span class="line">        metadata.put(<span class="string">&quot;contains_dates&quot;</span>, chunkEntities.stream()</span><br><span class="line">            .anyMatch(e -&gt; e.getType() == EntityType.DATE));</span><br><span class="line">        </span><br><span class="line">        metadata.put(<span class="string">&quot;risk_indicators&quot;</span>, extractRiskIndicators(chunk.getContent()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Document</span>(chunk.getContent(), metadata);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">retrieveFinancialContext</span><span class="params">(String query, FinancialContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Build hybrid search combining vector similarity and entity matching</span></span><br><span class="line">        SearchRequest.<span class="type">Builder</span> <span class="variable">searchBuilder</span> <span class="operator">=</span> SearchRequest.query(query)</span><br><span class="line">            .withTopK(<span class="number">10</span>)</span><br><span class="line">            .withSimilarityThreshold(<span class="number">0.7</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add financial domain filters</span></span><br><span class="line">        <span class="keyword">if</span> (context.hasLoanApplicationId()) &#123;</span><br><span class="line">            searchBuilder.withFilterExpression(</span><br><span class="line">                <span class="string">&quot;metadata.loan_application_id == &#x27;&quot;</span> + context.getLoanApplicationId() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (context.hasCustomerId()) &#123;</span><br><span class="line">            searchBuilder.withFilterExpression(</span><br><span class="line">                <span class="string">&quot;metadata.customer_id == &#x27;&quot;</span> + context.getCustomerId() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Boost relevance for documents with similar financial entities</span></span><br><span class="line">        <span class="keyword">if</span> (!context.getFinancialEntities().isEmpty()) &#123;</span><br><span class="line">            searchBuilder.withBoostFunction(createEntityBoostFunction(context.getFinancialEntities()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> vectorStore.similaritySearch(searchBuilder.build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Conversation-Flow-Management-with-State-Machines"><a href="#Conversation-Flow-Management-with-State-Machines" class="headerlink" title="Conversation Flow Management with State Machines"></a>Conversation Flow Management with State Machines</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConversationFlowManager</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StateMachineFactory&lt;ConversationState, ConversationEvent&gt; stateMachineFactory;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConversationContextService contextService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ConversationResponse <span class="title function_">processMessage</span><span class="params">(</span></span><br><span class="line"><span class="params">            String sessionId, </span></span><br><span class="line"><span class="params">            String userMessage, </span></span><br><span class="line"><span class="params">            ConversationContext context)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Get or create state machine for this conversation</span></span><br><span class="line">        StateMachine&lt;ConversationState, ConversationEvent&gt; stateMachine = </span><br><span class="line">            getOrCreateStateMachine(sessionId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Determine event from user message</span></span><br><span class="line">        <span class="type">ConversationEvent</span> <span class="variable">event</span> <span class="operator">=</span> classifyUserMessage(userMessage, context);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process state transition</span></span><br><span class="line">        stateMachine.sendEvent(event);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ConversationState</span> <span class="variable">currentState</span> <span class="operator">=</span> stateMachine.getState().getId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate appropriate response based on current state</span></span><br><span class="line">        <span class="keyword">return</span> generateStateBasedResponse(currentState, userMessage, context);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ConversationEvent <span class="title function_">classifyUserMessage</span><span class="params">(String message, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Use AI to classify the user&#x27;s intent</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">classificationPrompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Classify the user&#x27;s message into one of these conversation events:</span></span><br><span class="line"><span class="string">            - LOAN_APPLICATION_START</span></span><br><span class="line"><span class="string">            - PROVIDE_PERSONAL_INFO</span></span><br><span class="line"><span class="string">            - UPLOAD_DOCUMENT</span></span><br><span class="line"><span class="string">            - ASK_QUESTION</span></span><br><span class="line"><span class="string">            - REQUEST_STATUS</span></span><br><span class="line"><span class="string">            - PROVIDE_CLARIFICATION</span></span><br><span class="line"><span class="string">            - END_CONVERSATION</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Current conversation state: &#123;state&#125;</span></span><br><span class="line"><span class="string">            User message: &quot;&#123;message&#125;&quot;</span></span><br><span class="line"><span class="string">            Context: &#123;context&#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Classification:</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(classificationPrompt</span><br><span class="line">            .replace(<span class="string">&quot;&#123;state&#125;&quot;</span>, context.getCurrentState().toString())</span><br><span class="line">            .replace(<span class="string">&quot;&#123;message&#125;&quot;</span>, message)</span><br><span class="line">            .replace(<span class="string">&quot;&#123;context&#125;&quot;</span>, context.getSummary()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ConversationEvent.valueOf(</span><br><span class="line">            response.getResult().getOutput().getContent().trim().toUpperCase()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStateChange</span><span class="params">(StateMachineEvent event)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sessionId</span> <span class="operator">=</span> (String) event.getStateMachine().getExtendedState()</span><br><span class="line">            .getVariables().get(<span class="string">&quot;sessionId&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ConversationState</span> <span class="variable">newState</span> <span class="operator">=</span> (ConversationState) event.getTarget().getId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update conversation context</span></span><br><span class="line">        contextService.updateState(sessionId, newState);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Log state transition for analytics</span></span><br><span class="line">        analyticsService.recordStateTransition(sessionId, </span><br><span class="line">            (ConversationState) event.getSource().getId(), newState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Multi-Modal-Document-Processing"><a href="#Multi-Modal-Document-Processing" class="headerlink" title="Multi-Modal Document Processing"></a>Multi-Modal Document Processing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiModalDocumentProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OCRService ocrService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ImageAnalysisService imageAnalysisService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AudioTranscriptionService audioService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ProcessedDocument <span class="title function_">processMultiModalDocument</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> determineFileType(file);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (fileType) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;PDF&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> processPDFDocument(file);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;IMAGE&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> processImageDocument(file);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;AUDIO&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> processAudioDocument(file);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedDocumentTypeException</span>(<span class="string">&quot;Unsupported file type: &quot;</span> + fileType);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ProcessedDocument <span class="title function_">processImageDocument</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Extract text using OCR</span></span><br><span class="line">            <span class="type">OCRResult</span> <span class="variable">ocrResult</span> <span class="operator">=</span> ocrService.extractText(file.getBytes());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Analyze image for financial document characteristics</span></span><br><span class="line">            <span class="type">ImageAnalysisResult</span> <span class="variable">imageAnalysis</span> <span class="operator">=</span> imageAnalysisService.analyze(file.getBytes());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Use AI to understand document structure and content</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">analysisPrompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                Analyze this financial document based on the extracted text and image analysis:</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                Extracted Text:</span></span><br><span class="line"><span class="string">                &#123;text&#125;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                Image Analysis:</span></span><br><span class="line"><span class="string">                - Document type detected: &#123;doc_type&#125;</span></span><br><span class="line"><span class="string">                - Quality score: &#123;quality&#125;</span></span><br><span class="line"><span class="string">                - Tables detected: &#123;tables&#125;</span></span><br><span class="line"><span class="string">                - Stamps/signatures: &#123;stamps&#125;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                Please provide:</span></span><br><span class="line"><span class="string">                1. Document classification</span></span><br><span class="line"><span class="string">                2. Key financial information extracted</span></span><br><span class="line"><span class="string">                3. Confidence score</span></span><br><span class="line"><span class="string">                4. Any issues or concerns</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ChatResponse</span> <span class="variable">aiAnalysis</span> <span class="operator">=</span> chatClient.call(analysisPrompt</span><br><span class="line">                .replace(<span class="string">&quot;&#123;text&#125;&quot;</span>, ocrResult.getText())</span><br><span class="line">                .replace(<span class="string">&quot;&#123;doc_type&#125;&quot;</span>, imageAnalysis.getDocumentType())</span><br><span class="line">                .replace(<span class="string">&quot;&#123;quality&#125;&quot;</span>, String.valueOf(imageAnalysis.getQualityScore()))</span><br><span class="line">                .replace(<span class="string">&quot;&#123;tables&#125;&quot;</span>, String.valueOf(imageAnalysis.getTableCount()))</span><br><span class="line">                .replace(<span class="string">&quot;&#123;stamps&#125;&quot;</span>, String.valueOf(imageAnalysis.hasStampsOrSignatures())));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> ProcessedDocument.builder()</span><br><span class="line">                .originalFilename(file.getOriginalFilename())</span><br><span class="line">                .extractedText(ocrResult.getText())</span><br><span class="line">                .confidence(ocrResult.getConfidence())</span><br><span class="line">                .documentType(determineDocumentType(aiAnalysis.getResult().getOutput().getContent()))</span><br><span class="line">                .aiAnalysis(aiAnalysis.getResult().getOutput().getContent())</span><br><span class="line">                .metadata(createDocumentMetadata(ocrResult, imageAnalysis))</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to process image document&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> ProcessedDocument.failed(file.getOriginalFilename(), e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ProcessedDocument <span class="title function_">processAudioDocument</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Transcribe audio to text</span></span><br><span class="line">            <span class="type">TranscriptionResult</span> <span class="variable">transcription</span> <span class="operator">=</span> audioService.transcribe(file.getBytes());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Analyze conversation for financial intent</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">conversationAnalysis</span> <span class="operator">=</span> analyzeFinancialConversation(transcription.getText());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> ProcessedDocument.builder()</span><br><span class="line">                .originalFilename(file.getOriginalFilename())</span><br><span class="line">                .extractedText(transcription.getText())</span><br><span class="line">                .confidence(transcription.getConfidence())</span><br><span class="line">                .documentType(DocumentType.AUDIO_TRANSCRIPT)</span><br><span class="line">                .aiAnalysis(conversationAnalysis)</span><br><span class="line">                .metadata(Map.of(</span><br><span class="line">                    <span class="string">&quot;duration&quot;</span>, transcription.getDuration(),</span><br><span class="line">                    <span class="string">&quot;language&quot;</span>, transcription.getDetectedLanguage(),</span><br><span class="line">                    <span class="string">&quot;speaker_count&quot;</span>, transcription.getSpeakerCount()</span><br><span class="line">                ))</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to process audio document&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> ProcessedDocument.failed(file.getOriginalFilename(), e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Real-Time-Fraud-Detection-Integration"><a href="#Real-Time-Fraud-Detection-Integration" class="headerlink" title="Real-Time Fraud Detection Integration"></a>Real-Time Fraud Detection Integration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RealTimeFraudDetectionService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FraudDetectionModel fraudModel;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BehaviorAnalysisService behaviorAnalysis;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlertingService alertingService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoanApplicationSubmitted</span><span class="params">(LoanApplicationEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">LoanApplication</span> <span class="variable">application</span> <span class="operator">=</span> event.getApplication();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Real-time fraud scoring</span></span><br><span class="line">            <span class="type">FraudScore</span> <span class="variable">fraudScore</span> <span class="operator">=</span> calculateFraudScore(application);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Behavioral analysis</span></span><br><span class="line">            <span class="type">BehaviorProfile</span> <span class="variable">profile</span> <span class="operator">=</span> behaviorAnalysis.analyzeUserBehavior(</span><br><span class="line">                application.getUserId(), application.getSubmissionContext());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Combined risk assessment</span></span><br><span class="line">            <span class="type">RiskAssessment</span> <span class="variable">riskAssessment</span> <span class="operator">=</span> combineRiskFactors(fraudScore, profile);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (riskAssessment.getRiskLevel() == RiskLevel.HIGH) &#123;</span><br><span class="line">                <span class="comment">// Immediate alert for high-risk applications</span></span><br><span class="line">                alertingService.sendHighRiskAlert(AlertContext.builder()</span><br><span class="line">                    .applicationId(application.getId())</span><br><span class="line">                    .userId(application.getUserId())</span><br><span class="line">                    .riskScore(riskAssessment.getScore())</span><br><span class="line">                    .riskFactors(riskAssessment.getRiskFactors())</span><br><span class="line">                    .timestamp(Instant.now())</span><br><span class="line">                    .build());</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Automatically flag for manual review</span></span><br><span class="line">                workflowService.flagForManualReview(application.getId(), </span><br><span class="line">                    <span class="string">&quot;High fraud risk detected&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Fraud detection failed for application: &#123;&#125;&quot;</span>, </span><br><span class="line">                event.getApplication().getId(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> FraudScore <span class="title function_">calculateFraudScore</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="comment">// Feature engineering for fraud detection</span></span><br><span class="line">        <span class="type">FraudFeatures</span> <span class="variable">features</span> <span class="operator">=</span> FraudFeatures.builder()</span><br><span class="line">            .applicationHour(application.getSubmissionTime().getHour())</span><br><span class="line">            .deviceFingerprint(application.getDeviceInfo().getFingerprint())</span><br><span class="line">            .ipAddress(application.getSubmissionContext().getIpAddress())</span><br><span class="line">            .requestedAmount(application.getRequestedAmount())</span><br><span class="line">            .incomeToLoanRatio(calculateIncomeToLoanRatio(application))</span><br><span class="line">            .documentConsistency(analyzeDocumentConsistency(application.getDocuments()))</span><br><span class="line">            .velocityMetrics(calculateVelocityMetrics(application.getUserId()))</span><br><span class="line">            .build();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> fraudModel.predict(features);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> VelocityMetrics <span class="title function_">calculateVelocityMetrics</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="comment">// Check for unusual application velocity</span></span><br><span class="line">        List&lt;LoanApplication&gt; recentApplications = applicationRepository</span><br><span class="line">            .findByUserIdAndSubmissionTimeAfter(userId, </span><br><span class="line">                Instant.now().minus(Duration.ofDays(<span class="number">30</span>)));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> VelocityMetrics.builder()</span><br><span class="line">            .applicationsLast24Hours(countApplicationsInTimeframe(recentApplications, Duration.ofHours(<span class="number">24</span>)))</span><br><span class="line">            .applicationsLast7Days(countApplicationsInTimeframe(recentApplications, Duration.ofDays(<span class="number">7</span>)))</span><br><span class="line">            .applicationsLast30Days(recentApplications.size())</span><br><span class="line">            .averageTimeBetweenApplications(calculateAverageTimeBetween(recentApplications))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Advanced-Monitoring-and-Alerting"><a href="#Advanced-Monitoring-and-Alerting" class="headerlink" title="Advanced Monitoring and Alerting"></a>Advanced Monitoring and Alerting</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemHealthMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MeterRegistry meterRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlertManager alertManager;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 30000)</span> <span class="comment">// Every 30 seconds</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">monitorSystemHealth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SystemHealthMetrics</span> <span class="variable">metrics</span> <span class="operator">=</span> collectSystemMetrics();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check AI service health</span></span><br><span class="line">        <span class="keyword">if</span> (metrics.getAiResponseTime() &gt; Duration.ofSeconds(<span class="number">30</span>)) &#123;</span><br><span class="line">            alertManager.sendAlert(Alert.builder()</span><br><span class="line">                .type(AlertType.PERFORMANCE_DEGRADATION)</span><br><span class="line">                .severity(Severity.WARNING)</span><br><span class="line">                .message(<span class="string">&quot;AI response time exceeds threshold&quot;</span>)</span><br><span class="line">                .metrics(Map.of(<span class="string">&quot;response_time&quot;</span>, metrics.getAiResponseTime().toString()))</span><br><span class="line">                .build());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check error rates</span></span><br><span class="line">        <span class="keyword">if</span> (metrics.getErrorRate() &gt; <span class="number">0.05</span>) &#123; <span class="comment">// 5% error rate threshold</span></span><br><span class="line">            alertManager.sendAlert(Alert.builder()</span><br><span class="line">                .type(AlertType.HIGH_ERROR_RATE)</span><br><span class="line">                .severity(Severity.CRITICAL)</span><br><span class="line">                .message(<span class="string">&quot;System error rate exceeds 5%&quot;</span>)</span><br><span class="line">                .metrics(Map.of(<span class="string">&quot;error_rate&quot;</span>, String.valueOf(metrics.getErrorRate())))</span><br><span class="line">                .build());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check external service availability</span></span><br><span class="line">        metrics.getExternalServiceHealth().forEach((service, isHealthy) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isHealthy) &#123;</span><br><span class="line">                alertManager.sendAlert(Alert.builder()</span><br><span class="line">                    .type(AlertType.EXTERNAL_SERVICE_DOWN)</span><br><span class="line">                    .severity(Severity.HIGH)</span><br><span class="line">                    .message(<span class="string">&quot;External service unavailable: &quot;</span> + service)</span><br><span class="line">                    .build());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> SystemHealthMetrics <span class="title function_">collectSystemMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SystemHealthMetrics.builder()</span><br><span class="line">            .aiResponseTime(getAverageResponseTime(<span class="string">&quot;ai.response.time&quot;</span>))</span><br><span class="line">            .errorRate(getErrorRate())</span><br><span class="line">            .activeConnections(getActiveConnectionCount())</span><br><span class="line">            .memoryUsage(getMemoryUsage())</span><br><span class="line">            .cpuUsage(getCpuUsage())</span><br><span class="line">            .externalServiceHealth(checkExternalServices())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationFailure</span><span class="params">(ApplicationFailureEvent event)</span> &#123;</span><br><span class="line">        alertManager.sendAlert(Alert.builder()</span><br><span class="line">            .type(AlertType.APPLICATION_ERROR)</span><br><span class="line">            .severity(Severity.CRITICAL)</span><br><span class="line">            .message(<span class="string">&quot;Application failure detected&quot;</span>)</span><br><span class="line">            .exception(event.getException())</span><br><span class="line">            .context(event.getContext())</span><br><span class="line">            .timestamp(Instant.now())</span><br><span class="line">            .build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Performance-Optimization-Strategies"><a href="#Performance-Optimization-Strategies" class="headerlink" title="Performance Optimization Strategies"></a>Performance Optimization Strategies</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceOptimizationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CacheManager cacheManager;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CompletableFutureTaskExecutor asyncExecutor;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Intelligent caching with TTL based on data volatility</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;user-profiles&quot;, key = &quot;#userId&quot;, </span></span><br><span class="line"><span class="meta">               condition = &quot;#result != null&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserProfile <span class="title function_">getUserProfile</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userProfileRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(userId));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Batch processing for efficiency</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CreditScore&gt; <span class="title function_">batchGetCreditScores</span><span class="params">(List&lt;String&gt; userIds)</span> &#123;</span><br><span class="line">        <span class="comment">// Split into chunks to avoid overwhelming external services</span></span><br><span class="line">        List&lt;List&lt;String&gt;&gt; chunks = Lists.partition(userIds, <span class="number">50</span>);</span><br><span class="line">        </span><br><span class="line">        List&lt;CompletableFuture&lt;List&lt;CreditScore&gt;&gt;&gt; futures = chunks.stream()</span><br><span class="line">            .map(chunk -&gt; CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">                creditServiceClient.getCreditScores(chunk), asyncExecutor))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> futures.stream()</span><br><span class="line">            .map(CompletableFuture::join)</span><br><span class="line">            .flatMap(List::stream)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Connection pooling optimization</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;external-services.connection-pool&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> HikariConfig <span class="title function_">hikariConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HikariConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariConfig</span>();</span><br><span class="line">        config.setMaximumPoolSize(<span class="number">20</span>);</span><br><span class="line">        config.setMinimumIdle(<span class="number">5</span>);</span><br><span class="line">        config.setConnectionTimeout(<span class="number">30000</span>);</span><br><span class="line">        config.setIdleTimeout(<span class="number">600000</span>);</span><br><span class="line">        config.setMaxLifetime(<span class="number">1800000</span>);</span><br><span class="line">        config.setLeakDetectionThreshold(<span class="number">60000</span>);</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Query optimization with database hints</span></span><br><span class="line">    <span class="meta">@Query(value = &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        SELECT /*+ USE_INDEX(loan_applications, idx_user_status_created) */ </span></span><br><span class="line"><span class="meta">        la.* FROM loan_applications la </span></span><br><span class="line"><span class="meta">        WHERE la.user_id = :userId </span></span><br><span class="line"><span class="meta">        AND la.status IN :statuses </span></span><br><span class="line"><span class="meta">        AND la.created_date &gt;= :fromDate </span></span><br><span class="line"><span class="meta">        ORDER BY la.created_date DESC </span></span><br><span class="line"><span class="meta">        LIMIT :limit</span></span><br><span class="line"><span class="meta">        &quot;&quot;&quot;, nativeQuery = true)</span></span><br><span class="line">    List&lt;LoanApplication&gt; <span class="title function_">findOptimizedUserApplications</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;userId&quot;)</span> String userId,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;statuses&quot;)</span> List&lt;String&gt; statuses,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;fromDate&quot;)</span> Instant fromDate,</span></span><br><span class="line"><span class="params">        <span class="meta">@Param(&quot;limit&quot;)</span> <span class="type">int</span> limit)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion-and-Future-Roadmap"><a href="#Conclusion-and-Future-Roadmap" class="headerlink" title="Conclusion and Future Roadmap"></a>Conclusion and Future Roadmap</h2><p>This comprehensive FinTech AI Workflow and Chat System represents a production-ready architecture that successfully balances innovation with reliability. The system demonstrates how modern AI capabilities can be integrated into traditional financial workflows while maintaining the strict compliance, security, and performance requirements of the financial industry.</p>
<h3 id="Key-Success-Factors"><a href="#Key-Success-Factors" class="headerlink" title="Key Success Factors"></a>Key Success Factors</h3><ol>
<li><strong>Hybrid Architecture</strong>: Combining traditional rule-based systems with AI capabilities provides both reliability and innovation</li>
<li><strong>Microservices Design</strong>: Enables independent scaling and deployment of different system components</li>
<li><strong>Comprehensive Monitoring</strong>: Real-time visibility into system performance and health</li>
<li><strong>Security-First Approach</strong>: Built-in encryption, audit trails, and compliance mechanisms</li>
<li><strong>Resilience Patterns</strong>: Circuit breakers, retries, and fallback mechanisms ensure system stability</li>
</ol>
<h3 id="Performance-Achievements"><a href="#Performance-Achievements" class="headerlink" title="Performance Achievements"></a>Performance Achievements</h3><ul>
<li><strong>2000+ concurrent conversations</strong> with optimized context caching</li>
<li><strong>30-second average response time</strong> through intelligent load balancing</li>
<li><strong>99.9% uptime</strong> with robust error handling and recovery mechanisms</li>
<li><strong>Sub-second document processing</strong> for standard financial documents</li>
<li><strong>Real-time fraud detection</strong> with minimal false positives</li>
</ul>
<h3 id="Future-Enhancement-Opportunities"><a href="#Future-Enhancement-Opportunities" class="headerlink" title="Future Enhancement Opportunities"></a>Future Enhancement Opportunities</h3><ol>
<li><strong>Advanced ML Ops</strong>: Implement automated model retraining and deployment pipelines</li>
<li><strong>Blockchain Integration</strong>: Add immutable audit trails for regulatory compliance</li>
<li><strong>Edge Computing</strong>: Deploy lightweight models closer to users for reduced latency</li>
<li><strong>Voice Interface</strong>: Expand multi-modal capabilities with advanced voice processing</li>
<li><strong>Predictive Analytics</strong>: Implement customer behavior prediction for proactive service</li>
</ol>
<p>This architecture serves as a blueprint for organizations looking to modernize their financial services with AI while maintaining the highest standards of security, compliance, and reliability expected in the financial industry.</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/" rel="prev" title="Design Distributed Pressure Test Tool By Zookeeper">
                  <i class="fa fa-angle-left"></i> Design Distributed Pressure Test Tool By Zookeeper
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
