<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="OverviewIntroductionThe FinTech AI Workflow and Chat System represents a comprehensive lending platform that combines traditional workflow automation with artificial intelligence capabilities. This sy">
<meta property="og:type" content="article">
<meta property="og:title" content="Design FinTech AI Workflow and Chat System">
<meta property="og:url" content="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="OverviewIntroductionThe FinTech AI Workflow and Chat System represents a comprehensive lending platform that combines traditional workflow automation with artificial intelligence capabilities. This sy">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-07-02T09:39:48.000Z">
<meta property="article:modified_time" content="2025-07-03T12:24:11.410Z">
<meta property="article:author" content="Charlie Feng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/","path":"2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/","title":"Design FinTech AI Workflow and Chat System"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Design FinTech AI Workflow and Chat System | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Introduction"><span class="nav-number">1.1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Architecture-Design"><span class="nav-number">1.2.</span> <span class="nav-text">Architecture Design</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-Components"><span class="nav-number">2.</span> <span class="nav-text">Core Components</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WorkflowEngineService"><span class="nav-number">2.1.</span> <span class="nav-text">WorkflowEngineService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AIWorkflowEngineService"><span class="nav-number">2.2.</span> <span class="nav-text">AIWorkflowEngineService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ChatWebUI"><span class="nav-number">2.3.</span> <span class="nav-text">ChatWebUI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConversationService"><span class="nav-number">2.4.</span> <span class="nav-text">ConversationService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KnowledgeBaseService"><span class="nav-number">2.5.</span> <span class="nav-text">KnowledgeBaseService</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Key-Technologies"><span class="nav-number">3.</span> <span class="nav-text">Key Technologies</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LLM-fine-tuning-with-Financial-data"><span class="nav-number">3.1.</span> <span class="nav-text">LLM fine-tuning with Financial data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multi-Modal-Message-Processing"><span class="nav-number">3.2.</span> <span class="nav-text">Multi-Modal Message Processing</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MultiModalProcessor"><span class="nav-number">3.2.1.</span> <span class="nav-text">MultiModalProcessor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Multi-Format-Document-Processing"><span class="nav-number">3.2.2.</span> <span class="nav-text">Multi-Format Document Processing</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RAG-Implementation-for-Knowledge-Base"><span class="nav-number">3.3.</span> <span class="nav-text">RAG Implementation for Knowledge Base</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RAGService"><span class="nav-number">3.3.1.</span> <span class="nav-text">RAGService</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Multi-Vector-RAG-for-Financial-Documents"><span class="nav-number">3.3.2.</span> <span class="nav-text">Multi-Vector RAG for Financial Documents</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Financial-Domain-Specific-Text-Splitter"><span class="nav-number">3.3.3.</span> <span class="nav-text">Financial Domain-Specific Text Splitter</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MCP-Server-and-Agent-to-Agent-Communication"><span class="nav-number">3.4.</span> <span class="nav-text">MCP Server and Agent-to-Agent Communication</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MCPServerManager"><span class="nav-number">3.4.1.</span> <span class="nav-text">MCPServerManager</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Credit-Analysis-Agent-Example"><span class="nav-number">3.4.2.</span> <span class="nav-text">Credit Analysis Agent Example</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session-Memory-and-Context-Caching-with-mem0"><span class="nav-number">3.5.</span> <span class="nav-text">Session Memory and Context Caching with mem0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LLM-ReAct-Pattern-Implementation"><span class="nav-number">3.6.</span> <span class="nav-text">LLM ReAct Pattern Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LLM-Planning-Pattern-implementation"><span class="nav-number">3.7.</span> <span class="nav-text">LLM Planning Pattern implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Model-Providers-Routing-with-Higress-AI-gateway"><span class="nav-number">3.8.</span> <span class="nav-text">Model Providers Routing with Higress AI gateway</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LLM-Prompt-Templates-via-Nacos"><span class="nav-number">3.9.</span> <span class="nav-text">LLM Prompt Templates via Nacos</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monitoring-and-Observability-with-OpenTelemetry"><span class="nav-number">3.10.</span> <span class="nav-text">Monitoring and Observability with OpenTelemetry</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Cases-and-Examples"><span class="nav-number">4.</span> <span class="nav-text">Use Cases and Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-1-Automated-Loan-Application-Processing"><span class="nav-number">4.1.</span> <span class="nav-text">Use Case 1: Automated Loan Application Processing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-2-Multi-Modal-Customer-Support"><span class="nav-number">4.2.</span> <span class="nav-text">Use Case 2: Multi-Modal Customer Support</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-3-Complex-Financial-Query-Resolution"><span class="nav-number">4.3.</span> <span class="nav-text">Use Case 3: Complex Financial Query Resolution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Optimization-and-Scalability"><span class="nav-number">5.</span> <span class="nav-text">Performance Optimization and Scalability</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Caching-Strategy"><span class="nav-number">5.1.</span> <span class="nav-text">Caching Strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Load-Balancing-and-Horizontal-Scaling"><span class="nav-number">5.2.</span> <span class="nav-text">Load Balancing and Horizontal Scaling</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Database-Optimization"><span class="nav-number">5.3.</span> <span class="nav-text">Database Optimization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">6.</span> <span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#External-Resources-and-References"><span class="nav-number">7.</span> <span class="nav-text">External Resources and References</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Design FinTech AI Workflow and Chat System | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Design FinTech AI Workflow and Chat System
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-07-02 17:39:48" itemprop="dateCreated datePublished" datetime="2025-07-02T17:39:48+08:00">2025-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-07-03 20:24:11" itemprop="dateModified" datetime="2025-07-03T20:24:11+08:00">2025-07-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>The FinTech AI Workflow and Chat System represents a comprehensive lending platform that combines traditional workflow automation with artificial intelligence capabilities. This system streamlines the personal loan application process through intelligent automation while maintaining human oversight at critical decision points.</p>
<p>The architecture employs a microservices approach, integrating multiple AI technologies including Large Language Models (LLMs), Retrieval-Augmented Generation (RAG), and intelligent agents to create a seamless lending experience. The system processes over 2000 concurrent conversations with an average response time of 30 seconds, demonstrating enterprise-grade performance.</p>
<p><strong>Key Business Benefits:</strong></p>
<ul>
<li><strong>Reduced Processing Time</strong>: From days to minutes for loan approvals</li>
<li><strong>Enhanced Accuracy</strong>: AI-powered risk assessment reduces default rates</li>
<li><strong>Improved Customer Experience</strong>: 24&#x2F;7 availability with multi-modal interaction</li>
<li><strong>Regulatory Compliance</strong>: Built-in compliance checks and audit trails</li>
<li><strong>Cost Efficiency</strong>: Automated workflows reduce operational costs by 60%</li>
</ul>
<p><strong>Key Interview Question</strong>: <em>“How would you design a scalable FinTech system that balances automation with regulatory compliance?”</em></p>
<p><strong>Reference Answer</strong>: The system employs a layered architecture with clear separation of concerns. The workflow engine handles business logic while maintaining audit trails for regulatory compliance. AI components augment human decision-making rather than replacing it entirely, ensuring transparency and accountability. The microservices architecture allows for independent scaling of components based on demand.</p>
<h3 id="Architecture-Design"><a href="#Architecture-Design" class="headerlink" title="Architecture Design"></a>Architecture Design</h3><pre>
<code class="mermaid">
flowchart TB
subgraph &quot;Frontend Layer&quot;
    A[ChatWebUI] --&gt; B[React&#x2F;Vue Components]
    B --&gt; C[Multi-Modal Input Handler]
end

subgraph &quot;Gateway Layer&quot;
    D[Higress AI Gateway] --&gt; E[Load Balancer]
    E --&gt; F[Multi-Model Provider]
    F --&gt; G[Context Memory - mem0]
end

subgraph &quot;Service Layer&quot;
    H[ConversationService] --&gt; I[AIWorkflowEngineService]
    I --&gt; J[WorkflowEngineService]
    H --&gt; K[KnowledgeBaseService]
end

subgraph &quot;AI Layer&quot;
    L[LLM Providers] --&gt; M[ReAct Pattern Engine]
    M --&gt; N[MCP Server Agents]
    N --&gt; O[RAG System]
end

subgraph &quot;External Systems&quot;
    P[BankCreditSystem]
    Q[TaxSystem]
    R[SocialSecuritySystem]
    S[Rule Engine]
end

subgraph &quot;Configuration&quot;
    T[Nacos Config Center]
    U[Prompt Templates]
end

A --&gt; D
D --&gt; H
H --&gt; L
I --&gt; P
I --&gt; Q
I --&gt; R
J --&gt; S
K --&gt; O
T --&gt; U
U --&gt; L
</code>
</pre>

<p>The architecture follows a distributed microservices pattern with clear separation between presentation, business logic, and data layers. The AI Gateway serves as the entry point for all AI-related operations, providing load balancing and context management across multiple LLM providers.</p>
<h2 id="Core-Components"><a href="#Core-Components" class="headerlink" title="Core Components"></a>Core Components</h2><h3 id="WorkflowEngineService"><a href="#WorkflowEngineService" class="headerlink" title="WorkflowEngineService"></a>WorkflowEngineService</h3><p>The WorkflowEngineService serves as the backbone of the lending process, orchestrating the three-stage review workflow: Initial Review, Review, and Final Review.</p>
<p><strong>Core Responsibilities:</strong></p>
<ul>
<li>Workflow orchestration and state management</li>
<li>External system integration</li>
<li>Business rule execution</li>
<li>Audit trail maintenance</li>
<li>SLA monitoring and enforcement</li>
</ul>
<p><strong>Implementation Architecture:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkflowEngineService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoanApplicationRepository loanRepo;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ExternalIntegrationService integrationService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuleEngineService ruleEngine;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> NotificationService notificationService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> WorkflowResult <span class="title function_">processLoanApplication</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Initialize workflow</span></span><br><span class="line">            <span class="type">WorkflowInstance</span> <span class="variable">workflow</span> <span class="operator">=</span> initializeWorkflow(application);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Execute initial review</span></span><br><span class="line">            <span class="type">InitialReviewResult</span> <span class="variable">initialResult</span> <span class="operator">=</span> executeInitialReview(application);</span><br><span class="line">            workflow.updateStage(WorkflowStage.INITIAL_REVIEW, initialResult);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (initialResult.isApproved()) &#123;</span><br><span class="line">                <span class="comment">// Proceed to detailed review</span></span><br><span class="line">                <span class="type">DetailedReviewResult</span> <span class="variable">detailedResult</span> <span class="operator">=</span> executeDetailedReview(application);</span><br><span class="line">                workflow.updateStage(WorkflowStage.DETAILED_REVIEW, detailedResult);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (detailedResult.isApproved()) &#123;</span><br><span class="line">                    <span class="comment">// Final review</span></span><br><span class="line">                    <span class="type">FinalReviewResult</span> <span class="variable">finalResult</span> <span class="operator">=</span> executeFinalReview(application);</span><br><span class="line">                    workflow.updateStage(WorkflowStage.FINAL_REVIEW, finalResult);</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">return</span> WorkflowResult.builder()</span><br><span class="line">                        .status(finalResult.isApproved() ? </span><br><span class="line">                            WorkflowStatus.APPROVED : WorkflowStatus.REJECTED)</span><br><span class="line">                        .workflowId(workflow.getId())</span><br><span class="line">                        .build();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> WorkflowResult.builder()</span><br><span class="line">                .status(WorkflowStatus.REJECTED)</span><br><span class="line">                .workflowId(workflow.getId())</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Workflow processing failed&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> handleWorkflowError(application, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> InitialReviewResult <span class="title function_">executeInitialReview</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="comment">// Validate basic information</span></span><br><span class="line">        <span class="type">ValidationResult</span> <span class="variable">validation</span> <span class="operator">=</span> validateBasicInfo(application);</span><br><span class="line">        <span class="keyword">if</span> (!validation.isValid()) &#123;</span><br><span class="line">            <span class="keyword">return</span> InitialReviewResult.rejected(validation.getErrors());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check credit score</span></span><br><span class="line">        <span class="type">CreditScoreResult</span> <span class="variable">creditScore</span> <span class="operator">=</span> integrationService.getCreditScore(</span><br><span class="line">            application.getApplicantId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Apply initial screening rules</span></span><br><span class="line">        <span class="type">RuleResult</span> <span class="variable">ruleResult</span> <span class="operator">=</span> ruleEngine.evaluateInitialRules(</span><br><span class="line">            application, creditScore);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> InitialReviewResult.builder()</span><br><span class="line">            .approved(ruleResult.isApproved())</span><br><span class="line">            .creditScore(creditScore.getScore())</span><br><span class="line">            .reasons(ruleResult.getReasons())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Three-Stage Review Process:</strong></p>
<ol>
<li><p><strong>Initial Review</strong>: Automated screening based on basic criteria</p>
<ul>
<li>Identity verification</li>
<li>Credit score check</li>
<li>Basic eligibility validation</li>
<li>Fraud detection algorithms</li>
</ul>
</li>
<li><p><strong>Detailed Review</strong>: Comprehensive analysis of financial capacity</p>
<ul>
<li>Income verification through tax systems</li>
<li>Employment history validation</li>
<li>Debt-to-income ratio calculation</li>
<li>Collateral assessment (if applicable)</li>
</ul>
</li>
<li><p><strong>Final Review</strong>: Human oversight and final approval</p>
<ul>
<li>Risk assessment confirmation</li>
<li>Regulatory compliance check</li>
<li>Manual review of edge cases</li>
<li>Final approval or rejection</li>
</ul>
</li>
</ol>
<p><strong>External System Integration:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalIntegrationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BankCreditSystemClient bankCreditClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaxSystemClient taxClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SocialSecuritySystemClient socialSecurityClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Retryable(value = &#123;Exception.class&#125;, maxAttempts = 3)</span></span><br><span class="line">    <span class="keyword">public</span> CreditScoreResult <span class="title function_">getCreditScore</span><span class="params">(String applicantId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bankCreditClient.getCreditScore(applicantId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Retryable(value = &#123;Exception.class&#125;, maxAttempts = 3)</span></span><br><span class="line">    <span class="keyword">public</span> TaxInformationResult <span class="title function_">getTaxInformation</span><span class="params">(String applicantId, <span class="type">int</span> years)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> taxClient.getTaxInformation(applicantId, years);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Retryable(value = &#123;Exception.class&#125;, maxAttempts = 3)</span></span><br><span class="line">    <span class="keyword">public</span> SocialSecurityResult <span class="title function_">getSocialSecurityInfo</span><span class="params">(String applicantId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> socialSecurityClient.getSocialSecurityInfo(applicantId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Key Interview Question</strong>: <em>“How do you handle transaction consistency across multiple external system calls in a workflow?”</em></p>
<p><strong>Reference Answer</strong>: The system uses the Saga pattern for distributed transactions. Each step in the workflow is designed as a compensable transaction. If a step fails, the system executes compensation actions to maintain consistency. For example, if the final review fails after initial approvals, the system automatically triggers cleanup processes to revert any provisional approvals.</p>
<h3 id="AIWorkflowEngineService"><a href="#AIWorkflowEngineService" class="headerlink" title="AIWorkflowEngineService"></a>AIWorkflowEngineService</h3><p>The AIWorkflowEngineService leverages Spring AI to provide intelligent automation of the lending process, reducing manual intervention while maintaining accuracy.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Sl4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIWorkflowEngineService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PromptTemplateService promptTemplateService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WorkflowEngineService traditionalWorkflowService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> AIWorkflowResult <span class="title function_">processLoanApplicationWithAI</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="comment">// First, gather all relevant data</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> gatherApplicationContext(application);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Use AI to perform initial assessment</span></span><br><span class="line">        <span class="type">AIAssessmentResult</span> <span class="variable">aiAssessment</span> <span class="operator">=</span> performAIAssessment(context);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Decide whether to proceed with full automated flow or human review</span></span><br><span class="line">        <span class="keyword">if</span> (aiAssessment.getConfidenceScore() &gt; <span class="number">0.85</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> processAutomatedFlow(context, aiAssessment);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> processHybridFlow(context, aiAssessment);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> AIAssessmentResult <span class="title function_">performAIAssessment</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">promptTemplate</span> <span class="operator">=</span> promptTemplateService.getTemplate(<span class="string">&quot;loan_assessment&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; variables = Map.of(</span><br><span class="line">            <span class="string">&quot;applicantData&quot;</span>, context.getApplicantData(),</span><br><span class="line">            <span class="string">&quot;creditHistory&quot;</span>, context.getCreditHistory(),</span><br><span class="line">            <span class="string">&quot;financialData&quot;</span>, context.getFinancialData()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(promptTemplate, variables).create();</span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatModel.call(prompt);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseAIResponse(response.getResult().getOutput().getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> AIAssessmentResult <span class="title function_">parseAIResponse</span><span class="params">(String aiResponse)</span> &#123;</span><br><span class="line">        <span class="comment">// Parse structured AI response</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.readValue(aiResponse, AIAssessmentResult.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to parse AI response&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> AIAssessmentResult.lowConfidence();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Key Interview Question</strong>: <em>“How do you ensure AI decisions are explainable and auditable in a regulated financial environment?”</em></p>
<p><strong>Reference Answer</strong>: The system maintains detailed audit logs for every AI decision, including the input data, prompt templates used, model responses, and confidence scores. Each AI assessment includes reasoning chains that explain the decision logic. For regulatory compliance, the system can replay any decision by re-running the same prompt with the same input data, ensuring reproducibility and transparency.</p>
<h3 id="ChatWebUI"><a href="#ChatWebUI" class="headerlink" title="ChatWebUI"></a>ChatWebUI</h3><p>The ChatWebUI serves as the primary interface for user interaction, supporting multi-modal communication including text, files, images, and audio.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Multi-Modal Input</strong>: Text, voice, image, and document upload</li>
<li><strong>Real-Time Chat</strong>: WebSocket-based instant messaging</li>
<li><strong>Progressive Web App</strong>: Mobile-responsive design</li>
<li><strong>Accessibility</strong>: WCAG 2.1 compliant interface</li>
<li><strong>Internationalization</strong>: Multi-language support</li>
</ul>
<p><strong>React-based Implementation:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConversationService conversationService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileProcessingService fileProcessingService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/message&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ChatResponse&gt; <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@RequestBody</span> ChatRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> conversationService.processMessage(request);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)</span><br><span class="line">                .body(ChatResponse.error(<span class="string">&quot;Failed to process message&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;FileUploadResponse&gt; <span class="title function_">uploadFile</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;conversationId&quot;)</span> String conversationId)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileProcessingResult</span> <span class="variable">result</span> <span class="operator">=</span> fileProcessingService.processFile(</span><br><span class="line">                file, conversationId);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(FileUploadResponse.builder()</span><br><span class="line">                .fileId(result.getFileId())</span><br><span class="line">                .extractedText(result.getExtractedText())</span><br><span class="line">                .processingStatus(result.getStatus())</span><br><span class="line">                .build());</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)</span><br><span class="line">                .body(FileUploadResponse.error(<span class="string">&quot;File processing failed&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/conversation/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ConversationHistory&gt; <span class="title function_">getConversationHistory</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ConversationHistory</span> <span class="variable">history</span> <span class="operator">=</span> conversationService.getConversationHistory(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(history);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ConversationService"><a href="#ConversationService" class="headerlink" title="ConversationService"></a>ConversationService</h3><p>The ConversationService handles multi-modal customer interactions, supporting text, file uploads, images, and audio processing.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@sl4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConversationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KnowledgeBaseService knowledgeBaseService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AIWorkflowEngineService aiWorkflowService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ContextMemoryService contextMemoryService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ConversationResponse <span class="title function_">processMessage</span><span class="params">(ConversationRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Retrieve conversation context</span></span><br><span class="line">        <span class="type">ConversationContext</span> <span class="variable">context</span> <span class="operator">=</span> contextMemoryService.getContext(</span><br><span class="line">            request.getSessionId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process multi-modal input</span></span><br><span class="line">        <span class="type">ProcessedInput</span> <span class="variable">processedInput</span> <span class="operator">=</span> processMultiModalInput(request);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Classify intent using ReAct pattern</span></span><br><span class="line">        <span class="type">IntentClassification</span> <span class="variable">intent</span> <span class="operator">=</span> classifyIntent(processedInput, context);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (intent.getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> LOAN_APPLICATION:</span><br><span class="line">                <span class="keyword">return</span> handleLoanApplication(processedInput, context);</span><br><span class="line">            <span class="keyword">case</span> KNOWLEDGE_QUERY:</span><br><span class="line">                <span class="keyword">return</span> handleKnowledgeQuery(processedInput, context);</span><br><span class="line">            <span class="keyword">case</span> DOCUMENT_UPLOAD:</span><br><span class="line">                <span class="keyword">return</span> handleDocumentUpload(processedInput, context);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> handleGeneralChat(processedInput, context);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ProcessedInput <span class="title function_">processMultiModalInput</span><span class="params">(ConversationRequest request)</span> &#123;</span><br><span class="line">        ProcessedInput.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> ProcessedInput.builder()</span><br><span class="line">            .sessionId(request.getSessionId())</span><br><span class="line">            .timestamp(Instant.now());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process text</span></span><br><span class="line">        <span class="keyword">if</span> (request.getText() != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.text(request.getText());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process files</span></span><br><span class="line">        <span class="keyword">if</span> (request.getFiles() != <span class="literal">null</span>) &#123;</span><br><span class="line">            List&lt;ProcessedFile&gt; processedFiles = request.getFiles().stream()</span><br><span class="line">                .map(<span class="built_in">this</span>::processFile)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            builder.files(processedFiles);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process images</span></span><br><span class="line">        <span class="keyword">if</span> (request.getImages() != <span class="literal">null</span>) &#123;</span><br><span class="line">            List&lt;ProcessedImage&gt; processedImages = request.getImages().stream()</span><br><span class="line">                .map(<span class="built_in">this</span>::processImage)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            builder.images(processedImages);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="KnowledgeBaseService"><a href="#KnowledgeBaseService" class="headerlink" title="KnowledgeBaseService"></a>KnowledgeBaseService</h3><p>The KnowledgeBaseService implements a comprehensive RAG system for financial domain knowledge, supporting various document formats and providing contextually relevant responses.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@sl4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KnowledgeBaseService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorStoreService vectorStoreService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DocumentParsingService documentParsingService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmbeddingModel embeddingModel;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> KnowledgeResponse <span class="title function_">queryKnowledge</span><span class="params">(String query, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Generate embedding for the query</span></span><br><span class="line">        <span class="type">EmbeddingRequest</span> <span class="variable">embeddingRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmbeddingRequest</span>(</span><br><span class="line">            List.of(query), EmbeddingOptions.EMPTY);</span><br><span class="line">        <span class="type">EmbeddingResponse</span> <span class="variable">embeddingResponse</span> <span class="operator">=</span> embeddingModel.call(embeddingRequest);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Retrieve relevant documents</span></span><br><span class="line">        List&lt;Document&gt; relevantDocs = vectorStoreService.similaritySearch(</span><br><span class="line">            SearchRequest.query(query)</span><br><span class="line">                .withTopK(<span class="number">5</span>)</span><br><span class="line">                .withSimilarityThreshold(<span class="number">0.7</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate contextual response</span></span><br><span class="line">        <span class="keyword">return</span> generateContextualResponse(query, relevantDocs, context);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">indexDocument</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Parse document based on format</span></span><br><span class="line">            <span class="type">ParsedDocument</span> <span class="variable">parsedDoc</span> <span class="operator">=</span> documentParsingService.parse(file);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Split into chunks</span></span><br><span class="line">            List&lt;DocumentChunk&gt; chunks = splitDocument(parsedDoc);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Generate embeddings and store</span></span><br><span class="line">            <span class="keyword">for</span> (DocumentChunk chunk : chunks) &#123;</span><br><span class="line">                <span class="type">EmbeddingRequest</span> <span class="variable">embeddingRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmbeddingRequest</span>(</span><br><span class="line">                    List.of(chunk.getContent()), EmbeddingOptions.EMPTY);</span><br><span class="line">                <span class="type">EmbeddingResponse</span> <span class="variable">embeddingResponse</span> <span class="operator">=</span> embeddingModel.call(embeddingRequest);</span><br><span class="line">                </span><br><span class="line">                <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>(chunk.getContent(), </span><br><span class="line">                    Map.of(<span class="string">&quot;source&quot;</span>, file.getOriginalFilename(),</span><br><span class="line">                           <span class="string">&quot;chunk_id&quot;</span>, chunk.getId()));</span><br><span class="line">                document.setEmbedding(embeddingResponse.getResults().get(<span class="number">0</span>).getOutput());</span><br><span class="line">                </span><br><span class="line">                vectorStoreService.add(List.of(document));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to index document: &#123;&#125;&quot;</span>, file.getOriginalFilename(), e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DocumentIndexingException</span>(<span class="string">&quot;Failed to index document&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;DocumentChunk&gt; <span class="title function_">splitDocument</span><span class="params">(ParsedDocument parsedDoc)</span> &#123;</span><br><span class="line">        <span class="comment">// Implement intelligent chunking based on document structure</span></span><br><span class="line">        <span class="keyword">return</span> DocumentChunker.builder()</span><br><span class="line">            .chunkSize(<span class="number">1000</span>)</span><br><span class="line">            .chunkOverlap(<span class="number">200</span>)</span><br><span class="line">            .respectSentenceBoundaries(<span class="literal">true</span>)</span><br><span class="line">            .respectParagraphBoundaries(<span class="literal">true</span>)</span><br><span class="line">            .build()</span><br><span class="line">            .split(parsedDoc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Key-Technologies"><a href="#Key-Technologies" class="headerlink" title="Key Technologies"></a>Key Technologies</h2><h3 id="LLM-fine-tuning-with-Financial-data"><a href="#LLM-fine-tuning-with-Financial-data" class="headerlink" title="LLM fine-tuning with Financial data"></a>LLM fine-tuning with Financial data</h3><p>Fine-tuning Large Language Models with domain-specific financial data enhances their understanding of financial concepts, regulations, and terminology.</p>
<p><strong>Fine-tuning Strategy:</strong></p>
<ul>
<li><strong>Base Model Selection</strong>: Choose appropriate foundation models (GPT-4, Claude, or Llama)</li>
<li><strong>Dataset Preparation</strong>: Curate high-quality financial datasets</li>
<li><strong>Training Pipeline</strong>: Implement efficient fine-tuning workflows</li>
<li><strong>Evaluation Metrics</strong>: Define domain-specific evaluation criteria</li>
<li><strong>Continuous Learning</strong>: Update models with new financial data</li>
</ul>
<p><strong>Implementation Example:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FinancialLLMFineTuner</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ModelTrainingService trainingService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DatasetManager datasetManager;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ModelEvaluationService evaluationService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 2 * * SUN&quot;)</span> <span class="comment">// Weekly training</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">scheduledFineTuning</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Prepare training dataset</span></span><br><span class="line">            <span class="type">FinancialDataset</span> <span class="variable">dataset</span> <span class="operator">=</span> datasetManager.prepareFinancialDataset();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Configure training parameters</span></span><br><span class="line">            <span class="type">TrainingConfig</span> <span class="variable">config</span> <span class="operator">=</span> TrainingConfig.builder()</span><br><span class="line">                .baseModel(<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line">                .learningRate(<span class="number">0.0001</span>)</span><br><span class="line">                .batchSize(<span class="number">16</span>)</span><br><span class="line">                .epochs(<span class="number">3</span>)</span><br><span class="line">                .warmupSteps(<span class="number">100</span>)</span><br><span class="line">                .evaluationStrategy(EvaluationStrategy.STEPS)</span><br><span class="line">                .evaluationSteps(<span class="number">500</span>)</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Start fine-tuning</span></span><br><span class="line">            <span class="type">TrainingResult</span> <span class="variable">result</span> <span class="operator">=</span> trainingService.fineTuneModel(config, dataset);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Evaluate model performance</span></span><br><span class="line">            <span class="type">EvaluationResult</span> <span class="variable">evaluation</span> <span class="operator">=</span> evaluationService.evaluate(</span><br><span class="line">                result.getModelId(), dataset.getTestSet());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Deploy if performance meets criteria</span></span><br><span class="line">            <span class="keyword">if</span> (evaluation.getFinancialAccuracy() &gt; <span class="number">0.95</span>) &#123;</span><br><span class="line">                deployModel(result.getModelId());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Fine-tuning failed&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">deployModel</span><span class="params">(String modelId)</span> &#123;</span><br><span class="line">        <span class="comment">// Implement model deployment logic</span></span><br><span class="line">        <span class="comment">// Include A/B testing for gradual rollout</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Multi-Modal-Message-Processing"><a href="#Multi-Modal-Message-Processing" class="headerlink" title="Multi-Modal Message Processing"></a>Multi-Modal Message Processing</h3><p>The system processes diverse input types, including text, images, audio, and documents. Each modality is handled by specialized processors that extract relevant information and convert it into a unified format.</p>
<h4 id="MultiModalProcessor"><a href="#MultiModalProcessor" class="headerlink" title="MultiModalProcessor"></a>MultiModalProcessor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiModalProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AudioTranscriptionService audioTranscriptionService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ImageAnalysisService imageAnalysisService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DocumentExtractionService documentExtractionService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ProcessedInput <span class="title function_">processInput</span><span class="params">(MultiModalInput input)</span> &#123;</span><br><span class="line">        ProcessedInput.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> ProcessedInput.builder();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process audio to text</span></span><br><span class="line">        <span class="keyword">if</span> (input.hasAudio()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">transcription</span> <span class="operator">=</span> audioTranscriptionService.transcribe(input.getAudio());</span><br><span class="line">            builder.transcription(transcription);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process images</span></span><br><span class="line">        <span class="keyword">if</span> (input.hasImages()) &#123;</span><br><span class="line">            List&lt;ImageAnalysisResult&gt; imageResults = input.getImages().stream()</span><br><span class="line">                .map(imageAnalysisService::analyzeImage)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            builder.imageAnalysis(imageResults);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process documents</span></span><br><span class="line">        <span class="keyword">if</span> (input.hasDocuments()) &#123;</span><br><span class="line">            List&lt;ExtractedContent&gt; documentContents = input.getDocuments().stream()</span><br><span class="line">                .map(documentExtractionService::extractContent)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            builder.documentContents(documentContents);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Multi-Format-Document-Processing"><a href="#Multi-Format-Document-Processing" class="headerlink" title="Multi-Format Document Processing"></a>Multi-Format Document Processing</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PdfProcessor pdfProcessor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ExcelProcessor excelProcessor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WordProcessor wordProcessor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TextSplitter textSplitter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">processDocument</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> file.getContentType();</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">switch</span> (contentType) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;application/pdf&quot;</span> -&gt; pdfProcessor.extractText(file);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span> -&gt; </span><br><span class="line">                excelProcessor.extractText(file);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span> -&gt; </span><br><span class="line">                wordProcessor.extractText(file);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;text/plain&quot;</span> -&gt; <span class="keyword">new</span> <span class="title class_">String</span>(file.getBytes(), StandardCharsets.UTF_8);</span><br><span class="line">            <span class="keyword">default</span> -&gt; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedFileTypeException</span>(<span class="string">&quot;Unsupported file type: &quot;</span> + contentType);</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Split content into chunks</span></span><br><span class="line">        List&lt;String&gt; chunks = textSplitter.splitText(content);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Create documents</span></span><br><span class="line">        <span class="keyword">return</span> chunks.stream()</span><br><span class="line">            .map(chunk -&gt; Document.builder()</span><br><span class="line">                .content(chunk)</span><br><span class="line">                .metadata(Map.of(</span><br><span class="line">                    <span class="string">&quot;filename&quot;</span>, filename,</span><br><span class="line">                    <span class="string">&quot;content_type&quot;</span>, contentType,</span><br><span class="line">                    <span class="string">&quot;chunk_size&quot;</span>, String.valueOf(chunk.length())</span><br><span class="line">                ))</span><br><span class="line">                .build())</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Key Interview Question</strong>: <em>“How do you handle different file formats and ensure consistent processing across modalities?”</em></p>
<p><strong>Reference Answer</strong>: The system uses a plugin-based architecture where each file type has a dedicated processor. Common formats like PDF, DOCX, and images are handled by specialized libraries (Apache PDFBox, Apache POI, etc.). For audio, we use speech-to-text services. All processors output to a common <code>ProcessedInput</code> format, ensuring consistency downstream. The system is extensible - new processors can be added without modifying core logic.</p>
<h3 id="RAG-Implementation-for-Knowledge-Base"><a href="#RAG-Implementation-for-Knowledge-Base" class="headerlink" title="RAG Implementation for Knowledge Base"></a>RAG Implementation for Knowledge Base</h3><p>The RAG system combines vector search with contextual generation to provide accurate, relevant responses about financial topics.</p>
<h4 id="RAGService"><a href="#RAGService" class="headerlink" title="RAGService"></a>RAGService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RAGService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorStoreService vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PromptTemplateService promptTemplateService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> RAGResponse <span class="title function_">generateResponse</span><span class="params">(String query, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Step 1: Retrieve relevant documents</span></span><br><span class="line">        List&lt;Document&gt; relevantDocs = retrieveRelevantDocuments(query);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 2: Rank and filter documents</span></span><br><span class="line">        List&lt;Document&gt; rankedDocs = rankDocuments(relevantDocs, query, context);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 3: Generate response with context</span></span><br><span class="line">        <span class="keyword">return</span> generateWithContext(query, rankedDocs, context);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;Document&gt; <span class="title function_">rankDocuments</span><span class="params">(List&lt;Document&gt; documents, </span></span><br><span class="line"><span class="params">                                       String query, </span></span><br><span class="line"><span class="params">                                       ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Implement re-ranking based on:</span></span><br><span class="line">        <span class="comment">// - Semantic similarity</span></span><br><span class="line">        <span class="comment">// - Recency of information</span></span><br><span class="line">        <span class="comment">// - User&#x27;s conversation history</span></span><br><span class="line">        <span class="comment">// - Domain-specific relevance</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> documents.stream()</span><br><span class="line">            .sorted((doc1, doc2) -&gt; &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">score1</span> <span class="operator">=</span> calculateRelevanceScore(doc1, query, context);</span><br><span class="line">                <span class="type">double</span> <span class="variable">score2</span> <span class="operator">=</span> calculateRelevanceScore(doc2, query, context);</span><br><span class="line">                <span class="keyword">return</span> Double.compare(score2, score1);</span><br><span class="line">            &#125;)</span><br><span class="line">            .limit(<span class="number">3</span>)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateRelevanceScore</span><span class="params">(Document doc, String query, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">semanticScore</span> <span class="operator">=</span> calculateSemanticSimilarity(doc, query);</span><br><span class="line">        <span class="type">double</span> <span class="variable">contextScore</span> <span class="operator">=</span> calculateContextualRelevance(doc, context);</span><br><span class="line">        <span class="type">double</span> <span class="variable">freshnessScore</span> <span class="operator">=</span> calculateFreshnessScore(doc);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.5</span> * semanticScore + <span class="number">0.3</span> * contextScore + <span class="number">0.2</span> * freshnessScore;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Multi-Vector-RAG-for-Financial-Documents"><a href="#Multi-Vector-RAG-for-Financial-Documents" class="headerlink" title="Multi-Vector RAG for Financial Documents"></a>Multi-Vector RAG for Financial Documents</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedRAGService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorStore semanticVectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorStore keywordVectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GraphRAGService graphRAGService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> RAGResponse <span class="title function_">queryWithMultiVectorRAG</span><span class="params">(String query, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Semantic search</span></span><br><span class="line">        List&lt;Document&gt; semanticResults = semanticVectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(query).withTopK(<span class="number">5</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Keyword search</span></span><br><span class="line">        List&lt;Document&gt; keywordResults = keywordVectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(extractKeywords(query)).withTopK(<span class="number">5</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Graph-based retrieval for relationship context</span></span><br><span class="line">        List&lt;Document&gt; graphResults = graphRAGService.retrieveRelatedDocuments(query);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Combine and re-rank results</span></span><br><span class="line">        List&lt;Document&gt; combinedResults = reRankDocuments(</span><br><span class="line">            Arrays.asList(semanticResults, keywordResults, graphResults), </span><br><span class="line">            query</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate response with multi-vector context</span></span><br><span class="line">        <span class="keyword">return</span> generateEnhancedResponse(query, combinedResults, context);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;Document&gt; <span class="title function_">reRankDocuments</span><span class="params">(List&lt;List&lt;Document&gt;&gt; documentLists, String query)</span> &#123;</span><br><span class="line">        <span class="comment">// Implement reciprocal rank fusion (RRF)</span></span><br><span class="line">        Map&lt;String, Double&gt; documentScores = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (List&lt;Document&gt; documents : documentLists) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; documents.size(); i++) &#123;</span><br><span class="line">                <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> documents.get(i);</span><br><span class="line">                <span class="type">String</span> <span class="variable">docId</span> <span class="operator">=</span> doc.getId();</span><br><span class="line">                <span class="type">double</span> <span class="variable">score</span> <span class="operator">=</span> <span class="number">1.0</span> / (i + <span class="number">1</span>); <span class="comment">// Reciprocal rank</span></span><br><span class="line">                documentScores.merge(docId, score, Double::sum);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sort by combined score and return top results</span></span><br><span class="line">        <span class="keyword">return</span> documentScores.entrySet().stream()</span><br><span class="line">            .sorted(Map.Entry.&lt;String, Double&gt;comparingByValue().reversed())</span><br><span class="line">            .limit(<span class="number">10</span>)</span><br><span class="line">            .map(entry -&gt; findDocumentById(entry.getKey()))</span><br><span class="line">            .filter(Objects::nonNull)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Financial-Domain-Specific-Text-Splitter"><a href="#Financial-Domain-Specific-Text-Splitter" class="headerlink" title="Financial Domain-Specific Text Splitter"></a>Financial Domain-Specific Text Splitter</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FinancialTextSplitter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">FINANCIAL_SECTION_PATTERN</span> <span class="operator">=</span> </span><br><span class="line">        Pattern.compile(<span class="string">&quot;(INCOME|EXPENSES|ASSETS|LIABILITIES|CASH FLOW|CREDIT HISTORY)&quot;</span>, </span><br><span class="line">                       Pattern.CASE_INSENSITIVE);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">CURRENCY_PATTERN</span> <span class="operator">=</span> </span><br><span class="line">        Pattern.compile(<span class="string">&quot;\\$[0-9,]+\\.?[0-9]*|[0-9,]+\\.[0-9]&#123;2&#125;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">splitFinancialDocument</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        List&lt;String&gt; chunks = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Split by financial sections first</span></span><br><span class="line">        String[] sections = FINANCIAL_SECTION_PATTERN.split(text);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String section : sections) &#123;</span><br><span class="line">            <span class="keyword">if</span> (section.length() &gt; <span class="number">2000</span>) &#123;</span><br><span class="line">                <span class="comment">// Further split large sections while preserving financial context</span></span><br><span class="line">                chunks.addAll(splitLargeSection(section));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                chunks.add(section.trim());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chunks.stream()</span><br><span class="line">            .filter(chunk -&gt; !chunk.isEmpty())</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; <span class="title function_">splitLargeSection</span><span class="params">(String section)</span> &#123;</span><br><span class="line">        List&lt;String&gt; chunks = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        String[] sentences = section.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">currentChunk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String sentence : sentences) &#123;</span><br><span class="line">            <span class="keyword">if</span> (currentChunk.length() + sentence.length() &gt; <span class="number">1500</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (currentChunk.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    chunks.add(currentChunk.toString().trim());</span><br><span class="line">                    currentChunk = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            currentChunk.append(sentence).append(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Preserve financial context by keeping currency amounts together</span></span><br><span class="line">            <span class="keyword">if</span> (CURRENCY_PATTERN.matcher(sentence).find()) &#123;</span><br><span class="line">                <span class="comment">// Don&#x27;t split immediately after financial amounts</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (currentChunk.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            chunks.add(currentChunk.toString().trim());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chunks;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MCP-Server-and-Agent-to-Agent-Communication"><a href="#MCP-Server-and-Agent-to-Agent-Communication" class="headerlink" title="MCP Server and Agent-to-Agent Communication"></a>MCP Server and Agent-to-Agent Communication</h3><p>The Model Context Protocol (MCP) enables seamless communication between specialized agents, each handling specific domain expertise.</p>
<h4 id="MCPServerManager"><a href="#MCPServerManager" class="headerlink" title="MCPServerManager"></a>MCPServerManager</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MCPServerManager</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, MCPAgent&gt; agents = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializeAgents</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Initialize specialized agents</span></span><br><span class="line">        agents.put(<span class="string">&quot;credit_agent&quot;</span>, <span class="keyword">new</span> <span class="title class_">CreditAnalysisAgent</span>());</span><br><span class="line">        agents.put(<span class="string">&quot;risk_agent&quot;</span>, <span class="keyword">new</span> <span class="title class_">RiskAssessmentAgent</span>());</span><br><span class="line">        agents.put(<span class="string">&quot;compliance_agent&quot;</span>, <span class="keyword">new</span> <span class="title class_">ComplianceAgent</span>());</span><br><span class="line">        agents.put(<span class="string">&quot;document_agent&quot;</span>, <span class="keyword">new</span> <span class="title class_">DocumentAnalysisAgent</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> AgentResponse <span class="title function_">routeToAgent</span><span class="params">(String agentType, AgentRequest request)</span> &#123;</span><br><span class="line">        <span class="type">MCPAgent</span> <span class="variable">agent</span> <span class="operator">=</span> agents.get(agentType);</span><br><span class="line">        <span class="keyword">if</span> (agent == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AgentNotFoundException</span>(<span class="string">&quot;Agent not found: &quot;</span> + agentType);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> agent.process(request);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompoundResponse <span class="title function_">processWithMultipleAgents</span><span class="params">(List&lt;String&gt; agentTypes, </span></span><br><span class="line"><span class="params">                                                     AgentRequest request)</span> &#123;</span><br><span class="line">        CompoundResponse.<span class="type">Builder</span> <span class="variable">responseBuilder</span> <span class="operator">=</span> CompoundResponse.builder();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process with multiple agents in parallel</span></span><br><span class="line">        List&lt;CompletableFuture&lt;AgentResponse&gt;&gt; futures = agentTypes.stream()</span><br><span class="line">            .map(agentType -&gt; CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">                routeToAgent(agentType, request)))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        CompletableFuture.allOf(futures.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]))</span><br><span class="line">            .join();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Combine responses</span></span><br><span class="line">        List&lt;AgentResponse&gt; responses = futures.stream()</span><br><span class="line">            .map(CompletableFuture::join)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> responseBuilder.agentResponses(responses).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Credit-Analysis-Agent-Example"><a href="#Credit-Analysis-Agent-Example" class="headerlink" title="Credit Analysis Agent Example"></a>Credit Analysis Agent Example</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreditAnalysisAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@MCPMethod(&quot;analyze_credit_profile&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CreditAnalysisResult <span class="title function_">analyzeCreditProfile</span><span class="params">(CreditAnalysisRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Specialized credit analysis logic</span></span><br><span class="line">        <span class="type">CreditProfile</span> <span class="variable">profile</span> <span class="operator">=</span> request.getCreditProfile();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Calculate various credit metrics</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">debtToIncomeRatio</span> <span class="operator">=</span> calculateDebtToIncomeRatio(profile);</span><br><span class="line">        <span class="type">double</span> <span class="variable">creditUtilization</span> <span class="operator">=</span> calculateCreditUtilization(profile);</span><br><span class="line">        <span class="type">int</span> <span class="variable">paymentHistory</span> <span class="operator">=</span> analyzePaymentHistory(profile);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate risk score</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">riskScore</span> <span class="operator">=</span> calculateCreditRiskScore(debtToIncomeRatio, creditUtilization, paymentHistory);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Provide recommendations</span></span><br><span class="line">        List&lt;String&gt; recommendations = generateCreditRecommendations(profile, riskScore);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> CreditAnalysisResult.builder()</span><br><span class="line">            .riskScore(riskScore)</span><br><span class="line">            .debtToIncomeRatio(debtToIncomeRatio)</span><br><span class="line">            .creditUtilization(creditUtilization)</span><br><span class="line">            .paymentHistoryScore(paymentHistory)</span><br><span class="line">            .recommendations(recommendations)</span><br><span class="line">            .analysisTimestamp(Instant.now())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateCreditRiskScore</span><span class="params">(<span class="type">double</span> dtiRatio, <span class="type">double</span> utilization, <span class="type">int</span> paymentHistory)</span> &#123;</span><br><span class="line">        <span class="comment">// Weighted scoring algorithm</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">dtiWeight</span> <span class="operator">=</span> <span class="number">0.35</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">utilizationWeight</span> <span class="operator">=</span> <span class="number">0.30</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">paymentHistoryWeight</span> <span class="operator">=</span> <span class="number">0.35</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">dtiScore</span> <span class="operator">=</span> Math.max(<span class="number">0</span>, <span class="number">100</span> - (dtiRatio * <span class="number">2</span>)); <span class="comment">// Lower DTI = higher score</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">utilizationScore</span> <span class="operator">=</span> Math.max(<span class="number">0</span>, <span class="number">100</span> - (utilization * <span class="number">100</span>)); <span class="comment">// Lower utilization = higher score</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">paymentScore</span> <span class="operator">=</span> paymentHistory; <span class="comment">// Already normalized to 0-100</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (dtiScore * dtiWeight) + (utilizationScore * utilizationWeight) + (paymentScore * paymentHistoryWeight);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Session-Memory-and-Context-Caching-with-mem0"><a href="#Session-Memory-and-Context-Caching-with-mem0" class="headerlink" title="Session Memory and Context Caching with mem0"></a>Session Memory and Context Caching with mem0</h3><p>The mem0 solution provides sophisticated context management, maintaining conversation state and user preferences across sessions.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextMemoryService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Mem0Client mem0Client;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ConversationContext <span class="title function_">getContext</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="comment">// Try L1 cache first (Redis)</span></span><br><span class="line">        <span class="type">ConversationContext</span> <span class="variable">context</span> <span class="operator">=</span> (ConversationContext) </span><br><span class="line">            redisTemplate.opsForValue().get(<span class="string">&quot;context:&quot;</span> + sessionId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (context == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Fall back to mem0 for persistent context</span></span><br><span class="line">            context = mem0Client.getContext(sessionId);</span><br><span class="line">            <span class="keyword">if</span> (context != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Cache in Redis for quick access</span></span><br><span class="line">                redisTemplate.opsForValue().set(<span class="string">&quot;context:&quot;</span> + sessionId, </span><br><span class="line">                    context, Duration.ofMinutes(<span class="number">30</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> context != <span class="literal">null</span> ? context : <span class="keyword">new</span> <span class="title class_">ConversationContext</span>(sessionId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateContext</span><span class="params">(String sessionId, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Update both caches</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;context:&quot;</span> + sessionId, </span><br><span class="line">            context, Duration.ofMinutes(<span class="number">30</span>));</span><br><span class="line">        mem0Client.updateContext(sessionId, context);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addMemory</span><span class="params">(String sessionId, Memory memory)</span> &#123;</span><br><span class="line">        mem0Client.addMemory(sessionId, memory);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Invalidate cache to force refresh</span></span><br><span class="line">        redisTemplate.delete(<span class="string">&quot;context:&quot;</span> + sessionId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Key Interview Question</strong>: <em>“How do you handle context windows and memory management in long conversations?”</em></p>
<p><strong>Reference Answer</strong>: The system uses a hierarchical memory approach. Short-term context is kept in Redis for quick access, while long-term memories are stored in mem0. We implement context window management by summarizing older parts of conversations and keeping only the most relevant recent exchanges. The system also uses semantic clustering to group related memories and retrieves them based on relevance to the current conversation.</p>
<h3 id="LLM-ReAct-Pattern-Implementation"><a href="#LLM-ReAct-Pattern-Implementation" class="headerlink" title="LLM ReAct Pattern Implementation"></a>LLM ReAct Pattern Implementation</h3><p>The ReAct (Reasoning + Acting) pattern enables the system to break down complex queries into reasoning steps and actions.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReActEngine</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ToolRegistry toolRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReActResponse <span class="title function_">process</span><span class="params">(String query, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="type">ReActState</span> <span class="variable">state</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReActState</span>(query, context);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (!state.isComplete() &amp;&amp; state.getStepCount() &lt; MAX_STEPS) &#123;</span><br><span class="line">            <span class="comment">// Reasoning step</span></span><br><span class="line">            <span class="type">ReasoningResult</span> <span class="variable">reasoning</span> <span class="operator">=</span> performReasoning(state);</span><br><span class="line">            state.addReasoning(reasoning);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Action step</span></span><br><span class="line">            <span class="keyword">if</span> (reasoning.requiresAction()) &#123;</span><br><span class="line">                <span class="type">ActionResult</span> <span class="variable">action</span> <span class="operator">=</span> performAction(reasoning.getAction(), state);</span><br><span class="line">                state.addAction(action);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Observation step</span></span><br><span class="line">                <span class="keyword">if</span> (action.hasObservation()) &#123;</span><br><span class="line">                    state.addObservation(action.getObservation());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Check if we have enough information to provide final answer</span></span><br><span class="line">            <span class="keyword">if</span> (reasoning.canProvideAnswer()) &#123;</span><br><span class="line">                state.setComplete(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> generateFinalResponse(state);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ReasoningResult <span class="title function_">performReasoning</span><span class="params">(ReActState state)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">reasoningPrompt</span> <span class="operator">=</span> buildReasoningPrompt(state);</span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatModel.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(reasoningPrompt));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseReasoningResponse(response.getResult().getOutput().getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ActionResult <span class="title function_">performAction</span><span class="params">(Action action, ReActState state)</span> &#123;</span><br><span class="line">        <span class="type">Tool</span> <span class="variable">tool</span> <span class="operator">=</span> toolRegistry.getTool(action.getToolName());</span><br><span class="line">        <span class="keyword">if</span> (tool == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ActionResult.error(<span class="string">&quot;Tool not found: &quot;</span> + action.getToolName());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> tool.execute(action.getParameters(), state.getContext());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="LLM-Planning-Pattern-implementation"><a href="#LLM-Planning-Pattern-implementation" class="headerlink" title="LLM Planning Pattern implementation"></a>LLM Planning Pattern implementation</h3><p>The Planning pattern enables the system to create and execute complex multi-step plans for loan processing workflows.</p>
<p><strong>Planning Implementation:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlanningAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskExecutor taskExecutor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PlanValidator planValidator;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> PlanExecutionResult <span class="title function_">executePlan</span><span class="params">(String objective, PlanningConfig config)</span> &#123;</span><br><span class="line">        <span class="comment">// Step 1: Generate plan</span></span><br><span class="line">        <span class="type">Plan</span> <span class="variable">plan</span> <span class="operator">=</span> generatePlan(objective, config);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 2: Validate plan</span></span><br><span class="line">        <span class="type">ValidationResult</span> <span class="variable">validation</span> <span class="operator">=</span> planValidator.validate(plan);</span><br><span class="line">        <span class="keyword">if</span> (!validation.isValid()) &#123;</span><br><span class="line">            <span class="keyword">return</span> PlanExecutionResult.failed(validation.getErrors());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Step 3: Execute plan</span></span><br><span class="line">        <span class="keyword">return</span> executePlanSteps(plan);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Plan <span class="title function_">generatePlan</span><span class="params">(String objective, PlanningConfig config)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;Create a detailed plan to achieve the following objective: %s\n\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Available capabilities: %s\n\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Constraints: %s\n\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Generate a step-by-step plan with the following format:\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;1. Step description\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   - Required tools: [tool1, tool2]\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   - Expected output: description\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   - Dependencies: [step numbers]\n\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Plan:&quot;</span>,</span><br><span class="line">            objective,</span><br><span class="line">            config.getAvailableCapabilities(),</span><br><span class="line">            config.getConstraints());</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt));</span><br><span class="line">        <span class="keyword">return</span> parsePlan(response.getResult().getOutput().getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> PlanExecutionResult <span class="title function_">executePlanSteps</span><span class="params">(Plan plan)</span> &#123;</span><br><span class="line">        List&lt;StepResult&gt; stepResults = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Map&lt;String, Object&gt; context = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (PlanStep step : plan.getSteps()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Check dependencies</span></span><br><span class="line">                <span class="keyword">if</span> (!areDependenciesMet(step, stepResults)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> PlanExecutionResult.failed(<span class="string">&quot;Dependencies not met for step: &quot;</span> + step.getId());</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Execute step</span></span><br><span class="line">                <span class="type">StepResult</span> <span class="variable">result</span> <span class="operator">=</span> executeStep(step, context);</span><br><span class="line">                stepResults.add(result);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Update context with results</span></span><br><span class="line">                context.put(step.getId(), result.getOutput());</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Check if step failed</span></span><br><span class="line">                <span class="keyword">if</span> (!result.isSuccess()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> PlanExecutionResult.failed(<span class="string">&quot;Step failed: &quot;</span> + step.getId());</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">return</span> PlanExecutionResult.failed(<span class="string">&quot;Step execution error: &quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> PlanExecutionResult.success(stepResults);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> StepResult <span class="title function_">executeStep</span><span class="params">(PlanStep step, Map&lt;String, Object&gt; context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> taskExecutor.execute(TaskExecution.builder()</span><br><span class="line">            .stepId(step.getId())</span><br><span class="line">            .description(step.getDescription())</span><br><span class="line">            .tools(step.getRequiredTools())</span><br><span class="line">            .context(context)</span><br><span class="line">            .build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example: Loan processing planning</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoanProcessingPlanner</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PlanningAgent planningAgent;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> LoanProcessingResult <span class="title function_">processLoanWithPlanning</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">objective</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;Process loan application for %s requesting $%,.2f. &quot;</span> +</span><br><span class="line">            <span class="string">&quot;Complete all required verifications and make final decision.&quot;</span>,</span><br><span class="line">            application.getApplicantName(),</span><br><span class="line">            application.getRequestedAmount());</span><br><span class="line">        </span><br><span class="line">        <span class="type">PlanningConfig</span> <span class="variable">config</span> <span class="operator">=</span> PlanningConfig.builder()</span><br><span class="line">            .availableCapabilities(Arrays.asList(</span><br><span class="line">                <span class="string">&quot;document_verification&quot;</span>, <span class="string">&quot;credit_check&quot;</span>, <span class="string">&quot;income_verification&quot;</span>,</span><br><span class="line">                <span class="string">&quot;employment_verification&quot;</span>, <span class="string">&quot;risk_assessment&quot;</span>, <span class="string">&quot;compliance_check&quot;</span>))</span><br><span class="line">            .constraints(Arrays.asList(</span><br><span class="line">                <span class="string">&quot;Must complete within 30 minutes&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Must verify all required documents&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Must comply with lending regulations&quot;</span>))</span><br><span class="line">            .build();</span><br><span class="line">        </span><br><span class="line">        <span class="type">PlanExecutionResult</span> <span class="variable">result</span> <span class="operator">=</span> planningAgent.executePlan(objective, config);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> LoanProcessingResult.builder()</span><br><span class="line">            .application(application)</span><br><span class="line">            .executionResult(result)</span><br><span class="line">            .decision(extractDecisionFromPlan(result))</span><br><span class="line">            .processingTime(result.getExecutionTime())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Model-Providers-Routing-with-Higress-AI-gateway"><a href="#Model-Providers-Routing-with-Higress-AI-gateway" class="headerlink" title="Model Providers Routing with Higress AI gateway"></a>Model Providers Routing with Higress AI gateway</h3><p>Higress AI Gateway provides intelligent routing and load balancing across multiple LLM providers, ensuring optimal performance and cost efficiency.</p>
<p><strong>Gateway Configuration:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HigressAIGatewayConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ModelProviderRouter <span class="title function_">modelProviderRouter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ModelProviderRouter.builder()</span><br><span class="line">            .addProvider(<span class="string">&quot;openai&quot;</span>, OpenAIProvider.builder()</span><br><span class="line">                .apiKey(<span class="string">&quot;$&#123;openai.api-key&#125;&quot;</span>)</span><br><span class="line">                .models(Arrays.asList(<span class="string">&quot;gpt-4&quot;</span>, <span class="string">&quot;gpt-3.5-turbo&quot;</span>))</span><br><span class="line">                .rateLimits(RateLimits.builder()</span><br><span class="line">                    .requestsPerMinute(<span class="number">60</span>)</span><br><span class="line">                    .tokensPerMinute(<span class="number">150000</span>)</span><br><span class="line">                    .build())</span><br><span class="line">                .build())</span><br><span class="line">            .addProvider(<span class="string">&quot;anthropic&quot;</span>, AnthropicProvider.builder()</span><br><span class="line">                .apiKey(<span class="string">&quot;$&#123;anthropic.api-key&#125;&quot;</span>)</span><br><span class="line">                .models(Arrays.asList(<span class="string">&quot;claude-3-opus&quot;</span>, <span class="string">&quot;claude-3-sonnet&quot;</span>))</span><br><span class="line">                .rateLimits(RateLimits.builder()</span><br><span class="line">                    .requestsPerMinute(<span class="number">50</span>)</span><br><span class="line">                    .tokensPerMinute(<span class="number">100000</span>)</span><br><span class="line">                    .build())</span><br><span class="line">                .build())</span><br><span class="line">            .addProvider(<span class="string">&quot;azure&quot;</span>, AzureProvider.builder()</span><br><span class="line">                .apiKey(<span class="string">&quot;$&#123;azure.api-key&#125;&quot;</span>)</span><br><span class="line">                .endpoint(<span class="string">&quot;$&#123;azure.endpoint&#125;&quot;</span>)</span><br><span class="line">                .models(Arrays.asList(<span class="string">&quot;gpt-4&quot;</span>, <span class="string">&quot;gpt-35-turbo&quot;</span>))</span><br><span class="line">                .rateLimits(RateLimits.builder()</span><br><span class="line">                    .requestsPerMinute(<span class="number">100</span>)</span><br><span class="line">                    .tokensPerMinute(<span class="number">200000</span>)</span><br><span class="line">                    .build())</span><br><span class="line">                .build())</span><br><span class="line">            .routingStrategy(RoutingStrategy.WEIGHTED_ROUND_ROBIN)</span><br><span class="line">            .fallbackStrategy(FallbackStrategy.CASCADE)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntelligentModelRouter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ModelProviderRouter router;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ModelPerformanceMonitor monitor;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CostOptimizer costOptimizer;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ModelResponse <span class="title function_">routeRequest</span><span class="params">(ModelRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Determine optimal provider based on request characteristics</span></span><br><span class="line">        <span class="type">ProviderSelection</span> <span class="variable">selection</span> <span class="operator">=</span> selectOptimalProvider(request);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Route to selected provider</span></span><br><span class="line">            <span class="type">ModelResponse</span> <span class="variable">response</span> <span class="operator">=</span> router.route(request, selection.getProvider());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Update performance metrics</span></span><br><span class="line">            monitor.recordSuccess(selection.getProvider(), response.getLatency());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// Handle failures with fallback</span></span><br><span class="line">            <span class="keyword">return</span> handleFailureWithFallback(request, selection, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ProviderSelection <span class="title function_">selectOptimalProvider</span><span class="params">(ModelRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Analyze request characteristics</span></span><br><span class="line">        <span class="type">RequestAnalysis</span> <span class="variable">analysis</span> <span class="operator">=</span> analyzeRequest(request);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Consider multiple factors for provider selection</span></span><br><span class="line">        List&lt;ProviderScore&gt; scores = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String provider : router.getAvailableProviders()) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">score</span> <span class="operator">=</span> calculateProviderScore(provider, analysis);</span><br><span class="line">            scores.add(<span class="keyword">new</span> <span class="title class_">ProviderScore</span>(provider, score));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Select provider with highest score</span></span><br><span class="line">        <span class="type">ProviderScore</span> <span class="variable">best</span> <span class="operator">=</span> scores.stream()</span><br><span class="line">            .max(Comparator.comparingDouble(ProviderScore::getScore))</span><br><span class="line">            .orElse(scores.get(<span class="number">0</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ProviderSelection.builder()</span><br><span class="line">            .provider(best.getProvider())</span><br><span class="line">            .confidence(best.getScore())</span><br><span class="line">            .reasoning(generateSelectionReasoning(best, analysis))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateProviderScore</span><span class="params">(String provider, RequestAnalysis analysis)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">score</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Factor 1: Model capability match</span></span><br><span class="line">        score += calculateCapabilityScore(provider, analysis) * <span class="number">0.4</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Factor 2: Performance (latency, availability)</span></span><br><span class="line">        score += calculatePerformanceScore(provider) * <span class="number">0.3</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Factor 3: Cost efficiency</span></span><br><span class="line">        score += calculateCostScore(provider, analysis) * <span class="number">0.2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Factor 4: Current load</span></span><br><span class="line">        score += calculateLoadScore(provider) * <span class="number">0.1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ModelResponse <span class="title function_">handleFailureWithFallback</span><span class="params">(</span></span><br><span class="line"><span class="params">            ModelRequest request, ProviderSelection selection, Exception error)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        log.warn(<span class="string">&quot;Provider &#123;&#125; failed, attempting fallback&quot;</span>, selection.getProvider(), error);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Get fallback providers</span></span><br><span class="line">        List&lt;String&gt; fallbackProviders = router.getFallbackProviders(selection.getProvider());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String fallbackProvider : fallbackProviders) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ModelResponse</span> <span class="variable">response</span> <span class="operator">=</span> router.route(request, fallbackProvider);</span><br><span class="line">                monitor.recordFallbackSuccess(fallbackProvider);</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception fallbackError) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;Fallback provider &#123;&#125; also failed&quot;</span>, fallbackProvider, fallbackError);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// All providers failed</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ModelRoutingException</span>(<span class="string">&quot;All providers failed for request&quot;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="LLM-Prompt-Templates-via-Nacos"><a href="#LLM-Prompt-Templates-via-Nacos" class="headerlink" title="LLM Prompt Templates via Nacos"></a>LLM Prompt Templates via Nacos</h3><p>Dynamic prompt management through Nacos configuration center enables hot-swapping of prompts without system restart.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;prompts&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromptTemplateService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NacosValue(&quot;$&#123;prompts.loan-assessment&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loanAssessmentTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NacosValue(&quot;$&#123;prompts.risk-analysis&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String riskAnalysisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NacosValue(&quot;$&#123;prompts.knowledge-query&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String knowledgeQueryTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; templateCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializeTemplates</span><span class="params">()</span> &#123;</span><br><span class="line">        templateCache.put(<span class="string">&quot;loan_assessment&quot;</span>, loanAssessmentTemplate);</span><br><span class="line">        templateCache.put(<span class="string">&quot;risk_analysis&quot;</span>, riskAnalysisTemplate);</span><br><span class="line">        templateCache.put(<span class="string">&quot;knowledge_query&quot;</span>, knowledgeQueryTemplate);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTemplate</span><span class="params">(String templateName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> templateCache.getOrDefault(templateName, getDefaultTemplate());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NacosConfigListener(dataId = &quot;prompts&quot;, type = ConfigType.YAML)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onConfigChange</span><span class="params">(String configInfo)</span> &#123;</span><br><span class="line">        <span class="comment">// Hot reload templates when configuration changes</span></span><br><span class="line">        log.info(<span class="string">&quot;Prompt templates updated, reloading...&quot;</span>);</span><br><span class="line">        <span class="comment">// Parse new configuration and update cache</span></span><br><span class="line">        updateTemplateCache(configInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateTemplateCache</span><span class="params">(String configInfo)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>(<span class="keyword">new</span> <span class="title class_">YAMLFactory</span>());</span><br><span class="line">            Map&lt;String, String&gt; newTemplates = mapper.readValue(configInfo, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;Map&lt;String, String&gt;&gt;() &#123;&#125;);</span><br><span class="line">            </span><br><span class="line">            templateCache.clear();</span><br><span class="line">            templateCache.putAll(newTemplates);</span><br><span class="line">            </span><br><span class="line">            log.info(<span class="string">&quot;Successfully updated &#123;&#125; prompt templates&quot;</span>, newTemplates.size());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to update prompt templates&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Monitoring-and-Observability-with-OpenTelemetry"><a href="#Monitoring-and-Observability-with-OpenTelemetry" class="headerlink" title="Monitoring and Observability with OpenTelemetry"></a>Monitoring and Observability with OpenTelemetry</h3><p>OpenTelemetry provides comprehensive observability for the AI system, enabling performance monitoring, error tracking, and optimization insights.</p>
<p><strong>OpenTelemetry Configuration:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenTelemetryConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OpenTelemetry <span class="title function_">openTelemetry</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenTelemetySdk.builder()</span><br><span class="line">            .setTracerProvider(</span><br><span class="line">                SdkTracerProvider.builder()</span><br><span class="line">                    .addSpanProcessor(BatchSpanProcessor.builder(</span><br><span class="line">                        OtlpGrpcSpanExporter.builder()</span><br><span class="line">                            .setEndpoint(<span class="string">&quot;http://jaeger:14250&quot;</span>)</span><br><span class="line">                            .build())</span><br><span class="line">                        .build())</span><br><span class="line">                    .setResource(Resource.getDefault()</span><br><span class="line">                        .merge(Resource.builder()</span><br><span class="line">                            .put(ResourceAttributes.SERVICE_NAME, <span class="string">&quot;fintech-ai-system&quot;</span>)</span><br><span class="line">                            .put(ResourceAttributes.SERVICE_VERSION, <span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">                            .build()))</span><br><span class="line">                    .build())</span><br><span class="line">            .setMeterProvider(</span><br><span class="line">                SdkMeterProvider.builder()</span><br><span class="line">                    .registerMetricReader(</span><br><span class="line">                        PeriodicMetricReader.builder(</span><br><span class="line">                            OtlpGrpcMetricExporter.builder()</span><br><span class="line">                                .setEndpoint(<span class="string">&quot;http://prometheus:9090&quot;</span>)</span><br><span class="line">                                .build())</span><br><span class="line">                            .setInterval(Duration.ofSeconds(<span class="number">30</span>))</span><br><span class="line">                            .build())</span><br><span class="line">                    .build())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AISystemObservability</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Tracer tracer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Meter meter;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Metrics</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter requestCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Histogram responseTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge activeConnections;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AISystemObservability</span><span class="params">(OpenTelemetry openTelemetry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tracer = openTelemetry.getTracer(<span class="string">&quot;fintech-ai-system&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.meter = openTelemetry.getMeter(<span class="string">&quot;fintech-ai-system&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Initialize metrics</span></span><br><span class="line">        <span class="built_in">this</span>.requestCounter = meter.counterBuilder(<span class="string">&quot;ai_requests_total&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;Total number of AI requests&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">this</span>.responseTime = meter.histogramBuilder(<span class="string">&quot;ai_response_time_seconds&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;AI response time in seconds&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">this</span>.activeConnections = meter.gaugeBuilder(<span class="string">&quot;ai_active_connections&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;Number of active AI connections&quot;</span>)</span><br><span class="line">            .buildObserver();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">traceAIOperation</span><span class="params">(String operationName, Supplier&lt;T&gt; operation)</span> &#123;</span><br><span class="line">        <span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span> tracer.spanBuilder(operationName)</span><br><span class="line">            .setSpanKind(SpanKind.INTERNAL)</span><br><span class="line">            .startSpan();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> span.makeCurrent()) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Execute operation</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> operation.get();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Record metrics</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.nanoTime() - startTime;</span><br><span class="line">            responseTime.record(duration / <span class="number">1_000_000_000.0</span>);</span><br><span class="line">            requestCounter.add(<span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Add span attributes</span></span><br><span class="line">            span.setStatus(StatusCode.OK);</span><br><span class="line">            span.setAttribute(<span class="string">&quot;operation.success&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            span.setStatus(StatusCode.ERROR, e.getMessage());</span><br><span class="line">            span.setAttribute(<span class="string">&quot;operation.success&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">            span.setAttribute(<span class="string">&quot;error.type&quot;</span>, e.getClass().getSimpleName());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            span.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordLLMMetrics</span><span class="params">(String provider, String model, <span class="type">long</span> tokens, </span></span><br><span class="line"><span class="params">                               <span class="type">double</span> latency, <span class="type">boolean</span> success)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Attributes</span> <span class="variable">attributes</span> <span class="operator">=</span> Attributes.builder()</span><br><span class="line">            .put(<span class="string">&quot;provider&quot;</span>, provider)</span><br><span class="line">            .put(<span class="string">&quot;model&quot;</span>, model)</span><br><span class="line">            .put(<span class="string">&quot;success&quot;</span>, success)</span><br><span class="line">            .build();</span><br><span class="line">        </span><br><span class="line">        meter.counterBuilder(<span class="string">&quot;llm_requests_total&quot;</span>)</span><br><span class="line">            .build()</span><br><span class="line">            .add(<span class="number">1</span>, attributes);</span><br><span class="line">        </span><br><span class="line">        meter.histogramBuilder(<span class="string">&quot;llm_token_usage&quot;</span>)</span><br><span class="line">            .build()</span><br><span class="line">            .record(tokens, attributes);</span><br><span class="line">        </span><br><span class="line">        meter.histogramBuilder(<span class="string">&quot;llm_latency_seconds&quot;</span>)</span><br><span class="line">            .build()</span><br><span class="line">            .record(latency, attributes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage in services</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonitoredAIService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AISystemObservability observability;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">processWithMonitoring</span><span class="params">(String query)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> observability.traceAIOperation(<span class="string">&quot;llm_query_processing&quot;</span>, () -&gt; &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(query));</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Record success metrics</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">latency</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">                observability.recordLLMMetrics(<span class="string">&quot;openai&quot;</span>, <span class="string">&quot;gpt-4&quot;</span>, </span><br><span class="line">                    response.getResult().getMetadata().getUsage().getTotalTokens(),</span><br><span class="line">                    latency / <span class="number">1000.0</span>, <span class="literal">true</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> response.getResult().getOutput().getContent();</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// Record failure metrics</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">latency</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">                observability.recordLLMMetrics(<span class="string">&quot;openai&quot;</span>, <span class="string">&quot;gpt-4&quot;</span>, <span class="number">0</span>, </span><br><span class="line">                    latency / <span class="number">1000.0</span>, <span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Use-Cases-and-Examples"><a href="#Use-Cases-and-Examples" class="headerlink" title="Use Cases and Examples"></a>Use Cases and Examples</h2><h3 id="Use-Case-1-Automated-Loan-Application-Processing"><a href="#Use-Case-1-Automated-Loan-Application-Processing" class="headerlink" title="Use Case 1: Automated Loan Application Processing"></a>Use Case 1: Automated Loan Application Processing</h3><p><strong>Scenario</strong>: A customer applies for a $50,000 personal loan through the chat interface.</p>
<p><strong>Flow</strong>:</p>
<ol>
<li>Customer initiates conversation: “I’d like to apply for a personal loan”</li>
<li>AI classifies intent as LOAN_APPLICATION</li>
<li>System guides customer through document collection</li>
<li>AI processes submitted documents using OCR and NLP</li>
<li>Automated workflow calls external systems for verification</li>
<li>AI makes preliminary assessment with 92% confidence</li>
<li>System auto-approves loan with conditions</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example implementation</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAutomatedLoanFlow</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Simulate customer input</span></span><br><span class="line">    <span class="type">ConversationRequest</span> <span class="variable">request</span> <span class="operator">=</span> ConversationRequest.builder()</span><br><span class="line">        .text(<span class="string">&quot;I need a $50,000 personal loan&quot;</span>)</span><br><span class="line">        .sessionId(<span class="string">&quot;session-123&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Process through conversation service</span></span><br><span class="line">    <span class="type">ConversationResponse</span> <span class="variable">response</span> <span class="operator">=</span> conversationService.processMessage(request);</span><br><span class="line">    </span><br><span class="line">    assertThat(response.getIntent()).isEqualTo(IntentType.LOAN_APPLICATION);</span><br><span class="line">    assertThat(response.getNextSteps()).contains(<span class="string">&quot;document_collection&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Simulate document upload</span></span><br><span class="line">    <span class="type">ConversationRequest</span> <span class="variable">docRequest</span> <span class="operator">=</span> ConversationRequest.builder()</span><br><span class="line">        .files(Arrays.asList(mockPayStub, mockBankStatement))</span><br><span class="line">        .sessionId(<span class="string">&quot;session-123&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">    </span><br><span class="line">    <span class="type">ConversationResponse</span> <span class="variable">docResponse</span> <span class="operator">=</span> conversationService.processMessage(docRequest);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Verify AI processing</span></span><br><span class="line">    assertThat(docResponse.getProcessingResult().getConfidence()).isGreaterThan(<span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Use-Case-2-Multi-Modal-Customer-Support"><a href="#Use-Case-2-Multi-Modal-Customer-Support" class="headerlink" title="Use Case 2: Multi-Modal Customer Support"></a>Use Case 2: Multi-Modal Customer Support</h3><p><strong>Scenario</strong>: Customer uploads a photo of their bank statement and asks about eligibility.</p>
<p><strong>Flow</strong>:</p>
<ol>
<li>Customer uploads bank statement image</li>
<li>OCR extracts text and financial data</li>
<li>AI analyzes income patterns and expenses</li>
<li>System queries knowledge base for eligibility criteria</li>
<li>AI provides personalized eligibility assessment</li>
</ol>
<h3 id="Use-Case-3-Complex-Financial-Query-Resolution"><a href="#Use-Case-3-Complex-Financial-Query-Resolution" class="headerlink" title="Use Case 3: Complex Financial Query Resolution"></a>Use Case 3: Complex Financial Query Resolution</h3><p><strong>Scenario</strong>: “What are the tax implications of early loan repayment?”</p>
<p><strong>Flow</strong>:</p>
<ol>
<li>ReAct engine breaks down the query</li>
<li>System retrieves relevant tax documents from knowledge base</li>
<li>AI reasons through tax implications step by step</li>
<li>System provides comprehensive answer with citations</li>
</ol>
<h2 id="Performance-Optimization-and-Scalability"><a href="#Performance-Optimization-and-Scalability" class="headerlink" title="Performance Optimization and Scalability"></a>Performance Optimization and Scalability</h2><h3 id="Caching-Strategy"><a href="#Caching-Strategy" class="headerlink" title="Caching Strategy"></a>Caching Strategy</h3><p>The system implements a multi-level caching strategy to achieve sub-30-second response times:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachingService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;llm-responses&quot;, key = &quot;#promptHash&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCachedResponse</span><span class="params">(String promptHash)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (String) redisTemplate.opsForValue().get(<span class="string">&quot;llm:&quot;</span> + promptHash);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CachePut(value = &quot;llm-responses&quot;, key = &quot;#promptHash&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">cacheResponse</span><span class="params">(String promptHash, String response)</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;llm:&quot;</span> + promptHash, response, </span><br><span class="line">            Duration.ofHours(<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;embeddings&quot;, key = &quot;#text.hashCode()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Float&gt; <span class="title function_">getCachedEmbedding</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (List&lt;Float&gt;) redisTemplate.opsForValue().get(<span class="string">&quot;embedding:&quot;</span> + text.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Load-Balancing-and-Horizontal-Scaling"><a href="#Load-Balancing-and-Horizontal-Scaling" class="headerlink" title="Load Balancing and Horizontal Scaling"></a>Load Balancing and Horizontal Scaling</h3><pre>
<code class="mermaid">
flowchart LR
A[Load Balancer] --&gt; B[Service Instance 1]
A --&gt; C[Service Instance 2]
A --&gt; D[Service Instance 3]

B --&gt; E[LLM Provider 1]
B --&gt; F[LLM Provider 2]
C --&gt; E
C --&gt; F
D --&gt; E
D --&gt; F

E --&gt; G[Redis Cache]
F --&gt; G

B --&gt; H[Vector DB]
C --&gt; H
D --&gt; H
</code>
</pre>

<h3 id="Database-Optimization"><a href="#Database-Optimization" class="headerlink" title="Database Optimization"></a>Database Optimization</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;loan_applications&quot;, indexes = &#123;</span></span><br><span class="line"><span class="meta">    @Index(name = &quot;idx_applicant_status&quot;, columnList = &quot;applicant_id, status&quot;),</span></span><br><span class="line"><span class="meta">    @Index(name = &quot;idx_created_date&quot;, columnList = &quot;created_date&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoanApplication</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;applicant_id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String applicantId;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;status&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationStatus status;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_date&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdDate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Optimized for queries</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;search_vector&quot;, columnDefinition = &quot;tsvector&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String searchVector;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Key Interview Question</strong>: <em>“How do you ensure the system can handle 2000+ concurrent users while maintaining response times?”</em></p>
<p><strong>Reference Answer</strong>: The system uses several optimization techniques: 1) Multi-level caching with Redis for frequently accessed data, 2) Connection pooling for database and external service calls, 3) Asynchronous processing for non-critical operations, 4) Load balancing across multiple LLM providers, 5) Database query optimization with proper indexing, 6) Context caching to avoid repeated LLM calls for similar queries, and 7) Horizontal scaling of microservices based on demand.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>The FinTech AI Workflow and Chat System represents a sophisticated integration of traditional financial workflows with cutting-edge AI technologies. By combining the reliability of established banking processes with the intelligence of modern AI systems, the platform delivers a superior user experience while maintaining the security and compliance requirements essential in financial services.</p>
<p>The architecture’s microservices design ensures scalability and maintainability, while the AI components provide intelligent automation that reduces processing time and improves accuracy. The system’s ability to handle over 2000 concurrent conversations with rapid response times demonstrates its enterprise readiness.</p>
<p>Key success factors include:</p>
<ul>
<li>Seamless integration between traditional and AI-powered workflows</li>
<li>Robust multi-modal processing capabilities</li>
<li>Intelligent context management and memory systems</li>
<li>Flexible prompt template management for rapid iteration</li>
<li>Comprehensive performance optimization strategies</li>
</ul>
<p>The system sets a new standard for AI-powered financial services, combining the best of human expertise with artificial intelligence to create a truly intelligent lending platform.</p>
<h2 id="External-Resources-and-References"><a href="#External-Resources-and-References" class="headerlink" title="External Resources and References"></a>External Resources and References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/">Spring AI Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://higress.io/">Higress AI Gateway</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mem0ai/mem0">mem0 Memory Management</a></li>
<li><a target="_blank" rel="noopener" href="https://nacos.io/">Nacos Configuration Center</a></li>
<li><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/">LangGraph Pattern Implementation</a></li>
<li><a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/">Model Context Protocol (MCP)</a></li>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2210.03629">ReAct Pattern Paper</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.llamaindex.ai/en/stable/getting_started/concepts.html">RAG Best Practices</a></li>
<li><a target="_blank" rel="noopener" href="https://www.federalregister.gov/documents/2021/03/15/2021-05015/artificial-intelligence-risk-management">Financial Services AI Compliance Guidelines</a></li>
<li><a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/production-best-practices">OpenAI API Best Practices</a></li>
<li><a target="_blank" rel="noopener" href="https://www.pinecone.io/learn/vector-database-performance/">Vector Database Performance Optimization</a></li>
<li><a target="_blank" rel="noopener" href="https://microservices.io/patterns/security/">Microservices Security Patterns</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/" rel="prev" title="Design Distributed Pressure Test Tool By Zookeeper">
                  <i class="fa fa-angle-left"></i> Design Distributed Pressure Test Tool By Zookeeper
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/07/28/Java-Basic-Interview-Questions-Reference-Answers/" rel="next" title="Java Basic Interview Questions-Reference Answers">
                  Java Basic Interview Questions-Reference Answers <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
