<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Executive SummaryThis document presents a comprehensive design for a modern FinTech AI-powered lending system that combines traditional workflow engines with artificial intelligence to automate and en">
<meta property="og:type" content="article">
<meta property="og:title" content="Design FinTech AI Workflow and Chat System">
<meta property="og:url" content="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="Executive SummaryThis document presents a comprehensive design for a modern FinTech AI-powered lending system that combines traditional workflow engines with artificial intelligence to automate and en">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-07-02T09:39:48.000Z">
<meta property="article:modified_time" content="2025-07-02T09:41:03.190Z">
<meta property="article:author" content="Charlie Feng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/","path":"2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/","title":"Design FinTech AI Workflow and Chat System"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Design FinTech AI Workflow and Chat System | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Executive-Summary"><span class="nav-number">1.</span> <span class="nav-text">Executive Summary</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#System-Architecture-Overview"><span class="nav-number">2.</span> <span class="nav-text">System Architecture Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WorkflowEngineService-Traditional-Foundation"><span class="nav-number">3.</span> <span class="nav-text">WorkflowEngineService - Traditional Foundation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Core-Workflow-Implementation"><span class="nav-number">3.1.</span> <span class="nav-text">Core Workflow Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#External-Service-Integration-Patterns"><span class="nav-number">3.2.</span> <span class="nav-text">External Service Integration Patterns</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AIWorkflowEngineService-Intelligent-Enhancement"><span class="nav-number">4.</span> <span class="nav-text">AIWorkflowEngineService - Intelligent Enhancement</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-AI-Integration"><span class="nav-number">4.1.</span> <span class="nav-text">Spring AI Integration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Intelligent-Decision-Trees"><span class="nav-number">4.2.</span> <span class="nav-text">Intelligent Decision Trees</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ChatWebUI-Interactive-User-Experience"><span class="nav-number">5.</span> <span class="nav-text">ChatWebUI - Interactive User Experience</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Multi-Modal-Chat-Interface"><span class="nav-number">5.1.</span> <span class="nav-text">Multi-Modal Chat Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Real-time-Document-Processing"><span class="nav-number">5.2.</span> <span class="nav-text">Real-time Document Processing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KnowledgeBaseService-RAG-Implementation"><span class="nav-number">6.</span> <span class="nav-text">KnowledgeBaseService - RAG Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Vector-Database-Integration"><span class="nav-number">6.1.</span> <span class="nav-text">Vector Database Integration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Intelligent-FAQ-System"><span class="nav-number">6.2.</span> <span class="nav-text">Intelligent FAQ System</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Production-Ready-Implementation-Considerations"><span class="nav-number">7.</span> <span class="nav-text">Production-Ready Implementation Considerations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Monitoring-and-Observability"><span class="nav-number">7.1.</span> <span class="nav-text">Monitoring and Observability</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-Implementation"><span class="nav-number">7.2.</span> <span class="nav-text">Security Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-Use-Cases-and-Examples"><span class="nav-number">8.</span> <span class="nav-text">Advanced Use Cases and Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-1-Automated-Income-Verification"><span class="nav-number">8.1.</span> <span class="nav-text">Use Case 1: Automated Income Verification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-2-Intelligent-Risk-Assessment"><span class="nav-number">8.2.</span> <span class="nav-text">Use Case 2: Intelligent Risk Assessment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Case-3-Conversational-Loan-Application"><span class="nav-number">8.3.</span> <span class="nav-text">Use Case 3: Conversational Loan Application</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-Optimization-Strategies"><span class="nav-number">9.</span> <span class="nav-text">Performance Optimization Strategies</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Caching-Implementation"><span class="nav-number">9.1.</span> <span class="nav-text">Caching Implementation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Asynchronous-Processing"><span class="nav-number">9.2.</span> <span class="nav-text">Asynchronous Processing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Testing-Strategies"><span class="nav-number">10.</span> <span class="nav-text">Testing Strategies</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AI-Component-Testing"><span class="nav-number">10.1.</span> <span class="nav-text">AI Component Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Integration-Testing"><span class="nav-number">10.2.</span> <span class="nav-text">Integration Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interview-Questions-and-Insights"><span class="nav-number">11.</span> <span class="nav-text">Interview Questions and Insights</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deployment-and-DevOps-Considerations"><span class="nav-number">12.</span> <span class="nav-text">Deployment and DevOps Considerations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-Configuration"><span class="nav-number">12.1.</span> <span class="nav-text">Docker Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-Deployment"><span class="nav-number">12.2.</span> <span class="nav-text">Kubernetes Deployment</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">13.</span> <span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#External-References"><span class="nav-number">14.</span> <span class="nav-text">External References</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/07/02/Design-FinTech-AI-Workflow-and-Chat-System/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Design FinTech AI Workflow and Chat System | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Design FinTech AI Workflow and Chat System
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-07-02 17:39:48 / Modified: 17:41:03" itemprop="dateCreated datePublished" datetime="2025-07-02T17:39:48+08:00">2025-07-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Executive-Summary"><a href="#Executive-Summary" class="headerlink" title="Executive Summary"></a>Executive Summary</h2><p>This document presents a comprehensive design for a modern FinTech AI-powered lending system that combines traditional workflow engines with artificial intelligence to automate and enhance the personal loan approval process. The system integrates multiple external services, implements intelligent decision-making through AI agents, and provides a seamless user experience through an interactive chat interface.</p>
<h2 id="System-Architecture-Overview"><a href="#System-Architecture-Overview" class="headerlink" title="System Architecture Overview"></a>System Architecture Overview</h2><p>The system consists of five core components working in harmony to deliver an intelligent, automated lending platform:</p>
<pre>
<code class="mermaid">
graph TB
subgraph &quot;User Interface Layer&quot;
    A[ChatWebUI]
end

subgraph &quot;AI Processing Layer&quot;
    B[AIWorkflowEngineService]
    C[KnowledgeBaseService]
end

subgraph &quot;Traditional Processing Layer&quot;
    D[WorkflowEngineService]
    E[Rule Engine]
end

subgraph &quot;External Systems&quot;
    F[BankCreditSystem]
    G[TaxSystem]
    H[SocialSecuritySystem]
end

subgraph &quot;Data Layer&quot;
    I[Vector Database]
    J[Relational Database]
    K[Document Store]
end

A --&gt; B
A --&gt; C
B --&gt; D
B --&gt; E
D --&gt; F
D --&gt; G
D --&gt; H
C --&gt; I
B --&gt; J
A --&gt; K
</code>
</pre>

<p><strong>Interview Question</strong>: <em>“How would you design a scalable architecture for a lending system that needs to handle both traditional rule-based processing and AI-driven decision making?”</em></p>
<p><strong>Answer</strong>: The key is to implement a layered architecture where the AI layer enhances rather than replaces traditional systems. Use microservices for each component, implement event-driven communication, and ensure fallback mechanisms to traditional rule engines when AI components are unavailable.</p>
<h2 id="WorkflowEngineService-Traditional-Foundation"><a href="#WorkflowEngineService-Traditional-Foundation" class="headerlink" title="WorkflowEngineService - Traditional Foundation"></a>WorkflowEngineService - Traditional Foundation</h2><h3 id="Core-Workflow-Implementation"><a href="#Core-Workflow-Implementation" class="headerlink" title="Core Workflow Implementation"></a>Core Workflow Implementation</h3><p>The WorkflowEngineService implements a three-stage lending process using Spring Boot’s robust framework:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkflowEngineService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ExternalServiceClient externalServiceClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuleEngine ruleEngine;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> LoanApplicationResult <span class="title function_">processLoanApplication</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="type">WorkflowContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WorkflowContext</span>(application);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Stage 1: Initial Review</span></span><br><span class="line">            <span class="type">InitialReviewResult</span> <span class="variable">initialResult</span> <span class="operator">=</span> performInitialReview(context);</span><br><span class="line">            <span class="keyword">if</span> (!initialResult.isApproved()) &#123;</span><br><span class="line">                <span class="keyword">return</span> LoanApplicationResult.rejected(initialResult.getReason());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Stage 2: Detailed Review</span></span><br><span class="line">            <span class="type">DetailedReviewResult</span> <span class="variable">detailedResult</span> <span class="operator">=</span> performDetailedReview(context);</span><br><span class="line">            <span class="keyword">if</span> (!detailedResult.isApproved()) &#123;</span><br><span class="line">                <span class="keyword">return</span> LoanApplicationResult.rejected(detailedResult.getReason());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Stage 3: Final Review</span></span><br><span class="line">            <span class="type">FinalReviewResult</span> <span class="variable">finalResult</span> <span class="operator">=</span> performFinalReview(context);</span><br><span class="line">            <span class="keyword">return</span> LoanApplicationResult.builder()</span><br><span class="line">                .approved(finalResult.isApproved())</span><br><span class="line">                .loanAmount(finalResult.getApprovedAmount())</span><br><span class="line">                .interestRate(finalResult.getInterestRate())</span><br><span class="line">                .terms(finalResult.getTerms())</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Error processing loan application&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> LoanApplicationResult.error(<span class="string">&quot;System error occurred&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> InitialReviewResult <span class="title function_">performInitialReview</span><span class="params">(WorkflowContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Basic eligibility checks</span></span><br><span class="line">        <span class="type">CustomerData</span> <span class="variable">customer</span> <span class="operator">=</span> context.getCustomer();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (customer.getAge() &lt; <span class="number">18</span> || customer.getAge() &gt; <span class="number">75</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> InitialReviewResult.rejected(<span class="string">&quot;Age not within acceptable range&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (customer.getAnnualIncome() &lt; <span class="number">30000</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> InitialReviewResult.rejected(<span class="string">&quot;Minimum income requirement not met&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> InitialReviewResult.approved();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> DetailedReviewResult <span class="title function_">performDetailedReview</span><span class="params">(WorkflowContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// External system calls for comprehensive review</span></span><br><span class="line">        CompletableFuture&lt;CreditReport&gt; creditFuture = </span><br><span class="line">            externalServiceClient.getCreditReport(context.getCustomer().getSsn());</span><br><span class="line">        CompletableFuture&lt;TaxRecord&gt; taxFuture = </span><br><span class="line">            externalServiceClient.getTaxRecord(context.getCustomer().getTaxId());</span><br><span class="line">        CompletableFuture&lt;EmploymentRecord&gt; employmentFuture = </span><br><span class="line">            externalServiceClient.getEmploymentRecord(context.getCustomer().getSsn());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">CreditReport</span> <span class="variable">creditReport</span> <span class="operator">=</span> creditFuture.get(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">            <span class="type">TaxRecord</span> <span class="variable">taxRecord</span> <span class="operator">=</span> taxFuture.get(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">            <span class="type">EmploymentRecord</span> <span class="variable">employment</span> <span class="operator">=</span> employmentFuture.get(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Calculate risk score using rule engine</span></span><br><span class="line">            <span class="type">RiskAssessment</span> <span class="variable">risk</span> <span class="operator">=</span> ruleEngine.calculateRisk(</span><br><span class="line">                context.getCustomer(), creditReport, taxRecord, employment);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (risk.getScore() &lt; <span class="number">600</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> DetailedReviewResult.rejected(<span class="string">&quot;Credit score too low&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> DetailedReviewResult.approved(risk);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExternalServiceException</span>(<span class="string">&quot;External service timeout&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="External-Service-Integration-Patterns"><a href="#External-Service-Integration-Patterns" class="headerlink" title="External Service Integration Patterns"></a>External Service Integration Patterns</h3><p><strong>Circuit Breaker Pattern Implementation</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker creditServiceBreaker;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RetryTemplate retryTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExternalServiceClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.creditServiceBreaker = CircuitBreaker.ofDefaults(<span class="string">&quot;creditService&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.retryTemplate = RetryTemplate.builder()</span><br><span class="line">            .maxAttempts(<span class="number">3</span>)</span><br><span class="line">            .exponentialBackoff(<span class="number">1000</span>, <span class="number">2</span>, <span class="number">10000</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;CreditReport&gt; <span class="title function_">getCreditReport</span><span class="params">(String ssn)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">            creditServiceBreaker.executeSupplier(() -&gt; </span><br><span class="line">                retryTemplate.execute(context -&gt; </span><br><span class="line">                    callBankCreditSystem(ssn))));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> CreditReport <span class="title function_">callBankCreditSystem</span><span class="params">(String ssn)</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation with proper error handling</span></span><br><span class="line">        <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(</span><br><span class="line">            <span class="string">&quot;https://api.bankcredit.com/report/&#123;ssn&#125;&quot;</span>, </span><br><span class="line">            CreditReport.class, ssn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AIWorkflowEngineService-Intelligent-Enhancement"><a href="#AIWorkflowEngineService-Intelligent-Enhancement" class="headerlink" title="AIWorkflowEngineService - Intelligent Enhancement"></a>AIWorkflowEngineService - Intelligent Enhancement</h2><h3 id="Spring-AI-Integration"><a href="#Spring-AI-Integration" class="headerlink" title="Spring AI Integration"></a>Spring AI Integration</h3><p>The AI-enhanced workflow engine leverages Spring AI to provide intelligent decision-making capabilities:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIWorkflowEngineService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorStore vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WorkflowEngineService traditionalService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> LoanApplicationResult <span class="title function_">processLoanApplicationWithAI</span><span class="params">(</span></span><br><span class="line"><span class="params">            LoanApplication application, List&lt;Document&gt; supportingDocs)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate AI-enhanced risk assessment</span></span><br><span class="line">        <span class="type">AIRiskAssessment</span> <span class="variable">aiRisk</span> <span class="operator">=</span> generateAIRiskAssessment(application, supportingDocs);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Combine traditional and AI assessments</span></span><br><span class="line">        <span class="type">LoanApplicationResult</span> <span class="variable">traditionalResult</span> <span class="operator">=</span> </span><br><span class="line">            traditionalService.processLoanApplication(application);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> combineAssessments(traditionalResult, aiRisk);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> AIRiskAssessment <span class="title function_">generateAIRiskAssessment</span><span class="params">(</span></span><br><span class="line"><span class="params">            LoanApplication application, List&lt;Document&gt; docs)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Document analysis using AI</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">documentAnalysis</span> <span class="operator">=</span> analyzeDocuments(docs);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Create comprehensive prompt for risk assessment</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Analyze this loan application for risk assessment:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Applicant Information:</span></span><br><span class="line"><span class="string">            - Name: %s</span></span><br><span class="line"><span class="string">            - Age: %d</span></span><br><span class="line"><span class="string">            - Annual Income: $%,.2f</span></span><br><span class="line"><span class="string">            - Employment: %s</span></span><br><span class="line"><span class="string">            - Requested Amount: $%,.2f</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Document Analysis:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Provide a risk score (0-1000) and detailed reasoning for:</span></span><br><span class="line"><span class="string">            1. Credit worthiness</span></span><br><span class="line"><span class="string">            2. Income stability</span></span><br><span class="line"><span class="string">            3. Debt-to-income ratio</span></span><br><span class="line"><span class="string">            4. Overall recommendation</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Format your response as JSON with fields: riskScore, reasoning, recommendation.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, </span><br><span class="line">            application.getApplicantName(),</span><br><span class="line">            application.getAge(),</span><br><span class="line">            application.getAnnualIncome(),</span><br><span class="line">            application.getEmployment(),</span><br><span class="line">            application.getRequestedAmount(),</span><br><span class="line">            documentAnalysis);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt, </span><br><span class="line">                OpenAiChatOptions.builder()</span><br><span class="line">                    .withModel(<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line">                    .withTemperature(<span class="number">0.1f</span>)</span><br><span class="line">                    .build()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseAIResponse(response.getResult().getOutput().getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">analyzeDocuments</span><span class="params">(List&lt;Document&gt; docs)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">analysis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Document doc : docs) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;Analyze this financial document and extract key information: &quot;</span> + </span><br><span class="line">                           doc.getContent();</span><br><span class="line">            </span><br><span class="line">            <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt));</span><br><span class="line">            analysis.append(response.getResult().getOutput().getContent()).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> analysis.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Intelligent-Decision-Trees"><a href="#Intelligent-Decision-Trees" class="headerlink" title="Intelligent Decision Trees"></a>Intelligent Decision Trees</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIDecisionEngine</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> LoanDecision <span class="title function_">makeIntelligentDecision</span><span class="params">(LoanContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// Multi-factor AI analysis</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">riskPrompt</span> <span class="operator">=</span> buildRiskAnalysisPrompt(context);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">riskResponse</span> <span class="operator">=</span> chatClient.call(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Prompt</span>(riskPrompt,</span><br><span class="line">                OpenAiChatOptions.builder()</span><br><span class="line">                    .withModel(<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line">                    .withTemperature(<span class="number">0.0f</span>) <span class="comment">// Deterministic for financial decisions</span></span><br><span class="line">                    .build()));</span><br><span class="line">        </span><br><span class="line">        <span class="type">RiskAssessment</span> <span class="variable">aiRisk</span> <span class="operator">=</span> parseRiskResponse(riskResponse);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Apply business rules with AI insights</span></span><br><span class="line">        <span class="keyword">return</span> applyDecisionRules(context, aiRisk);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">buildRiskAnalysisPrompt</span><span class="params">(LoanContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            You are a senior loan officer with 20 years of experience. </span></span><br><span class="line"><span class="string">            Analyze this loan application comprehensively:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Financial Profile:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Consider these factors:</span></span><br><span class="line"><span class="string">            1. Credit history patterns and trends</span></span><br><span class="line"><span class="string">            2. Income stability and growth trajectory</span></span><br><span class="line"><span class="string">            3. Debt service coverage ratio</span></span><br><span class="line"><span class="string">            4. Industry and employment risk factors</span></span><br><span class="line"><span class="string">            5. Macroeconomic conditions impact</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Provide your analysis in this JSON format:</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;creditworthiness&quot;: &#123;&quot;score&quot;: 0-100, &quot;reasoning&quot;: &quot;...&quot;&#125;,</span></span><br><span class="line"><span class="string">                &quot;income_stability&quot;: &#123;&quot;score&quot;: 0-100, &quot;reasoning&quot;: &quot;...&quot;&#125;,</span></span><br><span class="line"><span class="string">                &quot;debt_capacity&quot;: &#123;&quot;score&quot;: 0-100, &quot;reasoning&quot;: &quot;...&quot;&#125;,</span></span><br><span class="line"><span class="string">                &quot;overall_risk&quot;: &#123;&quot;level&quot;: &quot;LOW|MEDIUM|HIGH&quot;, &quot;score&quot;: 0-100&#125;,</span></span><br><span class="line"><span class="string">                &quot;recommendation&quot;: &#123;&quot;action&quot;: &quot;APPROVE|CONDITIONAL|REJECT&quot;, &quot;conditions&quot;: &quot;...&quot;&#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, context.getFinancialProfile());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Interview Question</strong>: <em>“How do you ensure AI decision-making in financial systems is both accurate and explainable for regulatory compliance?”</em></p>
<p><strong>Answer</strong>: Implement a hybrid approach where AI provides risk insights and recommendations, but final decisions follow deterministic business rules. Use structured prompts with clear reasoning requirements, maintain decision audit trails, and implement confidence thresholds where low-confidence AI decisions fall back to human review.</p>
<h2 id="ChatWebUI-Interactive-User-Experience"><a href="#ChatWebUI-Interactive-User-Experience" class="headerlink" title="ChatWebUI - Interactive User Experience"></a>ChatWebUI - Interactive User Experience</h2><h3 id="Multi-Modal-Chat-Interface"><a href="#Multi-Modal-Chat-Interface" class="headerlink" title="Multi-Modal Chat Interface"></a>Multi-Modal Chat Interface</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatService chatService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DocumentProcessingService documentService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/message&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ChatResponse&gt; <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@RequestBody</span> ChatMessage message)</span> &#123;</span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatService.processMessage(message);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;DocumentAnalysis&gt; <span class="title function_">uploadDocument</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;sessionId&quot;)</span> String sessionId)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DocumentAnalysis</span> <span class="variable">analysis</span> <span class="operator">=</span> documentService.analyzeDocument(file, sessionId);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(analysis);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedDocumentException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.badRequest()</span><br><span class="line">                .body(DocumentAnalysis.error(<span class="string">&quot;Unsupported document type&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KnowledgeBaseService knowledgeBase;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoanApplicationService loanService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ChatResponse <span class="title function_">processMessage</span><span class="params">(ChatMessage message)</span> &#123;</span><br><span class="line">        <span class="comment">// Determine intent using AI</span></span><br><span class="line">        <span class="type">ChatIntent</span> <span class="variable">intent</span> <span class="operator">=</span> determineIntent(message.getContent());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (intent.getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> LOAN_APPLICATION:</span><br><span class="line">                <span class="keyword">return</span> handleLoanInquiry(message, intent);</span><br><span class="line">            <span class="keyword">case</span> DOCUMENT_QUESTION:</span><br><span class="line">                <span class="keyword">return</span> handleDocumentQuestion(message, intent);</span><br><span class="line">            <span class="keyword">case</span> GENERAL_INQUIRY:</span><br><span class="line">                <span class="keyword">return</span> handleGeneralInquiry(message, intent);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> ChatResponse.defaultResponse();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ChatResponse <span class="title function_">handleLoanInquiry</span><span class="params">(ChatMessage message, ChatIntent intent)</span> &#123;</span><br><span class="line">        <span class="comment">// Extract loan requirements from natural language</span></span><br><span class="line">        <span class="type">LoanRequirements</span> <span class="variable">requirements</span> <span class="operator">=</span> extractLoanRequirements(message.getContent());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Get preliminary assessment</span></span><br><span class="line">        <span class="type">PreliminaryAssessment</span> <span class="variable">assessment</span> <span class="operator">=</span> </span><br><span class="line">            loanService.getPreliminaryAssessment(requirements);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ChatResponse.builder()</span><br><span class="line">            .message(formatLoanResponse(assessment))</span><br><span class="line">            .suggestedActions(generateSuggestedActions(assessment))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> LoanRequirements <span class="title function_">extractLoanRequirements</span><span class="params">(String userMessage)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Extract loan requirements from this user message: &quot;%s&quot;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Extract and return JSON with:</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;loanAmount&quot;: number or null,</span></span><br><span class="line"><span class="string">                &quot;purpose&quot;: &quot;string or null&quot;,</span></span><br><span class="line"><span class="string">                &quot;timeframe&quot;: &quot;string or null&quot;,</span></span><br><span class="line"><span class="string">                &quot;hasCollateral&quot;: boolean or null,</span></span><br><span class="line"><span class="string">                &quot;estimatedIncome&quot;: number or null</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Only include fields that can be clearly determined from the message.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, userMessage);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt));</span><br><span class="line">        <span class="keyword">return</span> parseRequirements(response.getResult().getOutput().getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Real-time-Document-Processing"><a href="#Real-time-Document-Processing" class="headerlink" title="Real-time Document Processing"></a>Real-time Document Processing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentProcessingService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OCRService ocrService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> DocumentAnalysis <span class="title function_">analyzeDocument</span><span class="params">(MultipartFile file, String sessionId)</span> &#123;</span><br><span class="line">        <span class="comment">// Extract text from document</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">extractedText</span> <span class="operator">=</span> extractTextFromDocument(file);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// AI-powered document classification and analysis</span></span><br><span class="line">        <span class="type">DocumentClassification</span> <span class="variable">classification</span> <span class="operator">=</span> classifyDocument(extractedText);</span><br><span class="line">        <span class="type">DocumentData</span> <span class="variable">extractedData</span> <span class="operator">=</span> extractRelevantData(extractedText, classification);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Store in session context</span></span><br><span class="line">        storeInSession(sessionId, classification, extractedData);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> DocumentAnalysis.builder()</span><br><span class="line">            .classification(classification)</span><br><span class="line">            .extractedData(extractedData)</span><br><span class="line">            .confidence(calculateConfidence(extractedText, extractedData))</span><br><span class="line">            .suggestedNextSteps(generateNextSteps(classification))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> DocumentData <span class="title function_">extractRelevantData</span><span class="params">(String text, DocumentClassification classification)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Extract structured data from this %s document:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Return JSON with fields relevant to %s:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, </span><br><span class="line">            classification.getType(),</span><br><span class="line">            text,</span><br><span class="line">            classification.getType(),</span><br><span class="line">            getExtractionTemplate(classification.getType()));</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt,</span><br><span class="line">                OpenAiChatOptions.builder()</span><br><span class="line">                    .withModel(<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line">                    .withTemperature(<span class="number">0.1f</span>)</span><br><span class="line">                    .build()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseDocumentData(response.getResult().getOutput().getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getExtractionTemplate</span><span class="params">(DocumentType type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> PAY_STUB -&gt; <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    &quot;grossPay&quot;: number,</span></span><br><span class="line"><span class="string">                    &quot;netPay&quot;: number,</span></span><br><span class="line"><span class="string">                    &quot;payPeriod&quot;: &quot;string&quot;,</span></span><br><span class="line"><span class="string">                    &quot;yearToDateGross&quot;: number,</span></span><br><span class="line"><span class="string">                    &quot;employerName&quot;: &quot;string&quot;,</span></span><br><span class="line"><span class="string">                    &quot;payDate&quot;: &quot;YYYY-MM-DD&quot;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> BANK_STATEMENT -&gt; <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    &quot;accountNumber&quot;: &quot;string&quot;,</span></span><br><span class="line"><span class="string">                    &quot;bankName&quot;: &quot;string&quot;,</span></span><br><span class="line"><span class="string">                    &quot;statementPeriod&quot;: &#123;&quot;start&quot;: &quot;YYYY-MM-DD&quot;, &quot;end&quot;: &quot;YYYY-MM-DD&quot;&#125;,</span></span><br><span class="line"><span class="string">                    &quot;endingBalance&quot;: number,</span></span><br><span class="line"><span class="string">                    &quot;averageBalance&quot;: number,</span></span><br><span class="line"><span class="string">                    &quot;deposits&quot;: [&#123;&quot;date&quot;: &quot;YYYY-MM-DD&quot;, &quot;amount&quot;: number, &quot;description&quot;: &quot;string&quot;&#125;],</span></span><br><span class="line"><span class="string">                    &quot;withdrawals&quot;: [&#123;&quot;date&quot;: &quot;YYYY-MM-DD&quot;, &quot;amount&quot;: number, &quot;description&quot;: &quot;string&quot;&#125;]</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> TAX_RETURN -&gt; <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    &quot;taxYear&quot;: number,</span></span><br><span class="line"><span class="string">                    &quot;adjustedGrossIncome&quot;: number,</span></span><br><span class="line"><span class="string">                    &quot;filingStatus&quot;: &quot;string&quot;,</span></span><br><span class="line"><span class="string">                    &quot;totalTax&quot;: number,</span></span><br><span class="line"><span class="string">                    &quot;refundAmount&quot;: number</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span> -&gt; <span class="string">&quot;&#123;&#125;&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="KnowledgeBaseService-RAG-Implementation"><a href="#KnowledgeBaseService-RAG-Implementation" class="headerlink" title="KnowledgeBaseService - RAG Implementation"></a>KnowledgeBaseService - RAG Implementation</h2><h3 id="Vector-Database-Integration"><a href="#Vector-Database-Integration" class="headerlink" title="Vector Database Integration"></a>Vector Database Integration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KnowledgeBaseService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VectorStore vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DocumentReader documentReader;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">answerQuestion</span><span class="params">(String question, String sessionContext)</span> &#123;</span><br><span class="line">        <span class="comment">// Retrieve relevant documents using similarity search</span></span><br><span class="line">        List&lt;Document&gt; relevantDocs = vectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(question)</span><br><span class="line">                .withTopK(<span class="number">5</span>)</span><br><span class="line">                .withSimilarityThreshold(<span class="number">0.7</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Combine with session context</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">contextualizedQuestion</span> <span class="operator">=</span> enhanceQuestionWithContext(question, sessionContext);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate response using RAG</span></span><br><span class="line">        <span class="keyword">return</span> generateRAGResponse(contextualizedQuestion, relevantDocs);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateRAGResponse</span><span class="params">(String question, List&lt;Document&gt; context)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">contextText</span> <span class="operator">=</span> context.stream()</span><br><span class="line">            .map(Document::getContent)</span><br><span class="line">            .collect(Collectors.joining(<span class="string">&quot;\n\n&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            You are a knowledgeable financial advisor specializing in lending and personal loans.</span></span><br><span class="line"><span class="string">            Answer the following question based on the provided context and your expertise.</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Context from knowledge base:</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Question: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Instructions:</span></span><br><span class="line"><span class="string">            1. Provide accurate, helpful information</span></span><br><span class="line"><span class="string">            2. If the context doesn&#x27;t fully answer the question, use your general knowledge</span></span><br><span class="line"><span class="string">            3. Be specific about loan requirements, rates, and procedures</span></span><br><span class="line"><span class="string">            4. Include relevant disclaimers when appropriate</span></span><br><span class="line"><span class="string">            5. Suggest next steps when helpful</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Response:</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, contextText, question);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt,</span><br><span class="line">                OpenAiChatOptions.builder()</span><br><span class="line">                    .withModel(<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line">                    .withTemperature(<span class="number">0.3f</span>)</span><br><span class="line">                    .build()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> response.getResult().getOutput().getContent();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializeKnowledgeBase</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Load and vectorize financial documents</span></span><br><span class="line">        List&lt;Resource&gt; resources = loadFinancialDocuments();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Resource resource : resources) &#123;</span><br><span class="line">            List&lt;Document&gt; documents = documentReader.get(resource);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Add metadata for better retrieval</span></span><br><span class="line">            documents.forEach(doc -&gt; &#123;</span><br><span class="line">                doc.getMetadata().put(<span class="string">&quot;source&quot;</span>, resource.getFilename());</span><br><span class="line">                doc.getMetadata().put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;financial_knowledge&quot;</span>);</span><br><span class="line">                doc.getMetadata().put(<span class="string">&quot;indexed_date&quot;</span>, Instant.now().toString());</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            vectorStore.add(documents);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;Knowledge base initialized with &#123;&#125; documents&quot;</span>, </span><br><span class="line">                vectorStore.similaritySearch(SearchRequest.query(<span class="string">&quot;loan&quot;</span>).withTopK(<span class="number">1000</span>)).size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Intelligent-FAQ-System"><a href="#Intelligent-FAQ-System" class="headerlink" title="Intelligent FAQ System"></a>Intelligent FAQ System</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntelligentFAQService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KnowledgeBaseService knowledgeBase;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> FAQResponse <span class="title function_">handleFAQ</span><span class="params">(String userQuestion, CustomerProfile profile)</span> &#123;</span><br><span class="line">        <span class="comment">// Classify question intent</span></span><br><span class="line">        <span class="type">QuestionClassification</span> <span class="variable">classification</span> <span class="operator">=</span> classifyQuestion(userQuestion);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Get base answer from knowledge base</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">baseAnswer</span> <span class="operator">=</span> knowledgeBase.answerQuestion(userQuestion, </span><br><span class="line">                                                        profile.getSessionContext());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Personalize response based on customer profile</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">personalizedAnswer</span> <span class="operator">=</span> personalizeResponse(baseAnswer, profile, classification);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate follow-up questions</span></span><br><span class="line">        List&lt;String&gt; followUps = generateFollowUpQuestions(classification, profile);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> FAQResponse.builder()</span><br><span class="line">            .answer(personalizedAnswer)</span><br><span class="line">            .confidence(classification.getConfidence())</span><br><span class="line">            .followUpQuestions(followUps)</span><br><span class="line">            .relatedTopics(findRelatedTopics(classification))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">personalizeResponse</span><span class="params">(String baseAnswer, CustomerProfile profile, </span></span><br><span class="line"><span class="params">                                     QuestionClassification classification)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Personalize this financial advice for the specific customer:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Base Answer: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Customer Profile:</span></span><br><span class="line"><span class="string">            - Credit Score Range: %s</span></span><br><span class="line"><span class="string">            - Income Level: %s</span></span><br><span class="line"><span class="string">            - Previous Loans: %s</span></span><br><span class="line"><span class="string">            - Current Debt: $%,.2f</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Question Category: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Adjust the answer to be more relevant to this customer&#x27;s situation.</span></span><br><span class="line"><span class="string">            Provide specific recommendations and mention relevant products or options.</span></span><br><span class="line"><span class="string">            Keep the same helpful tone but make it more targeted.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, </span><br><span class="line">            baseAnswer,</span><br><span class="line">            profile.getCreditScoreRange(),</span><br><span class="line">            profile.getIncomeLevel(),</span><br><span class="line">            profile.getPreviousLoans(),</span><br><span class="line">            profile.getCurrentDebt(),</span><br><span class="line">            classification.getCategory());</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt));</span><br><span class="line">        <span class="keyword">return</span> response.getResult().getOutput().getContent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Production-Ready-Implementation-Considerations"><a href="#Production-Ready-Implementation-Considerations" class="headerlink" title="Production-Ready Implementation Considerations"></a>Production-Ready Implementation Considerations</h2><h3 id="Monitoring-and-Observability"><a href="#Monitoring-and-Observability" class="headerlink" title="Monitoring and Observability"></a>Monitoring and Observability</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LendingSystemMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter loanApplications;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer processsingTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge aiModelConfidence;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LendingSystemMetrics</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        <span class="built_in">this</span>.loanApplications = Counter.builder(<span class="string">&quot;loan.applications.total&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Total loan applications processed&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">        <span class="built_in">this</span>.processsingTime = Timer.builder(<span class="string">&quot;loan.processing.time&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Time taken to process loan applications&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">        <span class="built_in">this</span>.aiModelConfidence = Gauge.builder(<span class="string">&quot;ai.model.confidence&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Average AI model confidence score&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordLoanApplication</span><span class="params">(String status)</span> &#123;</span><br><span class="line">        loanApplications.increment(Tags.of(<span class="string">&quot;status&quot;</span>, status));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordProcessingTime</span><span class="params">(Duration duration)</span> &#123;</span><br><span class="line">        processsingTime.record(duration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LendingAuditAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuditService auditService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(Auditable)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">auditLendingOperation</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">operation</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        </span><br><span class="line">        <span class="type">AuditEntry</span> <span class="variable">entry</span> <span class="operator">=</span> AuditEntry.builder()</span><br><span class="line">            .operation(operation)</span><br><span class="line">            .timestamp(Instant.now())</span><br><span class="line">            .userId(getCurrentUserId())</span><br><span class="line">            .parameters(args)</span><br><span class="line">            .build();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">            entry.setStatus(<span class="string">&quot;SUCCESS&quot;</span>);</span><br><span class="line">            entry.setResult(result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            entry.setStatus(<span class="string">&quot;ERROR&quot;</span>);</span><br><span class="line">            entry.setError(e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            auditService.logAudit(entry);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Security-Implementation"><a href="#Security-Implementation" class="headerlink" title="Security Implementation"></a>Security Implementation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LendingSecurityConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> http</span><br><span class="line">            .authorizeHttpRequests(auth -&gt; auth</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/api/public/**&quot;</span>).permitAll()</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/api/loan/**&quot;</span>).hasRole(<span class="string">&quot;CUSTOMER&quot;</span>)</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/api/admin/**&quot;</span>).hasRole(<span class="string">&quot;LOAN_OFFICER&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated())</span><br><span class="line">            .oauth2ResourceServer(oauth2 -&gt; oauth2</span><br><span class="line">                .jwt(jwt -&gt; jwt.jwtDecoder(jwtDecoder())))</span><br><span class="line">            .sessionManagement(session -&gt; session</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS))</span><br><span class="line">            .csrf(csrf -&gt; csrf.disable())</span><br><span class="line">            .headers(headers -&gt; headers</span><br><span class="line">                .frameOptions(HeadersConfigurer.FrameOptionsConfig::deny)</span><br><span class="line">                .contentTypeOptions(Customizer.withDefaults())</span><br><span class="line">                .httpStrictTransportSecurity(hstsConfig -&gt; hstsConfig</span><br><span class="line">                    .maxAgeInSeconds(<span class="number">31536000</span>)</span><br><span class="line">                    .includeSubDomains(<span class="literal">true</span>)))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>(<span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataEncryptionService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AESUtil aesUtil;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encryptPII</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> aesUtil.encrypt(data);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decryptPII</span><span class="params">(String encryptedData)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> aesUtil.decrypt(encryptedData);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleSensitiveDataAccess</span><span class="params">(SensitiveDataAccessEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// Log all access to sensitive data for compliance</span></span><br><span class="line">        log.info(<span class="string">&quot;Sensitive data accessed: user=&#123;&#125;, operation=&#123;&#125;, timestamp=&#123;&#125;&quot;</span>, </span><br><span class="line">                event.getUserId(), event.getOperation(), event.getTimestamp());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Advanced-Use-Cases-and-Examples"><a href="#Advanced-Use-Cases-and-Examples" class="headerlink" title="Advanced Use Cases and Examples"></a>Advanced Use Cases and Examples</h2><h3 id="Use-Case-1-Automated-Income-Verification"><a href="#Use-Case-1-Automated-Income-Verification" class="headerlink" title="Use Case 1: Automated Income Verification"></a>Use Case 1: Automated Income Verification</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IncomeVerificationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AIWorkflowEngineService aiEngine;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ExternalServiceClient externalClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> IncomeVerificationResult <span class="title function_">verifyIncome</span><span class="params">(String customerId, </span></span><br><span class="line"><span class="params">                                               List&lt;Document&gt; payStubs,</span></span><br><span class="line"><span class="params">                                               List&lt;Document&gt; bankStatements)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// AI-powered document analysis</span></span><br><span class="line">        <span class="type">IncomeAnalysis</span> <span class="variable">payStubAnalysis</span> <span class="operator">=</span> analyzePayStubs(payStubs);</span><br><span class="line">        <span class="type">BankAnalysis</span> <span class="variable">bankAnalysis</span> <span class="operator">=</span> analyzeBankStatements(bankStatements);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Cross-reference with external data</span></span><br><span class="line">        <span class="type">EmploymentVerification</span> <span class="variable">employment</span> <span class="operator">=</span> </span><br><span class="line">            externalClient.verifyEmployment(customerId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// AI consistency check</span></span><br><span class="line">        <span class="type">ConsistencyCheck</span> <span class="variable">consistency</span> <span class="operator">=</span> performConsistencyCheck(</span><br><span class="line">            payStubAnalysis, bankAnalysis, employment);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> IncomeVerificationResult.builder()</span><br><span class="line">            .verified(consistency.isConsistent())</span><br><span class="line">            .verifiedIncome(consistency.getVerifiedIncome())</span><br><span class="line">            .confidenceScore(consistency.getConfidenceScore())</span><br><span class="line">            .discrepancies(consistency.getDiscrepancies())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ConsistencyCheck <span class="title function_">performConsistencyCheck</span><span class="params">(</span></span><br><span class="line"><span class="params">            IncomeAnalysis payStubs, BankAnalysis bank, EmploymentVerification employment)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            As a financial analyst, verify income consistency across these sources:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Pay Stub Analysis:</span></span><br><span class="line"><span class="string">            - Reported monthly income: $%,.2f</span></span><br><span class="line"><span class="string">            - Employer: %s</span></span><br><span class="line"><span class="string">            - Employment duration: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Bank Statement Analysis:</span></span><br><span class="line"><span class="string">            - Average monthly deposits: $%,.2f</span></span><br><span class="line"><span class="string">            - Deposit pattern consistency: %s</span></span><br><span class="line"><span class="string">            - Deposit sources: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Employment Verification:</span></span><br><span class="line"><span class="string">            - Verified employer: %s</span></span><br><span class="line"><span class="string">            - Verified income: $%,.2f</span></span><br><span class="line"><span class="string">            - Employment status: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Analyze for:</span></span><br><span class="line"><span class="string">            1. Income consistency across sources</span></span><br><span class="line"><span class="string">            2. Red flags or discrepancies</span></span><br><span class="line"><span class="string">            3. Overall confidence in reported income</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Provide analysis as JSON:</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;consistent&quot;: boolean,</span></span><br><span class="line"><span class="string">                &quot;verifiedMonthlyIncome&quot;: number,</span></span><br><span class="line"><span class="string">                &quot;confidenceScore&quot;: number (0-100),</span></span><br><span class="line"><span class="string">                &quot;discrepancies&quot;: [&quot;array of issues found&quot;],</span></span><br><span class="line"><span class="string">                &quot;recommendations&quot;: [&quot;array of recommendations&quot;]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>,</span><br><span class="line">            payStubs.getMonthlyIncome(),</span><br><span class="line">            payStubs.getEmployer(),</span><br><span class="line">            payStubs.getEmploymentDuration(),</span><br><span class="line">            bank.getAverageMonthlyDeposits(),</span><br><span class="line">            bank.getDepositConsistency(),</span><br><span class="line">            bank.getDepositSources(),</span><br><span class="line">            employment.getEmployer(),</span><br><span class="line">            employment.getVerifiedIncome(),</span><br><span class="line">            employment.getStatus());</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> aiEngine.getChatClient().call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt));</span><br><span class="line">        <span class="keyword">return</span> parseConsistencyCheck(response.getResult().getOutput().getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Use-Case-2-Intelligent-Risk-Assessment"><a href="#Use-Case-2-Intelligent-Risk-Assessment" class="headerlink" title="Use Case 2: Intelligent Risk Assessment"></a>Use Case 2: Intelligent Risk Assessment</h3><pre>
<code class="mermaid">
flowchart TD
A[Loan Application] --&gt; B[Traditional Risk Scoring]
A --&gt; C[AI Document Analysis]
A --&gt; D[External Data Gathering]

B --&gt; E[Credit Score Calculation]
C --&gt; F[Document Insights]
D --&gt; G[Employment Verification]
D --&gt; H[Bank Account Analysis]

E --&gt; I[Risk Fusion Engine]
F --&gt; I
G --&gt; I
H --&gt; I

I --&gt; J{AI Confidence &gt; 0.8?}
J --&gt;|Yes| K[Automated Decision]
J --&gt;|No| L[Human Review Queue]

K --&gt; M[Approval&#x2F;Rejection]
L --&gt; N[Loan Officer Review]
N --&gt; M
</code>
</pre>

<h3 id="Use-Case-3-Conversational-Loan-Application"><a href="#Use-Case-3-Conversational-Loan-Application" class="headerlink" title="Use Case 3: Conversational Loan Application"></a>Use Case 3: Conversational Loan Application</h3><p><strong>Example Conversation Flow</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">User: &quot;Hi, I need a loan to buy a car&quot;</span><br><span class="line"></span><br><span class="line">AI: &quot;I&#x27;d be happy to help you with a car loan! To get started, I&#x27;ll need some information:</span><br><span class="line">     • What&#x27;s the estimated cost of the car you&#x27;re looking to purchase?</span><br><span class="line">     • Do you have a specific car in mind, or are you still shopping?</span><br><span class="line">     • What&#x27;s your current monthly income?</span><br><span class="line">     </span><br><span class="line">     Also, please feel free to upload any recent pay stubs or bank statements to speed up the process.&quot;</span><br><span class="line"></span><br><span class="line">User: [Uploads pay stub] &quot;The car costs about $25,000, and here&#x27;s my latest pay stub&quot;</span><br><span class="line"></span><br><span class="line">AI: &quot;Thanks for uploading your pay stub! I can see you earn $4,200 monthly gross income working at TechCorp. </span><br><span class="line">     For a $25,000 car loan, you&#x27;re looking at roughly $450-500 monthly payments over 5 years.</span><br><span class="line">     </span><br><span class="line">     A few more questions:</span><br><span class="line">     • How much are you planning to put down?</span><br><span class="line">     • Do you have any existing auto loans or major debts?</span><br><span class="line">     • Would you like me to check what interest rates you might qualify for?&quot;</span><br><span class="line"></span><br><span class="line">User: &quot;I can put down $5,000, and I have about $800 in credit card debt&quot;</span><br><span class="line"></span><br><span class="line">AI: &quot;Perfect! With a $5,000 down payment, you&#x27;d need to finance $20,000. Your debt-to-income ratio looks good.</span><br><span class="line">     </span><br><span class="line">     Based on your income and the information provided, you may qualify for rates between 4.5-6.2% APR.</span><br><span class="line">     </span><br><span class="line">     Would you like me to:</span><br><span class="line">     1. Start a formal pre-approval application</span><br><span class="line">     2. Show you payment scenarios at different rates</span><br><span class="line">     3. Explain what documents you&#x27;ll need for final approval&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Implementation of this conversation</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConversationalLoanService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoanCalculatorService calculatorService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ChatResponse <span class="title function_">handleLoanConversation</span><span class="params">(String userMessage, ConversationContext context)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Extract entities and intent from user message</span></span><br><span class="line">        <span class="type">ConversationAnalysis</span> <span class="variable">analysis</span> <span class="operator">=</span> analyzeMessage(userMessage, context);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Update conversation state</span></span><br><span class="line">        updateConversationState(context, analysis);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Generate appropriate response</span></span><br><span class="line">        <span class="keyword">return</span> generateContextualResponse(context, analysis);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ConversationAnalysis <span class="title function_">analyzeMessage</span><span class="params">(String message, ConversationContext context)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Analyze this user message in the context of a loan application conversation:</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            User Message: &quot;%s&quot;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Conversation History: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Extract and return JSON:</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;intent&quot;: &quot;information_request|document_upload|application_start|clarification&quot;,</span></span><br><span class="line"><span class="string">                &quot;extracted_entities&quot;: &#123;</span></span><br><span class="line"><span class="string">                    &quot;loan_amount&quot;: number or null,</span></span><br><span class="line"><span class="string">                    &quot;down_payment&quot;: number or null,</span></span><br><span class="line"><span class="string">                    &quot;monthly_income&quot;: number or null,</span></span><br><span class="line"><span class="string">                    &quot;existing_debt&quot;: number or null,</span></span><br><span class="line"><span class="string">                    &quot;loan_purpose&quot;: &quot;string or null&quot;</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                &quot;user_sentiment&quot;: &quot;positive|neutral|concerned|frustrated&quot;,</span></span><br><span class="line"><span class="string">                &quot;confidence_level&quot;: number (0-1),</span></span><br><span class="line"><span class="string">                &quot;next_best_action&quot;: &quot;string describing what to do next&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, message, context.getHistorySummary());</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(<span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt));</span><br><span class="line">        <span class="keyword">return</span> parseConversationAnalysis(response.getResult().getOutput().getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ChatResponse <span class="title function_">generateContextualResponse</span><span class="params">(ConversationContext context, </span></span><br><span class="line"><span class="params">                                                  ConversationAnalysis analysis)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Calculate loan scenarios if we have enough information</span></span><br><span class="line">        List&lt;LoanScenario&gt; scenarios = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (context.hasBasicLoanInfo()) &#123;</span><br><span class="line">            scenarios = calculatorService.calculateScenarios(</span><br><span class="line">                context.getLoanAmount(),</span><br><span class="line">                context.getDownPayment(),</span><br><span class="line">                context.getEstimatedCreditScore());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            You are a helpful loan specialist having a conversation with a customer.</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Conversation Context:</span></span><br><span class="line"><span class="string">            - Current stage: %s</span></span><br><span class="line"><span class="string">            - Information collected: %s</span></span><br><span class="line"><span class="string">            - Last user message analysis: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Available loan scenarios: %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Generate a helpful, conversational response that:</span></span><br><span class="line"><span class="string">            1. Acknowledges what the user shared</span></span><br><span class="line"><span class="string">            2. Provides relevant information or calculations</span></span><br><span class="line"><span class="string">            3. Asks for the next piece of needed information</span></span><br><span class="line"><span class="string">            4. Maintains a friendly, professional tone</span></span><br><span class="line"><span class="string">            5. Offers specific next steps</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Keep responses concise but informative. Use bullet points for clarity when listing options.</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>,</span><br><span class="line">            context.getCurrentStage(),</span><br><span class="line">            context.getCollectedInfo(),</span><br><span class="line">            analysis.toString(),</span><br><span class="line">            formatScenarios(scenarios));</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Prompt</span>(prompt,</span><br><span class="line">                OpenAiChatOptions.builder()</span><br><span class="line">                    .withTemperature(<span class="number">0.7f</span>)</span><br><span class="line">                    .build()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ChatResponse.builder()</span><br><span class="line">            .message(response.getResult().getOutput().getContent())</span><br><span class="line">            .suggestedActions(generateSuggestedActions(context, analysis))</span><br><span class="line">            .loanScenarios(scenarios)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Performance-Optimization-Strategies"><a href="#Performance-Optimization-Strategies" class="headerlink" title="Performance Optimization Strategies"></a>Performance Optimization Strategies</h2><h3 id="Caching-Implementation"><a href="#Caching-Implementation" class="headerlink" title="Caching Implementation"></a>Caching Implementation</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        RedisCacheManager.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> RedisCacheManager</span><br><span class="line">            .RedisCacheManagerBuilder</span><br><span class="line">            .fromConnectionFactory(redisConnectionFactory())</span><br><span class="line">            .cacheDefaults(cacheConfiguration());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> RedisCacheConfiguration <span class="title function_">cacheConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">            .entryTtl(Duration.ofHours(<span class="number">1</span>))</span><br><span class="line">            .serializeKeysWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>()))</span><br><span class="line">            .serializeValuesWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachedExternalService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;creditReports&quot;, key = &quot;#ssn&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CreditReport <span class="title function_">getCreditReport</span><span class="params">(String ssn)</span> &#123;</span><br><span class="line">        <span class="comment">// Expensive external API call</span></span><br><span class="line">        <span class="keyword">return</span> externalCreditService.fetchReport(ssn);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;aiRiskAssessments&quot;, key = &quot;#application.hashCode()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> AIRiskAssessment <span class="title function_">getAIRiskAssessment</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        <span class="comment">// Expensive AI model inference</span></span><br><span class="line">        <span class="keyword">return</span> aiService.assessRisk(application);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;creditReports&quot;, key = &quot;#ssn&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invalidateCreditReport</span><span class="params">(String ssn)</span> &#123;</span><br><span class="line">        <span class="comment">// Called when we know credit data has changed</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Asynchronous-Processing"><a href="#Asynchronous-Processing" class="headerlink" title="Asynchronous Processing"></a>Asynchronous Processing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncLoanProcessingService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher eventPublisher;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async(&quot;loanProcessingExecutor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;LoanApplicationResult&gt; <span class="title function_">processLoanAsync</span><span class="params">(LoanApplication application)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Publish event for tracking</span></span><br><span class="line">            eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">LoanProcessingStartedEvent</span>(application.getId()));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Process in stages with progress updates</span></span><br><span class="line">            <span class="type">InitialReviewResult</span> <span class="variable">initial</span> <span class="operator">=</span> performInitialReview(application);</span><br><span class="line">            eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">LoanProcessingProgressEvent</span>(</span><br><span class="line">                application.getId(), <span class="string">&quot;Initial review complete&quot;</span>, <span class="number">33</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!initial.isApproved()) &#123;</span><br><span class="line">                <span class="keyword">return</span> CompletableFuture.completedFuture(</span><br><span class="line">                    LoanApplicationResult.rejected(initial.getReason()));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">DetailedReviewResult</span> <span class="variable">detailed</span> <span class="operator">=</span> performDetailedReview(application);</span><br><span class="line">            eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">LoanProcessingProgressEvent</span>(</span><br><span class="line">                application.getId(), <span class="string">&quot;Detailed review complete&quot;</span>, <span class="number">66</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!detailed.isApproved()) &#123;</span><br><span class="line">                <span class="keyword">return</span> CompletableFuture.completedFuture(</span><br><span class="line">                    LoanApplicationResult.rejected(detailed.getReason()));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">FinalReviewResult</span> <span class="variable">finalResult</span> <span class="operator">=</span> performFinalReview(application);</span><br><span class="line">            eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">LoanProcessingProgressEvent</span>(</span><br><span class="line">                application.getId(), <span class="string">&quot;Final review complete&quot;</span>, <span class="number">100</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="type">LoanApplicationResult</span> <span class="variable">result</span> <span class="operator">=</span> LoanApplicationResult.builder()</span><br><span class="line">                .approved(finalResult.isApproved())</span><br><span class="line">                .loanAmount(finalResult.getApprovedAmount())</span><br><span class="line">                .interestRate(finalResult.getInterestRate())</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">LoanProcessingCompletedEvent</span>(</span><br><span class="line">                application.getId(), result));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> CompletableFuture.completedFuture(result);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">LoanProcessingFailedEvent</span>(</span><br><span class="line">                application.getId(), e.getMessage()));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LoanProcessingException</span>(<span class="string">&quot;Failed to process loan application&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean(name = &quot;loanProcessingExecutor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TaskExecutor <span class="title function_">loanProcessingExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        executor.setCorePoolSize(<span class="number">5</span>);</span><br><span class="line">        executor.setMaxPoolSize(<span class="number">20</span>);</span><br><span class="line">        executor.setQueueCapacity(<span class="number">100</span>);</span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">&quot;loan-processor-&quot;</span>);</span><br><span class="line">        executor.setRejectedExecutionHandler(<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Testing-Strategies"><a href="#Testing-Strategies" class="headerlink" title="Testing Strategies"></a>Testing Strategies</h2><h3 id="AI-Component-Testing"><a href="#AI-Component-Testing" class="headerlink" title="AI Component Testing"></a>AI Component Testing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AIWorkflowEngineServiceTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> VectorStore vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@InjectMocks</span></span><br><span class="line">    <span class="keyword">private</span> AIWorkflowEngineService aiService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shouldGenerateAccurateRiskAssessment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">LoanApplication</span> <span class="variable">application</span> <span class="operator">=</span> createTestApplication();</span><br><span class="line">        List&lt;Document&gt; documents = createTestDocuments();</span><br><span class="line">        </span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">mockResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatResponse</span>(<span class="keyword">new</span> <span class="title class_">Generation</span>(</span><br><span class="line">            <span class="string">&quot;&#123;\&quot;riskScore\&quot;: 750, \&quot;reasoning\&quot;: \&quot;Good credit history\&quot;, \&quot;recommendation\&quot;: \&quot;APPROVE\&quot;&#125;&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">when</span>(chatClient.call(any(Prompt.class))).thenReturn(mockResponse);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        <span class="type">AIRiskAssessment</span> <span class="variable">result</span> <span class="operator">=</span> aiService.generateAIRiskAssessment(application, documents);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertThat(result.getRiskScore()).isEqualTo(<span class="number">750</span>);</span><br><span class="line">        assertThat(result.getRecommendation()).isEqualTo(<span class="string">&quot;APPROVE&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ArgumentCaptor&lt;Prompt&gt; promptCaptor = ArgumentCaptor.forClass(Prompt.class);</span><br><span class="line">        verify(chatClient).call(promptCaptor.capture());</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">capturedPrompt</span> <span class="operator">=</span> promptCaptor.getValue().getInstructions().get(<span class="number">0</span>).getText();</span><br><span class="line">        assertThat(capturedPrompt).contains(<span class="string">&quot;risk assessment&quot;</span>);</span><br><span class="line">        assertThat(capturedPrompt).contains(application.getApplicantName());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shouldHandleAIServiceFailureGracefully</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">LoanApplication</span> <span class="variable">application</span> <span class="operator">=</span> createTestApplication();</span><br><span class="line">        <span class="keyword">when</span>(chatClient.call(any(Prompt.class))).thenThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;AI service down&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When &amp; Then</span></span><br><span class="line">        assertThatThrownBy(() -&gt; aiService.generateAIRiskAssessment(application, List.of()))</span><br><span class="line">            .isInstanceOf(AIServiceException.class)</span><br><span class="line">            .hasMessageContaining(<span class="string">&quot;AI risk assessment failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TestConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestAIConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">testChatClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MockChatClient</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MockChatClient</span> <span class="keyword">implements</span> <span class="title class_">ChatClient</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> ChatResponse <span class="title function_">call</span><span class="params">(Prompt prompt)</span> &#123;</span><br><span class="line">            <span class="comment">// Return deterministic responses for testing</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">promptText</span> <span class="operator">=</span> prompt.getInstructions().get(<span class="number">0</span>).getText();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (promptText.contains(<span class="string">&quot;risk assessment&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChatResponse</span>(<span class="keyword">new</span> <span class="title class_">Generation</span>(</span><br><span class="line">                    <span class="string">&quot;&#123;\&quot;riskScore\&quot;: 700, \&quot;reasoning\&quot;: \&quot;Test assessment\&quot;, \&quot;recommendation\&quot;: \&quot;APPROVE\&quot;&#125;&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChatResponse</span>(<span class="keyword">new</span> <span class="title class_">Generation</span>(<span class="string">&quot;Default test response&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Integration-Testing"><a href="#Integration-Testing" class="headerlink" title="Integration Testing"></a>Integration Testing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="meta">@TestPropertySource(properties = &#123;</span></span><br><span class="line"><span class="meta">    &quot;spring.ai.openai.api-key=test-key&quot;,</span></span><br><span class="line"><span class="meta">    &quot;external.services.enabled=false&quot;</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoanWorkflowIntegrationTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TestRestTemplate restTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoanApplicationRepository repository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> ExternalServiceClient externalServiceClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shouldProcessCompleteLoanWorkflow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">LoanApplicationRequest</span> <span class="variable">request</span> <span class="operator">=</span> LoanApplicationRequest.builder()</span><br><span class="line">            .applicantName(<span class="string">&quot;John Doe&quot;</span>)</span><br><span class="line">            .ssn(<span class="string">&quot;123-45-6789&quot;</span>)</span><br><span class="line">            .annualIncome(<span class="number">75000.0</span>)</span><br><span class="line">            .requestedAmount(<span class="number">25000.0</span>)</span><br><span class="line">            .build();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Mock external service responses</span></span><br><span class="line">        <span class="keyword">when</span>(externalServiceClient.getCreditReport(anyString()))</span><br><span class="line">            .thenReturn(CompletableFuture.completedFuture(createMockCreditReport()));</span><br><span class="line">        <span class="keyword">when</span>(externalServiceClient.getTaxRecord(anyString()))</span><br><span class="line">            .thenReturn(CompletableFuture.completedFuture(createMockTaxRecord()));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        ResponseEntity&lt;LoanApplicationResult&gt; response = restTemplate.postForEntity(</span><br><span class="line">            <span class="string">&quot;/api/loan/apply&quot;</span>, request, LoanApplicationResult.class);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);</span><br><span class="line">        assertThat(response.getBody().isApproved()).isTrue();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Verify database state</span></span><br><span class="line">        <span class="type">LoanApplication</span> <span class="variable">savedApplication</span> <span class="operator">=</span> repository.findByApplicantName(<span class="string">&quot;John Doe&quot;</span>).orElseThrow();</span><br><span class="line">        assertThat(savedApplication.getStatus()).isEqualTo(ApplicationStatus.APPROVED);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shouldHandleExternalServiceFailure</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">LoanApplicationRequest</span> <span class="variable">request</span> <span class="operator">=</span> createTestRequest();</span><br><span class="line">        <span class="keyword">when</span>(externalServiceClient.getCreditReport(anyString()))</span><br><span class="line">            .thenReturn(CompletableFuture.failedFuture(<span class="keyword">new</span> <span class="title class_">TimeoutException</span>()));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        ResponseEntity&lt;LoanApplicationResult&gt; response = restTemplate.postForEntity(</span><br><span class="line">            <span class="string">&quot;/api/loan/apply&quot;</span>, request, LoanApplicationResult.class);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.SERVICE_UNAVAILABLE);</span><br><span class="line">        assertThat(response.getBody().getErrorMessage()).contains(<span class="string">&quot;External service unavailable&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Interview-Questions-and-Insights"><a href="#Interview-Questions-and-Insights" class="headerlink" title="Interview Questions and Insights"></a>Interview Questions and Insights</h2><p><strong>Q: How would you handle the scenario where AI models provide conflicting recommendations compared to traditional rule-based systems?</strong></p>
<p><strong>A:</strong> Implement a hybrid decision framework with the following approach:</p>
<ul>
<li>Use confidence scores from both systems</li>
<li>When conflicts arise, route to human review if the difference exceeds a threshold</li>
<li>Maintain audit trails showing both AI and traditional assessments</li>
<li>Implement A&#x2F;B testing to validate AI improvements over time</li>
<li>Use ensemble methods to combine predictions when both systems have high confidence</li>
</ul>
<p><strong>Q: What strategies would you use to ensure data privacy and compliance in a lending AI system?</strong></p>
<p><strong>A:</strong> </p>
<ul>
<li>Implement data minimization principles - only collect necessary information</li>
<li>Use differential privacy techniques for AI training data</li>
<li>Implement proper data retention policies with automated deletion</li>
<li>Ensure all AI model training uses anonymized data</li>
<li>Implement role-based access controls with audit logging</li>
<li>Regular compliance audits and penetration testing</li>
<li>Clear consent mechanisms and opt-out capabilities</li>
</ul>
<p><strong>Q: How would you design the system to handle peak loads during loan application seasons?</strong></p>
<p><strong>A:</strong></p>
<ul>
<li>Implement auto-scaling groups for microservices</li>
<li>Use message queues (Apache Kafka) for asynchronous processing</li>
<li>Implement circuit breakers for external service calls</li>
<li>Use caching strategies for frequently accessed data</li>
<li>Database read replicas for scaling read operations</li>
<li>CDN for static content delivery</li>
<li>Implement rate limiting to prevent abuse</li>
</ul>
<h2 id="Deployment-and-DevOps-Considerations"><a href="#Deployment-and-DevOps-Considerations" class="headerlink" title="Deployment and DevOps Considerations"></a>Deployment and DevOps Considerations</h2><h3 id="Docker-Configuration"><a href="#Docker-Configuration" class="headerlink" title="Docker Configuration"></a>Docker Configuration</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Multi-stage build for Spring Boot application</span></span><br><span class="line"><span class="keyword">FROM</span> maven:<span class="number">3.8</span>.<span class="number">4</span>-openjdk-<span class="number">17</span> AS builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> pom.xml .</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> src ./src</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> mvn clean package -DskipTests</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span>-jre-slim</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/target/lending-service.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Security: Run as non-root user</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> addgroup --system lending &amp;&amp; adduser --system --group lending</span></span><br><span class="line"><span class="keyword">USER</span> lending:lending</span><br><span class="line"></span><br><span class="line"><span class="comment"># Health check</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=30s --<span class="built_in">timeout</span>=3s --start-period=5s --retries=3 \</span></span><br><span class="line"><span class="language-bash">  CMD curl -f http://localhost:8080/actuator/health || <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="Kubernetes-Deployment"><a href="#Kubernetes-Deployment" class="headerlink" title="Kubernetes Deployment"></a>Kubernetes Deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">lending-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">lending-service</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">lending-service</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lending-service</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">lending-service:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPRING_PROFILES_ACTIVE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;kubernetes&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_URL</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">database-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">url</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/readiness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">lending-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">lending-service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This FinTech AI Workflow and Chat System represents a modern approach to lending automation that combines the reliability of traditional rule-based systems with the intelligence and adaptability of AI. The architecture provides:</p>
<ul>
<li><strong>Scalability</strong>: Microservices architecture with containerized deployment</li>
<li><strong>Reliability</strong>: Circuit breakers, fallback mechanisms, and comprehensive monitoring</li>
<li><strong>Intelligence</strong>: AI-powered document analysis, risk assessment, and conversational interfaces</li>
<li><strong>Compliance</strong>: Comprehensive audit trails, data encryption, and regulatory adherence</li>
<li><strong>User Experience</strong>: Intuitive chat interface with multi-modal input support</li>
</ul>
<p>The system is designed to evolve with changing business requirements while maintaining the high standards of security and reliability required in financial services.</p>
<h2 id="External-References"><a href="#External-References" class="headerlink" title="External References"></a>External References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/">Spring AI Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/guides">Spring Boot Best Practices</a></li>
<li><a target="_blank" rel="noopener" href="https://platform.openai.com/docs">OpenAI API Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://microservices.io/patterns/">Microservices Patterns</a></li>
<li><a target="_blank" rel="noopener" href="https://gdpr.eu/">GDPR Compliance Guidelines</a></li>
<li><a target="_blank" rel="noopener" href="https://www.pcisecuritystandards.org/">PCI DSS Requirements</a></li>
<li><a target="_blank" rel="noopener" href="https://kafka.apache.org/documentation/">Apache Kafka Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/documentation">Redis Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/">Kubernetes Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/develop/dev-best-practices/">Docker Best Practices</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/29/Design-Distributed-Pressure-Test-Tool-By-Zookeeper/" rel="prev" title="Design Distributed Pressure Test Tool By Zookeeper">
                  <i class="fa fa-angle-left"></i> Design Distributed Pressure Test Tool By Zookeeper
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
