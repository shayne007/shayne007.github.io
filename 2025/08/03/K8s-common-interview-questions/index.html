<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"shayne007.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="What is Kubernetes and why would you use it for Java applications?Reference AnswerKubernetes is an open-source container orchestration platform that automates the deployment, scaling, and management o">
<meta property="og:type" content="article">
<meta property="og:title" content="K8s common interview questions">
<meta property="og:url" content="https://shayne007.github.io/2025/08/03/K8s-common-interview-questions/index.html">
<meta property="og:site_name" content="Charlie Feng&#39;s Tech Space">
<meta property="og:description" content="What is Kubernetes and why would you use it for Java applications?Reference AnswerKubernetes is an open-source container orchestration platform that automates the deployment, scaling, and management o">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-08-03T07:38:17.000Z">
<meta property="article:modified_time" content="2025-08-03T07:44:32.324Z">
<meta property="article:author" content="Charlie Feng">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://shayne007.github.io/2025/08/03/K8s-common-interview-questions/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://shayne007.github.io/2025/08/03/K8s-common-interview-questions/","path":"2025/08/03/K8s-common-interview-questions/","title":"K8s common interview questions"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>K8s common interview questions | Charlie Feng's Tech Space</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"cdn":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Charlie Feng's Tech Space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">You will survive with skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-Kubernetes-and-why-would-you-use-it-for-Java-applications"><span class="nav-number">1.</span> <span class="nav-text">What is Kubernetes and why would you use it for Java applications?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer"><span class="nav-number">1.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Key-Benefits-for-Java-Applications"><span class="nav-number">1.2.</span> <span class="nav-text">Key Benefits for Java Applications:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Architecture-Overview"><span class="nav-number">1.3.</span> <span class="nav-text">Architecture Overview</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Explain-the-difference-between-Pods-Services-and-Deployments"><span class="nav-number">2.</span> <span class="nav-text">Explain the difference between Pods, Services, and Deployments</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-1"><span class="nav-number">2.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod"><span class="nav-number">2.2.</span> <span class="nav-text">Pod</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service"><span class="nav-number">2.3.</span> <span class="nav-text">Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deployment"><span class="nav-number">2.4.</span> <span class="nav-text">Deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Relationship-Diagram"><span class="nav-number">2.5.</span> <span class="nav-text">Relationship Diagram</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-do-you-handle-configuration-management-for-Java-applications-in-Kubernetes"><span class="nav-number">3.</span> <span class="nav-text">How do you handle configuration management for Java applications in Kubernetes?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-2"><span class="nav-number">3.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConfigMaps-Non-sensitive-data"><span class="nav-number">3.2.</span> <span class="nav-text">ConfigMaps (Non-sensitive data)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Secrets-Sensitive-data"><span class="nav-number">3.3.</span> <span class="nav-text">Secrets (Sensitive data)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Configuration-in-Deployment"><span class="nav-number">3.4.</span> <span class="nav-text">Using Configuration in Deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-Integration"><span class="nav-number">3.5.</span> <span class="nav-text">Spring Boot Integration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuration-Hot-Reloading-with-Spring-Cloud-Kubernetes"><span class="nav-number">3.6.</span> <span class="nav-text">Configuration Hot-Reloading with Spring Cloud Kubernetes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Describe-resource-management-and-JVM-tuning-in-Kubernetes"><span class="nav-number">4.</span> <span class="nav-text">Describe resource management and JVM tuning in Kubernetes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-3"><span class="nav-number">4.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Resource-Requests-vs-Limits"><span class="nav-number">4.2.</span> <span class="nav-text">Resource Requests vs Limits</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JVM-Container-Awareness"><span class="nav-number">4.3.</span> <span class="nav-text">JVM Container Awareness</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory-Calculation-Strategy"><span class="nav-number">4.4.</span> <span class="nav-text">Memory Calculation Strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Advanced-JVM-Configuration"><span class="nav-number">4.5.</span> <span class="nav-text">Advanced JVM Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Resource-Monitoring"><span class="nav-number">4.6.</span> <span class="nav-text">Resource Monitoring</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vertical-Pod-Autoscaler-VPA-Configuration"><span class="nav-number">4.7.</span> <span class="nav-text">Vertical Pod Autoscaler (VPA) Configuration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-do-you-implement-health-checks-for-Java-applications"><span class="nav-number">5.</span> <span class="nav-text">How do you implement health checks for Java applications?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-4"><span class="nav-number">5.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Probe-Types"><span class="nav-number">5.2.</span> <span class="nav-text">Probe Types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-Actuator-Health-Endpoints"><span class="nav-number">5.3.</span> <span class="nav-text">Spring Boot Actuator Health Endpoints</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-Deployment-with-Health-Checks"><span class="nav-number">5.4.</span> <span class="nav-text">Kubernetes Deployment with Health Checks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-Health-Indicators"><span class="nav-number">5.5.</span> <span class="nav-text">Custom Health Indicators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Properties-Configuration"><span class="nav-number">5.6.</span> <span class="nav-text">Application Properties Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-and-Command-Probes"><span class="nav-number">5.7.</span> <span class="nav-text">TCP and Command Probes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Explain-how-to-handle-persistent-data-in-Java-applications-on-Kubernetes"><span class="nav-number">6.</span> <span class="nav-text">Explain how to handle persistent data in Java applications on Kubernetes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-5"><span class="nav-number">6.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Storage-Architecture"><span class="nav-number">6.2.</span> <span class="nav-text">Storage Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StorageClass-Definition"><span class="nav-number">6.3.</span> <span class="nav-text">StorageClass Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PersistentVolumeClaim"><span class="nav-number">6.4.</span> <span class="nav-text">PersistentVolumeClaim</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-Application-with-File-Storage"><span class="nav-number">6.5.</span> <span class="nav-text">Java Application with File Storage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StatefulSet-for-Database-Applications"><span class="nav-number">6.6.</span> <span class="nav-text">StatefulSet for Database Applications</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-File-Processing-Example"><span class="nav-number">6.7.</span> <span class="nav-text">Java File Processing Example</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backup-Strategy-with-CronJob"><span class="nav-number">6.8.</span> <span class="nav-text">Backup Strategy with CronJob</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Database-Connection-with-Persistent-Storage"><span class="nav-number">6.9.</span> <span class="nav-text">Database Connection with Persistent Storage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-do-you-implement-service-discovery-and-communication-between-Java-microservices"><span class="nav-number">7.</span> <span class="nav-text">How do you implement service discovery and communication between Java microservices?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-6"><span class="nav-number">7.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Discovery-Architecture"><span class="nav-number">7.2.</span> <span class="nav-text">Service Discovery Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Definitions"><span class="nav-number">7.3.</span> <span class="nav-text">Service Definitions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Cloud-Kubernetes-Configuration"><span class="nav-number">7.4.</span> <span class="nav-text">Spring Cloud Kubernetes Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Discovery-Configuration"><span class="nav-number">7.5.</span> <span class="nav-text">Service Discovery Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Inter-Service-Communication"><span class="nav-number">7.6.</span> <span class="nav-text">Inter-Service Communication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Circuit-Breaker-with-Resilience4j"><span class="nav-number">7.7.</span> <span class="nav-text">Circuit Breaker with Resilience4j</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Properties"><span class="nav-number">7.8.</span> <span class="nav-text">Application Properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Mesh-Integration-Istio"><span class="nav-number">7.9.</span> <span class="nav-text">Service Mesh Integration (Istio)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Describe-different-deployment-strategies-in-Kubernetes"><span class="nav-number">8.</span> <span class="nav-text">Describe different deployment strategies in Kubernetes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-7"><span class="nav-number">8.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deployment-Strategies-Overview"><span class="nav-number">8.2.</span> <span class="nav-text">Deployment Strategies Overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rolling-Update-Default-Strategy"><span class="nav-number">8.3.</span> <span class="nav-text">Rolling Update (Default Strategy)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blue-Green-Deployment"><span class="nav-number">8.4.</span> <span class="nav-text">Blue-Green Deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Canary-Deployment-with-Istio"><span class="nav-number">8.5.</span> <span class="nav-text">Canary Deployment with Istio</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Recreate-Strategy"><span class="nav-number">8.6.</span> <span class="nav-text">Recreate Strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deployment-Automation-Script"><span class="nav-number">8.7.</span> <span class="nav-text">Deployment Automation Script</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-Graceful-Shutdown"><span class="nav-number">8.8.</span> <span class="nav-text">Spring Boot Graceful Shutdown</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-do-you-handle-logging-and-monitoring-for-Java-applications-in-Kubernetes"><span class="nav-number">9.</span> <span class="nav-text">How do you handle logging and monitoring for Java applications in Kubernetes?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-8"><span class="nav-number">9.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Logging-Architecture"><span class="nav-number">9.2.</span> <span class="nav-text">Logging Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Structured-Logging-Configuration"><span class="nav-number">9.3.</span> <span class="nav-text">Structured Logging Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Logging-Code"><span class="nav-number">9.4.</span> <span class="nav-text">Application Logging Code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fluentd-Configuration"><span class="nav-number">9.5.</span> <span class="nav-text">Fluentd Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prometheus-Metrics-with-Micrometer"><span class="nav-number">9.6.</span> <span class="nav-text">Prometheus Metrics with Micrometer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deployment-with-Monitoring-Annotations"><span class="nav-number">9.7.</span> <span class="nav-text">Deployment with Monitoring Annotations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Distributed-Tracing-with-Jaeger"><span class="nav-number">9.8.</span> <span class="nav-text">Distributed Tracing with Jaeger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Properties-for-Monitoring"><span class="nav-number">9.9.</span> <span class="nav-text">Application Properties for Monitoring</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-are-the-security-considerations-for-Java-applications-in-Kubernetes"><span class="nav-number">10.</span> <span class="nav-text">What are the security considerations for Java applications in Kubernetes?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-9"><span class="nav-number">10.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-Architecture"><span class="nav-number">10.2.</span> <span class="nav-text">Security Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-Security-Context"><span class="nav-number">10.3.</span> <span class="nav-text">Pod Security Context</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Secure-Dockerfile"><span class="nav-number">10.4.</span> <span class="nav-text">Secure Dockerfile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-Policies"><span class="nav-number">10.5.</span> <span class="nav-text">Network Policies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RBAC-Configuration"><span class="nav-number">10.6.</span> <span class="nav-text">RBAC Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Secrets-Management"><span class="nav-number">10.7.</span> <span class="nav-text">Secrets Management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-Security-Standards"><span class="nav-number">10.8.</span> <span class="nav-text">Pod Security Standards</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-Configuration-in-Java"><span class="nav-number">10.9.</span> <span class="nav-text">Security Configuration in Java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Image-Scanning-with-Trivy"><span class="nav-number">10.10.</span> <span class="nav-text">Image Scanning with Trivy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Admission-Controller-OPA-Gatekeeper"><span class="nav-number">10.11.</span> <span class="nav-text">Admission Controller (OPA Gatekeeper)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-do-you-debug-issues-in-Java-applications-running-on-Kubernetes"><span class="nav-number">11.</span> <span class="nav-text">How do you debug issues in Java applications running on Kubernetes?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-10"><span class="nav-number">11.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugging-Workflow"><span class="nav-number">11.2.</span> <span class="nav-text">Debugging Workflow</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Basic-Kubernetes-Debugging-Commands"><span class="nav-number">11.3.</span> <span class="nav-text">Basic Kubernetes Debugging Commands</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-Application-Debugging"><span class="nav-number">11.4.</span> <span class="nav-text">Java Application Debugging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Remote-Debugging-Configuration"><span class="nav-number">11.5.</span> <span class="nav-text">Remote Debugging Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Port-Forwarding-for-Local-Debugging"><span class="nav-number">11.6.</span> <span class="nav-text">Port Forwarding for Local Debugging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Performance-Debugging-with-JVM-Tools"><span class="nav-number">11.7.</span> <span class="nav-text">Performance Debugging with JVM Tools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-Debugging"><span class="nav-number">11.8.</span> <span class="nav-text">Network Debugging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugging-Init-Containers"><span class="nav-number">11.9.</span> <span class="nav-text">Debugging Init Containers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Metrics-Debugging"><span class="nav-number">11.10.</span> <span class="nav-text">Application Metrics Debugging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugging-Persistent-Volumes"><span class="nav-number">11.11.</span> <span class="nav-text">Debugging Persistent Volumes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Resource-Usage-Investigation"><span class="nav-number">11.12.</span> <span class="nav-text">Resource Usage Investigation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugging-ConfigMaps-and-Secrets"><span class="nav-number">11.13.</span> <span class="nav-text">Debugging ConfigMaps and Secrets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Automated-Debugging-Script"><span class="nav-number">11.14.</span> <span class="nav-text">Automated Debugging Script</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Explain-Ingress-and-how-to-expose-Java-applications-externally"><span class="nav-number">12.</span> <span class="nav-text">Explain Ingress and how to expose Java applications externally</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference-Answer-11"><span class="nav-number">12.1.</span> <span class="nav-text">Reference Answer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ingress-Architecture"><span class="nav-number">12.2.</span> <span class="nav-text">Ingress Architecture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Basic-Ingress-Configuration"><span class="nav-number">12.3.</span> <span class="nav-text">Basic Ingress Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Advanced-Ingress-with-Path-based-Routing"><span class="nav-number">12.4.</span> <span class="nav-text">Advanced Ingress with Path-based Routing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-Application-Configuration-for-Ingress"><span class="nav-number">12.5.</span> <span class="nav-text">Java Application Configuration for Ingress</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-Configuration-for-Proxy-Headers"><span class="nav-number">12.6.</span> <span class="nav-text">Spring Boot Configuration for Proxy Headers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSL-TLS-Certificate-Management"><span class="nav-number">12.7.</span> <span class="nav-text">SSL&#x2F;TLS Certificate Management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ingress-with-Authentication"><span class="nav-number">12.8.</span> <span class="nav-text">Ingress with Authentication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-Error-Pages"><span class="nav-number">12.9.</span> <span class="nav-text">Custom Error Pages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Load-Balancing-and-Session-Affinity"><span class="nav-number">12.10.</span> <span class="nav-text">Load Balancing and Session Affinity</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ingress-Health-Checks-and-Monitoring"><span class="nav-number">12.11.</span> <span class="nav-text">Ingress Health Checks and Monitoring</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ingress-Controller-Configuration"><span class="nav-number">12.12.</span> <span class="nav-text">Ingress Controller Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Testing-Ingress-Configuration"><span class="nav-number">12.13.</span> <span class="nav-text">Testing Ingress Configuration</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Charlie Feng</p>
  <div class="site-description" itemprop="description">This place is for thinking and sharing.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://shayne007.github.io/2025/08/03/K8s-common-interview-questions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Charlie Feng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Charlie Feng's Tech Space">
      <meta itemprop="description" content="This place is for thinking and sharing.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="K8s common interview questions | Charlie Feng's Tech Space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          K8s common interview questions
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-08-03 15:38:17 / Modified: 15:44:32" itemprop="dateCreated datePublished" datetime="2025-08-03T15:38:17+08:00">2025-08-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="What-is-Kubernetes-and-why-would-you-use-it-for-Java-applications"><a href="#What-is-Kubernetes-and-why-would-you-use-it-for-Java-applications" class="headerlink" title="What is Kubernetes and why would you use it for Java applications?"></a>What is Kubernetes and why would you use it for Java applications?</h2><h3 id="Reference-Answer"><a href="#Reference-Answer" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Kubernetes is an open-source container orchestration platform that automates the deployment, scaling, and management of containerized applications. It acts as a distributed operating system for containerized workloads.</p>
<h3 id="Key-Benefits-for-Java-Applications"><a href="#Key-Benefits-for-Java-Applications" class="headerlink" title="Key Benefits for Java Applications:"></a>Key Benefits for Java Applications:</h3><ul>
<li><strong>Microservices Architecture</strong>: Enables independent scaling and deployment of Java services</li>
<li><strong>Service Discovery</strong>: Built-in DNS-based service discovery eliminates hardcoded endpoints</li>
<li><strong>Load Balancing</strong>: Automatic distribution of traffic across healthy instances</li>
<li><strong>Rolling Deployments</strong>: Zero-downtime deployments with gradual traffic shifting</li>
<li><strong>Configuration Management</strong>: Externalized configuration through ConfigMaps and Secrets</li>
<li><strong>Resource Management</strong>: Optimal JVM performance through resource quotas and limits</li>
<li><strong>Self-Healing</strong>: Automatic restart of failed containers and rescheduling on healthy nodes</li>
<li><strong>Horizontal Scaling</strong>: Auto-scaling based on CPU, memory, or custom metrics</li>
</ul>
<h3 id="Architecture-Overview"><a href="#Architecture-Overview" class="headerlink" title="Architecture Overview"></a>Architecture Overview</h3><pre>
<code class="mermaid">
graph TB
subgraph &quot;Kubernetes Cluster&quot;
    subgraph &quot;Master Node&quot;
        API[API Server]
        ETCD[etcd]
        SCHED[Scheduler]
        CM[Controller Manager]
    end
    
    subgraph &quot;Worker Node 1&quot;
        KUBELET1[Kubelet]
        PROXY1[Kube-proxy]
        subgraph &quot;Pods&quot;
            POD1[Java App Pod 1]
            POD2[Java App Pod 2]
        end
    end
    
    subgraph &quot;Worker Node 2&quot;
        KUBELET2[Kubelet]
        PROXY2[Kube-proxy]
        POD3[Java App Pod 3]
    end
end

USERS[Users] --&gt; API
API --&gt; ETCD
API --&gt; SCHED
API --&gt; CM
SCHED --&gt; KUBELET1
SCHED --&gt; KUBELET2
</code>
</pre>

<hr>
<h2 id="Explain-the-difference-between-Pods-Services-and-Deployments"><a href="#Explain-the-difference-between-Pods-Services-and-Deployments" class="headerlink" title="Explain the difference between Pods, Services, and Deployments"></a>Explain the difference between Pods, Services, and Deployments</h2><h3 id="Reference-Answer-1"><a href="#Reference-Answer-1" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>These are fundamental Kubernetes resources that work together to run and expose applications.</p>
<h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><ul>
<li><strong>Definition</strong>: Smallest deployable unit containing one or more containers</li>
<li><strong>Characteristics</strong>: Shared network and storage, ephemeral, single IP address</li>
<li><strong>Java Context</strong>: Typically one JVM per pod for resource isolation</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">openjdk:11-jre-slim</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><ul>
<li><strong>Definition</strong>: Abstraction that defines access to a logical set of pods</li>
<li><strong>Types</strong>: ClusterIP (internal), NodePort (external via node), LoadBalancer (cloud LB)</li>
<li><strong>Purpose</strong>: Provides stable networking and load balancing</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure>

<h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><ul>
<li><strong>Definition</strong>: Higher-level resource managing ReplicaSets and pod lifecycles</li>
<li><strong>Features</strong>: Rolling updates, rollbacks, replica management, declarative updates</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h3 id="Relationship-Diagram"><a href="#Relationship-Diagram" class="headerlink" title="Relationship Diagram"></a>Relationship Diagram</h3><pre>
<code class="mermaid">
graph LR
DEPLOY[Deployment] --&gt; RS[ReplicaSet]
RS --&gt; POD1[Pod 1]
RS --&gt; POD2[Pod 2]
RS --&gt; POD3[Pod 3]

SVC[Service] --&gt; POD1
SVC --&gt; POD2
SVC --&gt; POD3

USERS[External Users] --&gt; SVC
</code>
</pre>

<hr>
<h2 id="How-do-you-handle-configuration-management-for-Java-applications-in-Kubernetes"><a href="#How-do-you-handle-configuration-management-for-Java-applications-in-Kubernetes" class="headerlink" title="How do you handle configuration management for Java applications in Kubernetes?"></a>How do you handle configuration management for Java applications in Kubernetes?</h2><h3 id="Reference-Answer-2"><a href="#Reference-Answer-2" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Configuration management in Kubernetes separates configuration from application code using ConfigMaps and Secrets, following the twelve-factor app methodology.</p>
<h3 id="ConfigMaps-Non-sensitive-data"><a href="#ConfigMaps-Non-sensitive-data" class="headerlink" title="ConfigMaps (Non-sensitive data)"></a>ConfigMaps (Non-sensitive data)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">application.properties:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    server.port=8080</span></span><br><span class="line"><span class="string">    spring.profiles.active=production</span></span><br><span class="line"><span class="string">    logging.level.com.example=INFO</span></span><br><span class="line"><span class="string">    database.pool.size=10</span></span><br><span class="line"><span class="string"></span>  <span class="attr">app.env:</span> <span class="string">&quot;production&quot;</span></span><br><span class="line">  <span class="attr">debug.enabled:</span> <span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Secrets-Sensitive-data"><a href="#Secrets-Sensitive-data" class="headerlink" title="Secrets (Sensitive data)"></a>Secrets (Sensitive data)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-secrets</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">database-username:</span> <span class="string">dXNlcm5hbWU=</span>  <span class="comment"># base64 encoded</span></span><br><span class="line">  <span class="attr">database-password:</span> <span class="string">cGFzc3dvcmQ=</span>  <span class="comment"># base64 encoded</span></span><br><span class="line">  <span class="attr">api-key:</span> <span class="string">YWJjZGVmZ2hpams=</span>        <span class="comment"># base64 encoded</span></span><br></pre></td></tr></table></figure>

<h3 id="Using-Configuration-in-Deployment"><a href="#Using-Configuration-in-Deployment" class="headerlink" title="Using Configuration in Deployment"></a>Using Configuration in Deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="comment"># Environment variables from ConfigMap</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPRING_PROFILES_ACTIVE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">java-app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">app.env</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_USERNAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">java-app-secrets</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">database-username</span></span><br><span class="line">        <span class="comment"># Mount ConfigMap as volume</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/app/config</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/app/secrets</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">java-app-config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span></span><br><span class="line">        <span class="attr">secret:</span></span><br><span class="line">          <span class="attr">secretName:</span> <span class="string">java-app-secrets</span></span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-Integration"><a href="#Spring-Boot-Integration" class="headerlink" title="Spring Boot Integration"></a>Spring Boot Integration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String environment;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> debugEnabled;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;database.pool.size:5&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> poolSize;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Configuration-Hot-Reloading-with-Spring-Cloud-Kubernetes"><a href="#Configuration-Hot-Reloading-with-Spring-Cloud-Kubernetes" class="headerlink" title="Configuration Hot-Reloading with Spring Cloud Kubernetes"></a>Configuration Hot-Reloading with Spring Cloud Kubernetes</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">kubernetes:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">sources:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app-config</span></span><br><span class="line">          <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">reload:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">event</span></span><br><span class="line">        <span class="attr">strategy:</span> <span class="string">refresh</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Describe-resource-management-and-JVM-tuning-in-Kubernetes"><a href="#Describe-resource-management-and-JVM-tuning-in-Kubernetes" class="headerlink" title="Describe resource management and JVM tuning in Kubernetes"></a>Describe resource management and JVM tuning in Kubernetes</h2><h3 id="Reference-Answer-3"><a href="#Reference-Answer-3" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Resource management in Kubernetes involves setting appropriate CPU and memory requests and limits, while JVM tuning ensures optimal performance within container constraints.</p>
<h3 id="Resource-Requests-vs-Limits"><a href="#Resource-Requests-vs-Limits" class="headerlink" title="Resource Requests vs Limits"></a>Resource Requests vs Limits</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span>      <span class="comment"># Guaranteed memory</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span>        <span class="comment"># Guaranteed CPU (0.5 cores)</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span>      <span class="comment"># Maximum memory</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span>       <span class="comment"># Maximum CPU (1 core)</span></span><br></pre></td></tr></table></figure>

<h3 id="JVM-Container-Awareness"><a href="#JVM-Container-Awareness" class="headerlink" title="JVM Container Awareness"></a>JVM Container Awareness</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">openjdk:11-jre-slim</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JAVA_OPTS</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&gt;-</span></span><br><span class="line"><span class="string">            -XX:+UseContainerSupport</span></span><br><span class="line"><span class="string">            -XX:MaxRAMPercentage=75.0</span></span><br><span class="line"><span class="string">            -XX:+UseG1GC</span></span><br><span class="line"><span class="string">            -XX:+UseStringDeduplication</span></span><br><span class="line"><span class="string">            -XX:+OptimizeStringConcat</span></span><br><span class="line"><span class="string">            -Djava.security.egd=file:/dev/./urandom</span></span><br><span class="line"><span class="string"></span>        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Memory-Calculation-Strategy"><a href="#Memory-Calculation-Strategy" class="headerlink" title="Memory Calculation Strategy"></a>Memory Calculation Strategy</h3><pre>
<code class="mermaid">
graph TD
CONTAINER[Container Memory Limit: 2Gi] --&gt; JVM[JVM Heap: ~75% &#x3D; 1.5Gi]
CONTAINER --&gt; NONHEAP[Non-Heap: ~20% &#x3D; 400Mi]
CONTAINER --&gt; OS[OS&#x2F;Buffer: ~5% &#x3D; 100Mi]

JVM --&gt; HEAP_YOUNG[Young Generation]
JVM --&gt; HEAP_OLD[Old Generation]

NONHEAP --&gt; METASPACE[Metaspace]
NONHEAP --&gt; CODECACHE[Code Cache]
NONHEAP --&gt; STACK[Thread Stacks]
</code>
</pre>

<h3 id="Advanced-JVM-Configuration"><a href="#Advanced-JVM-Configuration" class="headerlink" title="Advanced JVM Configuration"></a>Advanced JVM Configuration</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11</span>-jre-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># JVM tuning for containers</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;-server \</span></span><br><span class="line"><span class="string">    -XX:+UseContainerSupport \</span></span><br><span class="line"><span class="string">    -XX:MaxRAMPercentage=75.0 \</span></span><br><span class="line"><span class="string">    -XX:InitialRAMPercentage=50.0 \</span></span><br><span class="line"><span class="string">    -XX:+UseG1GC \</span></span><br><span class="line"><span class="string">    -XX:MaxGCPauseMillis=200 \</span></span><br><span class="line"><span class="string">    -XX:+UseStringDeduplication \</span></span><br><span class="line"><span class="string">    -XX:+OptimizeStringConcat \</span></span><br><span class="line"><span class="string">    -XX:+UseCompressedOops \</span></span><br><span class="line"><span class="string">    -XX:+UseCompressedClassPointers \</span></span><br><span class="line"><span class="string">    -Djava.security.egd=file:/dev/./urandom \</span></span><br><span class="line"><span class="string">    -Dfile.encoding=UTF-8 \</span></span><br><span class="line"><span class="string">    -Duser.timezone=UTC&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> app.jar /app/app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;java <span class="variable">$JAVA_OPTS</span> -jar /app/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="Resource-Monitoring"><a href="#Resource-Monitoring" class="headerlink" title="Resource Monitoring"></a>Resource Monitoring</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">prometheus.io/scrape:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">prometheus.io/path:</span> <span class="string">&quot;/actuator/prometheus&quot;</span></span><br><span class="line">    <span class="attr">prometheus.io/port:</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">http</span></span><br></pre></td></tr></table></figure>

<h3 id="Vertical-Pod-Autoscaler-VPA-Configuration"><a href="#Vertical-Pod-Autoscaler-VPA-Configuration" class="headerlink" title="Vertical Pod Autoscaler (VPA) Configuration"></a>Vertical Pod Autoscaler (VPA) Configuration</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VerticalPodAutoscaler</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-vpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">targetRef:</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">  <span class="attr">updatePolicy:</span></span><br><span class="line">    <span class="attr">updateMode:</span> <span class="string">&quot;Auto&quot;</span></span><br><span class="line">  <span class="attr">resourcePolicy:</span></span><br><span class="line">    <span class="attr">containerPolicies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerName:</span> <span class="string">java-app</span></span><br><span class="line">      <span class="attr">maxAllowed:</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">4Gi</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">2000m</span></span><br><span class="line">      <span class="attr">minAllowed:</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">512Mi</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">250m</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="How-do-you-implement-health-checks-for-Java-applications"><a href="#How-do-you-implement-health-checks-for-Java-applications" class="headerlink" title="How do you implement health checks for Java applications?"></a>How do you implement health checks for Java applications?</h2><h3 id="Reference-Answer-4"><a href="#Reference-Answer-4" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Health checks in Kubernetes use three types of probes to ensure application reliability and proper traffic routing.</p>
<h3 id="Probe-Types"><a href="#Probe-Types" class="headerlink" title="Probe Types"></a>Probe Types</h3><pre>
<code class="mermaid">
graph LR
subgraph &quot;Pod Lifecycle&quot;
    START[Pod Start] --&gt; STARTUP{Startup Probe}
    STARTUP --&gt;|Pass| READY{Readiness Probe}
    STARTUP --&gt;|Fail| RESTART[Restart Container]
    READY --&gt;|Pass| TRAFFIC[Receive Traffic]
    READY --&gt;|Fail| NO_TRAFFIC[No Traffic]
    TRAFFIC --&gt; LIVE{Liveness Probe}
    LIVE --&gt;|Pass| TRAFFIC
    LIVE --&gt;|Fail| RESTART
end
</code>
</pre>

<h3 id="Spring-Boot-Actuator-Health-Endpoints"><a href="#Spring-Boot-Actuator-Health-Endpoints" class="headerlink" title="Spring Boot Actuator Health Endpoints"></a>Spring Boot Actuator Health Endpoints</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HealthController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/health/live&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">liveness</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; status = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        status.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        status.put(<span class="string">&quot;timestamp&quot;</span>, Instant.now().toString());</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(status);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/health/ready&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">readiness</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; health = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        health.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check database connectivity</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            dataSource.getConnection().close();</span><br><span class="line">            health.put(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            health.put(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;DOWN&quot;</span>);</span><br><span class="line">            health.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;DOWN&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(<span class="number">503</span>).body(health);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Check external dependencies</span></span><br><span class="line">        health.put(<span class="string">&quot;externalAPI&quot;</span>, checkExternalAPI());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(health);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">checkExternalAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Implementation to check external dependencies</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;UP&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Kubernetes-Deployment-with-Health-Checks"><a href="#Kubernetes-Deployment-with-Health-Checks" class="headerlink" title="Kubernetes Deployment with Health Checks"></a>Kubernetes Deployment with Health Checks</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Startup probe for slow-starting applications</span></span><br><span class="line">        <span class="attr">startupProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health/live</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">30</span>  <span class="comment"># 30 * 5 = 150s max startup time</span></span><br><span class="line">          </span><br><span class="line">        <span class="comment"># Liveness probe</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health/live</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span>   <span class="comment"># Restart after 3 consecutive failures</span></span><br><span class="line">          </span><br><span class="line">        <span class="comment"># Readiness probe</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health/ready</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span>   <span class="comment"># Remove from service after 3 failures</span></span><br></pre></td></tr></table></figure>

<h3 id="Custom-Health-Indicators"><a href="#Custom-Health-Indicators" class="headerlink" title="Custom Health Indicators"></a>Custom Health Indicators</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">            <span class="comment">// Perform a simple query</span></span><br><span class="line">            <span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.prepareStatement(<span class="string">&quot;SELECT 1&quot;</span>);</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (resultSet.next()) &#123;</span><br><span class="line">                <span class="keyword">return</span> Health.up()</span><br><span class="line">                    .withDetail(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;Available&quot;</span>)</span><br><span class="line">                    .withDetail(<span class="string">&quot;connectionPool&quot;</span>, getConnectionPoolInfo())</span><br><span class="line">                    .build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down()</span><br><span class="line">                .withDetail(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;Unavailable&quot;</span>)</span><br><span class="line">                .withDetail(<span class="string">&quot;error&quot;</span>, e.getMessage())</span><br><span class="line">                .build();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Health.down().build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title function_">getConnectionPoolInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Return connection pool metrics</span></span><br><span class="line">        Map&lt;String, Object&gt; poolInfo = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        poolInfo.put(<span class="string">&quot;active&quot;</span>, <span class="number">5</span>);</span><br><span class="line">        poolInfo.put(<span class="string">&quot;idle&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        poolInfo.put(<span class="string">&quot;max&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">return</span> poolInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Application-Properties-Configuration"><a href="#Application-Properties-Configuration" class="headerlink" title="Application Properties Configuration"></a>Application Properties Configuration</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Health endpoint configuration</span></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">health,info,metrics,prometheus</span></span><br><span class="line"><span class="attr">management.endpoint.health.show-details</span>=<span class="string">always</span></span><br><span class="line"><span class="attr">management.endpoint.health.show-components</span>=<span class="string">always</span></span><br><span class="line"><span class="attr">management.health.db.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">management.health.diskspace.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Custom health check paths</span></span><br><span class="line"><span class="attr">management.server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="attr">management.endpoints.web.base-path</span>=<span class="string">/actuator</span></span><br></pre></td></tr></table></figure>

<h3 id="TCP-and-Command-Probes"><a href="#TCP-and-Command-Probes" class="headerlink" title="TCP and Command Probes"></a>TCP and Command Probes</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TCP probe example</span></span><br><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">tcpSocket:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Command probe example</span></span><br><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">exec:</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;ps aux | grep java&quot;</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Explain-how-to-handle-persistent-data-in-Java-applications-on-Kubernetes"><a href="#Explain-how-to-handle-persistent-data-in-Java-applications-on-Kubernetes" class="headerlink" title="Explain how to handle persistent data in Java applications on Kubernetes"></a>Explain how to handle persistent data in Java applications on Kubernetes</h2><h3 id="Reference-Answer-5"><a href="#Reference-Answer-5" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Persistent data in Kubernetes requires understanding storage abstractions and choosing appropriate patterns based on application requirements.</p>
<h3 id="Storage-Architecture"><a href="#Storage-Architecture" class="headerlink" title="Storage Architecture"></a>Storage Architecture</h3><pre>
<code class="mermaid">
graph TB
subgraph &quot;Storage Layer&quot;
    SC[StorageClass] --&gt; PV[PersistentVolume]
    PVC[PersistentVolumeClaim] --&gt; PV
end

subgraph &quot;Application Layer&quot;
    POD[Pod] --&gt; PVC
    STATEFULSET[StatefulSet] --&gt; PVC
    DEPLOYMENT[Deployment] --&gt; PVC
end

subgraph &quot;Physical Storage&quot;
    PV --&gt; DISK[Physical Disk]
    PV --&gt; NFS[NFS Server]
    PV --&gt; CLOUD[Cloud Storage]
end
</code>
</pre>

<h3 id="StorageClass-Definition"><a href="#StorageClass-Definition" class="headerlink" title="StorageClass Definition"></a>StorageClass Definition</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fast-ssd</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/aws-ebs</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">gp3</span></span><br><span class="line">  <span class="attr">fsType:</span> <span class="string">ext4</span></span><br><span class="line">  <span class="attr">encrypted:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Delete</span></span><br><span class="line"><span class="attr">allowVolumeExpansion:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">WaitForFirstConsumer</span></span><br></pre></td></tr></table></figure>

<h3 id="PersistentVolumeClaim"><a href="#PersistentVolumeClaim" class="headerlink" title="PersistentVolumeClaim"></a>PersistentVolumeClaim</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-storage</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">fast-ssd</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">10Gi</span></span><br></pre></td></tr></table></figure>

<h3 id="Java-Application-with-File-Storage"><a href="#Java-Application-with-File-Storage" class="headerlink" title="Java Application with File Storage"></a>Java Application with File Storage</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-file-processor</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span>  <span class="comment"># Single replica for ReadWriteOnce</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app-storage</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/app/data</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-storage</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/app/logs</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATA_DIR</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;/app/data&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LOG_DIR</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;/app/logs&quot;</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app-storage</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">java-app-storage</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-storage</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">java-app-logs</span></span><br></pre></td></tr></table></figure>

<h3 id="StatefulSet-for-Database-Applications"><a href="#StatefulSet-for-Database-Applications" class="headerlink" title="StatefulSet for Database Applications"></a>StatefulSet for Database Applications</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-database-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">&quot;java-db-service&quot;</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-db-app:1.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/app/data</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">data-volume</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteOnce&quot;</span>]</span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">&quot;fast-ssd&quot;</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">20Gi</span></span><br></pre></td></tr></table></figure>

<h3 id="Java-File-Processing-Example"><a href="#Java-File-Processing-Example" class="headerlink" title="Java File Processing Example"></a>Java File Processing Example</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileProcessingService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.data.dir:/app/data&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String dataDirectory;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Ensure data directory exists</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">dataPath</span> <span class="operator">=</span> Paths.get(dataDirectory);</span><br><span class="line">        <span class="keyword">if</span> (!Files.exists(dataPath)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Files.createDirectories(dataPath);</span><br><span class="line">                logger.info(<span class="string">&quot;Created data directory: &#123;&#125;&quot;</span>, dataPath);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;Failed to create data directory&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processFile</span><span class="params">(MultipartFile uploadedFile)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> UUID.randomUUID().toString() + <span class="string">&quot;_&quot;</span> + uploadedFile.getOriginalFilename();</span><br><span class="line">            <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Paths.get(dataDirectory, filename);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Save uploaded file</span></span><br><span class="line">            uploadedFile.transferTo(filePath.toFile());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Process file</span></span><br><span class="line">            processFileContent(filePath);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Move to processed directory</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">processedDir</span> <span class="operator">=</span> Paths.get(dataDirectory, <span class="string">&quot;processed&quot;</span>);</span><br><span class="line">            Files.createDirectories(processedDir);</span><br><span class="line">            Files.move(filePath, processedDir.resolve(filename));</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;Error processing file&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileProcessingException</span>(<span class="string">&quot;Failed to process file&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processFileContent</span><span class="params">(Path filePath)</span> &#123;</span><br><span class="line">        <span class="comment">// File processing logic</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> Files.newBufferedReader(filePath)) &#123;</span><br><span class="line">            reader.lines()</span><br><span class="line">                .filter(line -&gt; !line.trim().isEmpty())</span><br><span class="line">                .forEach(<span class="built_in">this</span>::processLine);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;Error reading file: &quot;</span> + filePath, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Backup-Strategy-with-CronJob"><a href="#Backup-Strategy-with-CronJob" class="headerlink" title="Backup Strategy with CronJob"></a>Backup Strategy with CronJob</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">data-backup</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;0 2 * * *&quot;</span>  <span class="comment"># Daily at 2 AM</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">backup</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">alpine:latest</span></span><br><span class="line">            <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">              apk add --no-cache tar gzip</span></span><br><span class="line"><span class="string">              DATE=$(date +%Y%m%d_%H%M%S)</span></span><br><span class="line"><span class="string">              tar -czf /backup/data_backup_$DATE.tar.gz -C /app/data .</span></span><br><span class="line"><span class="string">              # Keep only last 7 backups</span></span><br><span class="line"><span class="string">              find /backup -name &quot;data_backup_*.tar.gz&quot; -mtime +7 -delete</span></span><br><span class="line"><span class="string"></span>            <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app-data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/app/data</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">backup-storage</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/backup</span></span><br><span class="line">          <span class="attr">volumes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app-data</span></span><br><span class="line">            <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">              <span class="attr">claimName:</span> <span class="string">java-app-storage</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">backup-storage</span></span><br><span class="line">            <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">              <span class="attr">claimName:</span> <span class="string">backup-storage</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span></span><br></pre></td></tr></table></figure>

<h3 id="Database-Connection-with-Persistent-Storage"><a href="#Database-Connection-with-Persistent-Storage" class="headerlink" title="Database Connection with Persistent Storage"></a>Database Connection with Persistent Storage</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String databaseUrl;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HikariConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariConfig</span>();</span><br><span class="line">        config.setJdbcUrl(databaseUrl);</span><br><span class="line">        config.setUsername(<span class="string">&quot;$&#123;DB_USERNAME&#125;&quot;</span>);</span><br><span class="line">        config.setPassword(<span class="string">&quot;$&#123;DB_PASSWORD&#125;&quot;</span>);</span><br><span class="line">        config.setMaximumPoolSize(<span class="number">20</span>);</span><br><span class="line">        config.setMinimumIdle(<span class="number">5</span>);</span><br><span class="line">        config.setConnectionTimeout(<span class="number">30000</span>);</span><br><span class="line">        config.setIdleTimeout(<span class="number">600000</span>);</span><br><span class="line">        config.setMaxLifetime(<span class="number">1800000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PlatformTransactionManager <span class="title function_">transactionManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>(dataSource());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="How-do-you-implement-service-discovery-and-communication-between-Java-microservices"><a href="#How-do-you-implement-service-discovery-and-communication-between-Java-microservices" class="headerlink" title="How do you implement service discovery and communication between Java microservices?"></a>How do you implement service discovery and communication between Java microservices?</h2><h3 id="Reference-Answer-6"><a href="#Reference-Answer-6" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Kubernetes provides built-in service discovery through DNS, while Java applications can leverage Spring Cloud Kubernetes for enhanced integration.</p>
<h3 id="Service-Discovery-Architecture"><a href="#Service-Discovery-Architecture" class="headerlink" title="Service Discovery Architecture"></a>Service Discovery Architecture</h3><pre>
<code class="mermaid">
graph TB
subgraph &quot;Kubernetes Cluster&quot;
    subgraph &quot;Namespace: default&quot;
        SVC1[user-service]
        SVC2[order-service]
        SVC3[payment-service]
        
        POD1[User Service Pods]
        POD2[Order Service Pods]
        POD3[Payment Service Pods]
        
        SVC1 --&gt; POD1
        SVC2 --&gt; POD2
        SVC3 --&gt; POD3
    end
    
    DNS[CoreDNS] --&gt; SVC1
    DNS --&gt; SVC2
    DNS --&gt; SVC3
end

POD2 --&gt;|user-service.default.svc.cluster.local| POD1
POD2 --&gt;|payment-service.default.svc.cluster.local| POD3
</code>
</pre>

<h3 id="Service-Definitions"><a href="#Service-Definitions" class="headerlink" title="Service Definitions"></a>Service Definitions</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># User Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">user-service</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">user-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">user-service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Order Service  </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">order-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Payment Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">payment-service</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">payment-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">payment-service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure>

<h3 id="Spring-Cloud-Kubernetes-Configuration"><a href="#Spring-Cloud-Kubernetes-Configuration" class="headerlink" title="Spring Cloud Kubernetes Configuration"></a>Spring Cloud Kubernetes Configuration</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Service-Discovery-Configuration"><a href="#Service-Discovery-Configuration" class="headerlink" title="Service Discovery Configuration"></a>Service Discovery Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceDiscoveryConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> WebClient.Builder <span class="title function_">webClientBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> WebClient.builder();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebClient <span class="title function_">webClient</span><span class="params">(WebClient.Builder builder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> builder</span><br><span class="line">            .codecs(configurer -&gt; configurer.defaultCodecs().maxInMemorySize(<span class="number">1024</span> * <span class="number">1024</span>))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Inter-Service-Communication"><a href="#Inter-Service-Communication" class="headerlink" title="Inter-Service Communication"></a>Inter-Service Communication</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(WebClient webClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClient = webClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;UserDto&gt; <span class="title function_">getUserDetails</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient</span><br><span class="line">            .get()</span><br><span class="line">            .uri(<span class="string">&quot;http://user-service/api/users/&#123;userId&#125;&quot;</span>, userId)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .onStatus(HttpStatus::isError, response -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> Mono.error(<span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;User service error: &quot;</span> + response.statusCode()));</span><br><span class="line">            &#125;)</span><br><span class="line">            .bodyToMono(UserDto.class)</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">            .retry(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;PaymentResponse&gt; <span class="title function_">processPayment</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient</span><br><span class="line">            .post()</span><br><span class="line">            .uri(<span class="string">&quot;http://payment-service/api/payments&quot;</span>)</span><br><span class="line">            .body(Mono.just(request), PaymentRequest.class)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(PaymentResponse.class)</span><br><span class="line">            .timeout(Duration.ofSeconds(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;OrderDto&gt; <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getUserDetails(request.getUserId())</span><br><span class="line">            .flatMap(user -&gt; &#123;</span><br><span class="line">                <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">                order.setUserId(user.getId());</span><br><span class="line">                order.setAmount(request.getAmount());</span><br><span class="line">                order.setStatus(OrderStatus.PENDING);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> Mono.fromCallable(() -&gt; orderRepository.save(order));</span><br><span class="line">            &#125;)</span><br><span class="line">            .flatMap(order -&gt; &#123;</span><br><span class="line">                <span class="type">PaymentRequest</span> <span class="variable">paymentRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentRequest</span>();</span><br><span class="line">                paymentRequest.setOrderId(order.getId());</span><br><span class="line">                paymentRequest.setAmount(order.getAmount());</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> processPayment(paymentRequest)</span><br><span class="line">                    .map(paymentResponse -&gt; &#123;</span><br><span class="line">                        order.setStatus(paymentResponse.isSuccessful() ? </span><br><span class="line">                            OrderStatus.CONFIRMED : OrderStatus.FAILED);</span><br><span class="line">                        <span class="keyword">return</span> orderRepository.save(order);</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;)</span><br><span class="line">            .map(<span class="built_in">this</span>::toOrderDto);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Circuit-Breaker-with-Resilience4j"><a href="#Circuit-Breaker-with-Resilience4j" class="headerlink" title="Circuit Breaker with Resilience4j"></a>Circuit Breaker with Resilience4j</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentServiceClient</span><span class="params">(WebClient webClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClient = webClient;</span><br><span class="line">        <span class="built_in">this</span>.circuitBreaker = CircuitBreaker.ofDefaults(<span class="string">&quot;payment-service&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;PaymentResponse&gt; <span class="title function_">processPayment</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        Supplier&lt;Mono&lt;PaymentResponse&gt;&gt; decoratedSupplier = CircuitBreaker</span><br><span class="line">            .decorateSupplier(circuitBreaker, () -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> webClient</span><br><span class="line">                    .post()</span><br><span class="line">                    .uri(<span class="string">&quot;http://payment-service/api/payments&quot;</span>)</span><br><span class="line">                    .body(Mono.just(request), PaymentRequest.class)</span><br><span class="line">                    .retrieve()</span><br><span class="line">                    .bodyToMono(PaymentResponse.class)</span><br><span class="line">                    .timeout(Duration.ofSeconds(<span class="number">5</span>));</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> decoratedSupplier.get()</span><br><span class="line">            .onErrorResume(CallNotPermittedException.class, ex -&gt; &#123;</span><br><span class="line">                <span class="comment">// Circuit breaker is open</span></span><br><span class="line">                <span class="keyword">return</span> Mono.just(PaymentResponse.failed(<span class="string">&quot;Service temporarily unavailable&quot;</span>));</span><br><span class="line">            &#125;)</span><br><span class="line">            .onErrorResume(TimeoutException.class, ex -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> Mono.just(PaymentResponse.failed(<span class="string">&quot;Payment service timeout&quot;</span>));</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Application-Properties"><a href="#Application-Properties" class="headerlink" title="Application Properties"></a>Application Properties</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">kubernetes:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">all-namespaces:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">wait-cache-ready:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">loadbalancer:</span></span><br><span class="line">      <span class="attr">ribbon:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">resilience4j:</span></span><br><span class="line">  <span class="attr">circuitbreaker:</span></span><br><span class="line">    <span class="attr">instances:</span></span><br><span class="line">      <span class="attr">payment-service:</span></span><br><span class="line">        <span class="attr">registerHealthIndicator:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">slidingWindowSize:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">minimumNumberOfCalls:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">failureRateThreshold:</span> <span class="number">50</span></span><br><span class="line">        <span class="attr">waitDurationInOpenState:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">permittedNumberOfCallsInHalfOpenState:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">retry:</span></span><br><span class="line">    <span class="attr">instances:</span></span><br><span class="line">      <span class="attr">payment-service:</span></span><br><span class="line">        <span class="attr">maxAttempts:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">waitDuration:</span> <span class="string">1s</span></span><br><span class="line">        <span class="attr">exponentialBackoffMultiplier:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">timelimiter:</span></span><br><span class="line">    <span class="attr">instances:</span></span><br><span class="line">      <span class="attr">payment-service:</span></span><br><span class="line">        <span class="attr">timeoutDuration:</span> <span class="string">5s</span></span><br></pre></td></tr></table></figure>

<h3 id="Service-Mesh-Integration-Istio"><a href="#Service-Mesh-Integration-Istio" class="headerlink" title="Service Mesh Integration (Istio)"></a>Service Mesh Integration (Istio)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">payment-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">payment-service</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uri:</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">/api/payments</span></span><br><span class="line">    <span class="attr">route:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">payment-service</span></span><br><span class="line">        <span class="attr">port:</span></span><br><span class="line">          <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">retries:</span></span><br><span class="line">      <span class="attr">attempts:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">perTryTimeout:</span> <span class="string">3s</span></span><br><span class="line">      <span class="attr">retryOn:</span> <span class="string">5xx,reset,connect-failure,refused-stream</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DestinationRule</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">payment-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">payment-service</span></span><br><span class="line">  <span class="attr">trafficPolicy:</span></span><br><span class="line">    <span class="attr">loadBalancer:</span></span><br><span class="line">      <span class="attr">simple:</span> <span class="string">LEAST_CONN</span></span><br><span class="line">    <span class="attr">connectionPool:</span></span><br><span class="line">      <span class="attr">tcp:</span></span><br><span class="line">        <span class="attr">maxConnections:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">http1MaxPendingRequests:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">maxRequestsPerConnection:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">circuitBreaker:</span></span><br><span class="line">      <span class="attr">consecutiveErrors:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">baseEjectionTime:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">maxEjectionPercent:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Describe-different-deployment-strategies-in-Kubernetes"><a href="#Describe-different-deployment-strategies-in-Kubernetes" class="headerlink" title="Describe different deployment strategies in Kubernetes"></a>Describe different deployment strategies in Kubernetes</h2><h3 id="Reference-Answer-7"><a href="#Reference-Answer-7" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Kubernetes supports various deployment strategies to minimize downtime and reduce risk during application updates.</p>
<h3 id="Deployment-Strategies-Overview"><a href="#Deployment-Strategies-Overview" class="headerlink" title="Deployment Strategies Overview"></a>Deployment Strategies Overview</h3><pre>
<code class="mermaid">
graph TB
subgraph &quot;Rolling Update&quot;
    RU1[v1 Pod] --&gt; RU2[v1 Pod]
    RU2 --&gt; RU3[v1 Pod]
    RU4[v2 Pod] --&gt; RU5[v2 Pod]
    RU5 --&gt; RU6[v2 Pod]
end

subgraph &quot;Blue-Green&quot;
    BG1[Blue Environment&lt;br&#x2F;&gt;v1 Pods] 
    BG2[Green Environment&lt;br&#x2F;&gt;v2 Pods]
    LB[Load Balancer] --&gt; BG1
    LB -.-&gt; BG2
end

subgraph &quot;Canary&quot;
    C1[v1 Pods - 90%]
    C2[v2 Pods - 10%]
    CLB[Load Balancer] --&gt; C1
    CLB --&gt; C2
end
</code>
</pre>

<h3 id="Rolling-Update-Default-Strategy"><a href="#Rolling-Update-Default-Strategy" class="headerlink" title="Rolling Update (Default Strategy)"></a>Rolling Update (Default Strategy)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-rolling</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span>      <span class="comment"># Max pods that can be unavailable</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">2</span>           <span class="comment"># Max pods that can be created above desired replica count</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:v2</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health/ready</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health/live</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h3 id="Blue-Green-Deployment"><a href="#Blue-Green-Deployment" class="headerlink" title="Blue-Green Deployment"></a>Blue-Green Deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Blue deployment (current version)</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-blue</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">blue</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">      <span class="attr">version:</span> <span class="string">blue</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">blue</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:v1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Green deployment (new version)</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-green</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">green</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">      <span class="attr">version:</span> <span class="string">green</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">green</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:v2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Service pointing to blue (active) version</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">blue</span>  <span class="comment"># Switch to &#x27;green&#x27; when ready</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h3 id="Canary-Deployment-with-Istio"><a href="#Canary-Deployment-with-Istio" class="headerlink" title="Canary Deployment with Istio"></a>Canary Deployment with Istio</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Primary deployment (90% traffic)</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-primary</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">9</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">      <span class="attr">version:</span> <span class="string">primary</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">primary</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:v1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Canary deployment (10% traffic)</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-canary</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">      <span class="attr">version:</span> <span class="string">canary</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">canary</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:v2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># VirtualService for traffic splitting</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VirtualService</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">java-app</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">headers:</span></span><br><span class="line">        <span class="attr">canary:</span></span><br><span class="line">          <span class="attr">exact:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">route:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">subset:</span> <span class="string">canary</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">route:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">subset:</span> <span class="string">primary</span></span><br><span class="line">      <span class="attr">weight:</span> <span class="number">90</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">destination:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">subset:</span> <span class="string">canary</span></span><br><span class="line">      <span class="attr">weight:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># DestinationRule defining subsets</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DestinationRule</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">java-app</span></span><br><span class="line">  <span class="attr">subsets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">primary</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">version:</span> <span class="string">primary</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">canary</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">version:</span> <span class="string">canary</span></span><br></pre></td></tr></table></figure>

<h3 id="Recreate-Strategy"><a href="#Recreate-Strategy" class="headerlink" title="Recreate Strategy"></a>Recreate Strategy</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-recreate</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span>  <span class="comment"># Terminates all old pods before creating new ones</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:v2</span></span><br></pre></td></tr></table></figure>

<h3 id="Deployment-Automation-Script"><a href="#Deployment-Automation-Script" class="headerlink" title="Deployment Automation Script"></a>Deployment Automation Script</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">DEPLOYMENT_NAME=<span class="string">&quot;java-app&quot;</span></span><br><span class="line">NEW_IMAGE=<span class="string">&quot;my-java-app:v2&quot;</span></span><br><span class="line">NAMESPACE=<span class="string">&quot;default&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Rolling update</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment/<span class="variable">$DEPLOYMENT_NAME</span> java-app=<span class="variable">$NEW_IMAGE</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Wait for rollout to complete</span></span><br><span class="line">kubectl rollout status deployment/<span class="variable">$DEPLOYMENT_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if rollout was successful</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Deployment successful&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Optional: Run smoke tests</span></span><br><span class="line">    kubectl run smoke-test --<span class="built_in">rm</span> -i --restart=Never --image=curlimages/curl -- \</span><br><span class="line">        curl -f http://java-app-service/health/ready</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Smoke tests passed&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Smoke tests failed, rolling back&quot;</span></span><br><span class="line">        kubectl rollout undo deployment/<span class="variable">$DEPLOYMENT_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Deployment failed, rolling back&quot;</span></span><br><span class="line">    kubectl rollout undo deployment/<span class="variable">$DEPLOYMENT_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-Graceful-Shutdown"><a href="#Spring-Boot-Graceful-Shutdown" class="headerlink" title="Spring Boot Graceful Shutdown"></a>Spring Boot Graceful Shutdown</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GracefulShutdownHook</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(GracefulShutdownHook.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ContextClosedEvent event)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Received shutdown signal, starting graceful shutdown...&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Allow ongoing requests to complete</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>); <span class="comment">// Grace period</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">&quot;Graceful shutdown completed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.properties</span></span><br><span class="line"><span class="attr">server.shutdown</span>=<span class="string">graceful</span></span><br><span class="line"><span class="attr">spring.lifecycle.timeout-per-shutdown-phase</span>=<span class="string">30s</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="How-do-you-handle-logging-and-monitoring-for-Java-applications-in-Kubernetes"><a href="#How-do-you-handle-logging-and-monitoring-for-Java-applications-in-Kubernetes" class="headerlink" title="How do you handle logging and monitoring for Java applications in Kubernetes?"></a>How do you handle logging and monitoring for Java applications in Kubernetes?</h2><h3 id="Reference-Answer-8"><a href="#Reference-Answer-8" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Comprehensive logging and monitoring in Kubernetes requires centralized log aggregation, metrics collection, and distributed tracing.</p>
<h3 id="Logging-Architecture"><a href="#Logging-Architecture" class="headerlink" title="Logging Architecture"></a>Logging Architecture</h3><pre>
<code class="mermaid">
graph TB
subgraph &quot;Kubernetes Cluster&quot;
    subgraph &quot;Application Pods&quot;
        APP1[Java App 1] --&gt; LOGS1[stdout&#x2F;stderr]
        APP2[Java App 2] --&gt; LOGS2[stdout&#x2F;stderr]
        APP3[Java App 3] --&gt; LOGS3[stdout&#x2F;stderr]
    end
    
    subgraph &quot;Log Collection&quot;
        FLUENTD[Fluentd DaemonSet]
        LOGS1 --&gt; FLUENTD
        LOGS2 --&gt; FLUENTD
        LOGS3 --&gt; FLUENTD
    end
    
    subgraph &quot;Monitoring&quot;
        PROMETHEUS[Prometheus]
        APP1 --&gt; PROMETHEUS
        APP2 --&gt; PROMETHEUS
        APP3 --&gt; PROMETHEUS
    end
end

subgraph &quot;External Systems&quot;
    FLUENTD --&gt; ELASTICSEARCH[Elasticsearch]
    ELASTICSEARCH --&gt; KIBANA[Kibana]
    PROMETHEUS --&gt; GRAFANA[Grafana]
end
</code>
</pre>

<h3 id="Structured-Logging-Configuration"><a href="#Structured-Logging-Configuration" class="headerlink" title="Structured Logging Configuration"></a>Structured Logging Configuration</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- logback-spring.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;!local&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">providers</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">timestamp</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">logLevel</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">loggerName</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">message</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mdc</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">arguments</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">stackTrace</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                &quot;service&quot;: &quot;java-app&quot;,</span><br><span class="line">                                &quot;version&quot;: &quot;$&#123;APP_VERSION:-unknown&#125;&quot;,</span><br><span class="line">                                &quot;pod&quot;: &quot;$&#123;HOSTNAME:-unknown&#125;&quot;,</span><br><span class="line">                                &quot;namespace&quot;: &quot;$&#123;POD_NAMESPACE:-default&#125;&quot;</span><br><span class="line">                            &#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;local&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.example&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework.web&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Application-Logging-Code"><a href="#Application-Logging-Code" class="headerlink" title="Application Logging Code"></a>Application Logging Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/orders&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDto&gt; <span class="title function_">createOrder</span><span class="params">(<span class="meta">@RequestBody</span> CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">correlationId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add correlation ID to MDC for request tracing</span></span><br><span class="line">        MDC.put(<span class="string">&quot;correlationId&quot;</span>, correlationId);</span><br><span class="line">        MDC.put(<span class="string">&quot;operation&quot;</span>, <span class="string">&quot;createOrder&quot;</span>);</span><br><span class="line">        MDC.put(<span class="string">&quot;userId&quot;</span>, request.getUserId());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;Creating order for user: &#123;&#125;&quot;</span>, request.getUserId());</span><br><span class="line">            </span><br><span class="line">            <span class="type">OrderDto</span> <span class="variable">order</span> <span class="operator">=</span> orderService.createOrder(request);</span><br><span class="line">            </span><br><span class="line">            log.info(<span class="string">&quot;Order created successfully: orderId=&#123;&#125;, amount=&#123;&#125;&quot;</span>, </span><br><span class="line">                order.getId(), order.getAmount());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(order);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to create order: &#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            MDC.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Fluentd-Configuration"><a href="#Fluentd-Configuration" class="headerlink" title="Fluentd Configuration"></a>Fluentd Configuration</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fluentd-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">fluent.conf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &lt;source&gt;</span></span><br><span class="line"><span class="string">      @type tail</span></span><br><span class="line"><span class="string">      path /var/log/containers/*java-app*.log</span></span><br><span class="line"><span class="string">      pos_file /var/log/fluentd-containers.log.pos</span></span><br><span class="line"><span class="string">      tag kubernetes.*</span></span><br><span class="line"><span class="string">      format json</span></span><br><span class="line"><span class="string">      read_from_head true</span></span><br><span class="line"><span class="string">    &lt;/source&gt;</span></span><br><span class="line"><span class="string"></span>    </span><br><span class="line">    <span class="string">&lt;filter</span> <span class="string">kubernetes.**&gt;</span></span><br><span class="line">      <span class="string">@type</span> <span class="string">kubernetes_metadata</span></span><br><span class="line">    <span class="string">&lt;/filter&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&lt;filter</span> <span class="string">kubernetes.**&gt;</span></span><br><span class="line">      <span class="string">@type</span> <span class="string">parser</span></span><br><span class="line">      <span class="string">key_name</span> <span class="string">log</span></span><br><span class="line">      <span class="string">reserve_data</span> <span class="literal">true</span></span><br><span class="line">      <span class="string">&lt;parse&gt;</span></span><br><span class="line">        <span class="string">@type</span> <span class="string">json</span></span><br><span class="line">      <span class="string">&lt;/parse&gt;</span></span><br><span class="line">    <span class="string">&lt;/filter&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&lt;match</span> <span class="string">kubernetes.**&gt;</span></span><br><span class="line">      <span class="string">@type</span> <span class="string">elasticsearch</span></span><br><span class="line">      <span class="string">host</span> <span class="string">elasticsearch.logging.svc.cluster.local</span></span><br><span class="line">      <span class="string">port</span> <span class="number">9200</span></span><br><span class="line">      <span class="string">index_name</span> <span class="string">kubernetes</span></span><br><span class="line">      <span class="string">type_name</span> <span class="string">_doc</span></span><br><span class="line">      <span class="string">&lt;buffer&gt;</span></span><br><span class="line">        <span class="string">@type</span> <span class="string">file</span></span><br><span class="line">        <span class="string">path</span> <span class="string">/var/log/fluentd-buffers/kubernetes.system.buffer</span></span><br><span class="line">        <span class="string">flush_mode</span> <span class="string">interval</span></span><br><span class="line">        <span class="string">retry_type</span> <span class="string">exponential_backoff</span></span><br><span class="line">        <span class="string">flush_thread_count</span> <span class="number">2</span></span><br><span class="line">        <span class="string">flush_interval</span> <span class="string">5s</span></span><br><span class="line">        <span class="string">retry_forever</span></span><br><span class="line">        <span class="string">retry_max_interval</span> <span class="number">30</span></span><br><span class="line">        <span class="string">chunk_limit_size</span> <span class="string">2M</span></span><br><span class="line">        <span class="string">queue_limit_length</span> <span class="number">8</span></span><br><span class="line">        <span class="string">overflow_action</span> <span class="string">block</span></span><br><span class="line">      <span class="string">&lt;/buffer&gt;</span></span><br><span class="line">    <span class="string">&lt;/match&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">fluent/fluentd-kubernetes-daemonset:v1.14-debian-elasticsearch7-1</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/log</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/fluentd/etc</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/log</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">fluentd-config</span></span><br></pre></td></tr></table></figure>

<h3 id="Prometheus-Metrics-with-Micrometer"><a href="#Prometheus-Metrics-with-Micrometer" class="headerlink" title="Prometheus Metrics with Micrometer"></a>Prometheus Metrics with Micrometer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MeterRegistryCustomizer&lt;MeterRegistry&gt; <span class="title function_">metricsCommonTags</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> registry -&gt; registry.config().commonTags(</span><br><span class="line">            <span class="string">&quot;application&quot;</span>, <span class="string">&quot;java-app&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>, System.getProperty(<span class="string">&quot;app.version&quot;</span>, <span class="string">&quot;unknown&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TimedAspect <span class="title function_">timedAspect</span><span class="params">(MeterRegistry registry)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TimedAspect</span>(registry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter orderCreatedCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer orderProcessingTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge activeOrdersGauge;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderCreatedCounter = Counter.builder(<span class="string">&quot;orders.created&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Number of orders created&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.orderProcessingTimer = Timer.builder(<span class="string">&quot;orders.processing.time&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Order processing time&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.activeOrdersGauge = Gauge.builder(<span class="string">&quot;orders.active&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Number of active orders&quot;</span>)</span><br><span class="line">            .register(meterRegistry, <span class="built_in">this</span>, OrderService::getActiveOrderCount);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Timed(name = &quot;orders.create&quot;, description = &quot;Create order operation&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> OrderDto <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Timer.Sample.start(orderProcessingTimer)</span><br><span class="line">            .stop(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// Order creation logic</span></span><br><span class="line">                    <span class="type">OrderDto</span> <span class="variable">order</span> <span class="operator">=</span> processOrder(request);</span><br><span class="line">                    orderCreatedCounter.increment(Tags.of(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;success&quot;</span>));</span><br><span class="line">                    <span class="keyword">return</span> order;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    orderCreatedCounter.increment(Tags.of(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;error&quot;</span>));</span><br><span class="line">                    <span class="keyword">throw</span> e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getActiveOrderCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Return current active order count</span></span><br><span class="line">        <span class="keyword">return</span> orderRepository.countByStatus(OrderStatus.ACTIVE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Deployment-with-Monitoring-Annotations"><a href="#Deployment-with-Monitoring-Annotations" class="headerlink" title="Deployment with Monitoring Annotations"></a>Deployment with Monitoring Annotations</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">prometheus.io/scrape:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">        <span class="attr">prometheus.io/path:</span> <span class="string">&quot;/actuator/prometheus&quot;</span></span><br><span class="line">        <span class="attr">prometheus.io/port:</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HOSTNAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_VERSION</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;1.0&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Distributed-Tracing-with-Jaeger"><a href="#Distributed-Tracing-with-Jaeger" class="headerlink" title="Distributed Tracing with Jaeger"></a>Distributed Tracing with Jaeger</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.opentracing.contrib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opentracing-spring-jaeger-cloud-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Tracer tracer;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/orders&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDto&gt; <span class="title function_">createOrder</span><span class="params">(<span class="meta">@RequestBody</span> CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span> tracer.nextSpan()</span><br><span class="line">            .name(<span class="string">&quot;create-order&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;user.id&quot;</span>, request.getUserId())</span><br><span class="line">            .tag(<span class="string">&quot;order.amount&quot;</span>, String.valueOf(request.getAmount()))</span><br><span class="line">            .start();</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">try</span> (Tracer.<span class="type">SpanInScope</span> <span class="variable">ws</span> <span class="operator">=</span> tracer.withSpanInScope(span)) &#123;</span><br><span class="line">            <span class="type">OrderDto</span> <span class="variable">order</span> <span class="operator">=</span> orderService.createOrder(request);</span><br><span class="line">            span.tag(<span class="string">&quot;order.id&quot;</span>, order.getId());</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(order);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            span.tag(<span class="string">&quot;error&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">            span.tag(<span class="string">&quot;error.message&quot;</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            span.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Application-Properties-for-Monitoring"><a href="#Application-Properties-for-Monitoring" class="headerlink" title="Application Properties for Monitoring"></a>Application Properties for Monitoring</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">health,info,metrics,prometheus,loggers</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="attr">export:</span></span><br><span class="line">      <span class="attr">prometheus:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">distribution:</span></span><br><span class="line">      <span class="attr">percentiles-histogram:</span></span><br><span class="line">        <span class="attr">http.server.requests:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">percentiles:</span></span><br><span class="line">        <span class="attr">http.server.requests:</span> <span class="number">0.5</span><span class="string">,</span> <span class="number">0.95</span><span class="string">,</span> <span class="number">0.99</span></span><br><span class="line">      <span class="attr">sla:</span></span><br><span class="line">        <span class="attr">http.server.requests:</span> <span class="string">100ms,</span> <span class="string">200ms,</span> <span class="string">500ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">opentracing:</span></span><br><span class="line">  <span class="attr">jaeger:</span></span><br><span class="line">    <span class="attr">service-name:</span> <span class="string">java-app</span></span><br><span class="line">    <span class="attr">sampler:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">const</span></span><br><span class="line">      <span class="attr">param:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">log-spans:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io.jaeger:</span> <span class="string">INFO</span></span><br><span class="line">    <span class="attr">io.opentracing:</span> <span class="string">INFO</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="What-are-the-security-considerations-for-Java-applications-in-Kubernetes"><a href="#What-are-the-security-considerations-for-Java-applications-in-Kubernetes" class="headerlink" title="What are the security considerations for Java applications in Kubernetes?"></a>What are the security considerations for Java applications in Kubernetes?</h2><h3 id="Reference-Answer-9"><a href="#Reference-Answer-9" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Security in Kubernetes requires a multi-layered approach covering container security, network policies, RBAC, and secure configuration management.</p>
<h3 id="Security-Architecture"><a href="#Security-Architecture" class="headerlink" title="Security Architecture"></a>Security Architecture</h3><pre>
<code class="mermaid">
graph TB
subgraph &quot;Cluster Security&quot;
    RBAC[RBAC] --&gt; API[API Server]
    PSP[Pod Security Standards] --&gt; PODS[Pods]
    NP[Network Policies] --&gt; NETWORK[Pod Network]
end

subgraph &quot;Pod Security&quot;
    SECCTX[Security Context] --&gt; CONTAINER[Container]
    SECRETS[Secrets] --&gt; CONTAINER
    SA[Service Account] --&gt; CONTAINER
end

subgraph &quot;Image Security&quot;
    SCAN[Image Scanning] --&gt; REGISTRY[Container Registry]
    SIGN[Image Signing] --&gt; REGISTRY
end
</code>
</pre>

<h3 id="Pod-Security-Context"><a href="#Pod-Security-Context" class="headerlink" title="Pod Security Context"></a>Pod Security Context</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secure-java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># Pod-level security context</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">runAsNonRoot:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">runAsUser:</span> <span class="number">1000</span></span><br><span class="line">        <span class="attr">runAsGroup:</span> <span class="number">3000</span></span><br><span class="line">        <span class="attr">fsGroup:</span> <span class="number">2000</span></span><br><span class="line">        <span class="attr">seccompProfile:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">RuntimeDefault</span></span><br><span class="line">      </span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="comment"># Container-level security context</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsNonRoot:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">drop:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">            <span class="attr">add:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">NET_BIND_SERVICE</span>  <span class="comment"># Only if needed for port &lt; 1024</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cache-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/app/cache</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line">      </span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tmp-volume</span></span><br><span class="line">        <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cache-volume</span></span><br><span class="line">        <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Secure-Dockerfile"><a href="#Secure-Dockerfile" class="headerlink" title="Secure Dockerfile"></a>Secure Dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11</span>-jre-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create non-root user</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> groupadd -r appgroup &amp;&amp; useradd -r -g appgroup -u 1000 appuser</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create app directory</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> -p /app/logs /app/cache &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chown</span> -R appuser:appgroup /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy application</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --<span class="built_in">chown</span>=appuser:appgroup target/app.jar /app/app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch to non-root user</span></span><br><span class="line"><span class="keyword">USER</span> appuser</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Expose port</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Health check</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=30s --<span class="built_in">timeout</span>=3s --start-period=5s --retries=3 \</span></span><br><span class="line"><span class="language-bash">  CMD curl -f http://localhost:8080/actuator/health || <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="Network-Policies"><a href="#Network-Policies" class="headerlink" title="Network Policies"></a>Network Policies</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deny all ingress traffic by default</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">default-deny-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podSelector:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">policyTypes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Ingress</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Allow specific ingress traffic to Java app</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podSelector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">  <span class="attr">policyTypes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Ingress</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Egress</span></span><br><span class="line">  <span class="attr">ingress:</span></span><br><span class="line">  <span class="comment"># Allow traffic from ingress controller</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">from:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">namespaceSelector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="comment"># Allow traffic from same namespace</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">from:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">podSelector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">app:</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">egress:</span></span><br><span class="line">  <span class="comment"># Allow DNS resolution</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span> []</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">UDP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">53</span></span><br><span class="line">  <span class="comment"># Allow database access</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">podSelector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">app:</span> <span class="string">database</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">5432</span></span><br><span class="line">  <span class="comment"># Allow external API calls</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span> []</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">443</span></span><br></pre></td></tr></table></figure>

<h3 id="RBAC-Configuration"><a href="#RBAC-Configuration" class="headerlink" title="RBAC Configuration"></a>RBAC Configuration</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Service Account</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-sa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Role with minimal permissions</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-role</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;configmaps&quot;</span>, <span class="string">&quot;secrets&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Role Binding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-sa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-role</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Deployment using Service Account</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">java-app-sa</span></span><br><span class="line">      <span class="attr">automountServiceAccountToken:</span> <span class="literal">false</span>  <span class="comment"># Disable if not needed</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br></pre></td></tr></table></figure>

<h3 id="Secrets-Management"><a href="#Secrets-Management" class="headerlink" title="Secrets Management"></a>Secrets Management</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create secret from command line (better than YAML)</span></span><br><span class="line"><span class="comment"># kubectl create secret generic db-credentials \</span></span><br><span class="line"><span class="comment">#   --from-literal=username=dbuser \</span></span><br><span class="line"><span class="comment">#   --from-literal=password=securepassword</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">db-credentials</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">ZGJ1c2Vy</span>        <span class="comment"># base64 encoded</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">c2VjdXJlcGFzc3dvcmQ=</span>  <span class="comment"># base64 encoded</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_USERNAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">db-credentials</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">username</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_PASSWORD</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">db-credentials</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">password</span></span><br><span class="line">        <span class="comment"># Or mount as files</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">db-credentials</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/secrets</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">db-credentials</span></span><br><span class="line">        <span class="attr">secret:</span></span><br><span class="line">          <span class="attr">secretName:</span> <span class="string">db-credentials</span></span><br><span class="line">          <span class="attr">defaultMode:</span> <span class="number">0400</span>  <span class="comment"># Read-only for owner</span></span><br></pre></td></tr></table></figure>

<h3 id="Pod-Security-Standards"><a href="#Pod-Security-Standards" class="headerlink" title="Pod Security Standards"></a>Pod Security Standards</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secure-namespace</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/enforce:</span> <span class="string">restricted</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/audit:</span> <span class="string">restricted</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/warn:</span> <span class="string">restricted</span></span><br></pre></td></tr></table></figure>

<h3 id="Security-Configuration-in-Java"><a href="#Security-Configuration-in-Java" class="headerlink" title="Security Configuration in Java"></a>Security Configuration in Java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            .sessionManagement()</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">            .and()</span><br><span class="line">            .headers()</span><br><span class="line">                .frameOptions().deny()</span><br><span class="line">                .contentTypeOptions()</span><br><span class="line">                .and()</span><br><span class="line">                .httpStrictTransportSecurity(hstsConfig -&gt; hstsConfig</span><br><span class="line">                    .maxAgeInSeconds(<span class="number">31536000</span>)</span><br><span class="line">                    .includeSubdomains(<span class="literal">true</span>))</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">            .authorizeHttpRequests(authz -&gt; authz</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/actuator/health&quot;</span>, <span class="string">&quot;/actuator/info&quot;</span>).permitAll()</span><br><span class="line">                .requestMatchers(<span class="string">&quot;/actuator/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">            )</span><br><span class="line">            .oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/secure-endpoint&quot;)</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">secureEndpoint</span><span class="params">(Authentication authentication)</span> &#123;</span><br><span class="line">        <span class="comment">// Log access attempt</span></span><br><span class="line">        log.info(<span class="string">&quot;Secure endpoint accessed by: &#123;&#125;&quot;</span>, authentication.getName());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;Secure data&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Image-Scanning-with-Trivy"><a href="#Image-Scanning-with-Trivy" class="headerlink" title="Image Scanning with Trivy"></a>Image Scanning with Trivy</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">image-scan</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">trivy</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">aquasec/trivy:latest</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">trivy</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">image</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--exit-code</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--severity</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">HIGH,CRITICAL</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">my-java-app:1.0</span></span><br></pre></td></tr></table></figure>

<h3 id="Admission-Controller-OPA-Gatekeeper"><a href="#Admission-Controller-OPA-Gatekeeper" class="headerlink" title="Admission Controller (OPA Gatekeeper)"></a>Admission Controller (OPA Gatekeeper)</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">templates.gatekeeper.sh/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConstraintTemplate</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8srequiredsecuritycontext</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">crd:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">names:</span></span><br><span class="line">        <span class="attr">kind:</span> <span class="string">K8sRequiredSecurityContext</span></span><br><span class="line">      <span class="attr">validation:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">runAsNonRoot:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">  <span class="attr">targets:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target:</span> <span class="string">admission.k8s.gatekeeper.sh</span></span><br><span class="line">      <span class="attr">rego:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        package k8srequiredsecuritycontext</span></span><br><span class="line"><span class="string"></span>        </span><br><span class="line">        <span class="string">violation[&#123;&quot;msg&quot;:</span> <span class="string">msg&#125;]</span> &#123;</span><br><span class="line">          <span class="string">container</span> <span class="string">:=</span> <span class="string">input.review.object.spec.containers</span>[<span class="string">_</span>]</span><br><span class="line">          <span class="string">not</span> <span class="string">container.securityContext.runAsNonRoot</span></span><br><span class="line">          <span class="string">msg</span> <span class="string">:=</span> <span class="string">&quot;Container must run as non-root user&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">constraints.gatekeeper.sh/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">K8sRequiredSecurityContext</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">must-run-as-non-root</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">match:</span></span><br><span class="line">    <span class="attr">kinds:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">        <span class="attr">kinds:</span> [<span class="string">&quot;Deployment&quot;</span>]</span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="attr">runAsNonRoot:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="How-do-you-debug-issues-in-Java-applications-running-on-Kubernetes"><a href="#How-do-you-debug-issues-in-Java-applications-running-on-Kubernetes" class="headerlink" title="How do you debug issues in Java applications running on Kubernetes?"></a>How do you debug issues in Java applications running on Kubernetes?</h2><h3 id="Reference-Answer-10"><a href="#Reference-Answer-10" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Debugging Kubernetes applications requires understanding both Kubernetes diagnostics and Java-specific debugging techniques.</p>
<h3 id="Debugging-Workflow"><a href="#Debugging-Workflow" class="headerlink" title="Debugging Workflow"></a>Debugging Workflow</h3><pre>
<code class="mermaid">
graph TD
ISSUE[Application Issue] --&gt; CHECK1{Pod Status}
CHECK1 --&gt;|Running| CHECK2{Logs Analysis}
CHECK1 --&gt;|Pending| EVENTS[Check Events]
CHECK1 --&gt;|Failed| DESCRIBE[Describe Pod]

CHECK2 --&gt;|App Logs| APPLOGS[Application Logs]
CHECK2 --&gt;|System Logs| SYSLOGS[System Logs]

EVENTS --&gt; RESOURCES{Resource Issues}
DESCRIBE --&gt; CONFIG{Config Issues}

APPLOGS --&gt; METRICS[Check Metrics]
SYSLOGS --&gt; NETWORK[Network Debug]

RESOURCES --&gt; SCALE[Scale Resources]
CONFIG --&gt; FIX[Fix Configuration]

METRICS --&gt; PROFILE[Java Profiling]
NETWORK --&gt; CONNECTIVITY[Test Connectivity]
</code>
</pre>

<h3 id="Basic-Kubernetes-Debugging-Commands"><a href="#Basic-Kubernetes-Debugging-Commands" class="headerlink" title="Basic Kubernetes Debugging Commands"></a>Basic Kubernetes Debugging Commands</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check pod status</span></span><br><span class="line">kubectl get pods -l app=java-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># Describe pod for detailed information</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get pod logs</span></span><br><span class="line">kubectl logs &lt;pod-name&gt;</span><br><span class="line">kubectl logs &lt;pod-name&gt; --previous  <span class="comment"># Previous container logs</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt;  <span class="comment"># Multi-container pod</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Follow logs in real-time</span></span><br><span class="line">kubectl logs -f &lt;pod-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get logs from all pods with label</span></span><br><span class="line">kubectl logs -l app=java-app --<span class="built_in">tail</span>=100</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check events</span></span><br><span class="line">kubectl get events --sort-by=.metadata.creationTimestamp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execute commands in pod</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- /bin/bash</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- ps aux</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- netstat -tlnp</span><br></pre></td></tr></table></figure>

<h3 id="Java-Application-Debugging"><a href="#Java-Application-Debugging" class="headerlink" title="Java Application Debugging"></a>Java Application Debugging</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DebugController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(DebugController.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MeterRegistry meterRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/debug/health&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getDetailedHealth</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; health = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// JVM Memory info</span></span><br><span class="line">        <span class="type">MemoryMXBean</span> <span class="variable">memoryBean</span> <span class="operator">=</span> ManagementFactory.getMemoryMXBean();</span><br><span class="line">        <span class="type">MemoryUsage</span> <span class="variable">heapUsage</span> <span class="operator">=</span> memoryBean.getHeapMemoryUsage();</span><br><span class="line">        <span class="type">MemoryUsage</span> <span class="variable">nonHeapUsage</span> <span class="operator">=</span> memoryBean.getNonHeapMemoryUsage();</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; memory = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        memory.put(<span class="string">&quot;heap&quot;</span>, Map.of(</span><br><span class="line">            <span class="string">&quot;used&quot;</span>, heapUsage.getUsed(),</span><br><span class="line">            <span class="string">&quot;committed&quot;</span>, heapUsage.getCommitted(),</span><br><span class="line">            <span class="string">&quot;max&quot;</span>, heapUsage.getMax()</span><br><span class="line">        ));</span><br><span class="line">        memory.put(<span class="string">&quot;nonHeap&quot;</span>, Map.of(</span><br><span class="line">            <span class="string">&quot;used&quot;</span>, nonHeapUsage.getUsed(),</span><br><span class="line">            <span class="string">&quot;committed&quot;</span>, nonHeapUsage.getCommitted(),</span><br><span class="line">            <span class="string">&quot;max&quot;</span>, nonHeapUsage.getMax()</span><br><span class="line">        ));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Thread info</span></span><br><span class="line">        <span class="type">ThreadMXBean</span> <span class="variable">threadBean</span> <span class="operator">=</span> ManagementFactory.getThreadMXBean();</span><br><span class="line">        Map&lt;String, Object&gt; threads = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        threads.put(<span class="string">&quot;count&quot;</span>, threadBean.getThreadCount());</span><br><span class="line">        threads.put(<span class="string">&quot;peak&quot;</span>, threadBean.getPeakThreadCount());</span><br><span class="line">        threads.put(<span class="string">&quot;daemon&quot;</span>, threadBean.getDaemonThreadCount());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// GC info</span></span><br><span class="line">        List&lt;GarbageCollectorMXBean&gt; gcBeans = ManagementFactory.getGarbageCollectorMXBeans();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; gcInfo = gcBeans.stream()</span><br><span class="line">            .map(gc -&gt; Map.of(</span><br><span class="line">                <span class="string">&quot;name&quot;</span>, gc.getName(),</span><br><span class="line">                <span class="string">&quot;collections&quot;</span>, gc.getCollectionCount(),</span><br><span class="line">                <span class="string">&quot;time&quot;</span>, gc.getCollectionTime()</span><br><span class="line">            ))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        health.put(<span class="string">&quot;timestamp&quot;</span>, Instant.now());</span><br><span class="line">        health.put(<span class="string">&quot;memory&quot;</span>, memory);</span><br><span class="line">        health.put(<span class="string">&quot;threads&quot;</span>, threads);</span><br><span class="line">        health.put(<span class="string">&quot;gc&quot;</span>, gcInfo);</span><br><span class="line">        health.put(<span class="string">&quot;uptime&quot;</span>, ManagementFactory.getRuntimeMXBean().getUptime());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> health;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/debug/threads&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getThreadDump</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadMXBean</span> <span class="variable">threadBean</span> <span class="operator">=</span> ManagementFactory.getThreadMXBean();</span><br><span class="line">        ThreadInfo[] threadInfos = threadBean.dumpAllThreads(<span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; dump = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        dump.put(<span class="string">&quot;timestamp&quot;</span>, Instant.now());</span><br><span class="line">        dump.put(<span class="string">&quot;threadCount&quot;</span>, threadInfos.length);</span><br><span class="line">        </span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; threads = Arrays.stream(threadInfos)</span><br><span class="line">            .map(info -&gt; &#123;</span><br><span class="line">                Map&lt;String, Object&gt; thread = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                thread.put(<span class="string">&quot;name&quot;</span>, info.getThreadName());</span><br><span class="line">                thread.put(<span class="string">&quot;state&quot;</span>, info.getThreadState().toString());</span><br><span class="line">                thread.put(<span class="string">&quot;blocked&quot;</span>, info.getBlockedCount());</span><br><span class="line">                thread.put(<span class="string">&quot;waited&quot;</span>, info.getWaitedCount());</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (info.getLockInfo() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    thread.put(<span class="string">&quot;lock&quot;</span>, info.getLockInfo().toString());</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> thread;</span><br><span class="line">            &#125;)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">            </span><br><span class="line">        dump.put(<span class="string">&quot;threads&quot;</span>, threads);</span><br><span class="line">        <span class="keyword">return</span> dump;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/debug/gc&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">triggerGC</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.warn(<span class="string">&quot;Manually triggering garbage collection - this should not be done in production&quot;</span>);</span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;GC triggered&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Remote-Debugging-Configuration"><a href="#Remote-Debugging-Configuration" class="headerlink" title="Remote Debugging Configuration"></a>Remote Debugging Configuration</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-debug</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span>  <span class="comment"># Single replica for debugging</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5005</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">debug</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JAVA_OPTS</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&gt;-</span></span><br><span class="line"><span class="string">            -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005</span></span><br><span class="line"><span class="string">            -XX:+UseContainerSupport</span></span><br><span class="line"><span class="string">            -XX:MaxRAMPercentage=75.0</span></span><br><span class="line"><span class="string"></span>        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-debug-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">java-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">debug</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5005</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">5005</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure>

<h3 id="Port-Forwarding-for-Local-Debugging"><a href="#Port-Forwarding-for-Local-Debugging" class="headerlink" title="Port Forwarding for Local Debugging"></a>Port Forwarding for Local Debugging</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Forward application port</span></span><br><span class="line">kubectl port-forward deployment/java-app 8080:8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># Forward debug port</span></span><br><span class="line">kubectl port-forward deployment/java-app-debug 5005:5005</span><br><span class="line"></span><br><span class="line"><span class="comment"># Forward multiple ports</span></span><br><span class="line">kubectl port-forward pod/&lt;pod-name&gt; 8080:8080 5005:5005</span><br><span class="line"></span><br><span class="line"><span class="comment"># Connect your IDE debugger to localhost:5005</span></span><br></pre></td></tr></table></figure>

<h3 id="Performance-Debugging-with-JVM-Tools"><a href="#Performance-Debugging-with-JVM-Tools" class="headerlink" title="Performance Debugging with JVM Tools"></a>Performance Debugging with JVM Tools</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execute JVM diagnostic commands in pod</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- jps -l</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- jstat -gc &lt;pid&gt; 5s</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- jstack &lt;pid&gt;</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- jmap -histo &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create heap dump</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- jcmd &lt;pid&gt; GC.run_finalization</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- jcmd &lt;pid&gt; VM.gc</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- jcmd &lt;pid&gt; GC.dump /tmp/heapdump.hprof</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy heap dump to local machine</span></span><br><span class="line">kubectl <span class="built_in">cp</span> &lt;pod-name&gt;:/tmp/heapdump.hprof ./heapdump.hprof</span><br></pre></td></tr></table></figure>

<h3 id="Network-Debugging"><a href="#Network-Debugging" class="headerlink" title="Network Debugging"></a>Network Debugging</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Network debugging pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">network-debug</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">network-tools</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nicolaka/netshoot</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/bash&quot;</span>]</span><br><span class="line">    <span class="attr">args:</span> [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;while true; do ping localhost; sleep 30;done&quot;</span>]</span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Test network connectivity</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it network-debug -- nslookup java-app-service</span><br><span class="line">kubectl <span class="built_in">exec</span> -it network-debug -- curl -v http://java-app-service:8080/health</span><br><span class="line">kubectl <span class="built_in">exec</span> -it network-debug -- telnet java-app-service 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check DNS resolution</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it network-debug -- dig java-app-service.default.svc.cluster.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test external connectivity</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it network-debug -- curl -v https://api.external-service.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Network policy testing</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it network-debug -- nc -zv java-app-service 8080</span><br></pre></td></tr></table></figure>

<h3 id="Debugging-Init-Containers"><a href="#Debugging-Init-Containers" class="headerlink" title="Debugging Init Containers"></a>Debugging Init Containers</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-with-init</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">wait-for-db</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">          echo &quot;Waiting for database...&quot;</span></span><br><span class="line"><span class="string">          until nc -z database-service 5432; do</span></span><br><span class="line"><span class="string">            echo &quot;Database not ready, waiting...&quot;</span></span><br><span class="line"><span class="string">            sleep 2</span></span><br><span class="line"><span class="string">          done</span></span><br><span class="line"><span class="string">          echo &quot;Database is ready!&quot;</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">migrate-db</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">migrate/migrate</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/migrate&quot;</span>]</span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;-path=/migrations&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;-database=postgresql://user:pass@database-service:5432/db?sslmode=disable&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;up&quot;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">migrations</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/migrations</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:1.0</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">migrations</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">db-migrations</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check init container logs</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -c wait-for-db</span><br><span class="line">kubectl logs &lt;pod-name&gt; -c migrate-db</span><br><span class="line"></span><br><span class="line"><span class="comment"># Describe pod to see init container status</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Application-Metrics-Debugging"><a href="#Application-Metrics-Debugging" class="headerlink" title="Application Metrics Debugging"></a>Application Metrics Debugging</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter httpRequestsTotal;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer httpRequestDuration;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Gauge activeConnections;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomMetrics</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.httpRequestsTotal = Counter.builder(<span class="string">&quot;http_requests_total&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Total HTTP requests&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.httpRequestDuration = Timer.builder(<span class="string">&quot;http_request_duration&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;HTTP request duration&quot;</span>)</span><br><span class="line">            .register(meterRegistry);</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">this</span>.activeConnections = Gauge.builder(<span class="string">&quot;active_connections&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;Active database connections&quot;</span>)</span><br><span class="line">            .register(meterRegistry, <span class="built_in">this</span>, CustomMetrics::getActiveConnections);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordRequest</span><span class="params">(String method, String endpoint, <span class="type">long</span> duration)</span> &#123;</span><br><span class="line">        httpRequestsTotal.increment(</span><br><span class="line">            Tags.of(<span class="string">&quot;method&quot;</span>, method, <span class="string">&quot;endpoint&quot;</span>, endpoint)</span><br><span class="line">        );</span><br><span class="line">        httpRequestDuration.record(duration, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getActiveConnections</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Return actual active connection count</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">10.0</span>; <span class="comment">// Placeholder</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Debugging-Persistent-Volumes"><a href="#Debugging-Persistent-Volumes" class="headerlink" title="Debugging Persistent Volumes"></a>Debugging Persistent Volumes</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check PV and PVC status</span></span><br><span class="line">kubectl get pv</span><br><span class="line">kubectl get pvc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Describe PVC for detailed info</span></span><br><span class="line">kubectl describe pvc java-app-storage</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check mounted volumes in pod</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- <span class="built_in">df</span> -h</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- <span class="built_in">ls</span> -la /app/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check file permissions</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- <span class="built_in">ls</span> -la /app/data</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- <span class="built_in">id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Test file creation</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- <span class="built_in">touch</span> /app/data/test.txt</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- <span class="built_in">echo</span> <span class="string">&quot;test&quot;</span> &gt; /app/data/test.txt</span><br></pre></td></tr></table></figure>

<h3 id="Resource-Usage-Investigation"><a href="#Resource-Usage-Investigation" class="headerlink" title="Resource Usage Investigation"></a>Resource Usage Investigation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check resource usage</span></span><br><span class="line">kubectl top pods</span><br><span class="line">kubectl top nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get detailed resource information</span></span><br><span class="line">kubectl describe node &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check resource quotas</span></span><br><span class="line">kubectl get resourcequota</span><br><span class="line">kubectl describe resourcequota</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check limit ranges</span></span><br><span class="line">kubectl get limitrange</span><br><span class="line">kubectl describe limitrange</span><br></pre></td></tr></table></figure>

<h3 id="Debugging-ConfigMaps-and-Secrets"><a href="#Debugging-ConfigMaps-and-Secrets" class="headerlink" title="Debugging ConfigMaps and Secrets"></a>Debugging ConfigMaps and Secrets</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check ConfigMap content</span></span><br><span class="line">kubectl get configmap java-app-config -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check Secret content (base64 encoded)</span></span><br><span class="line">kubectl get secret java-app-secrets -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decode secret values</span></span><br><span class="line">kubectl get secret java-app-secrets -o jsonpath=<span class="string">&#x27;&#123;.data.database-password&#125;&#x27;</span> | <span class="built_in">base64</span> --decode</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check mounted config in pod</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- <span class="built_in">cat</span> /app/config/application.properties</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- <span class="built_in">env</span> | grep -i database</span><br></pre></td></tr></table></figure>

<h3 id="Automated-Debugging-Script"><a href="#Automated-Debugging-Script" class="headerlink" title="Automated Debugging Script"></a>Automated Debugging Script</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">APP_NAME=<span class="string">&quot;java-app&quot;</span></span><br><span class="line">NAMESPACE=<span class="string">&quot;default&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Kubernetes Debugging Report for <span class="variable">$APP_NAME</span> ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Timestamp: <span class="subst">$(date)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Pod Status ===&quot;</span></span><br><span class="line">kubectl get pods -l app=<span class="variable">$APP_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Recent Events ===&quot;</span></span><br><span class="line">kubectl get events --sort-by=.metadata.creationTimestamp -n <span class="variable">$NAMESPACE</span> | <span class="built_in">tail</span> -10</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Pod Description ===&quot;</span></span><br><span class="line">POD_NAME=$(kubectl get pods -l app=<span class="variable">$APP_NAME</span> -n <span class="variable">$NAMESPACE</span> -o jsonpath=<span class="string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>)</span><br><span class="line">kubectl describe pod <span class="variable">$POD_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Application Logs (last 50 lines) ===&quot;</span></span><br><span class="line">kubectl logs <span class="variable">$POD_NAME</span> -n <span class="variable">$NAMESPACE</span> --<span class="built_in">tail</span>=50</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Resource Usage ===&quot;</span></span><br><span class="line">kubectl top pod <span class="variable">$POD_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Service Status ===&quot;</span></span><br><span class="line">kubectl get svc -l app=<span class="variable">$APP_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== ConfigMap Status ===&quot;</span></span><br><span class="line">kubectl get configmap -l app=<span class="variable">$APP_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Secret Status ===&quot;</span></span><br><span class="line">kubectl get secret -l app=<span class="variable">$APP_NAME</span> -n <span class="variable">$NAMESPACE</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Network Connectivity Test ===&quot;</span></span><br><span class="line">kubectl run debug-pod --<span class="built_in">rm</span> -i --restart=Never --image=nicolaka/netshoot -- \</span><br><span class="line">  /bin/bash -c <span class="string">&quot;nslookup <span class="variable">$APP_NAME</span>-service.<span class="variable">$NAMESPACE</span>.svc.cluster.local &amp;&amp; \</span></span><br><span class="line"><span class="string">                curl -s -o /dev/null -w &#x27;%&#123;http_code&#125;&#x27; http://<span class="variable">$APP_NAME</span>-service.<span class="variable">$NAMESPACE</span>.svc.cluster.local:8080/health&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Explain-Ingress-and-how-to-expose-Java-applications-externally"><a href="#Explain-Ingress-and-how-to-expose-Java-applications-externally" class="headerlink" title="Explain Ingress and how to expose Java applications externally"></a>Explain Ingress and how to expose Java applications externally</h2><h3 id="Reference-Answer-11"><a href="#Reference-Answer-11" class="headerlink" title="Reference Answer"></a>Reference Answer</h3><p>Ingress provides HTTP and HTTPS routing to services within a Kubernetes cluster, acting as a reverse proxy and load balancer for external traffic.</p>
<h3 id="Ingress-Architecture"><a href="#Ingress-Architecture" class="headerlink" title="Ingress Architecture"></a>Ingress Architecture</h3><pre>
<code class="mermaid">
graph TB
INTERNET[Internet] --&gt; LB[Load Balancer]
LB --&gt; INGRESS[Ingress Controller]

subgraph &quot;Kubernetes Cluster&quot;
    INGRESS --&gt; INGRESS_RULES[Ingress Rules]
    INGRESS_RULES --&gt; SVC1[Java App Service]
    INGRESS_RULES --&gt; SVC2[API Service]
    INGRESS_RULES --&gt; SVC3[Frontend Service]
    
    SVC1 --&gt; POD1[Java App Pods]
    SVC2 --&gt; POD2[API Pods]
    SVC3 --&gt; POD3[Frontend Pods]
end
</code>
</pre>

<h3 id="Basic-Ingress-Configuration"><a href="#Basic-Ingress-Configuration" class="headerlink" title="Basic Ingress Configuration"></a>Basic Ingress Configuration</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-body-size:</span> <span class="string">&quot;10m&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-connect-timeout:</span> <span class="string">&quot;60&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-send-timeout:</span> <span class="string">&quot;60&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-read-timeout:</span> <span class="string">&quot;60&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">myapp.example.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">myapp-tls</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">myapp.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">java-app-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="Advanced-Ingress-with-Path-based-Routing"><a href="#Advanced-Ingress-with-Path-based-Routing" class="headerlink" title="Advanced Ingress with Path-based Routing"></a>Advanced Ingress with Path-based Routing</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">microservices-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/$2</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/use-regex:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-body-size:</span> <span class="string">&quot;50m&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rate-limit:</span> <span class="string">&quot;100&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rate-limit-window:</span> <span class="string">&quot;1m&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">api.example.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">api-tls</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">api.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="comment"># User service</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/api/users(/|$)(.*)</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">user-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">      <span class="comment"># Order service  </span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/api/orders(/|$)(.*)</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">      <span class="comment"># Payment service</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/api/payments(/|$)(.*)</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">payment-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">      <span class="comment"># Default fallback</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/(.*)</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">frontend-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="Java-Application-Configuration-for-Ingress"><a href="#Java-Application-Configuration-for-Ingress" class="headerlink" title="Java Application Configuration for Ingress"></a>Java Application Configuration for Ingress</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Handle base path properly</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/health&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">health</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; health = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        health.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        health.put(<span class="string">&quot;service&quot;</span>, <span class="string">&quot;order-service&quot;</span>);</span><br><span class="line">        health.put(<span class="string">&quot;path&quot;</span>, request.getRequestURI());</span><br><span class="line">        health.put(<span class="string">&quot;forwardedPath&quot;</span>, request.getHeader(<span class="string">&quot;X-Forwarded-Prefix&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(health);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;OrderDto&gt;&gt; <span class="title function_">getOrders</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">            HttpServletRequest request)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Log forwarded headers for debugging</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">forwardedFor</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;X-Forwarded-For&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">forwardedProto</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;X-Forwarded-Proto&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">forwardedHost</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;X-Forwarded-Host&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;Request from: &#123;&#125; via &#123;&#125; to &#123;&#125;&quot;</span>, forwardedFor, forwardedProto, forwardedHost);</span><br><span class="line">        </span><br><span class="line">        List&lt;OrderDto&gt; orders = orderService.getOrders(page, size);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(orders);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-Configuration-for-Proxy-Headers"><a href="#Spring-Boot-Configuration-for-Proxy-Headers" class="headerlink" title="Spring Boot Configuration for Proxy Headers"></a>Spring Boot Configuration for Proxy Headers</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/</span></span><br><span class="line">  <span class="attr">forward-headers-strategy:</span> <span class="string">native</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">remoteip:</span></span><br><span class="line">      <span class="attr">remote-ip-header:</span> <span class="string">X-Forwarded-For</span></span><br><span class="line">      <span class="attr">protocol-header:</span> <span class="string">X-Forwarded-Proto</span></span><br><span class="line">      <span class="attr">port-header:</span> <span class="string">X-Forwarded-Port</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">base-path:</span> <span class="string">/actuator</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">health,info,metrics,prometheus</span></span><br></pre></td></tr></table></figure>

<h3 id="SSL-TLS-Certificate-Management"><a href="#SSL-TLS-Certificate-Management" class="headerlink" title="SSL&#x2F;TLS Certificate Management"></a>SSL&#x2F;TLS Certificate Management</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Using cert-manager for automatic SSL certificates</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">cert-manager.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterIssuer</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">letsencrypt-prod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">acme:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">https://acme-v02.api.letsencrypt.org/directory</span></span><br><span class="line">    <span class="attr">email:</span> <span class="string">admin@example.com</span></span><br><span class="line">    <span class="attr">privateKeySecretRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">letsencrypt-prod</span></span><br><span class="line">    <span class="attr">solvers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">http01:</span></span><br><span class="line">        <span class="attr">ingress:</span></span><br><span class="line">          <span class="attr">class:</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-ssl-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">cert-manager.io/cluster-issuer:</span> <span class="string">&quot;letsencrypt-prod&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">myapp.example.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">myapp-tls-auto</span>  <span class="comment"># Will be created by cert-manager</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">myapp.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">java-app-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="Ingress-with-Authentication"><a href="#Ingress-with-Authentication" class="headerlink" title="Ingress with Authentication"></a>Ingress with Authentication</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-auth-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-type:</span> <span class="string">basic</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-secret:</span> <span class="string">basic-auth</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-realm:</span> <span class="string">&#x27;Authentication Required&#x27;</span></span><br><span class="line">    <span class="comment"># Or OAuth2 authentication</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-url:</span> <span class="string">&quot;https://auth.example.com/oauth2/auth&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-signin:</span> <span class="string">&quot;https://auth.example.com/oauth2/start&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">secure.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">java-app-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Basic auth secret</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">basic-auth</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">auth:</span> <span class="string">YWRtaW46JGFwcjEkSDY1dnVhNU8kblNEOC9ObDBINFkwL3pmWUZOcUI4MQ==</span>  <span class="comment"># admin:admin</span></span><br></pre></td></tr></table></figure>

<h3 id="Custom-Error-Pages"><a href="#Custom-Error-Pages" class="headerlink" title="Custom Error Pages"></a>Custom Error Pages</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">custom-error-pages</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">404.html:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Page Not Found&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;style&gt;</span></span><br><span class="line"><span class="string">            body &#123; font-family: Arial, sans-serif; text-align: center; margin-top: 50px; &#125;</span></span><br><span class="line"><span class="string">            .error-code &#123; font-size: 72px; color: #e74c3c; &#125;</span></span><br><span class="line"><span class="string">            .error-message &#123; font-size: 24px; color: #7f8c8d; &#125;</span></span><br><span class="line"><span class="string">        &lt;/style&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;error-code&quot;&gt;404&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;error-message&quot;&gt;The page you&#x27;re looking for doesn&#x27;t exist.&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;a href=&quot;/&quot;&gt;Go back to homepage&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string"></span>  <span class="attr">500.html:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Internal Server Error&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;style&gt;</span></span><br><span class="line"><span class="string">            body &#123; font-family: Arial, sans-serif; text-align: center; margin-top: 50px; &#125;</span></span><br><span class="line"><span class="string">            .error-code &#123; font-size: 72px; color: #e74c3c; &#125;</span></span><br><span class="line"><span class="string">            .error-message &#123; font-size: 24px; color: #7f8c8d; &#125;</span></span><br><span class="line"><span class="string">        &lt;/style&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;error-code&quot;&gt;500&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;error-message&quot;&gt;Something went wrong on our end.&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;Please try again later.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-custom-errors</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/custom-http-errors:</span> <span class="string">&quot;404,500,503&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/default-backend:</span> <span class="string">error-pages-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">myapp.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">java-app-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="Load-Balancing-and-Session-Affinity"><a href="#Load-Balancing-and-Session-Affinity" class="headerlink" title="Load Balancing and Session Affinity"></a>Load Balancing and Session Affinity</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-app-sticky-sessions</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/affinity:</span> <span class="string">&quot;cookie&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/affinity-mode:</span> <span class="string">&quot;persistent&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/session-cookie-name:</span> <span class="string">&quot;JSESSIONID&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/session-cookie-expires:</span> <span class="string">&quot;86400&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/session-cookie-max-age:</span> <span class="string">&quot;86400&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/session-cookie-path:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/upstream-hash-by:</span> <span class="string">&quot;$remote_addr&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">myapp.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">java-app-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="Ingress-Health-Checks-and-Monitoring"><a href="#Ingress-Health-Checks-and-Monitoring" class="headerlink" title="Ingress Health Checks and Monitoring"></a>Ingress Health Checks and Monitoring</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IngressHealthController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/health/ingress&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">ingressHealth</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; health = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        health.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        health.put(<span class="string">&quot;timestamp&quot;</span>, Instant.now());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Include request information for debugging</span></span><br><span class="line">        Map&lt;String, String&gt; requestInfo = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        requestInfo.put(<span class="string">&quot;remoteAddr&quot;</span>, request.getRemoteAddr());</span><br><span class="line">        requestInfo.put(<span class="string">&quot;forwardedFor&quot;</span>, request.getHeader(<span class="string">&quot;X-Forwarded-For&quot;</span>));</span><br><span class="line">        requestInfo.put(<span class="string">&quot;forwardedProto&quot;</span>, request.getHeader(<span class="string">&quot;X-Forwarded-Proto&quot;</span>));</span><br><span class="line">        requestInfo.put(<span class="string">&quot;forwardedHost&quot;</span>, request.getHeader(<span class="string">&quot;X-Forwarded-Host&quot;</span>));</span><br><span class="line">        requestInfo.put(<span class="string">&quot;userAgent&quot;</span>, request.getHeader(<span class="string">&quot;User-Agent&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        health.put(<span class="string">&quot;request&quot;</span>, requestInfo);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(health);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/ready&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">readiness</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Perform readiness checks</span></span><br><span class="line">        <span class="keyword">if</span> (isApplicationReady()) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;Ready&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(<span class="number">503</span>).body(<span class="string">&quot;Not Ready&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isApplicationReady</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Check database connectivity, external services, etc.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Ingress-Controller-Configuration"><a href="#Ingress-Controller-Configuration" class="headerlink" title="Ingress Controller Configuration"></a>Ingress Controller Configuration</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-configuration</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># Global settings</span></span><br><span class="line">  <span class="attr">proxy-connect-timeout:</span> <span class="string">&quot;60&quot;</span></span><br><span class="line">  <span class="attr">proxy-send-timeout:</span> <span class="string">&quot;60&quot;</span></span><br><span class="line">  <span class="attr">proxy-read-timeout:</span> <span class="string">&quot;60&quot;</span></span><br><span class="line">  <span class="attr">proxy-body-size:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Performance tuning</span></span><br><span class="line">  <span class="attr">worker-processes:</span> <span class="string">&quot;auto&quot;</span></span><br><span class="line">  <span class="attr">worker-connections:</span> <span class="string">&quot;1024&quot;</span></span><br><span class="line">  <span class="attr">keepalive-timeout:</span> <span class="string">&quot;65&quot;</span></span><br><span class="line">  <span class="attr">keepalive-requests:</span> <span class="string">&quot;100&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Security headers</span></span><br><span class="line">  <span class="attr">add-headers:</span> <span class="string">&quot;ingress-nginx/custom-headers&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Compression</span></span><br><span class="line">  <span class="attr">enable-gzip:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">gzip-types:</span> <span class="string">&quot;text/plain text/css application/json application/javascript text/xml application/xml&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Rate limiting</span></span><br><span class="line">  <span class="attr">rate-limit:</span> <span class="string">&quot;1000&quot;</span></span><br><span class="line">  <span class="attr">rate-limit-window:</span> <span class="string">&quot;1m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">custom-headers</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">X-Content-Type-Options:</span> <span class="string">&quot;nosniff&quot;</span></span><br><span class="line">  <span class="attr">X-Frame-Options:</span> <span class="string">&quot;DENY&quot;</span></span><br><span class="line">  <span class="attr">X-XSS-Protection:</span> <span class="string">&quot;1; mode=block&quot;</span></span><br><span class="line">  <span class="attr">Strict-Transport-Security:</span> <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span></span><br><span class="line">  <span class="attr">Content-Security-Policy:</span> <span class="string">&quot;default-src &#x27;self&#x27;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Testing-Ingress-Configuration"><a href="#Testing-Ingress-Configuration" class="headerlink" title="Testing Ingress Configuration"></a>Testing Ingress Configuration</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Test basic connectivity</span></span><br><span class="line">curl -H <span class="string">&quot;Host: myapp.example.com&quot;</span> http://&lt;ingress-ip&gt;/health</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test SSL</span></span><br><span class="line">curl -H <span class="string">&quot;Host: myapp.example.com&quot;</span> https://&lt;ingress-ip&gt;/health</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test with custom headers</span></span><br><span class="line">curl -H <span class="string">&quot;Host: myapp.example.com&quot;</span> -H <span class="string">&quot;X-Custom-Header: test&quot;</span> http://&lt;ingress-ip&gt;/api/orders</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test different paths</span></span><br><span class="line">curl -H <span class="string">&quot;Host: api.example.com&quot;</span> http://&lt;ingress-ip&gt;/api/users/health</span><br><span class="line">curl -H <span class="string">&quot;Host: api.example.com&quot;</span> http://&lt;ingress-ip&gt;/api/orders/health</span><br><span class="line"></span><br><span class="line"><span class="comment"># Debug ingress controller logs</span></span><br><span class="line">kubectl logs -n ingress-nginx deployment/ingress-nginx-controller -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check ingress status</span></span><br><span class="line">kubectl get ingress</span><br><span class="line">kubectl describe ingress java-app-ingress</span><br></pre></td></tr></table></figure>

<p>This comprehensive guide covers the essential Kubernetes concepts and practical implementations that senior Java developers need to understand when working with containerized applications in production environments. </p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/k8s/" rel="tag"># k8s</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/07/28/Java-Basic-Interview-Questions-Reference-Answers/" rel="prev" title="Java Basic Interview Questions-Reference Answers">
                  <i class="fa fa-angle-left"></i> Java Basic Interview Questions-Reference Answers
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/09/11/Design-File-Storage-Service-with-GCS-and-Postgrel/" rel="next" title="Design File Storage Service with GCS and PostgreSQL">
                  Design File Storage Service with GCS and PostgreSQL <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Charlie Feng</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
